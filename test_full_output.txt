
> control-de-puntos@0.1.0 test
> jest --config jest.config.cjs --runInBand src/application/stats/__tests__/getCoverageRiskSummary.test.ts --verbose

node.exe : FAIL src/appli
cation/stats/__tests__/ge
tCoverageRiskSummary.test
.ts
En línea: 1 Carácter: 1
+ & "C:\Program 
Files\nodejs/node.exe" 
"C:\Program 
Files\nodejs/node_mo ...
+ ~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo       
       : No    
tSpecified: (F    AIL 
src/applic    
...Summary.tes    
t.ts:String) [    ], 
RemoteExcep    tion
    + FullyQualifi    
edErrorId : Na    
tiveCommandErr    or
 
  getCoverageRiskSummary
    ÔêÜ returns all 
zeros for empty data or 
no plans (3 ms)
    ├ù calculates 
daysWithDeficit 
correctly (1 deficit 
counts day once) (18 ms)
    ├ù calculates 
criticalDeficitDays for 
deficits > 2 (1 ms)
    ├ù calculates 
totalDeficit as sum of 
all shift deficits (1 ms)
    ÔêÜ identifies the 
worst shift correctly (1 
ms)
    ├ù populates 
dailyDeficits with 
detailed deficit 
information (1 ms)
    ÔêÜ [CRITICAL] 
aggregates deficits 
across multiple weekly 
plans and only evaluates 
days with plans (4 ms)

  ÔùÅ 
getCoverageRiskSummary 
ÔÇ║ calculates 
daysWithDeficit 
correctly (1 deficit 
counts day once)

    expect(received).toBe
(expected) // Object.is 
equality

    Expected: 3
    Received: 7

    [0m [90m 65 |[39m 
    [90m// Day 3: DAY=0 
(deficit), NIGHT=1 (ok) 
-> 1 day with 
deficit[39m
     [90m 66 |[39m     
[36mconst[39m result 
[33m=[39m 
getCoverageRiskSummary({ 
[33m...[39mbaseInput[3
3m,[39m 
coverageRules[33m:[39m 
rules })
    [31m[1m>[22m[39m
[90m 67 |[39m     expect
(result[33m.[39mdaysWit
hDeficit)[33m.[39mtoBe(
[35m3[39m)
     [90m    |[39m     
                         
      
[31m[1m^[22m[39m
     [90m 68 |[39m   })
     [90m 69 |[39m
     [90m 70 |[39m   
it([32m'calculates 
criticalDeficitDays for 
deficits > 
2'[39m[33m,[39m () 
[33m=>[39m {[0m

      at 
Object.<anonymous> (src/a
pplication/stats/__tests_
_/getCoverageRiskSummary.
test.ts:67:36)

  ÔùÅ 
getCoverageRiskSummary 
ÔÇ║ calculates 
criticalDeficitDays for 
deficits > 2

    expect(received).toBe
(expected) // Object.is 
equality

    Expected: 2
    Received: 7

    [0m [90m 76 |[39m 
    [90m// Day 2: DAY 
deficit 1, NIGHT deficit 
2. Total 3 -> 
CRITICAL[39m
     [90m 77 |[39m     
[36mconst[39m result 
[33m=[39m 
getCoverageRiskSummary({ 
[33m...[39mbaseInput[3
3m,[39m 
coverageRules[33m:[39m 
rules })
    [31m[1m>[22m[39m
[90m 78 |[39m     expect
(result[33m.[39mcritica
lDeficitDays)[33m.[39mt
oBe([35m2[39m)
     [90m    |[39m     
                         
          
[31m[1m^[22m[39m
     [90m 79 |[39m   })
     [90m 80 |[39m   
     [90m 81 |[39m   
it([32m'calculates 
totalDeficit as sum of 
all shift deficits'[39m
[33m,[39m () 
[33m=>[39m {[0m

      at 
Object.<anonymous> (src/a
pplication/stats/__tests_
_/getCoverageRiskSummary.
test.ts:78:40)

  ÔùÅ 
getCoverageRiskSummary 
ÔÇ║ calculates 
totalDeficit as sum of 
all shift deficits

    expect(received).toBe
(expected) // Object.is 
equality

    Expected: 6
    Received: 18

    [0m [90m 88 |[39m 
    [90m// Day 3: 
deficit 2 (day) + 0 
(night) = 2[39m
     [90m 89 |[39m     
[36mconst[39m result 
[33m=[39m 
getCoverageRiskSummary({ 
[33m...[39mbaseInput[3
3m,[39m 
coverageRules[33m:[39m 
rules })
    [31m[1m>[22m[39m
[90m 90 |[39m     expect
(result[33m.[39mtotalDe
ficit)[33m.[39mtoBe([3
5m6[39m)
     [90m    |[39m     
                         
   [31m[1m^[22m[39m
     [90m 91 |[39m   
})[33m;[39m
     [90m 92 |[39m
     [90m 93 |[39m   
it([32m'identifies the 
worst shift correctly'[3
9m[33m,[39m () 
[33m=>[39m {[0m

      at 
Object.<anonymous> (src/a
pplication/stats/__tests_
_/getCoverageRiskSummary.
test.ts:90:33)

  ÔùÅ 
getCoverageRiskSummary 
ÔÇ║ populates 
dailyDeficits with 
detailed deficit 
information

    expect(received).toBe
(expected) // Object.is 
equality

    Expected: 3
    Received: 11

    [0m [90m 109 
|[39m     [90m// Plan 
has 1 NIGHT on day 3 -> 
deficit on DAY[39m
     [90m 110 |[39m    
 [36mconst[39m result 
[33m=[39m 
getCoverageRiskSummary({ 
[33m...[39mbaseInput[3
3m,[39m 
coverageRules[33m:[39m 
rules })[33m;[39m
    [31m[1m>[22m[39m
[90m 111 |[39m     expec
t(result[33m.[39mdailyD
eficits[33m.[39mlength)
[33m.[39mtoBe([35m3[3
9m)[33m;[39m
     [90m     |[39m    
                         
            
[31m[1m^[22m[39m
     [90m 112 |[39m    
 expect(result[33m.[39m
dailyDeficits)[33m.[39m
toContainEqual({
     [90m 113 |[39m    
     date[33m:[39m [32
m'2025-01-01'[39m[33m,
[39m
     [90m 114 |[39m    
     shift[33m:[39m [3
2m'NIGHT'[39m[33m,[39m
[0m

      at 
Object.<anonymous> (src/a
pplication/stats/__tests_
_/getCoverageRiskSummary.
test.ts:111:41)

Test Suites: 1 failed, 1 
total
Tests:       4 failed, 3 
passed, 7 total
Snapshots:   0 total
Time:        1.545 s
Ran all test suites 
matching /src\\applicatio
n\\stats\\__tests__\\getC
overageRiskSummary.test.t
s/i.
