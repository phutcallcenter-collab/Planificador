(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3652:function(e,t,n){Promise.resolve().then(n.bind(n,3951))},3951:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return nb}});var i=n(7437),r=n(2265),a=n(9625),o=n(4391);let s=[],l=[],d=[],c={specialDays:[{date:"2024-12-25",kind:"HOLIDAY",label:"Navidad"},{date:"2025-01-01",kind:"HOLIDAY",label:"A\xf1o Nuevo"},{date:"2025-01-06",kind:"HOLIDAY",label:"D\xeda de los Reyes Magos"},{date:"2025-01-21",kind:"HOLIDAY",label:"D\xeda de la Altagracia"},{date:"2025-01-26",kind:"HOLIDAY",label:"D\xeda de Duarte"},{date:"2025-02-27",kind:"HOLIDAY",label:"D\xeda de la Independencia"},{date:"2025-04-18",kind:"HOLIDAY",label:"Viernes Santo"},{date:"2025-05-01",kind:"HOLIDAY",label:"D\xeda del Trabajo"},{date:"2025-06-19",kind:"HOLIDAY",label:"Corpus Christi"},{date:"2025-08-16",kind:"HOLIDAY",label:"D\xeda de la Restauraci\xf3n"},{date:"2025-09-24",kind:"HOLIDAY",label:"D\xeda de las Mercedes"},{date:"2025-11-06",kind:"HOLIDAY",label:"D\xeda de la Constituci\xf3n"},{date:"2025-12-25",kind:"HOLIDAY",label:"Navidad"},{date:"2026-01-01",kind:"HOLIDAY",label:"A\xf1o Nuevo"},{date:"2026-01-06",kind:"HOLIDAY",label:"D\xeda de los Reyes Magos"},{date:"2026-01-21",kind:"HOLIDAY",label:"D\xeda de la Altagracia"},{date:"2026-01-26",kind:"HOLIDAY",label:"D\xeda de Duarte"},{date:"2026-02-27",kind:"HOLIDAY",label:"D\xeda de la Independencia"},{date:"2026-04-03",kind:"HOLIDAY",label:"Viernes Santo"},{date:"2026-05-01",kind:"HOLIDAY",label:"D\xeda del Trabajo"},{date:"2026-06-04",kind:"HOLIDAY",label:"Corpus Christi"},{date:"2026-08-16",kind:"HOLIDAY",label:"D\xeda de la Restauraci\xf3n"},{date:"2026-09-24",kind:"HOLIDAY",label:"D\xeda de las Mercedes"},{date:"2026-11-06",kind:"HOLIDAY",label:"D\xeda de la Constituci\xf3n"},{date:"2026-12-25",kind:"HOLIDAY",label:"Navidad"}]},p=[{id:"global-day",scope:{type:"SHIFT",shift:"DAY"},required:10},{id:"global-night",scope:{type:"SHIFT",shift:"NIGHT"},required:6}],x=[],u=[],f=[];function g(){return{representatives:s,incidents:l,specialSchedules:d,effectivePeriods:[],calendar:c,coverageRules:p,version:7,historyEvents:x,auditLog:u,swaps:f}}var h=n(960);let y="baseState",b="singleton",m=void 0!==window.indexedDB;class v{async loadState(){if(!m)return null;try{let e=await this.openDatabase(),t=await e.get(y,b);return e.close(),null!=t?t:null}catch(e){return console.error("Failed to load state from IndexedDB:",e),null}}async saveState(e){if(m)try{let t=await this.openDatabase();await t.put(y,e,b),t.close()}catch(e){throw console.error("Failed to save state to IndexedDB:",e),e}}openDatabase(){return m?(0,h.X3)("control-puntos-db",7,{upgrade(e){e.objectStoreNames.contains(y)||e.createObjectStore(y)}}):Promise.resolve({get:()=>Promise.resolve(void 0),put:()=>Promise.resolve(void 0),close:()=>{}})}}class j{async loadState(){try{let e=await fetch("".concat(this.baseUrl,"/state"));if(!e.ok){if(404===e.status)return null;throw Error("Failed to load state: ".concat(e.statusText))}return await e.json()}catch(e){return console.error("HTTP Load Error:",e),null}}async saveState(e){try{let t=await fetch("".concat(this.baseUrl,"/state"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to save state: ".concat(t.statusText))}catch(e){throw console.error("HTTP Save Error:",e),e}}constructor(e){this.baseUrl=e}}var S=n(257);let I=S.env.NEXT_PUBLIC_BACKEND_URL?new j(S.env.NEXT_PUBLIC_BACKEND_URL):new v;async function C(){var e,t,n,i,r,a,o,s;let l=await I.loadState();return l?(null!==(e=l.incidents)&&void 0!==e||(l.incidents=[]),null!==(t=l.historyEvents)&&void 0!==t||(l.historyEvents=[]),null!==(n=l.auditLog)&&void 0!==n||(l.auditLog=[]),null!==(i=l.swaps)&&void 0!==i||(l.swaps=[]),null!==(r=l.specialSchedules)&&void 0!==r||(l.specialSchedules=[]),null!==(a=l.coverageRules)&&void 0!==a||(l.coverageRules=[]),null!==(o=l.representatives)&&void 0!==o||(l.representatives=[]),null!==(s=l.effectivePeriods)&&void 0!==s||(l.effectivePeriods=[]),l):null}async function D(e){return I.saveState(e)}var k=n(9651),E=n(5696),A=n(936),R=n(9121),w=n(1747),O=n(183),N=n(3993);function z(e,t,n){let i=new Date(e,t,0).getDate(),r=[];for(let n=1;n<=i;n++){let i=function(e,t,n){let i=e=>e.toString().padStart(2,"0");return"".concat(e,"-").concat(i(t),"-").concat(i(n))}(e,t,n);r.push(function(e){let[t,n,i]=e.split("-").map(Number);return{date:e,dayOfWeek:(0,N.w)(new Date(t,n-1,i)),kind:"WORKING",isSpecial:!1}}(i))}return function(e,t){let n=new Map(t.specialDays.map(e=>[e.date,e]));return e.map(e=>{let t=n.get(e.date);return t?{...e,...t,isSpecial:!0}:e})}(r,n)}var T=n(6698),M=n(5778);function W(e,t,n){var i,r,a;let o;if(!Array.isArray(t)||!e.startDate||!(0,T.J)((0,A.D)(e.startDate)))return console.warn("[resolveIncidentDates] Invalid arguments (calendar days or incident date) for incident ".concat(e.id,". Skipping resolution.")),{incident:e,dates:[],start:null,end:null};let s=[],l="VACACIONES"===e.type?null!==(i=e.duration)&&void 0!==i?i:14:null!==(r=e.duration)&&void 0!==r?r:1;if(l<=0)return{incident:e,dates:[],start:e.startDate,end:e.startDate};let d=new Map(t.map(e=>[e.date,e])),c=(0,A.D)(e.startDate),p=0,x=3*l+30,u=0;for(;p<l&&u<x;){let t=(0,M.c)(c,{representation:"date"}),i=d.get(t);u++;let r=!1;switch(e.type){case"LICENCIA":r=!0;break;case"VACACIONES":if(i){let e="HOLIDAY"!==i.kind;if(n){let t=c.getUTCDay(),i="OFF"===n.baseSchedule[t];e=e&&!i}r=e}break;default:0===s.length&&(r=!0)}if(r&&(s.push(t),p++),"LICENCIA"!==e.type&&"VACACIONES"!==e.type&&1===p)break;c=(0,R.E)(c,1)}let f=s[s.length-1];if(f&&("VACACIONES"===e.type||"LICENCIA"===e.type)){let e=(0,R.E)((0,A.D)(f),1);for(let t=0;t<14;t++){let t=(0,M.c)(e,{representation:"date"}),i=d.get(t),r=!1;if((null==i?void 0:i.kind)!=="HOLIDAY"){if(n){let t=e.getUTCDay();r="OFF"!==n.baseSchedule[t]}else r=!0}if(r){o=t;break}e=(0,R.E)(e,1)}}else f&&(o=(0,M.c)((0,R.E)((0,A.D)(f),1),{representation:"date"}));return{incident:e,dates:s,start:null!==(a=s[0])&&void 0!==a?a:e.startDate,end:null!=f?f:e.startDate,returnDate:o}}function L(e,t,n){return t>n&&"VACACIONES"!==e?{ok:!1,code:"CANNOT_REGISTER_IN_FUTURE",message:'Las incidencias de tipo "'.concat(e,'" no pueden registrarse en fechas futuras.')}:{ok:!0}}let B={AUSENCIA:{weekday:3,weekend:6},TARDANZA:{weekday:2,weekend:3},ERROR:{weekday:2,weekend:2}};function F(e){if(!e.startDate||"LICENCIA"===e.type||"VACACIONES"===e.type||"OVERRIDE"===e.type)return 0;if("OTRO"===e.type){var t;return Number(null!==(t=e.customPoints)&&void 0!==t?t:0)}let n=function(e){let t=e.getDay();return 5===t||6===t||0===t}(function(e){let[t,n,i]=e.split("-").map(Number);return new Date(t,n-1,i)}(e.startDate)),i=B[e.type];return i?n?i.weekend:i.weekday:0}function H(e,t,n){let i=e.filter(e=>e.startDate&&e.startDate.startsWith(t)),r={};for(let e of n)r[e.id]={representativeId:e.id,name:e.name,incidents:[],totals:{puntos:0,ausencias:0,tardanzas:0,errores:0},riskLevel:"ok"};for(let e of i){let t=r[e.representativeId];if(!t)continue;let n=F(e);switch(t.incidents.push({...e,points:n}),t.totals.puntos+=n,e.type){case"AUSENCIA":t.totals.ausencias++;break;case"TARDANZA":t.totals.tardanzas++;break;case"ERROR":t.totals.errores++}}let a=Object.values(r).map(e=>(e.totals.puntos>=10||e.totals.ausencias>=2||e.totals.tardanzas>=3||e.totals.errores>=2?e.riskLevel="danger":e.totals.puntos>0&&(e.riskLevel="warning"),e)),o={totalPoints:0,totalIncidents:0,ausencias:0,tardanzas:0,errores:0};return a.forEach(e=>{o.totalPoints+=e.totals.puntos,o.totalIncidents+=e.incidents.length,o.ausencias+=e.totals.ausencias,o.tardanzas+=e.totals.tardanzas,o.errores+=e.totals.errores}),{month:t,byPerson:a,totals:o}}function P(e,t){let n={id:"audit-".concat(crypto.randomUUID()),timestamp:new Date().toISOString(),...t};e.auditLog.unshift(n)}function U(e){switch(e){case"TARDANZA":return"Tardanza";case"AUSENCIA":return"Ausencia";case"ERROR":return"Error";case"OTRO":return"Otro";case"VACACIONES":return"Vacaciones";case"LICENCIA":return"Licencia";case"OVERRIDE":return"Cambio de turno";default:return"Incidencia"}}function V(e,t){let n=e=>{var n,i;return null!==(i=null===(n=t.find(t=>t.id===e))||void 0===n?void 0:n.name)&&void 0!==i?i:"—"};switch(e.type){case"COVER":return"".concat(n(e.toRepresentativeId)," cubre a ").concat(n(e.fromRepresentativeId));case"DOUBLE":return"".concat(n(e.representativeId)," realiza doble turno");case"SWAP":return"".concat(n(e.fromRepresentativeId)," intercambia turno con ").concat(n(e.toRepresentativeId));default:return"Movimiento de turno registrado"}}function Y(e,t){var n,i;return t&&null!==(i=null===(n=e.find(e=>e.id===t))||void 0===n?void 0:n.name)&&void 0!==i?i:"—"}function G(e,t,n){let i=e.filter(e=>(!n||e.id!==n)&&e.representativeId===t.representativeId&&t.startDate<=e.endDate&&e.startDate<=t.endDate);if(i.length>0){let e=i.map(e=>"".concat(e.startDate," to ").concat(e.endDate)).join(", ");return"Este per\xedodo se solapa con per\xedodos existentes: ".concat(e)}return null}let Z=(0,a.Ue)()((0,o.n)((e,t)=>({...g(),isLoading:!0,planningAnchorDate:new Date().toISOString().split("T")[0],allCalendarDaysForRelevantMonths:[],confirmState:null,detailModalState:{isOpen:!1,personId:null,month:null},vacationConfirmationState:null,mixedShiftConfirmModalState:null,undoStack:[],async initialize(){let n=await C();if(n)e(e=>{Object.assign(e,n),e.representatives.forEach((e,t)=>{void 0===e.orderIndex&&(e.orderIndex=t)}),e.isLoading=!1});else{let t=g();e(e=>{Object.assign(e,t),e.isLoading=!1}),await D(t)}t()._generateCalendarDays()},setPlanningAnchorDate:n=>{e(e=>{let t=(0,k.WU)((0,E.z)((0,A.D)(n),{weekStartsOn:1}),"yyyy-MM-dd");e.planningAnchorDate=t}),t()._generateCalendarDays()},_generateCalendarDays:()=>{e(e=>{if(!e.calendar)return;let t=new Date(e.planningAnchorDate+"T12:00:00Z"),n=new Map;for(let i=-6;i<=18;i++){let r=(0,R.E)(t,30*i);z((0,w.S)(r),(0,O.j)(r)+1,e.calendar).forEach(e=>{n.has(e.date)||n.set(e.date,e)})}e.allCalendarDaysForRelevantMonths=Array.from(n.values())})},addOrUpdateCoverageRule:n=>{let{addHistoryEvent:i}=t();i({category:"RULE",title:"Regla de cobertura actualizada",description:n.label||n.id,impact:"M\xednimo ".concat(n.required," pers."),metadata:{rule:n}}),e(e=>{let t=Math.max(0,Math.floor(n.required)),i={...n,required:t};e.coverageRules.some(e=>e.id===i.id)?e.coverageRules=e.coverageRules.map(e=>e.id===i.id?i:e):e.coverageRules.push(i)})},removeCoverageRule:n=>{let{addHistoryEvent:i,coverageRules:r}=t(),a=r.find(e=>e.id===n);a&&i({category:"RULE",title:"Regla de cobertura eliminada",description:a.label||a.id,metadata:{rule:a}}),e(e=>{e.coverageRules=e.coverageRules.filter(e=>e.id!==n)})},addOrUpdateSpecialDay:n=>{let{addHistoryEvent:i}=t();i({category:"CALENDAR",title:"D\xeda especial actualizado",subject:n.date,description:n.label,impact:n.kind,metadata:{day:n}}),e(e=>{let t=e.calendar.specialDays.filter(e=>e.date!==n.date);e.calendar.specialDays=[...t,n]}),t()._generateCalendarDays()},removeSpecialDay:n=>{let{addHistoryEvent:i}=t();i({category:"CALENDAR",title:"Excepci\xf3n de d\xeda eliminada",subject:n}),e(e=>{e.calendar.specialDays=e.calendar.specialDays.filter(e=>e.date!==n)}),t()._generateCalendarDays()},resetState:async n=>{let{showConfirm:i}=t();await i({title:"⚠️ \xbfReiniciar la planificaci\xf3n?",description:"Esto restaurar\xe1 el estado a los valores iniciales. Esta acci\xf3n no se puede deshacer.",intent:"danger",confirmLabel:"S\xed, reiniciar"})&&(e(e=>{let t=g(),i=[];n&&(i=e.incidents.filter(e=>"LICENCIA"===e.type||"VACACIONES"===e.type),t.incidents=i),Object.assign(e,t,{isLoading:!1})}),t()._generateCalendarDays())},addIncident:async function(n){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{representatives:r,incidents:a,allCalendarDaysForRelevantMonths:o,showConfirm:s}=t(),l=r.find(e=>e.id===n.representativeId);if(!l)return{ok:!1,reason:"Representante no encontrado."};let d={id:"incident-".concat(crypto.randomUUID()),createdAt:new Date().toISOString(),...n},c=function(e,t,n,i,r){if("OVERRIDE"===e.type)return{ok:!0};let a=(0,k.WU)(new Date,"yyyy-MM-dd"),o=L(e.type,e.startDate,a);if(!o.ok)return{ok:!1,code:o.code,message:o.message};let s=W(e,n,i);if(0===s.dates.length&&"VACACIONES"===e.type)return{ok:!1,code:"NO_WORKING_DAYS_FOR_VACATION",message:"No se encontraron d\xedas laborables para iniciar las vacaciones."};if(0===s.dates.length&&"LICENCIA"===e.type&&e.duration>0)return{ok:!1,code:"NO_DAYS_FOR_LICENSE",message:"La duraci\xf3n de la licencia debe ser de al menos 1 d\xeda."};let l=s.dates,d=t.filter(t=>t.representativeId===e.representativeId),c=new Map(r.map(e=>[e.id,e]));if("AUSENCIA"!==e.type){for(let e of l)if(d.some(t=>t.startDate===e&&"AUSENCIA"===t.type))return{ok:!1,code:"BLOCKED_BY_ABSENCE",message:"No se pueden registrar eventos en un d\xeda con ausencia (".concat(e,").")}}for(let i of t)if(i.representativeId===e.representativeId&&i.id!==e.id&&("VACACIONES"===i.type||"LICENCIA"===i.type)){let t=c.get(i.representativeId);if(!t)continue;let r=W(i,n,t).dates;if(l.some(e=>r.includes(e)))return{ok:!1,code:"OVERLAP_WITH_FORMAL_INCIDENT",message:"VACACIONES"===e.type||"LICENCIA"===e.type?"El rango de fechas se solapa con una ".concat("VACACIONES"===i.type?"vacaci\xf3n":"licencia"," existente."):"El d\xeda seleccionado est\xe1 cubierto por una ".concat("VACACIONES"===i.type?"vacaci\xf3n":"licencia"," existente.")}}return"TARDANZA"===e.type&&d.some(t=>t.id!==e.id&&t.startDate===e.startDate&&"TARDANZA"===t.type)?{ok:!1,code:"DUPLICATE_TARDY",message:"Ya existe una tardanza registrada para este d\xeda."}:"AUSENCIA"===e.type&&d.some(t=>t.startDate===e.startDate&&"OVERRIDE"!==t.type)?{ok:!0,warning:"Registrar una ausencia en esta fecha eliminar\xe1 otras incidencias existentes para este representante en el mismo d\xeda. \xbfDesea continuar?"}:{ok:!0}}(d,a,o,l,r);if(!c.ok)return{ok:!1,reason:c.message};let p=i;if(!p){if(c.warning)p=await s({title:"Confirmar Acci\xf3n",description:c.warning,intent:"warning",confirmLabel:"Continuar"});else{let e="OVERRIDE"===d.type;p=await s({title:e?"Confirmar Cambio de Turno":"Confirmar Incidencia",description:"Registrar ".concat(e?"una modificaci\xf3n manual":U(d.type)," a ").concat(Y(r,d.representativeId),"."),intent:"info",confirmLabel:e?"Aplicar Cambio":"Registrar"})}if(!p)return{ok:!1,reason:"Acci\xf3n cancelada por el usuario."}}let{addHistoryEvent:x,addAuditEvent:u,pushUndo:f}=t();return x({category:"INCIDENT",title:"".concat(U(d.type)," registrada"),subject:l.name,impact:"OVERRIDE"!==d.type&&"VACACIONES"!==d.type&&"LICENCIA"!==d.type?"-".concat(F(d)," pts"):void 0,description:d.note}),u({actor:{id:"admin",name:"Administrador"},action:"INCIDENT_CREATED",target:{entity:"INCIDENT",entityId:d.id,label:U(d.type)},context:{date:d.startDate,representativeId:d.representativeId,reason:d.note}}),e(e=>{if("AUSENCIA"===d.type){let t=e.incidents.filter(e=>e.representativeId===d.representativeId&&e.startDate===d.startDate);t.length>0&&x({category:"SYSTEM",title:"Incidencias limpiadas por AUSENCIA",subject:l.name,description:"Se eliminaron ".concat(t.length," evento(s) previos.")}),e.incidents=e.incidents.filter(e=>!(e.representativeId===d.representativeId&&e.startDate===d.startDate))}if(e.incidents.some(e=>e.id===d.id)||e.incidents.push(d),"OVERRIDE"!==d.type&&f({label:"".concat(U(d.type)," registrada: ").concat(l.name),undo:()=>t().removeIncident(d.id)}),"VACACIONES"===d.type){let t=W(d,o,l);t.dates.length>0&&(e.vacationConfirmationState={isOpen:!0,repName:l.name,startDate:t.start||d.startDate,endDate:t.end||d.startDate,returnDate:t.returnDate||d.startDate,workingDays:t.dates.length})}}),{ok:!0,newId:d.id}},removeIncident:n=>{let{incidents:i,representatives:r,addHistoryEvent:a,addAuditEvent:o}=t(),s=i.find(e=>e.id===n);if(!s)return;let l=Y(r,s.representativeId);a({category:"INCIDENT",title:"Incidencia eliminada: ".concat(U(s.type)),subject:l,metadata:{incident:s}}),o({actor:{id:"admin",name:"Administrador"},action:"INCIDENT_DELETED",target:{entity:"INCIDENT",entityId:s.id,label:U(s.type)},context:{date:s.startDate,representativeId:s.representativeId,reason:"Eliminaci\xf3n manual"}}),e(e=>{e.incidents=e.incidents.filter(e=>e.id!==n)})},removeIncidents:n=>{let{incidents:i,representatives:r,pushUndo:a,addHistoryEvent:o}=t(),s=i.filter(e=>n.includes(e.id));if(0===s.length)return;let l=Y(r,s[0].representativeId);o({category:"INCIDENT",title:"".concat(s.length," incidencia(s) eliminada(s)"),subject:l,description:"Tipo: ".concat(U(s[0].type)),metadata:{incidents:s}}),e(e=>{s.forEach(t=>{"OVERRIDE"!==t.type&&P(e,{action:"INCIDENT_DELETED",actor:{id:"admin",name:"Administrador"},target:{entity:"INCIDENT",entityId:t.id,label:U(t.type)},context:{date:t.startDate,representativeId:t.representativeId,reason:"Eliminaci\xf3n m\xfaltiple"}})}),e.incidents=e.incidents.filter(e=>!n.includes(e.id))}),a({label:"Restauradas ".concat(s.length," incidencias de ").concat(l),undo:()=>{o({category:"SYSTEM",title:'Incidencias restauradas por "Deshacer"',subject:l,metadata:{incidents:s}}),e(e=>{e.incidents.push(...s)})}})},addSwap:n=>{let{addHistoryEvent:i,representatives:r,pushUndo:a}=t(),o={id:"swap-".concat(crypto.randomUUID()),createdAt:new Date().toISOString(),...n};e(e=>{e.swaps.push(o)}),i({category:"PLANNING",title:"Cobertura registrada",description:V(o,r),metadata:{swap:o}}),a({label:"Cobertura cancelada: ".concat(V(o,r).substring(0,50),"..."),undo:()=>{e(e=>{e.swaps=e.swaps.filter(e=>e.id!==o.id)}),i({category:"SYSTEM",title:"Cambio de turno deshecho",description:"Se revirti\xf3: ".concat(V(o,r))})}})},removeSwap:t=>{e(e=>{e.swaps=e.swaps.filter(e=>e.id!==t)})},deactivateRepresentative:async n=>{let{showConfirm:i,representatives:r,normalizeOrderIndexes:a}=t(),o=Y(r,n),s=r.find(e=>e.id===n);await i({title:"\xbfDesactivar Representante?",description:"Est\xe1s a punto de desactivar a ".concat(o,". No aparecer\xe1 en los nuevos planes, pero su historial se conservar\xe1. \xbfEst\xe1s seguro?"),intent:"warning",confirmLabel:"S\xed, desactivar"})&&(e(e=>{let t=e.representatives.findIndex(e=>e.id===n);-1!==t&&(e.representatives[t].isActive=!1)}),(null==s?void 0:s.baseShift)&&a(s.baseShift))},showConfirm:t=>new Promise(n=>{e(e=>{e.confirmState={options:t,resolve:n}})}),handleConfirm:t=>{e(e=>{e.confirmState&&(e.confirmState.resolve(t),e.confirmState=null)})},showMixedShiftConfirmModal:(t,n,i)=>new Promise(r=>{e(e=>{e.mixedShiftConfirmModalState={isOpen:!0,representativeId:t,date:n,activeShift:i,resolve:r}})}),handleMixedShiftConfirm:t=>{e(e=>{e.mixedShiftConfirmModalState&&(e.mixedShiftConfirmModalState.resolve(t),e.mixedShiftConfirmModalState=null)})},addRepresentative:t=>{e(e=>{e.representatives.push({id:crypto.randomUUID(),...t,isActive:!0})})},updateRepresentative:t=>{e(e=>{let n=e.representatives.findIndex(e=>e.id===t.id);-1!==n&&(e.representatives[n]={...e.representatives[n],...t})})},reorderRepresentatives:(n,i)=>{e(e=>{let t=e.representatives.filter(e=>e.baseShift===n&&e.isActive);if(i.length!==t.length){console.warn("⚠️ Orden incompleto ignorado. Esperado:",t.length,"Recibido:",i.length);return}i.forEach((t,i)=>{let r=e.representatives.find(e=>e.id===t);r&&r.baseShift===n&&(r.orderIndex=i)})}),t().addHistoryEvent({category:"SETTINGS",title:"Orden de ".concat("DAY"===n?"D\xeda":"Noche"," actualizado"),description:"Se reordenaron los representantes del turno"})},normalizeOrderIndexes:t=>{e(e=>{e.representatives.filter(e=>e.baseShift===t&&e.isActive).sort((e,t)=>e.orderIndex-t.orderIndex).forEach((e,t)=>{e.orderIndex=t})})},addSpecialSchedule:t=>{e(e=>{let n={id:"ss-".concat(crypto.randomUUID()),...t};e.specialSchedules.push(n)})},removeSpecialSchedule:t=>{e(e=>{e.specialSchedules=e.specialSchedules.filter(e=>e.id!==t)})},addEffectivePeriod:n=>{let{effectivePeriods:i}=t(),r=G(i,n);return r?{success:!1,error:r}:(e(e=>{let t={id:"ep-".concat(crypto.randomUUID()),createdAt:new Date().toISOString().split("T")[0],...n};e.effectivePeriods.push(t)}),{success:!0})},updateEffectivePeriod:(n,i)=>{let{effectivePeriods:r}=t(),a=r.find(e=>e.id===n);if(!a)return{success:!1,error:"Per\xedodo no encontrado"};let o=G(r,{...a,...i},n);return o?{success:!1,error:o}:(e(e=>{let t=e.effectivePeriods.find(e=>e.id===n);t&&Object.assign(t,i)}),{success:!0})},deleteEffectivePeriod:t=>{e(e=>{e.effectivePeriods=e.effectivePeriods.filter(e=>e.id!==t)})},openDetailModal:(t,n)=>{e({detailModalState:{isOpen:!0,personId:t,month:n}})},closeDetailModal:()=>{e({detailModalState:{isOpen:!1,personId:null,month:null}})},addHistoryEvent:t=>{e(e=>{let n={id:"hist-".concat(crypto.randomUUID()),timestamp:new Date().toISOString(),...t};e.historyEvents.unshift(n)})},addAuditEvent:t=>{e(e=>{P(e,t)})},pushUndo:function(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,{commitUndo:r}=t();e(e=>{let t="undo-".concat(crypto.randomUUID()),a=window.setTimeout(()=>{r(t)},i),o=e.undoStack.findIndex(e=>e.id===t);o>-1&&(clearTimeout(e.undoStack[o].timeoutId),e.undoStack.splice(o,1)),e.undoStack.push({...n,id:t,timeoutId:a})})},commitUndo:t=>{e(e=>{e.undoStack=e.undoStack.filter(e=>e.id!==t)})},executeUndo:e=>{let{undoStack:n,commitUndo:i}=t(),r=n.find(t=>t.id===e);r&&(clearTimeout(r.timeoutId),r.undo(),i(e))},closeVacationConfirmation:()=>{e({vacationConfirmationState:null})},exportState:()=>{let{representatives:e,incidents:n,calendar:i,coverageRules:r,swaps:a,specialSchedules:o,effectivePeriods:s,historyEvents:l,auditLog:d,version:c}=t();return{representatives:e,incidents:n,calendar:i,coverageRules:r,swaps:a,specialSchedules:o,effectivePeriods:s,historyEvents:l,auditLog:d,version:c}},importState:n=>{var i,r,a,o,s,l,d;let c={...g(),representatives:Array.isArray(n.representatives)?n.representatives:[],incidents:Array.isArray(n.incidents)?n.incidents:[],calendar:null!==(i=n.calendar)&&void 0!==i?i:g().calendar,coverageRules:null!==(r=n.coverageRules)&&void 0!==r?r:[],swaps:null!==(a=n.swaps)&&void 0!==a?a:[],historyEvents:null!==(o=n.historyEvents)&&void 0!==o?o:[],auditLog:null!==(s=n.auditLog)&&void 0!==s?s:[],specialSchedules:null!==(l=n.specialSchedules)&&void 0!==l?l:[],effectivePeriods:null!==(d=n.effectivePeriods)&&void 0!==d?d:[],version:7};return e(e=>{Object.assign(e,c,{isLoading:!1,planningAnchorDate:new Date().toISOString().split("T")[0],confirmState:null,mixedShiftConfirmModalState:null,vacationConfirmationState:null,undoStack:[]})}),t()._generateCalendarDays(),{success:!0,message:"Estado importado correctamente."}}})));var _=n(413),K=n(8614),q=n(521);function X(e){let{content:t,children:n}=e,[a,o]=r.useState(!1);return t?(0,i.jsxs)("div",{className:"relative inline-block",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onFocus:()=>o(!0),onBlur:()=>o(!1),children:[n,(0,i.jsx)(K.M,{children:a&&(0,i.jsx)(q.E.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},transition:{duration:.15,ease:"easeOut"},style:{position:"absolute",zIndex:50,bottom:"100%",marginBottom:"8px",left:"50%",transform:"translateX(-50%)",padding:"8px 12px",borderRadius:"6px",fontSize:"12px",color:"white",backgroundColor:"hsl(0, 0%, 13%)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",whiteSpace:"nowrap"},children:t})})]}):(0,i.jsx)(i.Fragment,{children:n})}var J=n(401),Q=n(5929),$=n(9388);let ee={WORKING:{bg:"#ffffff",fg:"#15803d",icon:J.Z},OFF:{bg:"transparent",fg:"#9ca3af",border:"none"},VACATION:{bg:"hsl(200, 70%, 94%)",fg:"hsl(200, 55%, 30%)"},LICENSE:{bg:"hsl(265, 60%, 95%)",fg:"hsl(265, 40%, 35%)"},HOLIDAY:{bg:"hsl(142, 60%, 94%)",fg:"hsl(35, 90%, 30%)",border:"hsl(35, 90%, 60%)",icon:Q.Z},ABSENT:{bg:"hsl(0, 85%, 92%)",fg:"hsl(0, 70%, 25%)",border:"hsl(0, 85%, 60%)",icon:$.Z}},et=r.memo(function(e){let{resolved:t,onClick:n,onContextMenu:r}=e,a=ee[t.variant],o=a.icon,s={flex:1,padding:"10px 8px",textAlign:"center",fontSize:"12px",fontWeight:600,userSelect:"none",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",background:a.bg,color:a.fg,border:a.border?"1px solid ".concat(a.border):"1px solid #eee",borderLeft:"1px solid #eee",cursor:t.canEdit?"pointer":"default",opacity:t.canEdit?1:.6,borderRadius:"6px",transition:"background-color 120ms ease, transform 100ms ease, box-shadow 120ms ease"};return(0,i.jsx)("div",{role:"gridcell","aria-label":t.ariaLabel,"aria-disabled":!t.canEdit,tabIndex:0,style:s,onClick:t.canEdit?n:void 0,onContextMenu:t.canContextMenu?r:void 0,onKeyDown:e=>{t.canEdit&&("Enter"===e.key||" "===e.key)&&(e.preventDefault(),n())},children:(0,i.jsx)(X,{content:t.tooltip,children:(0,i.jsxs)("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[o&&(0,i.jsx)(o,{size:14,strokeWidth:2}),t.label&&(0,i.jsx)("span",{children:t.label})]})})})}),en=r.memo(function(e){let{agent:t,weekDays:n,activeShift:r,assignmentsMap:a,isAlternate:o,onCellClick:s,onCellContextMenu:l}=e,{representatives:d}=Z(e=>({representatives:e.representatives}));return(0,i.jsxs)("div",{style:{display:"flex",alignItems:"stretch",borderBottom:"1px solid #eee",minHeight:"45px",background:o?"#f9fafb":"white"},children:[(0,i.jsx)("div",{style:{padding:"8px 12px",fontWeight:500,width:"".concat(220,"px"),minWidth:"".concat(220,"px"),display:"flex",alignItems:"center"},children:t.name}),(0,i.jsx)("div",{style:{flex:1,display:"flex",gap:"4px",paddingRight:"4px"},children:n.map(e=>{var n,o,d,c,p,x,u;let f=(d=null===(o=a[t.id])||void 0===o?void 0:null===(n=o[e.date])||void 0===n?void 0:n[r],c=e,p=t,x=0,"AUSENCIA"===d.reason?{variant:"ABSENT",label:"AUS",tooltip:(c.date,"".concat(p.name," deb\xeda trabajar este d\xeda pero no se present\xf3.")),ariaLabel:"".concat(p.name," estuvo ausente el ").concat(c.date),canEdit:!1,canContextMenu:!1}:"VACACIONES"===d.reason?{variant:"VACATION",label:"VAC",tooltip:"".concat(p.name," est\xe1 de vacaciones."),ariaLabel:"".concat(p.name," est\xe1 de vacaciones"),canEdit:!1,canContextMenu:!1}:"LICENCIA"===d.reason?{variant:"LICENSE",label:"LIC",tooltip:"".concat(p.name," est\xe1 de licencia."),ariaLabel:"".concat(p.name," est\xe1 de licencia"),canEdit:!1,canContextMenu:!1}:d.shouldWork?c.isSpecial?{variant:"HOLIDAY",label:"FER",tooltip:(u=c.label,"".concat(p.name," trabaja en feriado").concat(u?" (".concat(u,")"):"",". Este d\xeda se compensa fuera del planner.")),ariaLabel:"".concat(p.name," trabaja en feriado: ").concat(c.label||"feriado"),canEdit:!0,canContextMenu:!0}:{variant:"WORKING",tooltip:(c.date,"".concat(p.name," trabaja normalmente este d\xeda.")),ariaLabel:"".concat(p.name," trabaja normalmente"),canEdit:!0,canContextMenu:!0}:{variant:"OFF",label:"OFF",tooltip:"D\xeda libre habitual de ".concat(p.name,"."),ariaLabel:"".concat(p.name," no trabaja este d\xeda"),canEdit:!0,canContextMenu:!0});return(0,i.jsx)(et,{resolved:f,repId:t.id,date:e.date,onClick:()=>s(t.id,e.date),onContextMenu:n=>l(t.id,e.date,n)},e.date)})})]})});function ei(e){let{index:t,style:n,data:r}=e,{agents:a,weeklyPlan:o,weekDays:s,activeShift:l,assignmentsMap:d,onCellClick:c,onCellContextMenu:p}=r,x=a[t];return x?(0,i.jsx)("div",{style:n,children:(0,i.jsx)(en,{agent:x,weeklyPlan:o,weekDays:s,activeShift:l,assignmentsMap:d,isAlternate:t%2!=0,onCellClick:c,onCellContextMenu:p})}):null}function er(e){let{weeklyPlan:t,weekDays:n,agents:a,activeShift:o,assignmentsMap:s,onCellClick:l,onCellContextMenu:d,onEditDay:c}=e,p=r.useMemo(()=>({agents:a,weeklyPlan:t,weekDays:n,activeShift:o,assignmentsMap:s,onCellClick:l,onCellContextMenu:d}),[a,t,n,o,s,l,d]);return(0,i.jsxs)("div",{style:{height:"calc(100vh - 280px)",width:"100%"},children:[(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"".concat(220,"px repeat(7, 1fr)"),borderBottom:"1px solid #e5e7eb",paddingBottom:"10px",fontWeight:600,background:"#f9fafb",color:"#374151",position:"sticky",top:0,zIndex:10},children:[(0,i.jsx)("div",{style:{paddingLeft:"16px"},children:"Agente"}),n.map(e=>(0,i.jsxs)("div",{style:{textAlign:"center",cursor:"pointer",color:e.isSpecial?"#b45309":"inherit"},onClick:()=>c(e),children:[(0,i.jsx)("div",{children:new Date(e.date+"T12:00:00Z").toLocaleDateString("es-ES",{weekday:"short"}).toUpperCase()}),(0,i.jsx)("div",{style:{fontSize:"12px",fontWeight:400},children:e.date.split("-")[2]})]},e.date))]}),(0,i.jsx)("div",{style:{height:"calc(100% - ${HEADER_HEIGHT}px)",width:"100%",overflow:"auto"},children:(0,i.jsx)(_.S_,{height:window.innerHeight-280-48,itemCount:a.length,itemSize:()=>44,width:"100%",itemData:p,children:ei})})]})}function ea(e){var t;let{day:n,onClose:a,onSave:o,onClear:s}=e,[l,d]=(0,r.useState)("HOLIDAY"===n.kind?"HOLIDAY":"WORKING"),[c,p]=(0,r.useState)(null!==(t=n.label)&&void 0!==t?t:"");(0,r.useEffect)(()=>{var e;d("HOLIDAY"===n.kind?"HOLIDAY":"WORKING"),p(null!==(e=n.label)&&void 0!==e?e:"")},[n]),n.dayOfWeek;let x={width:"100%",padding:"10px",fontSize:"14px",border:"1px solid var(--border-strong)",borderRadius:"6px",boxSizing:"border-box"},u={padding:"10px 15px",border:"none",borderRadius:"6px",fontSize:"14px",cursor:"pointer",fontWeight:600};return(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:a,children:(0,i.jsxs)("div",{style:{background:"var(--bg-panel)",padding:"25px",borderRadius:"12px",width:"400px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.1)"},onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("h2",{style:{marginTop:0,marginBottom:"20px",color:"var(--text-main)"},children:["Editar D\xeda:"," ",new Date(n.date+"T12:00:00Z").toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})]}),(0,i.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:500,color:"var(--text-main)"},children:"Tipo de D\xeda"}),(0,i.jsxs)("select",{value:l,onChange:e=>d(e.target.value),style:x,children:[(0,i.jsx)("option",{value:"WORKING",children:"Laborable"}),(0,i.jsx)("option",{value:"HOLIDAY",children:"Feriado (Laborable)"})]}),(0,i.jsxs)("p",{style:{fontSize:12,color:"var(--text-muted)",marginTop:"5px"},children:["El estado base de este d\xeda es: ",(0,i.jsx)("strong",{children:"Laborable"}),"."]})]}),(0,i.jsxs)("div",{style:{marginBottom:"25px"},children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:500,color:"var(--text-main)"},children:"Etiqueta (opcional)"}),(0,i.jsx)("input",{type:"text",value:c,onChange:e=>p(e.target.value),placeholder:"Ej: Navidad, D\xeda del Trabajador",style:x})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,i.jsx)("div",{children:n.isSpecial&&(0,i.jsx)("button",{onClick:()=>{s(n.date),a()},style:{...u,background:"#fee2e2",color:"#991b1b"},children:"Quitar Excepci\xf3n"})}),(0,i.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,i.jsx)("button",{onClick:a,style:{...u,background:"#f3f4f6",color:"var(--text-main)"},children:"Cancelar"}),(0,i.jsx)("button",{onClick:()=>{o({date:n.date,kind:l,label:c.trim()||void 0}),a()},style:{...u,background:"#111827",color:"white"},children:"Guardar Cambios"})]})]})]})})}let eo=(0,r.createContext)(null);function es(){let e=(0,r.useContext)(eo);if(!e)throw Error("useEditMode must be used within an EditModeProvider");return e}function el(e){let{children:t}=e,[n,a]=(0,r.useState)("NORMAL"),o=(0,r.useCallback)(()=>{a("ADMIN_OVERRIDE")},[]),s=(0,r.useCallback)(()=>{a("NORMAL")},[]),l=(0,r.useCallback)(()=>{a(e=>"NORMAL"===e?"ADMIN_OVERRIDE":"NORMAL")},[]),d=(0,r.useMemo)(()=>({mode:n,isAdmin:"ADMIN_OVERRIDE"===n,enableAdmin:o,disableAdmin:s,toggle:l}),[n,o,s,l]);return(0,i.jsx)(eo.Provider,{value:d,children:t})}var ed=n(7226),ec=n(2489),ep=n(6865),ex=n(8906),eu=n(8428),ef=n(8867),eg=n(2934);function eh(e,t){return!!e&&e.has(t)}function ey(e){let{weeklyPlan:t,initialDate:n,initialShift:a,initialRepId:o,existingSwap:s,onClose:l}=e,{representatives:d,addSwap:c,planningAnchorDate:p,incidents:x,allCalendarDaysForRelevantMonths:u,removeSwap:f,addHistoryEvent:g,swaps:h}=Z(e=>({representatives:e.representatives,addSwap:e.addSwap,planningAnchorDate:e.planningAnchorDate,incidents:e.incidents,allCalendarDaysForRelevantMonths:e.allCalendarDaysForRelevantMonths,removeSwap:e.removeSwap,addHistoryEvent:e.addHistoryEvent,swaps:e.swaps})),{mode:y}=es(),[b,m]=(0,r.useState)(n||p),[v,j]=(0,r.useState)("SWAP"),[S,I]=(0,r.useState)(a||"DAY"),C=(0,r.useMemo)(()=>t?function(e){let{date:t,weeklyPlan:n,swaps:i,incidents:r,allCalendarDays:a,representatives:o}=e,s={daily:{}},l=i.filter(e=>e.date===t);for(let e of n.agents){let n=e.representativeId,i=e.days[t],d=null==i?void 0:i.assignment,c=new Set;d&&("SINGLE"===d.type?c.add(d.shift):"BOTH"===d.type&&(c.add("DAY"),c.add("NIGHT")));let p=o.find(e=>e.id===n),x=!!r.find(e=>!!(e.representativeId===n&&["VACACIONES","LICENCIA"].includes(e.type))&&W(e,a,p).dates.includes(t)),u=new Set;if(!x){let e=new Set(c);for(let t of l)"COVER"===t.type?(t.fromRepresentativeId===n&&e.has(t.shift)&&e.delete(t.shift),t.toRepresentativeId===n&&e.add(t.shift)):"DOUBLE"===t.type?t.representativeId===n&&e.add(t.shift):"SWAP"===t.type&&(t.fromRepresentativeId===n&&e.has(t.fromShift)&&(e.delete(t.fromShift),e.add(t.toShift)),t.toRepresentativeId===n&&e.has(t.toShift)&&(e.delete(t.toShift),e.add(t.fromShift)));e.forEach(e=>u.add(e))}s.daily[n]={effectiveShifts:u,baseShifts:c,isBlocked:x}}return s}({date:b,weeklyPlan:t,swaps:h,incidents:x,allCalendarDays:u,representatives:d}):{daily:{}},[b,t,h,x,u,d]),[D,k]=(0,r.useState)((null==s?void 0:s.type)||"COVER"),[E,A]=(0,r.useState)(o||(s&&"fromRepresentativeId"in s?s.fromRepresentativeId:"")||""),[R,w]=(0,r.useState)((s&&"toRepresentativeId"in s?s.toRepresentativeId:s&&"representativeId"in s?s.representativeId:"")||""),[O,N]=(0,r.useState)((null==s?void 0:s.note)||""),z=(0,r.useMemo)(()=>{if("COVER"===D&&E&&C.daily[E]){let e=Array.from(C.daily[E].baseShifts);if(1===e.length)return e[0]}return S},[D,E,S,C]),T=(0,r.useMemo)(()=>D&&b?function(e,t,n,i,r){let a=e=>e?r.daily[e]:void 0;if("COVER"===e||"SWAP"===e){if(!t||!n)return null;if(t===n)return"La operaci\xf3n requiere dos personas distintas."}if("DOUBLE"===e&&!n)return null;let o=a(t),s=a(n);return"COVER"===e?o&&s?o.isBlocked?"No se puede cubrir a alguien de vacaciones o licencia.":s.isBlocked?"No se puede cubrir con alguien de vacaciones o licencia.":eh(o.effectiveShifts,i)?eh(s.effectiveShifts,i)?"El representante que cubre no est\xe1 disponible en ese horario.":null:"El representante no tiene ese turno asignado para ser cubierto.":"Representante inv\xe1lido.":"SWAP"===e?o&&s?o.isBlocked||s.isBlocked?"No se puede intercambiar con alguien de vacaciones o licencia.":0===o.effectiveShifts.size||0===s.effectiveShifts.size?"Ambos representantes deben tener turnos asignados para intercambiar.":1===o.effectiveShifts.size&&1===s.effectiveShifts.size&&Array.from(o.effectiveShifts)[0]===Array.from(s.effectiveShifts)[0]?"El intercambio no tiene efecto: ambos trabajan el mismo turno.":null:"Representante inv\xe1lido.":"DOUBLE"===e?s?s.isBlocked?"No se puede asignar doble turno a alguien de vacaciones o licencia.":eh(s.effectiveShifts,i)?"El representante ya trabaja ese turno.":null:"Representante inv\xe1lido.":"Operaci\xf3n no v\xe1lida."}(D,E,R,z,C):null,[D,E,R,b,z,C]),M=(0,r.useMemo)(()=>!T&&("COVER"===D||"SWAP"===D?!!(E&&R&&b):"DOUBLE"===D&&!!(R&&b)),[D,E,R,T,b]),L=(0,r.useMemo)(()=>{if(!M||!E&&"DOUBLE"!==D||!R)return null;let e=Y(d,E),t=Y(d,R);if("COVER"===D){let n="DAY"===z?"D\xeda":"Noche";return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("strong",{children:t})," cubrir\xe1 el turno ",(0,i.jsx)("strong",{children:n})," ","de ",(0,i.jsx)("strong",{children:e}),".",(0,i.jsx)("br",{}),(0,i.jsx)("span",{style:{fontSize:"12px",color:"#6b7280"},children:"Este cambio aplica para el d\xeda seleccionado."})]})}if("SWAP"===D){var n,r;let a=null===(n=C.daily[E])||void 0===n?void 0:n.effectiveShifts,o=null===(r=C.daily[R])||void 0===r?void 0:r.effectiveShifts;if(a&&o&&1===a.size&&1===o.size){let n=Array.from(a)[0],r=Array.from(o)[0];return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("strong",{children:e})," (Turno ",n,") y ",(0,i.jsx)("strong",{children:t})," (Turno ",r,") intercambian sus turnos."]})}return"Intercambio de turnos."}if("DOUBLE"===D){let e="DAY"===S?"D\xeda":"Noche";return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("strong",{children:t})," har\xe1 un turno DOBLE en"," ",(0,i.jsx)("strong",{children:e}),".",(0,i.jsx)("br",{}),(0,i.jsx)("span",{style:{fontSize:"12px",color:"#6b7280"},children:"Se cuenta como +1 en la cobertura."})]})}return null},[D,E,R,M,S,z,C,d]),B=()=>{if(!s)return"";if("COVER"===s.type){let e=Y(d,s.fromRepresentativeId),t=Y(d,s.toRepresentativeId),n="DAY"===s.shift?"D\xeda":"Noche";return"".concat(t," est\xe1 cubriendo el turno ").concat(n," de ").concat(e)}if("DOUBLE"===s.type){let e=Y(d,s.representativeId),t="DAY"===s.shift?"D\xeda":"Noche";return"".concat(e," tiene un turno doble en ").concat(t)}if("SWAP"===s.type){let e=Y(d,s.fromRepresentativeId),t=Y(d,s.toRepresentativeId);return"".concat(e," y ").concat(t," intercambiaron turnos")}return""},F={width:"100%",padding:"10px",backgroundColor:"#f9fafb",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",outline:"none",boxSizing:"border-box"},H={display:"block",fontSize:"11px",fontWeight:600,color:"#6b7280",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"6px"};return(0,i.jsx)("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50,padding:"16px"},onClick:l,children:(0,i.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",width:"100%",maxWidth:"500px",overflow:"hidden",display:"flex",flexDirection:"column",maxHeight:"90vh"},onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("div",{style:{backgroundColor:"#f9fafb",padding:"16px 24px",borderBottom:"1px solid #f3f4f6",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{style:{fontSize:"18px",fontWeight:700,color:"#111827",margin:0},children:"Gesti\xf3n de Cobertura"}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"8px"},children:[(0,i.jsx)("input",{type:"date",style:{fontSize:"13px",border:"1px solid #d1d5db",borderRadius:"4px",padding:"4px 8px",color:"#374151"},value:b,onChange:e=>m(e.target.value),disabled:!!s}),(0,i.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,i.jsxs)("button",{onClick:()=>I("DAY"),style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:600,cursor:"pointer",border:"DAY"===S?"1px solid #fcd34d":"1px solid #e5e7eb",backgroundColor:"DAY"===S?"#fffbeb":"white",color:"DAY"===S?"#b45309":"#6b7280",pointerEvents:s?"none":"auto",opacity:s?.7:1},children:[(0,i.jsx)(Q.Z,{size:12})," D\xeda"]}),(0,i.jsxs)("button",{onClick:()=>I("NIGHT"),style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:600,cursor:"pointer",border:"NIGHT"===S?"1px solid #c7d2fe":"1px solid #e5e7eb",backgroundColor:"NIGHT"===S?"#eef2ff":"white",color:"NIGHT"===S?"#4338ca":"#6b7280",pointerEvents:s?"none":"auto",opacity:s?.7:1},children:[(0,i.jsx)(ed.Z,{size:12})," Noche"]})]})]})]}),(0,i.jsx)("button",{onClick:l,style:{color:"#9ca3af",background:"none",border:"none",cursor:"pointer",padding:"4px"},children:(0,i.jsx)(ec.Z,{size:20})})]}),(0,i.jsx)("div",{style:{padding:"24px",overflowY:"auto",flex:1},children:s?(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[(0,i.jsxs)("div",{style:{background:"#fef3c7",border:"1px solid #fcd34d",borderRadius:"8px",padding:"16px",display:"flex",gap:"12px",alignItems:"flex-start"},children:[(0,i.jsx)(ep.Z,{size:24,color:"#b45309",style:{flexShrink:0}}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontWeight:600,color:"#92400e"},children:"Cambio de turno activo"}),(0,i.jsx)("div",{style:{fontSize:"14px",color:"#78350f",marginTop:"4px"},children:B()}),s.note&&(0,i.jsxs)("div",{style:{fontSize:"13px",fontStyle:"italic",marginTop:"8px",color:"#78350f"},children:["Nota: ",s.note]})]})]}),(0,i.jsx)("div",{style:{fontSize:"14px",color:"#6b7280",lineHeight:1.5},children:"Si eliminas este cambio, la celda volver\xe1 a su estado original seg\xfan el plan base (WORKING u OFF)."})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"12px",marginBottom:"24px"},children:[(0,i.jsx)(eb,{active:"COVER"===D,onClick:()=>k("COVER"),icon:ex.Z,label:"Cubrir",color:"blue"}),(0,i.jsx)(eb,{active:"SWAP"===D,onClick:()=>k("SWAP"),icon:eu.Z,label:"Intercambio",color:"green"}),(0,i.jsx)(eb,{active:"DOUBLE"===D,onClick:()=>k("DOUBLE"),icon:ef.Z,label:"Doble",color:"orange"})]}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px",marginBottom:"24px"},children:["DOUBLE"!==D&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:H,children:"SWAP"===D?"Qui\xe9n cede (Origen)":"Qui\xe9n necesita cobertura"}),(0,i.jsxs)("select",{style:F,value:E,onChange:e=>A(e.target.value),children:[(0,i.jsx)("option",{value:"",children:"Seleccionar representante..."}),d.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]}),"COVER"===D&&E&&C.daily[E]&&(0,i.jsxs)("div",{style:{marginTop:"8px",fontSize:"12px",color:"#6b7280",display:"flex",alignItems:"center",gap:"6px"},children:["DAY"===z?(0,i.jsx)(Q.Z,{size:14}):(0,i.jsx)(ed.Z,{size:14}),(0,i.jsxs)("span",{children:["Turno a cubrir:"," ",(0,i.jsx)("strong",{children:"DAY"===z?"D\xeda":"Noche"})]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:H,children:"DOUBLE"===D?"Qui\xe9n har\xe1 el doble turno":"SWAP"===D?"Con qui\xe9n intercambia":"Qui\xe9n va a cubrir"}),(0,i.jsxs)("select",{style:F,value:R,onChange:e=>w(e.target.value),children:[(0,i.jsx)("option",{value:"",children:"Seleccionar representante..."}),d.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),L&&!T&&(0,i.jsxs)("div",{style:{marginBottom:"24px",padding:"16px",backgroundColor:"#f9fafb",border:"1px solid #e5e7eb",borderRadius:"8px",display:"flex",gap:"12px",alignItems:"flex-start"},children:[(0,i.jsx)(eg.Z,{color:"#16a34a",size:18,style:{marginTop:"2px",flexShrink:0}}),(0,i.jsx)("div",{style:{fontSize:"14px",color:"#374151",lineHeight:"1.5"},children:L})]}),T&&(0,i.jsxs)("div",{style:{marginBottom:"24px",padding:"16px",backgroundColor:"#fef2f2",border:"1px solid #fee2e2",borderRadius:"8px",display:"flex",gap:"12px",alignItems:"flex-start"},children:[(0,i.jsx)(ep.Z,{color:"#ef4444",size:18,style:{marginTop:"2px",flexShrink:0}}),(0,i.jsx)("div",{style:{fontSize:"14px",color:"#b91c1c",fontWeight:500},children:T})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:H,children:"Nota Adicional (Opcional)"}),(0,i.jsx)("input",{style:F,placeholder:"Ej: Cambio autorizado por jefe de guardia...",value:O,onChange:e=>N(e.target.value)})]})]})}),(0,i.jsx)("div",{style:{padding:"16px",borderTop:"1px solid #f3f4f6",backgroundColor:"#f9fafb",display:"flex",justifyContent:"space-between",alignItems:"center"},children:s?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{style:{fontSize:"12px",color:"#9ca3af"},children:"Esta acci\xf3n no se puede deshacer."}),(0,i.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,i.jsx)("button",{onClick:l,style:{padding:"8px 16px",fontSize:"14px",fontWeight:500,color:"#4b5563",backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"8px",cursor:"pointer"},children:"Cancelar"}),"ADMIN_OVERRIDE"===y&&(0,i.jsx)("button",{onClick:()=>{s&&(f(s.id),g({category:"PLANNING",title:"Cambio de turno eliminado",description:B()}),l())},style:{padding:"8px 20px",fontSize:"14px",fontWeight:500,color:"white",backgroundColor:"#dc2626",border:"none",borderRadius:"8px",cursor:"pointer"},children:"Eliminar Cambio"})]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{style:{fontSize:"12px",color:"#9ca3af"},children:"Los cambios afectan solo a este d\xeda."}),(0,i.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,i.jsx)("button",{onClick:l,style:{padding:"8px 16px",fontSize:"14px",fontWeight:500,color:"#4b5563",backgroundColor:"transparent",border:"none",cursor:"pointer"},children:"Cancelar"}),(0,i.jsx)("button",{onClick:()=>{if(M&&(E||"DOUBLE"===D)){if("COVER"===D&&E)c({type:"COVER",date:b,shift:z,fromRepresentativeId:E,toRepresentativeId:R,note:O});else if("DOUBLE"===D&&R)c({type:"DOUBLE",date:b,shift:S,representativeId:R,note:O});else if("SWAP"===D&&E&&R){var e,t;let n=null===(e=C.daily[E])||void 0===e?void 0:e.effectiveShifts,i=null===(t=C.daily[R])||void 0===t?void 0:t.effectiveShifts;n&&i&&1===n.size&&1===i.size&&c({type:"SWAP",date:b,fromRepresentativeId:E,fromShift:Array.from(n)[0],toRepresentativeId:R,toShift:Array.from(i)[0],note:O})}l()}},disabled:!M,style:{padding:"8px 20px",fontSize:"14px",fontWeight:500,color:"white",backgroundColor:M?"#2563eb":"#d1d5db",border:"none",borderRadius:"8px",cursor:M?"pointer":"not-allowed",boxShadow:M?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none",transition:"all 0.2s"},children:"Confirmar"})]})]})})]})})}function eb(e){let{active:t,onClick:n,icon:r,label:a,color:o}=e,s=((e,t)=>{if(!t)return{backgroundColor:"white",borderColor:"#e5e7eb",color:"#4b5563"};switch(e){case"blue":return{backgroundColor:"#eff6ff",borderColor:"#bfdbfe",color:"#1d4ed8"};case"green":return{backgroundColor:"#f0fdf4",borderColor:"#bbf7d0",color:"#15803d"};case"orange":return{backgroundColor:"#fff7ed",borderColor:"#fed7aa",color:"#c2410c"};default:return{}}})(o,t);return(0,i.jsxs)("button",{onClick:n,style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"12px",borderRadius:"12px",border:"1px solid ".concat(s.borderColor),backgroundColor:s.backgroundColor,color:s.color,cursor:"pointer",transition:"all 0.2s",width:"100%"},children:[(0,i.jsx)(r,{size:24,style:{color:t?"inherit":"#9ca3af"},strokeWidth:1.5}),(0,i.jsx)("span",{style:{fontSize:"12px",fontWeight:600},children:a})]})}function em(e){let{onNavigateToSettings:t}=e;return(0,i.jsxs)("div",{style:{background:"#FFFFFF",padding:"20px",borderRadius:"12px",border:"1px solid #e5e7eb"},children:[(0,i.jsx)("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:"10px"},children:(0,i.jsx)("h3",{style:{margin:0,color:"#111827",fontSize:"16px"},children:"Demanda Operativa"})}),(0,i.jsx)("p",{style:{margin:"0 0 15px 0",fontSize:"13px",color:"#6b7280",lineHeight:"1.5"},children:"La cantidad m\xednima de personal se define por d\xeda y turno."}),(0,i.jsx)("button",{onClick:t,style:{background:"none",border:"none",color:"#2563eb",fontSize:"13px",fontWeight:600,cursor:"pointer",padding:0,display:"flex",alignItems:"center",gap:"4px"},children:"Ver configuraci\xf3n →"})]})}var ev=n(5775);function ej(e){let{representatives:t,incidents:n,specialSchedules:i,allCalendarDaysForRelevantMonths:a}=Z(e=>({representatives:e.representatives,incidents:e.incidents,specialSchedules:e.specialSchedules,allCalendarDaysForRelevantMonths:e.allCalendarDaysForRelevantMonths}));return{weeklyPlan:(0,r.useMemo)(()=>t.length&&e&&7===e.length?function(e,t,n,i,r){if(7!==i.length)throw Error("buildWeeklySchedule expects an array of 7 DayInfo objects.");let a=i[0].date,o=new Map(e.map(e=>[e.id,e])),s=t.filter(e=>"VACACIONES"===e.type||"LICENCIA"===e.type).map(e=>{let t=o.get(e.representativeId);return W(e,r,t)}).filter(e=>e.dates.length>0),l=new Map;t.filter(e=>"OVERRIDE"===e.type||"AUSENCIA"===e.type).forEach(e=>{l.set("".concat(e.representativeId,":").concat(e.startDate),e)});let d=new Map;return n.forEach(e=>{d.has(e.representativeId)||d.set(e.representativeId,[]),d.get(e.representativeId).push(e)}),{weekStart:a,agents:e.map(e=>{let t={},n=d.get(e.id)||[];for(let r of i){let i=r.date,a=(0,A.D)(i),o=s.find(t=>t.incident.representativeId===e.id&&t.dates.includes(i)),d=l.get("".concat(e.id,":").concat(i)),c=(null==d?void 0:d.type)==="OVERRIDE"?d:void 0,p=(null==d?void 0:d.type)==="AUSENCIA",x=n.find(e=>(0,ev._)(a,{start:(0,A.D)(e.startDate),end:(0,A.D)(e.endDate)})&&e.daysOfWeek.includes(r.dayOfWeek)),u=function(e,t,n,i,r,a){var o,s,l,d;let c;if(i)return{status:"OFF",source:"INCIDENT",type:i.incident.type,assignment:{type:"NONE"}};if(r&&r.assignment)return{status:"NONE"===r.assignment.type?"OFF":"WORKING",source:"OVERRIDE",assignment:r.assignment};if(a)return{status:"NONE"===a.assignment.type?"OFF":"WORKING",source:"BASE",assignment:a.assignment};if("OFF"===(null!==(d=null===(o=e.baseSchedule)||void 0===o?void 0:o[t.dayOfWeek])&&void 0!==d?d:"OFF"))return{status:"OFF",source:"BASE",assignment:{type:"NONE"}};let p=t.dayOfWeek>=1&&t.dayOfWeek<=4,x=0===t.dayOfWeek||5===t.dayOfWeek||6===t.dayOfWeek;return(c=(null===(s=e.mixProfile)||void 0===s?void 0:s.type)==="WEEKDAY"&&p||(null===(l=e.mixProfile)||void 0===l?void 0:l.type)==="WEEKEND"&&x?{type:"BOTH"}:{type:"SINGLE",shift:e.baseShift},n)?{status:"WORKING",source:"INCIDENT",type:"AUSENCIA",assignment:c}:{status:"WORKING",source:"BASE",assignment:c}}(e,r,p,o,c,x);t[i]={status:u.status,source:u.source,type:u.type,assignment:u.assignment}}return{representativeId:e.id,days:t}})}}(t,n,i,e,a):null,[e,t,n,i,a])}}var eS=n(5704),eI=n(6579),eC=n(6035),eD=n(3292);function ek(e){return(0,k.WU)(e,"yyyy-MM-dd")}function eE(e,t){let{calendar:n}=Z(e=>({calendar:e.calendar})),i=(0,r.useMemo)(()=>(function(e,t){let n=function(e){let t="string"==typeof e?new Date(e+"T12:00:00Z"):e;return(0,E.z)(t,{weekStartsOn:1})}(e),i=z((0,w.S)(n),(0,O.j)(n)+1,t),r=(0,R.E)(n,6);if((0,O.j)(r)!==(0,O.j)(n)){let e=z((0,w.S)(r),(0,O.j)(r)+1,t);i.push(...e)}let a=new Map(i.map(e=>[e.date,e])),o=[];for(let e=0;e<7;e++){let t=(0,R.E)(n,e),i=(0,k.WU)(t,"yyyy-MM-dd"),r=a.get(i);if(r)o.push(r);else{console.warn("Could not find day info for ".concat(i));let e={date:i,dayOfWeek:t.getDay(),kind:"WORKING",isSpecial:!1};o.push(e)}}return o})(e,n),[e,n]),a=(0,r.useMemo)(()=>(function(e){let t=new Date(e+"T12:00:00Z"),n=(0,E.z)(t,{weekStartsOn:1}),i=(0,eC.v)(t,{weekStartsOn:1});if((0,k.WU)(n,"MMMM",{locale:eD.es})===(0,k.WU)(i,"MMMM",{locale:eD.es})){let e=(0,k.WU)(n,"d"),t=(0,k.WU)(i,"d 'de' MMMM 'de' yyyy",{locale:eD.es});return"Semana del ".concat(e," al ").concat(t)}{let e=(0,k.WU)(n,"d 'de' MMMM",{locale:eD.es}),t=(0,k.WU)(i,"d 'de' MMMM 'de' yyyy",{locale:eD.es});return"Semana del ".concat(e," al ").concat(t)}})(e),[e]),o=(0,r.useMemo)(()=>(0,eS.x)(new Date,new Date(e+"T12:00:00"),{weekStartsOn:1}),[e]);return{weekStart:e,weekDays:i,label:a,isCurrentWeek:o,handlePrevWeek:()=>{t(ek((0,eI.j)(new Date(e+"T12:00:00"),-1)))},handleNextWeek:()=>{t(ek((0,eI.j)(new Date(e+"T12:00:00"),1)))},handleGoToday:()=>{t(ek(new Date))}}}var eA=n(4887);let eR=e=>{let{content:t,children:n}=e,[a,o]=r.useState(!1),[s,l]=r.useState({top:0,left:0}),d=r.useRef(null);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{ref:d,onMouseEnter:()=>{if(d.current){let e=d.current.getBoundingClientRect();l({top:e.top-8,left:e.left+e.width/2}),o(!0)}},onMouseLeave:()=>{o(!1)},style:{width:"100%",height:"100%",display:"flex",alignItems:"flex-end",justifyContent:"center"},children:n}),a&&"undefined"!=typeof document&&(0,eA.createPortal)((0,i.jsx)("div",{style:{position:"fixed",top:s.top,left:s.left,transform:"translate(-50%, calc(-100% - 8px))",background:"#1f2937",color:"white",padding:"8px 12px",borderRadius:"6px",fontSize:"13px",zIndex:9999,pointerEvents:"none",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",maxWidth:"240px",width:"max-content"},children:t}),document.body)]})};function ew(e){let{data:t}=e,n=Object.keys(t).sort(),r=Math.max(1,...Object.values(t).map(e=>Math.max(e.actual,e.required)));return(0,i.jsxs)("div",{style:{padding:"20px",background:"#f9fafb",borderRadius:"8px",border:"1px solid #e5e7eb",position:"relative",maxWidth:"100%",overflow:"hidden"},children:[(0,i.jsx)("h3",{style:{marginTop:0,marginBottom:"20px",color:"#111827"},children:"An\xe1lisis de Cobertura Diaria"}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"flex-end",gap:"10px",height:"250px",borderLeft:"1px solid #d1d5db",borderBottom:"1px solid #d1d5db",paddingLeft:"10px",position:"relative",maxWidth:"100%",overflow:"visible"},children:[n.map(e=>{let{actual:n,required:a,status:o,reason:s}=t[e],l=r>0?n/r*100:0,d="DEFICIT"===o,c=n-a,p=(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[(0,i.jsxs)("div",{style:{fontWeight:700,marginBottom:"2px"},children:[d?"\uD83D\uDD34":"\uD83D\uDFE2"," ",d?"D\xe9ficit de cobertura":"Cobertura OK"," (",c>=0?"+":"",c,")"]}),(0,i.jsxs)("div",{children:["\uD83D\uDC65 En turno: ",n]}),(0,i.jsxs)("div",{children:["\uD83C\uDFAF M\xednimo requerido: ",a]}),(0,i.jsxs)("div",{children:["\uD83D\uDCCF Criterio: ",s||"N/A"]})]});return(0,i.jsxs)("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end",gap:"8px",height:"100%"},children:[(0,i.jsx)("div",{style:{fontWeight:"600",color:d?"hsl(350, 80%, 50%)":"#111827",transition:"color 0.3s ease-in-out"},children:n}),(0,i.jsx)(eR,{content:p,children:(0,i.jsx)("div",{style:{width:"80%",height:"".concat(l,"%"),minHeight:"4px",backgroundColor:d?"hsl(350, 80%, 60%)":"hsl(142.1, 76.2%, 40%)",borderRadius:"4px 4px 0 0",transition:"all 0.3s ease-in-out",cursor:"help"}})}),(0,i.jsx)("div",{style:{fontSize:"12px",color:"#6b7280",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"60px",textAlign:"center"},children:new Date(e+"T12:00:00Z").toLocaleDateString("es-ES",{weekday:"short",day:"numeric"})})]},e)}),(0,i.jsx)("svg",{style:{position:"absolute",inset:0,pointerEvents:"none"},viewBox:"0 0 100 100",preserveAspectRatio:"none",children:(0,i.jsx)("polyline",{points:n.map((e,i)=>{var a,o;let s=null!==(o=null===(a=t[e])||void 0===a?void 0:a.required)&&void 0!==o?o:0,l=100/n.length*(i+.5);return"".concat(l,",").concat((1-(r>0?s/r:0))*100)}).join(" "),stroke:"#9ca3af",strokeWidth:"0.5",fill:"none",strokeDasharray:"2 2",vectorEffect:"non-scaling-stroke"})})]})]})}function eO(e,t,n,i,r,a,o,s){var l;let d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[],c=function(e,t,n){let i=e.filter(e=>e.representativeId===t&&n>=e.startDate&&n<=e.endDate);return 0===i.length?null:i.length>1?(console.error("[CRITICAL] Multiple overlapping EffectiveSchedulePeriods found for rep ".concat(t," on ").concat(n),i),i.sort((e,t)=>t.createdAt.localeCompare(e.createdAt))[0]):i[0]}(d,a,i);if(c){let e=function(e,t){let n=new Date(t+"T12:00:00Z").getDay();return e.weeklyPattern[n]}(c,i);if("OFF"===e)return{shouldWork:!1,role:"NONE",reason:c.reason||"Per\xedodo de horario especial"};if("BOTH"===e)return{shouldWork:!0,role:"BASE",reason:c.reason};if("DAY"===e||"NIGHT"===e){let t=e===r;return{shouldWork:t,role:t?"BASE":"NONE",reason:c.reason}}}let p=e.agents.find(e=>e.representativeId===a),x=null==p?void 0:null===(l=p.days[i])||void 0===l?void 0:l.assignment,u=(null==x?void 0:x.type)==="BOTH"||(null==x?void 0:x.type)==="SINGLE"&&x.shift===r,f=s.find(e=>e.id===a);f||console.warn("[resolveEffectiveDuty] Representative ".concat(a," not found. This may cause incorrect vacation calculations."));let g=n.find(e=>{if(e.representativeId!==a||!["VACACIONES","LICENCIA"].includes(e.type))return!1;let t=W(e,o,f);return!!t.dates.includes(i)||"VACACIONES"===e.type&&!!t.start&&!!t.returnDate&&i>=t.start&&i<t.returnDate||"LICENCIA"===e.type&&!!t.start&&!!t.returnDate&&i>=t.start&&i<t.returnDate});if(g)return{shouldWork:!1,role:"NONE",reason:g.type};if(n.find(e=>e.representativeId===a&&"AUSENCIA"===e.type&&W(e,o,f).dates.includes(i))&&u)return{shouldWork:!1,role:"NONE",reason:"AUSENCIA"};for(let e of t.filter(e=>e.date===i)){if("COVER"===e.type&&e.shift===r){if(e.fromRepresentativeId===a)return{shouldWork:!1,role:"COVERED",reason:"Cubierto por ".concat(e.toRepresentativeId)};if(e.toRepresentativeId===a)return{shouldWork:!0,role:"COVERING",reason:"Cubriendo a ".concat(e.fromRepresentativeId)}}if("DOUBLE"===e.type&&e.shift===r&&e.representativeId===a)return{shouldWork:!0,role:"DOUBLE",reason:"Turno adicional"};if("SWAP"===e.type){if(e.fromRepresentativeId===a){if(e.fromShift===r)return{shouldWork:!1,role:"SWAPPED_OUT",reason:"Intercambio con ".concat(e.toRepresentativeId)};if(e.toShift===r)return{shouldWork:!0,role:"SWAPPED_IN",reason:"Intercambio con ".concat(e.toRepresentativeId)}}if(e.toRepresentativeId===a){if(e.toShift===r)return{shouldWork:!1,role:"SWAPPED_OUT",reason:"Intercambio con ".concat(e.fromRepresentativeId)};if(e.fromShift===r)return{shouldWork:!0,role:"SWAPPED_IN",reason:"Intercambio con ".concat(e.fromRepresentativeId)}}}}return u?{shouldWork:!0,role:"BASE"}:{shouldWork:!1,role:"NONE"}}function eN(e,t,n){let i=n.find(t=>"DATE"===t.scope.type&&t.scope.date===e);if(i)return{required:i.required,source:"RULE",ruleId:i.id,reason:i.label||"Excepci\xf3n por Fecha"};let r=new Date(e+"T12:00:00Z").toLocaleDateString("es-ES",{weekday:"long"}),a=r.charAt(0).toUpperCase()+r.slice(1),o="DAY"===t?"D\xeda":"Noche",s=new Date(e+"T12:00:00Z").getDay(),l=n.find(e=>"WEEKDAY"===e.scope.type&&e.scope.day===s&&e.scope.shift===t);if(l)return{required:l.required,source:"RULE",ruleId:l.id,reason:l.label||"Demanda: ".concat(a," \xb7 Turno ").concat(o)};let d=n.find(e=>"WEEKDAY"===e.scope.type&&e.scope.day===s&&!e.scope.shift);if(d)return{required:d.required,source:"RULE",ruleId:d.id,reason:d.label||"Demanda: ".concat(a," (Global)")};let c=n.find(e=>"SHIFT"===e.scope.type&&e.scope.shift===t);if(c)return{required:c.required,source:"RULE",ruleId:c.id,reason:c.label||"Criterio: Turno ".concat(o," (Est\xe1ndar)")};let p=n.find(e=>"GLOBAL"===e.scope.type);return p?{required:p.required,source:"RULE",ruleId:p.id,reason:p.label||"Global (Est\xe1ndar)"}:{required:0,source:"DEFAULT",reason:"Valor por defecto (ninguna regla aplicable)"}}function ez(e,t){return e<t?"DEFICIT":e>t?"SURPLUS":"OK"}var eT=n(5368);function eM(e){let{title:t,points:n}=e,[a,o]=(0,r.useState)(!1);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("button",{onClick:()=>o(!0),style:{background:"none",border:"none",color:"var(--text-muted)",fontSize:"13px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",padding:"4px 8px",borderRadius:"4px",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.background="#f3f4f6",e.currentTarget.style.color="#374151"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="#6b7280"},children:[(0,i.jsx)(eT.Z,{size:14}),t]}),a&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{onClick:()=>o(!1),style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.3)",zIndex:999}}),(0,i.jsxs)("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"var(--bg-panel)",borderRadius:"12px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",zIndex:1e3},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[(0,i.jsx)("h3",{style:{margin:0,fontSize:"18px",fontWeight:600,color:"var(--text-main)"},children:t}),(0,i.jsx)("button",{onClick:()=>o(!1),style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)",padding:"4px"},children:(0,i.jsx)(ec.Z,{size:20})})]}),(0,i.jsx)("ul",{style:{margin:0,padding:0,listStyle:"none",display:"flex",flexDirection:"column",gap:"12px"},children:n.map((e,t)=>(0,i.jsxs)("li",{style:{display:"flex",gap:"8px",fontSize:"14px",color:"var(--text-main)",lineHeight:"1.5"},children:[(0,i.jsx)("span",{style:{color:"#6366f1",fontWeight:600},children:"•"}),(0,i.jsx)("span",{children:e})]},t))})]})]})]})}function eW(e){let{onNavigateToSettings:t}=e,{representatives:n,coverageRules:a,planningAnchorDate:o,isLoading:s,addOrUpdateSpecialDay:l,removeSpecialDay:d,setPlanningAnchorDate:c,incidents:p,swaps:x,addIncident:u,showMixedShiftConfirmModal:f,allCalendarDaysForRelevantMonths:g,pushUndo:h,effectivePeriods:y}=Z(e=>{var t,n;return{representatives:null!==(t=e.representatives)&&void 0!==t?t:[],coverageRules:e.coverageRules,planningAnchorDate:e.planningAnchorDate,isLoading:e.isLoading,addOrUpdateSpecialDay:e.addOrUpdateSpecialDay,removeSpecialDay:e.removeSpecialDay,setPlanningAnchorDate:e.setPlanningAnchorDate,incidents:e.incidents,addIncident:e.addIncident,showMixedShiftConfirmModal:e.showMixedShiftConfirmModal,swaps:e.swaps,allCalendarDaysForRelevantMonths:e.allCalendarDaysForRelevantMonths,pushUndo:e.pushUndo,effectivePeriods:null!==(n=e.effectivePeriods)&&void 0!==n?n:[]}}),b=(0,r.useMemo)(()=>n.filter(e=>!1!==e.isActive),[n]),{mode:m}=es(),{weekDays:v,label:j,isCurrentWeek:S,handlePrevWeek:I,handleNextWeek:C,handleGoToday:D}=eE(o,c),{weeklyPlan:k}=ej(v),[E,A]=(0,r.useState)("DAY"),[R,w]=(0,r.useState)(null),[O,N]=(0,r.useState)({isOpen:!1,repId:null,date:null,shift:null,existingSwap:null}),{showConfirm:z}=Z(e=>({showConfirm:e.showConfirm})),T=async(e,t)=>{var i;let r;if(!k)return;let a=n.find(t=>t.id===e);if(!a||p.find(n=>{if(n.representativeId!==e||!["VACACIONES","LICENCIA"].includes(n.type))return!1;let i=W(n,g,a);return!!i.start&&!!i.returnDate&&t>=i.start&&t<i.returnDate}))return;let o=k.agents.find(t=>t.representativeId===e),s=null==o?void 0:o.days[t],l=p.find(n=>n.representativeId===e&&n.startDate===t&&"OVERRIDE"===n.type);if(l){Z.setState(n=>{n.incidents=n.incidents.filter(e=>e.id!==l.id),n.swaps=n.swaps.filter(n=>n.date!==t||!("representativeId"in n&&n.representativeId===e||"fromRepresentativeId"in n&&n.fromRepresentativeId===e||"toRepresentativeId"in n&&n.toRepresentativeId===e))}),h({label:"Reaplicar cambio de turno de ".concat(a.name),undo:()=>{Z.setState(e=>{e.incidents.push(l)})}});return}let d=null!==(i=null==s?void 0:s.assignment)&&void 0!==i?i:{type:"NONE"};if((null==d?void 0:d.type)==="BOTH"){if(null===(r=await f(e,t,E)))return}else r="SINGLE"===d.type&&d.shift===E?{type:"NONE"}:{type:"SINGLE",shift:E};let c={representativeId:e,startDate:t,type:"OVERRIDE",duration:1,assignment:r,previousAssignment:d},x=await u(c,!0);x.ok&&h({label:"Deshacer cambio de turno de ".concat(a.name),undo:()=>{Z.setState(n=>{n.incidents=n.incidents.filter(e=>e.id!==x.newId),n.swaps=n.swaps.filter(n=>n.date!==t||!("representativeId"in n&&n.representativeId===e||"fromRepresentativeId"in n&&n.fromRepresentativeId===e||"toRepresentativeId"in n&&n.toRepresentativeId===e))})}})},M=(0,r.useMemo)(()=>k?function(e,t,n,i,r){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o={};for(let s of e.agents)for(let l of(o[s.representativeId]={},Object.keys(s.days)))o[s.representativeId][l]={DAY:eO(e,t,n,l,"DAY",s.representativeId,i,r,a),NIGHT:eO(e,t,n,l,"NIGHT",s.representativeId,i,r,a)};return o}(k,x,p,g,n,y):{},[k,x,p,g,n,y]),L=(0,r.useMemo)(()=>{if(!k)return[];let e=new Map(k.agents.map(e=>[e.representativeId,e]));return b.filter(t=>{let n=e.get(t.id);return!!n&&(t.baseShift===E||v.some(e=>{var t;let i=null===(t=n.days[e.date])||void 0===t?void 0:t.assignment;return!!i&&("BOTH"===i.type||"SINGLE"===i.type&&i.shift===E)}))})},[k,v,E,b]),B=(0,r.useMemo)(()=>{if(!k)return{};let e={};return v.forEach(t=>{let i=function(e,t,n,i,r,a,o){let s=function(e,t,n,i){let r=new Set;for(let a of e){if(!["VACACIONES","LICENCIA"].includes(a.type))continue;let e=i.find(e=>e.id===a.representativeId);if(!e)continue;let o=W(a,n,e);o.start&&o.returnDate&&t>=o.start&&t<o.returnDate&&r.add(a.representativeId)}return r}(r,i,a,o),l={DAY:{actual:0},NIGHT:{actual:0}};for(let t of e.agents){if(s.has(t.representativeId))continue;let e=t.days[i];(null==e?void 0:e.assignment)&&("SINGLE"===e.assignment.type?l[e.assignment.shift].actual++:"BOTH"===e.assignment.type&&(l.DAY.actual++,l.NIGHT.actual++))}let d=function(e,t){let n={date:e.date,shifts:{DAY:e.shifts.DAY,NIGHT:e.shifts.NIGHT}};for(let i of t.filter(t=>t.date===e.date))"DOUBLE"===i.type&&i.shift&&n.shifts[i.shift]++;return n}({date:i,shifts:{DAY:l.DAY.actual,NIGHT:l.NIGHT.actual}},t),c=eN(i,"DAY",n),p=eN(i,"NIGHT",n);return{DAY:{actual:d.shifts.DAY,required:c.required,status:ez(d.shifts.DAY,c.required),reason:c.reason},NIGHT:{actual:d.shifts.NIGHT,required:p.required,status:ez(d.shifts.NIGHT,p.required),reason:p.reason}}}(k,x,a,t.date,p,g,n);e[t.date]=i[E]}),e},[k,x,a,v,E]),F=(0,r.useMemo)(()=>Object.values(B).some(e=>e.required>0),[B]),H=e=>({padding:"8px 16px",cursor:"pointer",border:"none",borderBottom:e?"2px solid hsl(0, 0%, 13%)":"2px solid transparent",color:e?"#111827":"#4b5563",fontWeight:e?600:500,background:"transparent",fontSize:"16px",marginRight:"10px"});return s||!v||0===v.length?(0,i.jsx)("div",{style:{padding:"40px",fontFamily:"sans-serif",color:"#555"},children:"Cargando planificaci\xf3n..."}):(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{marginBottom:"25px",padding:"16px 20px",background:"#FFFFFF",borderRadius:"12px",display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid ".concat("ADMIN_OVERRIDE"===m?"#f59e0b":"#e5e7eb"),height:"74px",boxSizing:"border-box",transition:"border-color 0.3s ease"},children:(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,i.jsx)("h2",{style:{margin:0,fontWeight:600,fontSize:"18px"},children:"Planificaci\xf3n"}),(0,i.jsx)(eM,{title:"\xbfC\xf3mo usar el planner?",points:["Click en una celda para cambiar el turno del agente","Click derecho para gestionar swaps y coberturas","El gr\xe1fico lateral muestra la cobertura requerida vs actual"]})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,i.jsx)("button",{onClick:I,style:{padding:"8px",border:"1px solid #d1d5db",borderRadius:"6px",background:"white",lineHeight:1},children:"<"}),(0,i.jsx)("div",{style:{fontSize:"14px",fontWeight:500,color:"#374151",width:"280px",textAlign:"center"},children:j}),(0,i.jsx)("button",{onClick:C,style:{padding:"8px",border:"1px solid #d1d5db",borderRadius:"6px",background:"white",lineHeight:1},children:">"}),!S&&(0,i.jsx)("button",{onClick:D,style:{padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",background:"white",fontSize:"12px",fontWeight:600},children:"Semana Actual"})]})]})}),(0,i.jsx)("div",{style:{marginBottom:"20px"},children:(0,i.jsxs)("div",{style:{borderBottom:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("button",{style:H("DAY"===E),onClick:()=>A("DAY"),children:"Turno D\xeda"}),(0,i.jsx)("button",{style:H("NIGHT"===E),onClick:()=>A("NIGHT"),children:"Turno Noche"})]}),(0,i.jsxs)("button",{onClick:()=>N({isOpen:!0,repId:null,date:o,shift:E,existingSwap:null}),style:{padding:"8px 16px",backgroundColor:"#2563eb",color:"white",border:"none",borderRadius:"6px",fontWeight:600,fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,i.jsx)("path",{d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})}),"Gestionar Cambios"]})]})}),(0,i.jsx)(K.M,{mode:"wait",children:(0,i.jsx)(q.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.18,ease:"easeOut"},children:k?(0,i.jsxs)("div",{style:{display:"flex",overflowX:"hidden",gap:"40px",alignItems:"start"},children:[(0,i.jsx)("div",{style:{flex:1,minWidth:0},children:(0,i.jsx)(er,{weeklyPlan:k,weekDays:v,agents:L,activeShift:E,assignmentsMap:M,onCellClick:(e,t)=>T(e,t),onCellContextMenu:(e,t,n)=>{n.preventDefault();let i=x.find(n=>n.date===t&&("COVER"===n.type?(n.fromRepresentativeId===e||n.toRepresentativeId===e)&&n.shift===E:"DOUBLE"===n.type?n.representativeId===e&&n.shift===E:"SWAP"===n.type&&(n.fromRepresentativeId===e||n.toRepresentativeId===e)));N({isOpen:!0,repId:e,date:t,shift:E,existingSwap:i||null})},onEditDay:w})}),(0,i.jsx)("aside",{style:{position:"sticky",top:"20px",width:"340px",flexShrink:0},children:(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[F?(0,i.jsx)(ew,{data:B}):(0,i.jsx)("div",{style:{marginBottom:"16px",padding:"16px",background:"#f9fafb",borderRadius:"8px",border:"1px dashed #d1d5db",textAlign:"center",color:"#6b7280",fontSize:"13px"},children:"Sin reglas de cobertura activas."}),(0,i.jsx)(em,{onNavigateToSettings:t})]})})]}):(0,i.jsx)("div",{children:"Cargando plan..."})},k?k.weekStart+E:E)}),R&&(0,i.jsx)(ea,{day:R,onClose:()=>w(null),onSave:l,onClear:async e=>{await z({title:"\xbfQuitar Excepci\xf3n?",description:"Esto restaurar\xe1 el comportamiento por defecto del d\xeda ".concat(e,"."),intent:"warning"})&&d(e)}}),O.isOpen&&k&&(0,i.jsx)(ey,{weeklyPlan:k,initialDate:O.date||o,initialShift:O.shift||E,initialRepId:O.repId||void 0,existingSwap:O.existingSwap||void 0,onClose:()=>N({isOpen:!1,repId:null,date:null,shift:null,existingSwap:null})})]})}let eL={TARDANZA:{label:"Tardanza",variant:"warning"},AUSENCIA:{label:"Ausencia",variant:"danger"},ERROR:{label:"Error",variant:"danger"},LICENCIA:{label:"Licencia",variant:"info"},VACACIONES:{label:"Vacaciones",variant:"ok"},OTRO:{label:"Otro",variant:"neutral"},OVERRIDE:{label:"Cambio de Turno",variant:"neutral"}},eB={ok:{background:"hsl(142.1, 80%, 96%)",color:"hsl(142.1, 76.2%, 25%)"},warning:{background:"hsl(45, 100%, 96%)",color:"hsl(45, 80%, 25%)"},danger:{background:"hsl(0, 100%, 97%)",color:"hsl(0, 80%, 45%)"},info:{background:"hsl(210, 100%, 96%)",color:"hsl(210, 80%, 35%)"},neutral:{background:"hsl(220, 15%, 96%)",color:"hsl(220, 10%, 40%)"}};function eF(e){let{label:t,value:n,variant:r="neutral",className:a=""}=e,o={display:"inline-flex",alignItems:"center",gap:"8px",padding:"4px 12px",borderRadius:"9999px",fontSize:"12px",fontWeight:500,lineHeight:"1.5",...eB[r]};return(0,i.jsxs)("div",{style:o,className:a,children:[(0,i.jsx)("span",{children:t}),void 0!==n&&(0,i.jsx)("span",{style:{fontWeight:600},children:n})]})}var eH=n(8930);let eP=(0,r.memo)(function(e){let{person:t,onDelete:n,canDelete:r}=e;return(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 8px",borderRadius:"6px",background:"#f9fafb"},children:[(0,i.jsx)("span",{style:{fontWeight:500,color:"var(--text-main)"},children:t.repName}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.count>1&&(0,i.jsxs)("span",{style:{fontSize:"12px",fontWeight:600,color:"var(--text-muted)"},children:["\xd7",t.count]}),r&&(0,i.jsx)("button",{onClick:()=>n(t.incidents.map(e=>e.id)),style:{background:"none",border:"none",color:"#9ca3af",cursor:"pointer"},children:(0,i.jsx)(eH.Z,{size:14})})]})]})}),eU=(0,r.memo)(function(e){let{incident:t,onDelete:n,canDelete:r}=e,a=F(t);return(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"4px",padding:"8px",borderRadius:"6px",background:"#f9fafb"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("span",{style:{fontWeight:500,color:"var(--text-main)"},children:t.repName}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[a>0&&(0,i.jsxs)("div",{style:{fontSize:12,fontWeight:700,color:"#b91c1c"},children:["-",a," pts"]}),r&&(0,i.jsx)("button",{onClick:()=>n(t.id),style:{background:"none",border:"none",color:"#9ca3af",cursor:"pointer"},children:(0,i.jsx)(eH.Z,{size:14})})]})]}),t.note&&(0,i.jsx)("p",{style:{margin:0,fontSize:"12px",fontStyle:"italic",color:"var(--text-muted)"},children:t.note})]})}),eV=(0,r.memo)(function(e){var t;let{incident:n,onDelete:r,canDelete:a}=e,o=null!==(t=eL[n.type])&&void 0!==t?t:eL.OTRO,s=n.totalDuration&&n.dayCount?n.dayCount/n.totalDuration*100:0;return(0,i.jsxs)(q.E.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2,ease:"easeOut"},style:{marginBottom:"1rem",border:"1px solid var(--border-subtle)",borderRadius:"10px",background:"var(--bg-panel)",overflow:"hidden"},children:[(0,i.jsxs)("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 15px",borderBottom:"1px solid #f3f4f6"},children:[(0,i.jsx)(eF,{label:o.label,variant:o.variant}),a&&(0,i.jsx)("button",{onClick:()=>r(n.id),style:{background:"none",border:"none",color:"#9ca3af",cursor:"pointer"},children:(0,i.jsx)(eH.Z,{size:14})})]}),(0,i.jsxs)("div",{style:{padding:"12px 15px",display:"flex",flexDirection:"column",gap:"10px"},children:[(0,i.jsx)("div",{style:{fontWeight:600,color:"var(--text-main)"},children:n.repName}),(0,i.jsx)("div",{style:{position:"relative",width:"100%",background:"#f3f4f6",height:"8px",borderRadius:"4px"},children:(0,i.jsx)("div",{style:{position:"absolute",left:0,top:0,height:"100%",width:"".concat(s,"%"),background:"ok"===o.variant?"#22c55e":"#3b82f6",borderRadius:"4px",transition:"width 0.3s ease-out"}})}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"var(--text-muted)"},children:[(0,i.jsxs)("span",{children:["D\xeda ",n.dayCount," de ",n.totalDuration]}),n.returnDate&&(0,i.jsxs)("span",{style:{fontWeight:500},children:["Reingresa: ",(0,k.WU)((0,A.D)(n.returnDate),"dd/MM/yyyy",{locale:eD.es})]})]})]})]})}),eY=(0,r.memo)(function(e){var t,n,r;let{group:a,onDeleteSingle:o,onDeleteGroup:s,canDelete:l}=e,d=null!==(r=eL[a.type])&&void 0!==r?r:eL.OTRO;return(0,i.jsxs)(q.E.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2,ease:"easeOut"},style:{marginBottom:"1rem",border:"1px solid var(--border-subtle)",borderRadius:"10px",background:"var(--bg-panel)"},children:[(0,i.jsxs)("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 15px",borderBottom:"1px solid #f3f4f6"},children:[(0,i.jsx)(eF,{label:d.label,variant:d.variant}),(0,i.jsx)("span",{style:{fontWeight:700,fontSize:18,color:"var(--text-main)"},children:a.totalCount})]}),(0,i.jsx)("div",{style:{padding:"10px",display:"flex",flexDirection:"column",gap:"8px"},children:"OTRO"===a.type?null===(t=a.items)||void 0===t?void 0:t.map(e=>(0,i.jsx)(eU,{incident:e,onDelete:o,canDelete:l},e.id)):null===(n=a.people)||void 0===n?void 0:n.map(e=>(0,i.jsx)(eP,{person:e,onDelete:s,canDelete:l},e.repName))})]})});function eG(e){let{title:t,incidents:n=[],emptyMessage:a}=e,{removeIncident:o,removeIncidents:s,showConfirm:l}=Z(e=>({removeIncident:e.removeIncident,removeIncidents:e.removeIncidents,showConfirm:e.showConfirm})),{mode:d}=es(),c="ADMIN_OVERRIDE"===d,{punctualGroups:p,rangeIncidents:x}=(0,r.useMemo)(()=>{let e=n.filter(e=>"LICENCIA"!==e.type&&"VACACIONES"!==e.type),t=n.filter(e=>"LICENCIA"===e.type||"VACACIONES"===e.type),i=new Map;for(let t of e)i.has(t.type)||i.set(t.type,[]),i.get(t.type).push(t);let r=[];for(let[e,t]of i.entries()){if("OTRO"===e){r.push({type:e,totalCount:t.length,items:t,totalPoints:t.reduce((e,t)=>e+F(t),0),people:[]});continue}let n=new Map;for(let e of t){n.has(e.repName)||n.set(e.repName,{repName:e.repName,count:0,incidents:[]});let t=n.get(e.repName);t.count++,t.incidents.push(e)}r.push({type:e,totalCount:t.length,people:Array.from(n.values()),totalPoints:t.reduce((e,t)=>e+F(t),0)})}return{punctualGroups:r.sort((e,t)=>{let n={AUSENCIA:1,TARDANZA:2,ERROR:3,OTRO:4,VACACIONES:5,LICENCIA:6,OVERRIDE:7};return(n[e.type]||99)-(n[t.type]||99)}),rangeIncidents:t}},[n]),u=async(e,t)=>{var n;let i=null!==(n=eL[t])&&void 0!==n?n:eL.OTRO;await l({title:"\xbfEliminar ".concat(e.count," incidencia(s)?"),description:'Esto eliminar\xe1 permanentemente todas las incidencias de tipo "'.concat(i.label,'" registradas para ').concat(e.repName," en este d\xeda."),intent:"danger",confirmLabel:"S\xed, eliminar"})&&s(e.incidents.map(e=>e.id))},f=async e=>{await l({title:"\xbfEliminar incidencia?",description:'Esto eliminar\xe1 permanentemente la incidencia "'.concat(e.note||eL[e.type].label,'" registrada para ').concat(e.repName,"."),intent:"danger",confirmLabel:"S\xed, eliminar"})&&o(e.id)},g=n.length>0;return(0,i.jsxs)("section",{children:[(0,i.jsxs)("h3",{style:{marginBottom:"0.75rem",fontSize:"1rem",fontWeight:600,color:"var(--text-main)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("span",{children:t}),n.length>0&&(0,i.jsxs)("span",{style:{fontSize:"12px",color:"var(--text-muted)"},children:[n.length," evento(s)"]})]}),(0,i.jsxs)(K.M,{mode:"popLayout",children:[!g&&(0,i.jsx)(q.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{fontSize:"0.875rem",color:"var(--text-muted)",fontStyle:"italic",textAlign:"center",padding:"20px 0",background:"#f9fafb",borderRadius:"8px",border:"1px dashed #e5e7eb"},children:a},"empty-day"),x.map(e=>(0,i.jsx)(eV,{incident:e,onDelete:()=>f(e),canDelete:c},e.id)),p.map(e=>(0,i.jsx)(eY,{group:e,onDeleteSingle:t=>{var n;let i=null===(n=e.people)||void 0===n?void 0:n.flatMap(e=>e.incidents).find(e=>e.id===t);i&&f(i)},onDeleteGroup:t=>{var n;let i=null===(n=e.people)||void 0===n?void 0:n.find(e=>e.incidents.some(e=>e.id===t[0]));i&&u(i,e.type)},canDelete:c},e.type))]})]})}let eZ=(0,r.createContext)(null);function e_(e){let{children:t}=e,[n,a]=(0,r.useState)([]),o=e=>{switch(e){case"success":return{backgroundColor:"hsl(142.1, 80%, 96%)",color:"hsl(142.1, 76.2%, 25%)",border:"1px solid hsl(142.1, 76.2%, 85%)"};case"error":return{backgroundColor:"hsl(0, 100%, 97%)",color:"hsl(0, 80%, 45%)",border:"1px solid hsl(0, 100%, 90%)"};case"warning":return{backgroundColor:"hsl(45, 100%, 96%)",color:"hsl(45, 80%, 25%)",border:"1px solid hsl(45, 100%, 85%)"};default:return{backgroundColor:"hsl(210, 100%, 96%)",color:"hsl(210, 80%, 35%)",border:"1px solid hsl(210, 100%, 88%)"}}};return(0,i.jsxs)(eZ.Provider,{value:{showToast:e=>{let t=crypto.randomUUID(),n=e.type||"info";a(i=>[...i,{id:t,...e,type:n}]),setTimeout(()=>{a(e=>e.filter(e=>e.id!==t))},3500)}},children:[t,(0,i.jsx)("div",{style:{position:"fixed",top:"16px",right:"16px",display:"flex",flexDirection:"column",gap:"8px",zIndex:1001},children:n.map(e=>(0,i.jsxs)("div",{className:"animate-fade-in",style:{padding:"12px 16px",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",fontWeight:500,pointerEvents:"auto",minWidth:"300px",...o(e.type)},children:[(0,i.jsx)("div",{style:{fontWeight:600,marginBottom:"4px"},children:e.title}),(0,i.jsx)("div",{style:{fontSize:"14px",opacity:.9},children:e.message})]},e.id))})]})}let eK=()=>{let e=(0,r.useContext)(eZ);if(!e)throw Error("useToast must be inside ToastProvider");return e};var eq=n(5805),eX=n(2451),eJ=n(407),eQ=n(1047),e$=n(9322),e0=n(3245);function e1(e){let{variant:t,children:n}=e,r={warning:{background:"#fef3c7",border:"1px solid #fbbf24",color:"#92400e",icon:(0,i.jsx)(ep.Z,{size:18})},error:{background:"#fee2e2",border:"1px solid #ef4444",color:"#991b1b",icon:(0,i.jsx)(e$.Z,{size:18})},info:{background:"#dbeafe",border:"1px solid #3b82f6",color:"#1e40af",icon:(0,i.jsx)(e0.Z,{size:18})}}[t];return(0,i.jsxs)("div",{style:{display:"flex",gap:"10px",padding:"10px 12px",borderRadius:"6px",background:r.background,border:r.border,color:r.color,fontSize:"13px",alignItems:"flex-start"},children:[(0,i.jsx)("div",{style:{marginTop:"1px",flexShrink:0},children:r.icon}),(0,i.jsx)("div",{style:{flex:1},children:n})]})}var e2=n(5341),e6=n(9394),e4=n(29),e5=n.n(e4),e8=n(3070),e3=n(1650),e7=n(6357),e9=n(1994);function te(e){let{month:t,days:n,selected:r,onSelect:a}=e,o=(0,e8.N)(t),s=(0,e3.N)(t),l=((0,N.w)(o)+6)%7,d=new Map(n.map(e=>[(0,k.WU)(e.date,"yyyy-MM-dd"),e]));return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e5(),{id:"7fd884f4d6d24ce2",children:'.calendar.jsx-7fd884f4d6d24ce2{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:6px}.calendar-header.jsx-7fd884f4d6d24ce2,.calendar-grid.jsx-7fd884f4d6d24ce2{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}.day-label.jsx-7fd884f4d6d24ce2{text-align:center;padding:8px 0;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;font-size:14px;font-weight:600;color:#6b7280}.day.jsx-7fd884f4d6d24ce2{text-align:center;padding:8px 0;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;font-size:14px;background:#f9fafb;cursor:pointer;border:1px solid transparent;height:36px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-transition:all.15s ease;-moz-transition:all.15s ease;-o-transition:all.15s ease;transition:all.15s ease}.day.jsx-7fd884f4d6d24ce2:hover{background:#f1f5f9}.day[data-visual="ABSENT"].jsx-7fd884f4d6d24ce2{background:hsl(0,85%,90%);color:hsl(0,60%,30%);font-weight:600}.day[data-visual="VACATION"].jsx-7fd884f4d6d24ce2{background:hsl(195,70%,94%);color:hsl(195,40%,30%)}.day[data-visual="LICENSE"].jsx-7fd884f4d6d24ce2{background:hsl(260,55%,95%);color:hsl(260,35%,35%)}.day[data-visual="HOLIDAY"].jsx-7fd884f4d6d24ce2{background:hsl(45,90%,92%);color:hsl(45,50%,30%)}.day[data-visual="SHIFT_CHANGE"].jsx-7fd884f4d6d24ce2{border-bottom:2px solid hsl(220,15%,75%)}.day[data-visual="NORMAL"].jsx-7fd884f4d6d24ce2{background:transparent;color:hsl(220,15%,35%)}.day.warning.jsx-7fd884f4d6d24ce2{background:#fff7d6;color:#92400e}.day.danger.jsx-7fd884f4d6d24ce2{background:#fee2e2;color:#991b1b}.day.disabled.jsx-7fd884f4d6d24ce2{background:#f3f4f6;color:#d1d5db;cursor:default;opacity:.5}.day.selected.jsx-7fd884f4d6d24ce2{outline:2px solid#2563eb;border-color:#2563eb}.day.empty.jsx-7fd884f4d6d24ce2{background:transparent;pointer-events:none}'}),(0,i.jsxs)("div",{className:"jsx-7fd884f4d6d24ce2 calendar",children:[(0,i.jsx)("div",{className:"jsx-7fd884f4d6d24ce2 calendar-header",children:["L","M","X","J","V","S","D"].map(e=>(0,i.jsx)("div",{className:"jsx-7fd884f4d6d24ce2 day-label",children:e},e))}),(0,i.jsx)("div",{className:"jsx-7fd884f4d6d24ce2 calendar-grid",children:Array.from({length:7*Math.ceil((l+s)/7)}).map((e,n)=>{let o=n-l+1;if(o<1||o>s)return(0,i.jsx)("div",{className:"jsx-7fd884f4d6d24ce2 day empty"},n);let c=new Date(t.getFullYear(),t.getMonth(),o),p=(0,k.WU)(c,"yyyy-MM-dd"),x=d.get(p);return(0,i.jsx)("button",{"data-visual":(null==x?void 0:x.visualType)||"NORMAL",onClick:()=>a(c),className:"jsx-7fd884f4d6d24ce2 "+((0,e9.Z)("day",null==x?void 0:x.state,r&&(0,e7.K)(r,c)&&"selected")||""),children:o},p)})})]})]})}let tt=e=>["WORKING","COVERING","DOUBLE","SWAPPED_IN"].includes(e.logStatus),tn=e=>!!tt(e)||"ABSENT"===e.logStatus&&!(e.details&&["VACACIONES","LICENCIA"].includes(e.details)),ti={input:{width:"100%",border:"1px solid var(--border-strong)",borderRadius:"6px",padding:"10px 12px",fontSize:"14px",boxSizing:"border-box"},label:{display:"block",fontSize:"14px",fontWeight:500,marginBottom:"6px",color:"var(--text-main)"},listItem:{width:"100%",textAlign:"left",padding:"8px 12px",borderRadius:"6px",cursor:"pointer",border:"none",background:"transparent",fontSize:"14px",color:"var(--text-main)"},activeListItem:{background:"#f3f4f6",fontWeight:600}},tr=e=>{let{label:t,isActive:n,onClick:r,presentCount:a,plannedCount:o}=e,s={width:"100%",padding:"10px 14px",borderRadius:"8px",border:"1px solid transparent",textAlign:"left",cursor:"pointer",transition:"all 0.2s ease",background:"#f9fafb",borderColor:"#f3f4f6",position:"relative"};return n&&(s.background="white",s.borderColor="#e5e7eb",s.boxShadow="0 2px 8px rgba(0,0,0,0.05)"),(0,i.jsxs)("button",{onClick:r,style:s,children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:["D\xeda"===t?(0,i.jsx)(Q.Z,{size:18,style:{color:"#fbbf24"}}):(0,i.jsx)(ed.Z,{size:18,style:{color:"#a5b4fc"}}),(0,i.jsx)("span",{style:{fontWeight:600,fontSize:"1rem",color:"var(--text-main)"},children:t})]}),(0,i.jsxs)("div",{style:{position:"absolute",top:"12px",right:"14px",display:"flex",alignItems:"center",gap:"6px"},children:[(0,i.jsx)(eq.Z,{size:14,style:{color:"var(--text-muted)"}}),(0,i.jsx)("span",{style:{fontWeight:700,fontSize:"1.25rem",color:"var(--text-main)"},children:a}),(0,i.jsxs)("span",{style:{fontWeight:500,fontSize:"1rem",color:"#9ca3af"},children:["/ ",o]})]})]})};function ta(){let{incidents:e,allCalendarDaysForRelevantMonths:t,representatives:n,planningAnchorDate:a,setPlanningAnchorDate:o,swaps:s,isLoading:l,effectivePeriods:d}=Z(e=>{var t;return{incidents:e.incidents,allCalendarDaysForRelevantMonths:e.allCalendarDaysForRelevantMonths,representatives:e.representatives,planningAnchorDate:e.planningAnchorDate,setPlanningAnchorDate:e.setPlanningAnchorDate,swaps:e.swaps,isLoading:e.isLoading,effectivePeriods:null!==(t=e.effectivePeriods)&&void 0!==t?t:[]}}),[c,p]=(0,r.useState)(()=>(0,k.WU)(new Date,"yyyy-MM-dd")),[x,u]=(0,r.useState)(!1),f=(0,r.useRef)(null),{weekDays:g}=eE(c,p),{weeklyPlan:h}=ej(g),[y,b]=(0,r.useState)("DAY"),[m,v]=(0,r.useState)(null),[j,S]=(0,r.useState)(""),[I,C]=(0,r.useState)("TARDANZA"),[D,E]=(0,r.useState)(""),[w,O]=(0,r.useState)(1),[N,z]=(0,r.useState)(0);(0,r.useEffect)(()=>{function e(e){f.current&&!f.current.contains(e.target)&&u(!1)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[f]);let T=(0,r.useMemo)(()=>!h||l?[]:function(e,t,n,i,r,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],s=[];for(let l of e.agents)for(let d of["DAY","NIGHT"]){let c=eO(e,t,n,i,d,l.representativeId,r,a,o),p=function(e,t,n,i,r,a,o,s){let l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[];return eO(e,t,n,i,r,a,o,s,l).shouldWork}(e,t,n,i,d,l.representativeId,r,a,o),x="OFF";switch(c.role){case"BASE":x=c.shouldWork?"WORKING":"OFF";break;case"COVERING":x="COVERING";break;case"DOUBLE":x="DOUBLE";break;case"SWAPPED_IN":x="SWAPPED_IN";break;case"COVERED":x="COVERED";break;case"SWAPPED_OUT":x="SWAPPED_OUT";break;case"NONE":x="AUSENCIA"===c.reason?"ABSENT":c.reason&&["VACACIONES","LICENCIA"].includes(c.reason)?"ABSENT":"OFF"}s.push({representativeId:l.representativeId,shift:d,logStatus:x,isResponsible:p,details:c.reason})}return s}(h,s,e,c,t,n,d),[h,s,e,c,t,n,l,d]),{representativesInShift:M,dayShiftPresent:B,nightShiftPresent:F,dayShiftPlanned:H,nightShiftPlanned:P}=(0,r.useMemo)(()=>{if(!h||l)return{representativesInShift:[],dayShiftPresent:0,nightShiftPresent:0,dayShiftPlanned:0,nightShiftPlanned:0};let e=T.filter(e=>"DAY"===e.shift),t=T.filter(e=>"NIGHT"===e.shift),i=e.filter(tt).length,r=t.filter(tt).length,a=e.filter(tn).length,o=t.filter(tn).length,s="DAY"===y?e:t,d=new Map(n.map(e=>[e.id,e]));return{representativesInShift:s.filter(e=>{if("OFF"!==e.logStatus){if("ABSENT"===e.logStatus&&e.details&&["VACACIONES","LICENCIA"].includes(e.details)){let t=d.get(e.representativeId);if(t&&t.baseShift!==e.shift)return!1}return!0}return e.isResponsible}).map(e=>d.get(e.representativeId)).filter(e=>!!e),dayShiftPresent:i,nightShiftPresent:r,dayShiftPlanned:a,nightShiftPlanned:o}},[T,y,h,n,l]),U=(0,r.useMemo)(()=>j?M.filter(e=>e.name.toLowerCase().includes(j.toLowerCase())):M,[M,j]),{dayIncidents:V,ongoingIncidents:Y}=(0,r.useMemo)(()=>{if(l)return{dayIncidents:[],ongoingIncidents:[]};let i=new Map(n.map(e=>[e.id,e])),r=e.map(e=>{if("OVERRIDE"===e.type)return null;let n=i.get(e.representativeId);if(!n)return null;let r=W(e,t,n);if(!r.dates.includes(c))return null;let a=r.dates.indexOf(c)+1,o=r.dates.length;if("VACACIONES"===e.type){var s;o=null!==(s=e.duration)&&void 0!==s?s:14;let i=0,l=r.dates,d=l.indexOf(c);for(let e=0;e<=d;e++){let r=l[e],a=t.find(e=>e.date===r),o=(0,A.D)(r).getUTCDay(),s="OFF"===n.baseSchedule[o],d=(null==a?void 0:a.isSpecial)===!0;!s&&!d&&i++}a=Math.max(1,i)}return{...e,repName:n.name,repShift:n.baseShift,dayCount:a,totalDuration:o,returnDate:r.returnDate}}).filter(e=>!!e);return{dayIncidents:r.filter(e=>"VACACIONES"!==e.type&&"LICENCIA"!==e.type),ongoingIncidents:r.filter(e=>"VACACIONES"===e.type||"LICENCIA"===e.type)}},[e,c,t,n,l]),G=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];C("TARDANZA"),E(""),O(1),z(0),e||(v(null),S(""))},[]),{submit:_}=function(e){let{onSuccess:t}=e,n=Z(e=>e.addIncident),{showToast:i}=eK();return{submit:async(e,r)=>{if(!r||!e){i({title:"Datos incompletos",message:"Por favor, selecciona un representante y completa los datos.",type:"error"});return}let a=(0,k.WU)(new Date,"yyyy-MM-dd"),o=L(e.type,e.startDate,a);if(!o.ok){i({title:"Acci\xf3n no permitida",message:o.message,type:"error"});return}let s=await n(e);s.ok?t():"Acci\xf3n cancelada por el usuario."!==s.reason&&i({title:"Error de validaci\xf3n",message:s.reason||"Ocurri\xf3 un error desconocido.",type:"error"})}}}({onSuccess:()=>G(!0)}),K=(0,r.useMemo)(()=>!m||l?{hasConflict:!1}:function(e,t,n,i,r,a,o){let s=r.filter(t=>t.representativeId===e);for(let e of s.filter(e=>"VACACIONES"===e.type)){let n=W(e,a,o);if(n.dates.includes(t))return{hasConflict:!0,message:"Ya tiene vacaciones activas desde ".concat(n.start," hasta ").concat(n.end),conflictType:"VACATION"}}for(let e of s.filter(e=>"LICENCIA"===e.type)){let n=W(e,a,o);if(n.dates.includes(t))return{hasConflict:!0,message:"Ya tiene licencia activa desde ".concat(n.start," hasta ").concat(n.end),conflictType:"LICENSE"}}if("VACACIONES"===n||"LICENCIA"===n){let r=W({id:"temp",representativeId:e,type:n,startDate:t,duration:i,createdAt:new Date().toISOString()},a,o);for(let e of s)if("VACACIONES"===e.type||"LICENCIA"===e.type){let t=W(e,a,o);if(r.dates.some(e=>t.dates.includes(e)))return{hasConflict:!0,message:"Se solapa con ".concat("VACACIONES"===e.type?"vacaciones":"licencia"," del ").concat(t.start," al ").concat(t.end),conflictType:"OVERLAP"}}}return{hasConflict:!1}}(m.id,c,I,w,e,t,m),[m,c,I,w,e,t,l]);(0,r.useEffect)(()=>{m&&!U.some(e=>e.id===m.id)&&G(!1)},[y,m,U,G]);let q=(0,A.D)(c);return l||0===t.length?(0,i.jsx)("div",{children:"Cargando..."}):(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"300px 1fr",height:"calc(100vh - 200px)",gap:"16px",fontFamily:"sans-serif"},children:[(0,i.jsxs)("aside",{style:{flexShrink:0,backgroundColor:"white",borderRadius:"12px",padding:"20px",border:"1px solid var(--border-subtle)",display:"flex",flexDirection:"column",gap:"16px",marginBottom:"16px"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{style:{fontWeight:500,margin:"0 0 12px 0",color:"var(--text-main)",fontSize:"13px"},children:"Estado de Turnos"}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,i.jsx)(tr,{label:"D\xeda",isActive:"DAY"===y,onClick:()=>b("DAY"),presentCount:B,plannedCount:H}),(0,i.jsx)(tr,{label:"Noche",isActive:"NIGHT"===y,onClick:()=>b("NIGHT"),presentCount:F,plannedCount:P})]})]}),(0,i.jsxs)("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[(0,i.jsx)("label",{style:{...ti.label,marginBottom:"8px"},children:"Representantes del Turno"}),(0,i.jsx)("input",{type:"text",placeholder:"Buscar representante...",style:{...ti.input,marginBottom:"12px"},value:j,onChange:e=>S(e.target.value)}),(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px",overflowY:"auto",flex:1},children:U.map(e=>(0,i.jsx)("button",{onClick:()=>v(e),style:{...ti.listItem,...(null==m?void 0:m.id)===e.id?ti.activeListItem:{}},children:e.name},e.id))})]})]}),(0,i.jsxs)("section",{style:{display:"flex",flexDirection:"column",gap:"16px",overflowY:"auto"},children:[(0,i.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid var(--border-subtle)",borderRadius:"12px",padding:"16px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",height:"74px",boxSizing:"border-box"},children:[(0,i.jsx)("h2",{style:{margin:"0 0 32px 0",fontWeight:700,fontSize:"16px"},children:"Registro de Eventos"}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",position:"relative"},ref:f,children:[(0,i.jsx)("button",{onClick:()=>p((0,k.WU)((0,e2.k)(q,1),"yyyy-MM-dd")),style:{padding:"8px",border:"1px solid var(--border-strong)",background:"var(--bg-panel)",borderRadius:"6px",cursor:"pointer"},children:(0,i.jsx)(eX.Z,{size:16})}),(0,i.jsx)("div",{style:{fontWeight:600,fontSize:"14px",color:"var(--text-main)",minWidth:"220px",textAlign:"center"},children:(0,k.WU)(q,"EEEE, dd 'de' MMMM",{locale:eD.es})}),(0,i.jsx)("button",{onClick:()=>p((0,k.WU)((0,R.E)(q,1),"yyyy-MM-dd")),style:{padding:"8px",border:"1px solid var(--border-strong)",background:"var(--bg-panel)",borderRadius:"6px",cursor:"pointer"},children:(0,i.jsx)(eJ.Z,{size:16})}),(0,i.jsx)("button",{onClick:()=>u(e=>!e),style:{padding:"8px",border:"1px solid var(--border-strong)",background:"var(--bg-panel)",borderRadius:"6px",cursor:"pointer"},children:(0,i.jsx)(eQ.Z,{size:16})}),!(0,e6.z)(q)&&(0,i.jsx)("button",{onClick:()=>p((0,k.WU)(new Date,"yyyy-MM-dd")),style:{padding:"8px 12px",border:"1px solid var(--border-strong)",borderRadius:"6px",background:"var(--bg-panel)",fontSize:"12px",fontWeight:600,cursor:"pointer"},children:"Hoy"}),x&&(0,i.jsx)("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"8px",background:"var(--bg-panel)",border:"1px solid var(--border-subtle)",borderRadius:"8px",padding:"16px",zIndex:10,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:(0,i.jsx)(te,{month:q,selected:q,onSelect:e=>{p((0,k.WU)(e,"yyyy-MM-dd")),u(!1)},days:[]})})]})]}),(0,i.jsx)("form",{onSubmit:e=>{if(e.preventDefault(),!m)return;let t="LICENCIA"===I||"VACACIONES"===I;_({representativeId:m.id,type:I,startDate:c,duration:t?w:1,customPoints:"OTRO"===I?N:void 0,note:D.trim()||void 0},m)},children:(0,i.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid var(--border-subtle)",borderRadius:"12px",padding:"20px",display:"flex",flexDirection:"column",gap:"16px"},children:[(0,i.jsx)("header",{children:(0,i.jsx)("h3",{style:{margin:0,fontWeight:600,fontSize:"16px"},children:m?(0,i.jsxs)(i.Fragment,{children:["Registrar para:"," ",(0,i.jsx)("span",{style:{fontWeight:700},children:m.name})]}):"Seleccione un representante para comenzar"})}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:ti.label,children:"Tipo de incidencia"}),(0,i.jsxs)("select",{style:ti.input,value:I,onChange:e=>C(e.target.value),disabled:!m,children:[(0,i.jsx)("option",{value:"TARDANZA",children:"Tardanza"}),(0,i.jsx)("option",{value:"AUSENCIA",children:"Ausencia"}),(0,i.jsx)("option",{value:"ERROR",children:"Error"}),(0,i.jsx)("option",{value:"OTRO",children:"Otro"}),(0,i.jsx)("option",{value:"LICENCIA",children:"Licencia"}),(0,i.jsx)("option",{value:"VACACIONES",children:"Vacaciones"})]})]}),("LICENCIA"===I||"VACACIONES"===I)&&(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{style:ti.label,children:["Duraci\xf3n (","LICENCIA"===I?"d\xedas naturales":"d\xedas laborables",")"]}),(0,i.jsx)("input",{type:"number",style:ti.input,min:"1",value:w,onChange:e=>O(Math.max(1,parseInt(e.target.value)||1)),disabled:!m})]}),"OTRO"===I&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:ti.label,children:"Puntos (manual)"}),(0,i.jsx)("input",{type:"number",style:ti.input,min:"0",value:N,onChange:e=>z(Math.max(0,parseInt(e.target.value)||0)),disabled:!m})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:ti.label,children:"Comentario (opcional)"}),(0,i.jsx)("textarea",{style:{...ti.input,height:"60px"},placeholder:"Escribe un comentario...",value:D,onChange:e=>E(e.target.value),disabled:!m})]}),K.hasConflict&&(0,i.jsx)(e1,{variant:"warning",children:K.message}),(0,i.jsx)("div",{children:(0,i.jsx)("button",{type:"submit",disabled:!m,style:{padding:"10px 16px",fontSize:"14px",fontWeight:600,backgroundColor:m?"#2563eb":"#e5e7eb",color:m?"#ffffff":"#9ca3af",border:"none",borderRadius:"6px",cursor:m?"pointer":"not-allowed",width:"100%",transition:"background-color 0.2s"},children:"Registrar evento"})})]})}),(0,i.jsxs)("div",{style:{flex:1,display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",overflowY:"hidden"},children:[(0,i.jsx)("div",{style:{backgroundColor:"white",border:"1px solid var(--border-subtle)",borderRadius:"12px",padding:"20px",overflowY:"auto",marginBottom:"24px"},children:(0,i.jsx)(eG,{title:"Incidencias del D\xeda",incidents:V,emptyMessage:"No hay incidencias puntuales registradas hoy."})}),(0,i.jsx)("div",{style:{backgroundColor:"white",border:"1px solid var(--border-subtle)",borderRadius:"12px",padding:"20px",overflowY:"auto",marginBottom:"16px"},children:(0,i.jsx)(eG,{title:"Eventos en Curso (Todos)",incidents:Y,emptyMessage:"No hay licencias o vacaciones activas."})})]})]})]})}var to=n(5902),ts=n(1091),tl=n(6705),td=n(6381),tc=n(8736),tp=n(4084);tp.kL.register(tp.uw,tp.f$,tp.ZL,tp.Dx,tp.u,tp.De);let tx=e=>{let{monthLabel:t,onPrev:n,onNext:r}=e;return(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingBottom:"16px",borderBottom:"1px solid #e5e7eb"},children:[(0,i.jsx)("h2",{style:{fontSize:"20px",fontWeight:600,margin:0},children:"Resumen Mensual de Incidencias"}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,i.jsx)("button",{onClick:n,style:{padding:"8px",border:"1px solid var(--border-strong)",borderRadius:"6px",background:"var(--bg-panel)",cursor:"pointer"},children:"<"}),(0,i.jsx)("h3",{style:{fontSize:"16px",fontWeight:600,textTransform:"capitalize",margin:0,minWidth:"150px",textAlign:"center"},children:t}),(0,i.jsx)("button",{onClick:r,style:{padding:"8px",border:"1px solid var(--border-strong)",borderRadius:"6px",background:"var(--bg-panel)",cursor:"pointer"},children:">"})]})]})},tu=e=>{let{icon:t,label:n,value:r,color:a}=e;return(0,i.jsxs)("div",{style:{padding:"16px",background:"var(--bg-panel)",borderRadius:"8px",border:"1px solid var(--border-subtle)",display:"flex",flexDirection:"column",gap:"8px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,i.jsx)(t,{size:18,style:{color:a}}),(0,i.jsx)("span",{style:{fontSize:"13px",color:"var(--text-muted)",fontWeight:500},children:n})]}),(0,i.jsx)("div",{style:{fontSize:"28px",fontWeight:700,color:"var(--text-main)"},children:r})]})},tf=e=>{let{summary:t}=e,n=(0,r.useMemo)(()=>{if(!t)return null;let e=t.byPerson.flatMap(e=>e.incidents),[n,i]=t.month.split("-").map(Number),r=new Date(n,i,0).getDate(),a=Array.from({length:r},(e,t)=>String(t+1)),o=Array(r).fill(0);for(let t of e)if(t.startDate)try{let e=(0,A.D)(t.startDate).getDate();e>0&&e<=r&&(o[e-1]+=1)}catch(e){console.error("Invalid date for incident",t)}return{labels:a,datasets:[{label:"Incidencias por D\xeda",data:o,backgroundColor:o.map(e=>e>=3?"hsl(0, 70%, 60%)":e>0?"hsl(40, 80%, 60%)":"hsl(210, 30%, 85%)"),borderRadius:4,borderSkipped:!1}]}},[t]);return n?(0,i.jsxs)("div",{style:{background:"var(--bg-panel)",padding:"20px",borderRadius:"12px",border:"1px solid var(--border-subtle)",height:"100%"},children:[(0,i.jsx)("h3",{style:{marginTop:0,color:"var(--text-main)"},children:"Incidencias por D\xeda"}),(0,i.jsx)("div",{style:{height:"220px"},children:(0,i.jsx)(tl.$Q,{data:n,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!1},tooltip:{callbacks:{label:function(e){return"Incidencias: ".concat(e.parsed.y)}}}},scales:{x:{grid:{display:!1}},y:{beginAtZero:!0,grid:{color:"#f3f4f6"},ticks:{stepSize:1}}}}})})]}):(0,i.jsx)("div",{style:{height:"240px",background:"#f9fafb",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text-muted)"},children:"Cargando datos del gr\xe1fico..."})},tg=e=>{let{level:t}=e;return(0,i.jsx)("span",{style:{...{danger:{backgroundColor:"#fdecea",color:"#b42318"},warning:{backgroundColor:"#fff3cd",color:"#9a6a00"},ok:{backgroundColor:"#e6f9ee",color:"#1c7c44"}}[t],padding:"4px 10px",borderRadius:"99px",fontSize:"12px",fontWeight:600},children:{danger:"RIESGO",warning:"ATENCI\xd3N",ok:"OK"}[t]})},th=e=>{let{data:t,onSelectRow:n}=e,r={padding:"10px 12px",textAlign:"left",fontSize:"12px",fontWeight:600,color:"var(--text-muted)",textTransform:"uppercase",borderBottom:"1px solid #e5e7eb",opacity:.7},a={padding:"12px",borderTop:"1px solid #f3f4f6",fontSize:"14px"},o=[...t].sort((e,t)=>t.totals.puntos-e.totals.puntos);return(0,i.jsx)("div",{style:{borderRadius:"8px",border:"1px solid var(--border-subtle)",overflow:"hidden",background:"var(--bg-panel)"},children:(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,i.jsx)("thead",{style:{background:"#f9fafb"},children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:r,children:"Representante"}),(0,i.jsx)("th",{style:{...r,textAlign:"center"},children:"Puntos"}),(0,i.jsx)("th",{style:{...r,textAlign:"center"},children:"Ausencias"}),(0,i.jsx)("th",{style:{...r,textAlign:"center"},children:"Tardanzas"}),(0,i.jsx)("th",{style:{...r,textAlign:"center"},children:"Errores"}),(0,i.jsx)("th",{style:{...r,textAlign:"center"},children:"Estado"}),(0,i.jsx)("th",{style:{...r,textAlign:"center"},children:"Acci\xf3n"})]})}),(0,i.jsx)("tbody",{children:o.map(e=>(0,i.jsxs)("tr",{style:{background:"danger"===e.riskLevel?"hsl(0,100%,98%)":"warning"===e.riskLevel?"hsl(45,100%,98%)":"white"},className:"hover-row",children:[(0,i.jsx)("td",{style:{...a,fontWeight:600,color:"var(--text-main)"},children:e.name}),(0,i.jsx)("td",{style:{...a,fontWeight:700,color:e.totals.puntos>0?"#b91c1c":"#374151",textAlign:"center"},children:e.totals.puntos}),(0,i.jsx)("td",{style:{...a,textAlign:"center"},children:e.totals.ausencias}),(0,i.jsx)("td",{style:{...a,textAlign:"center"},children:e.totals.tardanzas}),(0,i.jsx)("td",{style:{...a,textAlign:"center"},children:e.totals.errores}),(0,i.jsx)("td",{style:{...a,textAlign:"center"},children:(0,i.jsx)(tg,{level:e.riskLevel})}),(0,i.jsx)("td",{style:{...a,textAlign:"center"},children:(0,i.jsx)("button",{onClick:()=>n(e),style:{fontSize:"12px",fontWeight:600,color:"#2563eb",background:"#eff6ff",border:"1px solid #dbeafe",padding:"6px 12px",borderRadius:"6px",cursor:"pointer"},children:"Ver detalle"})})]},e.representativeId))})]})})};function ty(){let[e,t]=(0,r.useState)(new Date),[n,a]=(0,r.useState)(""),o=Z(e=>e.openDetailModal),{incidents:s,representatives:l,allCalendarDaysForRelevantMonths:d}=Z(e=>({incidents:e.incidents,representatives:e.representatives,allCalendarDaysForRelevantMonths:e.allCalendarDaysForRelevantMonths})),c=(0,r.useMemo)(()=>(0,k.WU)(e,"yyyy-MM"),[e]),p=(0,r.useMemo)(()=>(0,k.WU)(e,"MMMM yyyy",{locale:eD.es}),[e]),x=function(e){let{incidents:t,representatives:n}=Z(e=>({incidents:e.incidents,representatives:e.representatives}));return(0,r.useMemo)(()=>e&&t&&n?H(t,e,n):null,[t,e,n])}(c),u=(0,r.useMemo)(()=>x&&n.trim()?{...x,byPerson:x.byPerson.filter(e=>e.name.toLowerCase().includes(n.toLowerCase()))}:x,[x,n]),f=(0,r.useMemo)(()=>{if(!x)return{onVacation:0,onLicense:0,atRisk:0};let e=(0,k.WU)(new Date,"yyyy-MM-dd"),t=s.filter(e=>"VACACIONES"===e.type),n=new Set;t.forEach(t=>{let i=l.find(e=>e.id===t.representativeId);i&&W(t,d,i).dates.includes(e)&&n.add(t.representativeId)});let i=s.filter(e=>"LICENCIA"===e.type),r=new Set;i.forEach(t=>{let n=l.find(e=>e.id===t.representativeId);n&&W(t,d,n).dates.includes(e)&&r.add(t.representativeId)});let a=x.byPerson.filter(e=>e.totals.puntos>=10).length;return{onVacation:n.size,onLicense:r.size,atRisk:a}},[x,s,l,d]);return x?(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"24px",padding:"24px"},className:"jsx-9414da19be6453a5",children:[(0,i.jsx)(e5(),{id:"9414da19be6453a5",children:".hover-row:hover{background-color:#f9fafb!important}"}),(0,i.jsx)(tx,{monthLabel:p,onPrev:()=>t(e=>(0,to.W)(e,1)),onNext:()=>t(e=>(0,ts.z)(e,1))}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"24px",marginBottom:"32px"},className:"jsx-9414da19be6453a5",children:[(0,i.jsx)(tu,{icon:td.Z,label:"De Vacaciones",value:f.onVacation,color:"#2563eb"}),(0,i.jsx)(tu,{icon:tc.Z,label:"De Licencia",value:f.onLicense,color:"#7c3aed"}),(0,i.jsx)(tu,{icon:ep.Z,label:"En Riesgo (≥10 pts)",value:f.atRisk,color:"#dc2626"})]}),(0,i.jsx)("div",{style:{marginBottom:"32px",paddingBottom:"16px",borderBottom:"1px dashed #e5e7eb"},className:"jsx-9414da19be6453a5",children:(0,i.jsx)(tf,{summary:x})}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},className:"jsx-9414da19be6453a5",children:[(0,i.jsx)("label",{style:{fontSize:"14px",fontWeight:600,color:"var(--text-main)"},className:"jsx-9414da19be6453a5",children:"Buscar Representante"}),(0,i.jsx)("input",{type:"text",placeholder:"Escribe el nombre del representante...",value:n,onChange:e=>a(e.target.value),style:{width:"100%",padding:"10px 14px",border:"1px solid var(--border-strong)",borderRadius:"8px",fontSize:"14px",outline:"none",transition:"border-color 0.2s"},onFocus:e=>e.target.style.borderColor="#2563eb",onBlur:e=>e.target.style.borderColor="#d1d5db",className:"jsx-9414da19be6453a5"}),n&&u&&(0,i.jsxs)("div",{style:{fontSize:"13px",color:"var(--text-muted)"},className:"jsx-9414da19be6453a5",children:["Mostrando ",u.byPerson.length," de ",(null==x?void 0:x.byPerson.length)||0," representantes"]})]}),(0,i.jsx)("div",{style:{marginTop:"16px"},className:"jsx-9414da19be6453a5",children:(0,i.jsx)(th,{data:(null==u?void 0:u.byPerson)||[],onSelectRow:e=>{o(e.representativeId,c)}})})]}):(0,i.jsx)("div",{style:{padding:"40px"},children:"Cargando resumen mensual..."})}let tb=["TARDANZA","AUSENCIA","ERROR","OTRO"];var tm=n(2735),tv=n(4857);let tj=e=>{let{monthLabel:t,onPrev:n,onNext:r}=e;return(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingBottom:"16px",borderBottom:"1px solid #e5e7eb"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{style:{fontSize:"20px",fontWeight:600,margin:0},children:"Reporte de Puntos por Incidencia"}),(0,i.jsx)("p",{style:{margin:"4px 0 0",color:"var(--text-muted)",fontSize:"14px"},children:"Resumen mensual de incidencias punitivas y puntos, segmentado por rol y turno."})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,i.jsx)("button",{onClick:n,style:{padding:"8px",border:"1px solid var(--border-strong)",borderRadius:"6px",background:"var(--bg-panel)",cursor:"pointer"},children:"<"}),(0,i.jsx)("h3",{style:{fontSize:"16px",fontWeight:600,textTransform:"capitalize",margin:0,minWidth:"150px",textAlign:"center"},children:t}),(0,i.jsx)("button",{onClick:r,style:{padding:"8px",border:"1px solid var(--border-strong)",borderRadius:"6px",background:"var(--bg-panel)",cursor:"pointer"},children:">"})]})]})},tS=e=>{let{title:t,data:n,onCopy:r}=e,a=()=>{let e=e=>0===e?"":e;return n.map(t=>[e(t.tardanza),e(t.ausencia),e(t.errores),e(t.otros)].join("	")).join("\n")},o={padding:"10px 12px",textAlign:"left",fontSize:"12px",fontWeight:600,color:"var(--text-muted)",textTransform:"uppercase",borderBottom:"1px solid #e5e7eb"},s={padding:"10px 12px",borderTop:"1px solid #f3f4f6",fontSize:"14px"};return(0,i.jsxs)("section",{children:[(0,i.jsxs)("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[(0,i.jsx)("h3",{style:{fontSize:"16px",fontWeight:600,margin:0},children:t}),(0,i.jsx)("div",{style:{display:"flex",gap:"10px"},children:(0,i.jsxs)("button",{onClick:()=>r(a(),t),style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px",padding:"6px 12px",background:"#eef2ff",color:"#312e81",border:"1px solid #c7d2fe",borderRadius:"6px",cursor:"pointer",fontWeight:600},children:[(0,i.jsx)(tm.Z,{size:14})," Copiar Puntos (para Excel)"]})})]}),(0,i.jsx)("div",{style:{border:"1px solid var(--border-subtle)",borderRadius:"8px",overflow:"hidden",background:"var(--bg-panel)"},children:(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,i.jsx)("thead",{style:{background:"#f9fafb"},children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:o,children:"Empleado"}),(0,i.jsx)("th",{style:{...o,textAlign:"right"},children:"Tardanza"}),(0,i.jsx)("th",{style:{...o,textAlign:"right"},children:"Ausencia"}),(0,i.jsx)("th",{style:{...o,textAlign:"right"},children:"Errores"}),(0,i.jsx)("th",{style:{...o,textAlign:"right"},children:"Otros"}),(0,i.jsx)("th",{style:{...o,textAlign:"right"},children:"Total"})]})}),(0,i.jsxs)("tbody",{children:[n.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{...s,fontWeight:500},children:e.repName}),(0,i.jsx)("td",{style:{...s,textAlign:"right"},children:e.tardanza>0?e.tardanza:""}),(0,i.jsx)("td",{style:{...s,textAlign:"right"},children:e.ausencia>0?e.ausencia:""}),(0,i.jsx)("td",{style:{...s,textAlign:"right"},children:e.errores>0?e.errores:""}),(0,i.jsx)("td",{style:{...s,textAlign:"right"},children:e.otros>0?e.otros:""}),(0,i.jsx)("td",{style:{...s,textAlign:"right",fontWeight:700,color:e.total>0?"#b91c1c":"#1f2937"},children:e.total})]},e.repId)),0===n.length&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:6,style:{...s,textAlign:"center",color:"#9ca3af",fontStyle:"italic"},children:"No hay representantes en esta categor\xeda."})})]})]})})]})};function tI(){let[e,t]=(0,r.useState)(new Date),{representatives:n,incidents:a}=Z(e=>({representatives:e.representatives,incidents:e.incidents})),[o,s]=(0,r.useState)(!1),l=(0,r.useMemo)(()=>(0,k.WU)(e,"yyyy-MM"),[e]),d=(0,r.useMemo)(()=>(0,k.WU)(e,"MMMM yyyy",{locale:eD.es}),[e]),c=(0,r.useMemo)(()=>(function(e,t,n){let i=t.filter(e=>tb.includes(e.type)&&e.startDate.startsWith(n)),r=e=>e.map(e=>{let t={repId:e.id,repName:e.name,tardanza:0,ausencia:0,errores:0,otros:0,total:0};return i.filter(t=>t.representativeId===e.id).forEach(e=>{var n;let i="OTRO"===e.type?null!==(n=e.customPoints)&&void 0!==n?n:0:F(e);switch(e.type){case"TARDANZA":t.tardanza+=i;break;case"AUSENCIA":t.ausencia+=i;break;case"ERROR":t.errores+=i;break;case"OTRO":t.otros+=i}}),t.total=t.tardanza+t.ausencia+t.errores+t.otros,t}),a=(t,n)=>e.filter(e=>{var i;return!1!==e.isActive&&(null!==(i=e.role)&&void 0!==i?i:"SALES")===t&&e.baseShift===n});return{salesDay:r(a("SALES","DAY")),salesNight:r(a("SALES","NIGHT")),serviceDay:r(a("CUSTOMER_SERVICE","DAY")),serviceNight:r(a("CUSTOMER_SERVICE","NIGHT"))}})(n,a,l),[n,a,l]),p=(e,t)=>{navigator.clipboard.writeText(e).then(()=>{s(t),setTimeout(()=>s(!1),2500)})};return(0,i.jsxs)("div",{style:{padding:"24px",display:"flex",flexDirection:"column",gap:"24px"},children:[(0,i.jsx)(tj,{monthLabel:d,onPrev:()=>t(e=>(0,to.W)(e,1)),onNext:()=>t(e=>(0,ts.z)(e,1))}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"32px"},children:[(0,i.jsx)(tS,{title:"Ventas - Turno D\xeda",data:c.salesDay,onCopy:p}),(0,i.jsx)(tS,{title:"Ventas - Turno Noche",data:c.salesNight,onCopy:p}),(0,i.jsx)(tS,{title:"Servicio al Cliente - Turno D\xeda",data:c.serviceDay,onCopy:p}),(0,i.jsx)(tS,{title:"Servicio al Cliente - Turno Noche",data:c.serviceNight,onCopy:p})]}),o&&(0,i.jsxs)("div",{style:{position:"fixed",bottom:"24px",left:"50%",transform:"translateX(-50%)",padding:"12px 24px",background:"#1f2937",color:"white",borderRadius:"8px",display:"flex",alignItems:"center",gap:"10px",zIndex:100},children:[(0,i.jsx)(tv.Z,{size:18}),(0,i.jsxs)("span",{children:['Matriz de puntos para "',o,'" copiada.']})]})]})}var tC=n(5527),tD=n(1567),tk=n(3085),tE=n(8896),tA=n(3327);function tR(e){return Math.round(10*e)/10}function tw(e,t){let n=e.filter(e=>e.shift===t);if(0===n.length)return{incidents:0,points:0,avgPointsPerRep:0};let i=n.reduce((e,t)=>e+t.points,0);return{incidents:n.reduce((e,t)=>e+t.incidents,0),points:i,avgPointsPerRep:tR(i/n.length)}}let tO=(e,t,n)=>(function(e,t,n,i){let r=e.filter(e=>!1!==e.isActive),a=t.filter(e=>e.startDate>=n&&e.startDate<=i),o=new Map;r.forEach(e=>{o.set(e.id,{repId:e.id,name:e.name,shift:e.baseShift,incidents:0,points:0})}),a.forEach(e=>{let t=o.get(e.representativeId);if(!t)return;let n=F(e);n>0&&(t.incidents++,t.points+=n)});let s=Array.from(o.values()),l=s.reduce((e,t)=>e+t.incidents,0),d=s.reduce((e,t)=>e+t.points,0),c=0===s.length?0:d/s.length,p={DAY:tw(s,"DAY"),NIGHT:tw(s,"NIGHT")},x=function(e){let t=new Map;return e.forEach(e=>{let n=t.get(e.type)||{type:e.type,count:0,points:0};n.count++,n.points+=F(e),t.set(e.type,n)}),Array.from(t.values()).sort((e,t)=>t.count-e.count)}(a.filter(e=>F(e)>0));return{period:{from:n,to:i},kpis:{totalIncidents:l,totalPoints:d,averagePointsPerRep:tR(c)},shifts:p,incidentTypes:x,candidates:s.filter(e=>0===e.incidents).sort((e,t)=>e.name.localeCompare(t.name)),needsAttention:s.filter(e=>e.points>0).sort((e,t)=>t.points-e.points)}})(e.representatives,e.incidents,t,n),tN=[{label:"\xdaltimos 7 d\xedas",days:7},{label:"\xdaltimos 30 d\xedas",days:30},{label:"Este Trimestre",days:"quarter"},{label:"\xdaltimos 90 d\xedas",days:90}],tz=e=>{let{onPeriodChange:t}=e;return(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingBottom:"16px",borderBottom:"1px solid #e5e7eb"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{style:{fontSize:"20px",fontWeight:600,margin:0},children:"Reporte Ejecutivo de Desempe\xf1o"}),(0,i.jsx)("p",{style:{margin:"4px 0 0",color:"var(--text-muted)",fontSize:"14px"},children:"Vista panor\xe1mica de incidencias y rendimiento del equipo."})]}),(0,i.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:(0,i.jsx)("select",{onChange:e=>t(e.target.value),defaultValue:30,style:{padding:"8px 12px",border:"1px solid var(--border-strong)",borderRadius:"6px",background:"var(--bg-panel)",cursor:"pointer",fontSize:"14px"},children:tN.map(e=>(0,i.jsx)("option",{value:e.days,children:e.label},e.label))})})]})},tT=e=>{let{label:t,value:n,Icon:r}=e;return(0,i.jsxs)("div",{style:{background:"var(--bg-panel)",border:"1px solid var(--border-subtle)",borderRadius:"8px",padding:"16px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"var(--text-muted)",fontSize:"14px",fontWeight:500},children:[(0,i.jsx)(r,{size:16}),(0,i.jsx)("span",{children:t})]}),(0,i.jsx)("div",{style:{marginTop:"8px",fontSize:"28px",fontWeight:700,color:"var(--text-main)"},children:n})]})},tM=e=>{let{shift:t,stats:n}=e;return(0,i.jsxs)("div",{style:{background:"var(--bg-panel)",border:"1px solid var(--border-subtle)",borderRadius:"8px",padding:"16px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"DAY"===t?"#b45309":"#312e81",fontSize:"16px",fontWeight:600},children:["DAY"===t?(0,i.jsx)(Q.Z,{size:18}):(0,i.jsx)(ed.Z,{size:18}),(0,i.jsxs)("span",{children:["Turno ","DAY"===t?"D\xeda":"Noche"]})]}),(0,i.jsxs)("div",{style:{marginTop:"12px",display:"flex",justifyContent:"space-around"},children:[(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("div",{style:{fontSize:12,color:"var(--text-muted)"},children:"Incidencias"}),(0,i.jsx)("div",{style:{fontSize:20,fontWeight:700},children:n.incidents})]}),(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("div",{style:{fontSize:12,color:"var(--text-muted)"},children:"Puntos"}),(0,i.jsx)("div",{style:{fontSize:20,fontWeight:700},children:n.points})]}),(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("div",{style:{fontSize:12,color:"var(--text-muted)"},children:"Ptos/Rep"}),(0,i.jsx)("div",{style:{fontSize:20,fontWeight:700},children:n.avgPointsPerRep})]})]})]})},tW=e=>{let{title:t,data:n,icon:r,variant:a}=e,o={padding:"8px 12px",fontSize:"14px",borderTop:"1px solid #f3f4f6"};return(0,i.jsxs)("div",{style:{border:"1px solid var(--border-subtle)",borderRadius:"12px",background:"var(--bg-panel)",height:"100%"},children:[(0,i.jsxs)("header",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",borderBottom:"1px solid #e5e7eb",color:"success"===a?"#059669":"#b91c1c"},children:[(0,i.jsx)(r,{size:20}),(0,i.jsxs)("h3",{style:{fontSize:"16px",fontWeight:600,margin:0},children:[t," (",n.length,")"]})]}),(0,i.jsx)("div",{style:{maxHeight:"250px",overflowY:"auto"},children:(0,i.jsx)("table",{style:{width:"100%",borderCollapse:"collapse"},children:(0,i.jsxs)("tbody",{children:[n.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{...o,fontWeight:500},children:e.name}),(0,i.jsx)("td",{style:{...o,textAlign:"right",fontWeight:700,color:"danger"===a&&e.points>0?"#b91c1c":"#374151"},children:e.points>0?"".concat(e.points," pts"):""})]},e.repId)),0===n.length&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:2,style:{...o,textAlign:"center",color:"var(--text-muted)",fontStyle:"italic"},children:"No hay representantes en esta categor\xeda."})})]})})})]})},tL=e=>{let{data:t}=e;return(0,i.jsxs)("div",{style:{border:"1px solid var(--border-subtle)",borderRadius:"12px",background:"var(--bg-panel)"},children:[(0,i.jsxs)("header",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",borderBottom:"1px solid #e5e7eb"},children:[(0,i.jsx)(tc.Z,{size:18}),(0,i.jsx)("h3",{style:{fontSize:"16px",fontWeight:600,margin:0},children:"Desglose por Tipo de Incidencia"})]}),(0,i.jsxs)("div",{style:{padding:"16px",display:"flex",flexDirection:"column",gap:"10px"},children:[t.map(e=>{let t=eL[e.type]||eL.OTRO;return(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("span",{style:{fontWeight:500,color:"var(--text-main)",fontSize:"14px"},children:t.label}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[(0,i.jsxs)("span",{style:{fontSize:"14px"},children:[(0,i.jsx)("strong",{children:e.count})," evento(s)"]}),(0,i.jsxs)("span",{style:{fontSize:"14px",fontWeight:700,color:"#b91c1c"},children:[e.points," pts"]})]})]},e.type)}),0===t.length&&(0,i.jsx)("div",{style:{textAlign:"center",color:"var(--text-muted)",fontStyle:"italic",padding:"20px 0"},children:"No hay incidencias punitivas en este per\xedodo."})]})]})};function tB(){let[e,t]=(0,r.useState)(30),{from:n,to:a}=(0,r.useMemo)(()=>{let t;let n=new Date;return t="quarter"===e?(0,tC.x)(n):(0,e2.k)(n,e),{from:(0,k.WU)(t,"yyyy-MM-dd"),to:(0,k.WU)(n,"yyyy-MM-dd")}},[e]),o=Z(e=>tO(e,n,a));return o?(0,i.jsxs)("div",{style:{padding:"24px",display:"flex",flexDirection:"column",gap:"24px"},children:[(0,i.jsx)(tz,{onPeriodChange:t}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",marginBottom:"32px"},children:[(0,i.jsx)(tT,{label:"Total Incidencias",value:o.kpis.totalIncidents,Icon:tD.Z}),(0,i.jsx)(tT,{label:"Total Puntos",value:o.kpis.totalPoints,Icon:tk.Z}),(0,i.jsx)(tT,{label:"Puntos / Rep Prom.",value:o.kpis.averagePointsPerRep,Icon:tE.Z})]}),(0,i.jsx)("div",{style:{marginBottom:"24px"},children:(0,i.jsx)(tW,{title:"Requieren Atenci\xf3n",data:o.needsAttention,icon:tk.Z,variant:"danger"})}),(0,i.jsx)("div",{style:{marginBottom:"32px",paddingBottom:"16px",borderBottom:"1px dashed #e5e7eb"},children:(0,i.jsx)(tW,{title:"Candidatos Destacados",data:o.candidates,icon:tA.Z,variant:"success"})}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"24px"},children:[(0,i.jsx)(tM,{shift:"DAY",stats:o.shifts.DAY}),(0,i.jsx)(tM,{shift:"NIGHT",stats:o.shifts.NIGHT})]}),(0,i.jsx)("div",{style:{marginTop:"16px"},children:(0,i.jsx)(tL,{data:o.incidentTypes})})]}):(0,i.jsx)("div",{children:"Cargando reporte..."})}function tF(){let[e,t]=(0,r.useState)("monthly"),n=e=>({padding:"10px 20px",cursor:"pointer",border:"none",borderBottom:e?"2px solid hsl(0, 0%, 13%)":"2px solid transparent",color:e?"#111827":"#4b5563",fontWeight:e?600:500,background:"transparent",fontSize:"15px"});return(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,i.jsxs)("div",{style:{background:"var(--bg-panel)",borderRadius:"12px 12px 0 0",padding:"0 16px",border:"1px solid var(--border-subtle)",borderBottom:"none"},children:[(0,i.jsx)("button",{style:n("monthly"===e),onClick:()=>t("monthly"),children:"Resumen Mensual"}),(0,i.jsx)("button",{style:n("points"===e),onClick:()=>t("points"),children:"Reporte de Puntos"}),(0,i.jsx)("button",{style:n("executive"===e),onClick:()=>t("executive"),children:"Reporte Ejecutivo"})]}),(0,i.jsxs)("div",{style:{background:"var(--bg-panel)",borderRadius:"0 0 12px 12px",border:"1px solid var(--border-subtle)",borderTop:"none",minHeight:"80vh"},children:["monthly"===e&&(0,i.jsx)(ty,{}),"points"===e&&(0,i.jsx)(tI,{}),"executive"===e&&(0,i.jsx)(tB,{})]})]})}var tH=n(9397);function tP(){let{calendar:e,addOrUpdateSpecialDay:t,removeSpecialDay:n}=Z(e=>({calendar:e.calendar,addOrUpdateSpecialDay:e.addOrUpdateSpecialDay,removeSpecialDay:e.removeSpecialDay})),{mode:a}=es(),[o,s]=(0,r.useState)(""),[l,d]=(0,r.useState)(""),c=e.specialDays.filter(e=>"HOLIDAY"===e.kind).sort((e,t)=>e.date.localeCompare(t.date)),p=()=>{if(!o.trim()){alert("Debe ingresar una fecha");return}if(!l.trim()){alert("Debe ingresar un nombre para el feriado");return}t({date:o,kind:"HOLIDAY",label:l.trim()}),s(""),d("")},x=e=>{confirm("\xbfEliminar este feriado?")&&n(e)},u=e=>{try{return new Date(e+"T12:00:00Z").toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})}catch(t){return e}};return(0,i.jsxs)("div",{style:{maxWidth:"800px",margin:"0 auto"},children:[(0,i.jsxs)("div",{style:{marginBottom:"30px"},children:[(0,i.jsx)("h2",{style:{margin:0,marginBottom:"8px",fontSize:"20px",color:"var(--text-main)"},children:"Feriados del A\xf1o"}),(0,i.jsx)("p",{style:{margin:0,fontSize:"14px",color:"var(--text-muted)"},children:"Los d\xedas marcados como feriados ser\xe1n excluidos autom\xe1ticamente del c\xe1lculo de vacaciones."})]}),(0,i.jsxs)("div",{style:{background:"#f9fafb",padding:"20px",borderRadius:"8px",border:"1px solid var(--border-subtle)",marginBottom:"24px"},children:[(0,i.jsx)("h3",{style:{margin:"0 0 16px 0",fontSize:"16px",color:"var(--text-main)"},children:"Agregar Feriado"}),(0,i.jsxs)("div",{style:{display:"flex",gap:"12px",alignItems:"flex-end"},children:[(0,i.jsxs)("div",{style:{flex:"0 0 160px"},children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"var(--text-main)"},children:"Fecha"}),(0,i.jsx)("input",{type:"date",value:o,onChange:e=>s(e.target.value),style:{width:"100%",padding:"8px 10px",border:"1px solid var(--border-strong)",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box"}})]}),(0,i.jsxs)("div",{style:{flex:1},children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"var(--text-main)"},children:"Nombre del Feriado"}),(0,i.jsx)("input",{type:"text",value:l,onChange:e=>d(e.target.value),placeholder:"Ej: D\xeda de la Independencia",style:{width:"100%",padding:"8px 10px",border:"1px solid var(--border-strong)",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box"},onKeyPress:e=>{"Enter"===e.key&&p()}})]}),(0,i.jsxs)("button",{onClick:p,style:{padding:"8px 16px",background:"#111827",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:600,fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:[(0,i.jsx)(tH.Z,{size:16}),"Agregar"]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("h3",{style:{margin:"0 0 12px 0",fontSize:"16px",color:"var(--text-main)"},children:["Feriados Configurados (",c.length,")"]}),0===c.length?(0,i.jsxs)("div",{style:{padding:"40px",textAlign:"center",background:"#f9fafb",borderRadius:"8px",border:"1px solid var(--border-subtle)"},children:[(0,i.jsx)(eQ.Z,{size:48,style:{color:"#d1d5db",margin:"0 auto 12px"}}),(0,i.jsx)("p",{style:{margin:0,color:"var(--text-muted)",fontSize:"14px"},children:"No hay feriados configurados"}),(0,i.jsx)("p",{style:{margin:"8px 0 0 0",color:"#9ca3af",fontSize:"13px"},children:"Agregue los feriados del a\xf1o para que se excluyan del c\xe1lculo de vacaciones"})]}):(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:c.map(e=>(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 16px",background:"var(--bg-panel)",border:"1px solid var(--border-subtle)",borderRadius:"6px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,i.jsx)("div",{style:{width:"4px",height:"40px",background:"#fbbf24",borderRadius:"2px"}}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontWeight:600,fontSize:"14px",color:"var(--text-main)"},children:e.label}),(0,i.jsx)("div",{style:{fontSize:"13px",color:"var(--text-muted)",marginTop:"2px"},children:u(e.date)})]})]}),"ADMIN_OVERRIDE"===a&&(0,i.jsx)("button",{onClick:()=>x(e.date),style:{padding:"8px",background:"transparent",border:"none",cursor:"pointer",color:"#ef4444",display:"flex",alignItems:"center",borderRadius:"4px"},title:"Eliminar feriado",children:(0,i.jsx)(eH.Z,{size:18})})]},e.date))})]})]})}function tU(e,t){return e.filter(e=>e.baseShift===t&&e.isActive).sort((e,t)=>e.orderIndex-t.orderIndex)}var tV=n(795),tY=n(3662),tG=n(9892),tZ=n(5868),t_=n(1005);let tK=e=>{let{selectedDays:t,onToggle:n}=e;return(0,i.jsx)("div",{style:{display:"flex",gap:"4px"},children:["D","L","M","X","J","V","S"].map((e,r)=>(0,i.jsx)("button",{type:"button",onClick:()=>n(r),style:{width:"36px",height:"36px",borderRadius:"50%",border:"2px solid",cursor:"pointer",fontWeight:600,fontSize:"13px",display:"flex",alignItems:"center",justifyContent:"center",background:t.includes(r)?"#eef2ff":"white",borderColor:t.includes(r)?"#6366f1":"#d1d5db",color:t.includes(r)?"#4f46e5":"#6b7280",transition:"all 120ms ease"},children:e},r))})};function tq(e){var t,n;let{repId:a,repName:o,onSave:s}=e,[l,d]=(0,r.useState)({intent:null,days:[],replaceBaseMixedDays:!0}),c=Z(e=>e.addSpecialSchedule),p=Z(e=>{var t;return null!==(t=e.representatives)&&void 0!==t?t:[]}).find(e=>e.id===a),x=(null==p?void 0:null===(t=p.mixProfile)||void 0===t?void 0:t.type)==="WEEKDAY"?[1,2,3,4]:(null==p?void 0:null===(n=p.mixProfile)||void 0===n?void 0:n.type)==="WEEKEND"?[5,6,0]:[],u=x.length>0,f=e=>{d(t=>({...t,...e}))},g=["Domingo","Lunes","Martes","Mi\xe9rcoles","Jueves","Viernes","S\xe1bado"],h=l.days.sort((e,t)=>e-t).map(e=>g[e]).join(", "),y=(0,r.useMemo)(()=>{if(!l.startDate||!l.endDate)return null;try{return(0,t_.p)((0,A.D)(l.endDate),(0,A.D)(l.startDate))}catch(e){return null}},[l.startDate,l.endDate]),b=l.intent&&l.days.length>0&&l.startDate&&l.endDate,m=(0,r.useMemo)(()=>{if(!b)return null;let e="";switch(l.intent){case"WORK_SINGLE_SHIFT":e="DAY"===l.shift?"Trabajar\xe1 en turno D\xeda":"Trabajar\xe1 en turno Noche";break;case"WORK_BOTH_SHIFTS":e="Trabajar\xe1 en ambos turnos (mixto)";break;case"OFF":e="No trabajar\xe1 (libre)"}return{action:e,period:"".concat((0,k.WU)((0,A.D)(l.startDate),"dd/MM/yyyy")," – ").concat((0,k.WU)((0,A.D)(l.endDate),"dd/MM/yyyy")),days:h}},[b,l.intent,l.shift,l.startDate,l.endDate,h]),v=e=>({display:"flex",alignItems:"center",gap:"12px",padding:"14px 16px",border:"2px solid",borderRadius:"8px",borderColor:e?"#6366f1":"#e5e7eb",background:e?"#f5f3ff":"white",cursor:"pointer",transition:"all 120ms ease",fontSize:"15px",fontWeight:500,color:e?"#4f46e5":"#374151"});return(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault();try{(function(e,t){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!e.intent)throw Error("Debe seleccionar qu\xe9 pasar\xe1 en esos d\xedas");if(!e.startDate||!e.endDate)throw Error("Debe especificar el per\xedodo (fechas de inicio y fin)");if(0===e.days.length)throw Error("Debe seleccionar al menos un d\xeda de la semana");let r=[];if("WORK_BOTH_SHIFTS"===e.intent&&!0===e.replaceBaseMixedDays&&i.length>0){let n=i.filter(t=>!e.days.includes(t));n.length>0&&r.push({representativeId:t,startDate:e.startDate,endDate:e.endDate,daysOfWeek:n,assignment:{type:"NONE"},reason:"Reemplazo de d\xedas mixtos base"})}switch(e.intent){case"WORK_SINGLE_SHIFT":if(!e.shift)throw Error("Debe seleccionar el turno espec\xedfico");n={type:"SINGLE",shift:e.shift};break;case"WORK_BOTH_SHIFTS":n={type:"BOTH"};break;case"OFF":n={type:"NONE"}}return r.push({representativeId:t,startDate:e.startDate,endDate:e.endDate,daysOfWeek:e.days,assignment:n,reason:e.note||void 0}),r})(l,a,x).forEach(e=>c(e)),s()}catch(e){alert(e instanceof Error?e.message:"Error al guardar")}},style:{background:"var(--bg-panel)",padding:"24px",borderRadius:"12px",border:"1px solid var(--border-subtle)",margin:"16px 0",display:"flex",flexDirection:"column",gap:"24px"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{style:{margin:0,fontSize:"18px",fontWeight:600,color:"var(--text-main)"},children:"Ajuste temporal de horario"}),(0,i.jsx)("p",{style:{margin:"4px 0 0 0",fontSize:"14px",color:"var(--text-muted)"},children:"Define excepciones al horario habitual durante un per\xedodo"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"15px",fontWeight:600,marginBottom:"12px",color:"var(--text-main)"},children:"\xbfQu\xe9 cambio necesitas?"}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,i.jsxs)("label",{style:v("WORK_SINGLE_SHIFT"===l.intent),children:[(0,i.jsx)("input",{type:"radio",name:"intent",checked:"WORK_SINGLE_SHIFT"===l.intent,onChange:()=>f({intent:"WORK_SINGLE_SHIFT",shift:"DAY"}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"Trabajar\xe1 en un turno espec\xedfico"]}),(0,i.jsxs)("label",{style:v("WORK_BOTH_SHIFTS"===l.intent),children:[(0,i.jsx)("input",{type:"radio",name:"intent",checked:"WORK_BOTH_SHIFTS"===l.intent,onChange:()=>f({intent:"WORK_BOTH_SHIFTS",shift:void 0}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"Trabajar\xe1 en ambos turnos (mixto)"]}),(0,i.jsxs)("label",{style:v("OFF"===l.intent),children:[(0,i.jsx)("input",{type:"radio",name:"intent",checked:"OFF"===l.intent,onChange:()=>f({intent:"OFF",shift:void 0}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"No trabajar\xe1 (libre)"]})]})]}),"WORK_BOTH_SHIFTS"===l.intent&&u&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"15px",fontWeight:600,marginBottom:"12px",color:"var(--text-main)"},children:"\xbfEste ajuste reemplaza los d\xedas mixtos habituales?"}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,i.jsxs)("label",{style:v(!0===l.replaceBaseMixedDays),children:[(0,i.jsx)("input",{type:"radio",name:"replaceBaseMixedDays",checked:!0===l.replaceBaseMixedDays,onChange:()=>f({replaceBaseMixedDays:!0}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"S\xed, solo estos d\xedas ser\xe1n mixtos"]}),(0,i.jsxs)("label",{style:v(!1===l.replaceBaseMixedDays),children:[(0,i.jsx)("input",{type:"radio",name:"replaceBaseMixedDays",checked:!1===l.replaceBaseMixedDays,onChange:()=>f({replaceBaseMixedDays:!1}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"No, se suman a los habituales (caso especial)"]})]})]}),"WORK_SINGLE_SHIFT"===l.intent&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"15px",fontWeight:600,marginBottom:"12px",color:"var(--text-main)"},children:"\xbfEn qu\xe9 turno trabajar\xe1?"}),(0,i.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,i.jsxs)("label",{style:v("DAY"===l.shift),children:[(0,i.jsx)("input",{type:"radio",name:"shift",checked:"DAY"===l.shift,onChange:()=>f({shift:"DAY"}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"Turno D\xeda"]}),(0,i.jsxs)("label",{style:v("NIGHT"===l.shift),children:[(0,i.jsx)("input",{type:"radio",name:"shift",checked:"NIGHT"===l.shift,onChange:()=>f({shift:"NIGHT"}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"Turno Noche"]})]})]}),"WORK_BOTH_SHIFTS"===l.intent&&(0,i.jsx)("div",{style:{padding:"12px 16px",background:"#f0fdf4",border:"1px solid #86efac",borderRadius:"8px",fontSize:"14px",color:"#166534"},children:"Trabajar\xe1 en ambos turnos"}),"OFF"===l.intent&&(0,i.jsx)("div",{style:{padding:"12px 16px",background:"#fef3c7",border:"1px solid #fde047",borderRadius:"8px",fontSize:"14px",color:"#854d0e"},children:"No tendr\xe1 asignaci\xf3n"}),l.intent&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"15px",fontWeight:600,marginBottom:"8px",color:"var(--text-main)"},children:"\xbfQu\xe9 d\xedas se ver\xe1n afectados?"}),(0,i.jsx)(tK,{selectedDays:l.days,onToggle:e=>{f({days:l.days.includes(e)?l.days.filter(t=>t!==e):[...l.days,e]})}}),(0,i.jsxs)("div",{style:{marginTop:"12px",display:"flex",gap:"8px",flexWrap:"wrap"},children:[(0,i.jsx)("button",{type:"button",onClick:()=>f({days:[1,2,3,4,5]}),style:{padding:"6px 12px",fontSize:"13px",border:"1px solid var(--border-strong)",borderRadius:"6px",background:"var(--bg-panel)",cursor:"pointer"},children:"Lunes a Viernes"}),(0,i.jsx)("button",{type:"button",onClick:()=>f({days:[0,6]}),style:{padding:"6px 12px",fontSize:"13px",border:"1px solid var(--border-strong)",borderRadius:"6px",background:"var(--bg-panel)",cursor:"pointer"},children:"Fin de semana"}),(0,i.jsx)("button",{type:"button",onClick:()=>f({days:[0,1,2,3,4,5,6]}),style:{padding:"6px 12px",fontSize:"13px",border:"1px solid var(--border-strong)",borderRadius:"6px",background:"var(--bg-panel)",cursor:"pointer"},children:"Todos"})]}),l.days.length>0&&(0,i.jsxs)("p",{style:{marginTop:"8px",fontSize:"14px",color:"var(--text-muted)"},children:["Se aplicar\xe1 los ",(0,i.jsx)("strong",{children:h})]})]}),l.intent&&l.days.length>0&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"15px",fontWeight:600,marginBottom:"12px",color:"var(--text-main)"},children:"\xbfDurante qu\xe9 per\xedodo aplica este ajuste?"}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"var(--text-muted)"},children:"Desde"}),(0,i.jsx)("input",{type:"date",value:l.startDate||"",onChange:e=>f({startDate:e.target.value}),style:{width:"100%",padding:"10px",border:"1px solid var(--border-strong)",borderRadius:"6px",fontSize:"14px"}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"var(--text-muted)"},children:"Hasta"}),(0,i.jsx)("input",{type:"date",value:l.endDate||"",onChange:e=>f({endDate:e.target.value}),style:{width:"100%",padding:"10px",border:"1px solid var(--border-strong)",borderRadius:"6px",fontSize:"14px"}})]})]}),null!==y&&y>=0&&(0,i.jsxs)("p",{style:{marginTop:"8px",fontSize:"14px",color:"var(--text-muted)"},children:["Este ajuste estar\xe1 activo durante ",(0,i.jsxs)("strong",{children:[y," semana",1!==y?"s":""]})]})]}),m&&(0,i.jsxs)("div",{style:{padding:"16px",background:"#f9fafb",border:"2px solid #e5e7eb",borderRadius:"8px"},children:[(0,i.jsx)("div",{style:{fontSize:"13px",fontWeight:600,color:"var(--text-muted)",marginBottom:"8px"},children:"\uD83E\uDDFE Resumen del ajuste"}),(0,i.jsxs)("div",{style:{fontSize:"15px",color:"var(--text-main)",lineHeight:1.6},children:[(0,i.jsx)("div",{style:{fontWeight:600,marginBottom:"4px"},children:o}),(0,i.jsxs)("div",{children:["Durante el per\xedodo ",(0,i.jsx)("strong",{children:m.period})]}),(0,i.jsx)("div",{children:(0,i.jsx)("strong",{children:m.action})}),(0,i.jsxs)("div",{children:["Los d\xedas: ",(0,i.jsx)("strong",{children:m.days})]})]})]}),l.intent&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"var(--text-muted)"},children:"Motivo (opcional)"}),(0,i.jsx)("input",{type:"text",value:l.note||"",onChange:e=>f({note:e.target.value}),placeholder:"Ej: Universidad, Capacitaci\xf3n, Familiar enfermo",style:{width:"100%",padding:"10px",border:"1px solid var(--border-strong)",borderRadius:"6px",fontSize:"14px"}})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",paddingTop:"8px",borderTop:"1px solid #e5e7eb"},children:[(0,i.jsx)("button",{type:"button",onClick:s,style:{padding:"10px 16px",border:"1px solid var(--border-strong)",borderRadius:"8px",background:"var(--bg-panel)",cursor:"pointer",fontSize:"14px",fontWeight:500},children:"Cancelar"}),(0,i.jsx)("button",{type:"submit",disabled:!b,style:{padding:"10px 20px",background:b?"#111827":"#d1d5db",color:"white",border:"none",borderRadius:"8px",cursor:b?"pointer":"not-allowed",fontWeight:600,fontSize:"14px"},children:"Guardar Horario"})]})]})}var tX=n(1723);function tJ(e){let{repId:t}=e,{specialSchedules:n,removeSpecialSchedule:r}=Z(e=>({specialSchedules:e.specialSchedules.filter(e=>e.representativeId===t),removeSpecialSchedule:e.removeSpecialSchedule})),{mode:a}=es();if(0===n.length)return null;let o=e=>{let t=["D","L","M","X","J","V","S"];return e.map(e=>t[e]).join(", ")},s=e=>"NONE"===e.type?"Libre":"BOTH"===e.type?"Mixto":"DAY"===e.shift?"D\xeda":"Noche";return(0,i.jsx)("div",{style:{marginTop:"16px"},children:n.map(e=>(0,i.jsxs)("div",{style:{fontSize:"12px",color:"#4b5563",background:"#f9fafb",padding:"10px",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,i.jsx)(eQ.Z,{size:14}),(0,i.jsxs)("span",{children:[(0,k.WU)((0,A.D)(e.startDate),"dd/MM/yy")," - ",(0,k.WU)((0,A.D)(e.endDate),"dd/MM/yy")]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginTop:"4px"},children:[(0,i.jsx)(tX.Z,{size:14}),(0,i.jsxs)("span",{children:[o(e.daysOfWeek)," → ",(0,i.jsx)("strong",{children:s(e.assignment)})]})]})]}),"ADMIN_OVERRIDE"===a&&(0,i.jsx)("button",{onClick:()=>r(e.id),style:{color:"#ef4444",background:"none",border:"none",cursor:"pointer"},children:(0,i.jsx)(eH.Z,{size:14})})]},e.id))})}function tQ(e){var t,n;let{repId:a,repName:o,onClose:s}=e,{representatives:l,addEffectivePeriod:d}=Z(),c=l.find(e=>e.id===a);if(!c)return null;let p=(null===(t=c.mixProfile)||void 0===t?void 0:t.type)==="WEEKDAY"?[1,2,3,4]:(null===(n=c.mixProfile)||void 0===n?void 0:n.type)==="WEEKEND"?[5,6,0]:[],x=Array(7).fill("BASE").map((e,t)=>p.includes(t)?"MIXED":"BASE"),[u,f]=(0,r.useState)(x),[g,h]=(0,r.useState)((0,k.WU)((0,E.z)(new Date,{locale:eD.es}),"yyyy-MM-dd")),[y,b]=(0,r.useState)((0,k.WU)((0,R.E)(new Date,90),"yyyy-MM-dd")),[m,v]=(0,r.useState)(""),j=["Domingo","Lunes","Martes","Mi\xe9rcoles","Jueves","Viernes","S\xe1bado"],S=["D","L","M","X","J","V","S"],I=e=>{f(t=>{let n=t[e],i="BASE";"BASE"===n?i="MIXED":"MIXED"===n?i="OFF":"OFF"===n&&(i="BASE");let r=[...t];return r[e]=i,r})};return(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},onClick:s,children:(0,i.jsxs)("div",{style:{background:"var(--bg-panel)",borderRadius:"12px",width:"600px",maxWidth:"90vw",maxHeight:"90vh",overflow:"auto",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)"},onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("div",{style:{padding:"24px",borderBottom:"1px solid var(--border-subtle)"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px"},children:[(0,i.jsx)(eQ.Z,{size:24,color:"var(--accent)"}),(0,i.jsx)("h2",{style:{margin:0,fontSize:"20px",fontWeight:700,color:"var(--text-main)"},children:"Gesti\xf3n de Horario Mixto"})]}),(0,i.jsxs)("p",{style:{margin:"8px 0 0 36px",fontSize:"14px",color:"var(--text-muted)"},children:[o," • Turno Base: ","DAY"===c.baseShift?"D\xeda":"Noche"]})]}),(0,i.jsxs)("div",{style:{padding:"24px"},children:[(0,i.jsxs)("div",{style:{background:"#eff6ff",border:"1px solid #93c5fd",borderRadius:"8px",padding:"16px",marginBottom:"24px",display:"flex",gap:"12px"},children:[(0,i.jsx)(e$.Z,{size:20,color:"#3b82f6",style:{flexShrink:0,marginTop:"2px"}}),(0,i.jsxs)("div",{style:{fontSize:"14px",color:"#1e40af"},children:[(0,i.jsx)("strong",{children:"Selecciona el estado de cada d\xeda:"}),(0,i.jsx)("br",{}),"Clic 1: \uD83D\uDD35 MIXTO (Ambos turnos)",(0,i.jsx)("br",{}),"Clic 2: \uD83D\uDD34 LIBRE (No trabaja)",(0,i.jsx)("br",{}),"Clic 3: ⚪ BASE (","DAY"===c.baseShift?"D\xeda":"Noche",")"]})]}),(0,i.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:600,marginBottom:"12px",color:"var(--text-main)"},children:"D\xedas Mixtos"}),(0,i.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"8px"},children:j.map((e,t)=>{let n=u[t],r=p.includes(t),a="var(--bg-muted)",o="var(--border-subtle)",s="var(--text-muted)",l="var(--text-muted)",d="BASE";return"MIXED"===n?(a="#eef2ff",o="#6366f1",s="#4f46e5",l="#4338ca",d="MIXTO"):"OFF"===n&&(a="#fef2f2",o="#fca5a5",s="#991b1b",l="#b91c1c",d="LIBRE"),(0,i.jsxs)("button",{type:"button",onClick:()=>I(t),style:{padding:"16px 8px",borderRadius:"8px",border:"2px solid",cursor:"pointer",background:a,borderColor:o,transition:"all 0.2s",position:"relative",minHeight:"80px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,i.jsx)("div",{style:{fontSize:"12px",fontWeight:600,color:l,marginBottom:"4px"},children:S[t]}),(0,i.jsx)("div",{style:{fontSize:"11px",fontWeight:700,color:s,textDecoration:"OFF"===n?"line-through":"none"},children:d}),n!==(r?"MIXED":"BASE")&&(0,i.jsx)("div",{style:{position:"absolute",top:"4px",right:"4px",width:"8px",height:"8px",borderRadius:"50%",background:"#f59e0b"}})]},t)})})]}),(0,i.jsxs)("div",{style:{background:"#fef3c7",border:"1px solid #fbbf24",borderRadius:"8px",padding:"12px 16px",marginBottom:"24px",fontSize:"13px"},children:[(0,i.jsx)("div",{style:{fontWeight:600,color:"#92400e",marginBottom:"8px"},children:"\uD83D\uDCDD Cambios detectados:"}),(0,i.jsx)("div",{style:{color:"#78350f"},children:u.map((e,t)=>e===(p.includes(t)?"MIXED":"BASE")?null:"MIXED"===e?(0,i.jsxs)("div",{children:["• ",j[t],": Ahora es MIXTO"]},t):"OFF"===e?(0,i.jsxs)("div",{children:["• ",j[t],": Ahora es LIBRE (No trabaja)"]},t):"BASE"===e?(0,i.jsxs)("div",{children:["• ",j[t],": Vuelve a turno BASE"]},t):null)})]}),(0,i.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:600,marginBottom:"8px",color:"var(--text-main)"},children:"Per\xedodo de Aplicaci\xf3n"}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"12px",color:"var(--text-muted)",marginBottom:"4px"},children:"Desde"}),(0,i.jsx)("input",{type:"date",value:g,onChange:e=>h(e.target.value),style:{width:"100%",padding:"10px",border:"1px solid var(--border-strong)",borderRadius:"6px",fontSize:"14px",background:"var(--bg-muted)",color:"var(--text-main)"}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"12px",color:"var(--text-muted)",marginBottom:"4px"},children:"Hasta"}),(0,i.jsx)("input",{type:"date",value:y,onChange:e=>b(e.target.value),style:{width:"100%",padding:"10px",border:"1px solid var(--border-strong)",borderRadius:"6px",fontSize:"14px",background:"var(--bg-muted)",color:"var(--text-main)"}})]})]})]}),(0,i.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:600,marginBottom:"8px",color:"var(--text-main)"},children:"Nota (opcional)"}),(0,i.jsx)("textarea",{value:m,onChange:e=>v(e.target.value),placeholder:"Ej: Ajuste por inicio de universidad",style:{width:"100%",padding:"10px",border:"1px solid var(--border-strong)",borderRadius:"6px",fontSize:"14px",minHeight:"60px",resize:"vertical",background:"var(--bg-muted)",color:"var(--text-main)"}})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[(0,i.jsxs)("button",{onClick:s,style:{padding:"10px 20px",border:"1px solid var(--border-strong)",borderRadius:"8px",background:"var(--bg-panel)",color:"var(--text-main)",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[(0,i.jsx)(ec.Z,{size:16}),"Cancelar"]}),(0,i.jsxs)("button",{onClick:()=>{let e=e=>"DAY"===c.baseShift?"DAY":"NIGHT"===c.baseShift?"NIGHT":"OFF",t=d({representativeId:a,startDate:g,endDate:y,weeklyPattern:{0:"MIXED"===u[0]?"BOTH":"OFF"===u[0]?"OFF":e(0),1:"MIXED"===u[1]?"BOTH":"OFF"===u[1]?"OFF":e(1),2:"MIXED"===u[2]?"BOTH":"OFF"===u[2]?"OFF":e(2),3:"MIXED"===u[3]?"BOTH":"OFF"===u[3]?"OFF":e(3),4:"MIXED"===u[4]?"BOTH":"OFF"===u[4]?"OFF":e(4),5:"MIXED"===u[5]?"BOTH":"OFF"===u[5]?"OFF":e(5),6:"MIXED"===u[6]?"BOTH":"OFF"===u[6]?"OFF":e(6)},reason:m||"Ajuste de horario mixto"});if(!t.success){alert(t.error||"Error al guardar el per\xedodo");return}s()},disabled:!1,style:{padding:"10px 20px",border:"none",borderRadius:"8px",background:"var(--accent)",color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[(0,i.jsx)(J.Z,{size:16}),"Aplicar Cambios"]})]})]})]})})}function t$(e){let{rep:t,onEdit:n,onAddSchedule:r,addingScheduleFor:a,advancedEditMode:o,managingMixedFor:s,onManageMixed:l}=e,d=Z(e=>e.deactivateRepresentative),{mode:c}=es(),{attributes:p,listeners:x,setNodeRef:u,transform:f,transition:g,isDragging:h}=(0,tY.nB)({id:t.id}),y=o?{transform:tG.ux.Transform.toString(f),transition:g,opacity:h?.5:1}:{};return(0,i.jsxs)("div",{ref:o?u:void 0,style:{...y,padding:"16px",background:"var(--bg-panel)",border:"1px solid var(--border-subtle)",borderRadius:"8px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[o&&(0,i.jsx)(X,{content:"Arrastra para reordenar",children:(0,i.jsx)("span",{...p,...x,style:{cursor:"grab",padding:"8px",fontSize:"18px",color:"#9ca3af",userSelect:"none",display:"flex",alignItems:"center"},children:"≡"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontWeight:600,fontSize:"14px",color:"var(--text-main)"},children:t.name}),(0,i.jsxs)("div",{style:{fontSize:"13px",color:"var(--text-muted)",marginTop:"2px"},children:["Rol: ","CUSTOMER_SERVICE"===t.role?"Servicio al Cliente":"Ventas"," | Turno: ","DAY"===t.baseShift?"D\xeda":"Noche"," ",t.mixProfile&&"(Mixto ".concat("WEEKDAY"===t.mixProfile.type?"L-J":"V-D",")")]})]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,i.jsx)("button",{onClick:()=>n(t),style:{padding:"8px",background:"#f3f4f6",border:"1px solid var(--border-subtle)",borderRadius:"4px",cursor:"pointer",color:"var(--text-main)"},title:"Editar",children:(0,i.jsx)(tZ.Z,{size:16})}),"ADMIN_OVERRIDE"===c&&(0,i.jsx)("button",{onClick:()=>d(t.id),style:{padding:"8px",background:"#fef2f2",border:"1px solid #fee2e2",borderRadius:"4px",cursor:"pointer",color:"#b91c1c"},title:"Desactivar",children:(0,i.jsx)(eH.Z,{size:16})})]})]}),(0,i.jsx)(tJ,{repId:t.id}),s===t.id&&(0,i.jsx)(tQ,{repId:t.id,repName:t.name,onClose:()=>l(null)}),a===t.id?(0,i.jsx)(tq,{repId:t.id,repName:t.name,onSave:()=>r(null)}):(0,i.jsxs)("div",{style:{marginTop:"12px",display:"flex",gap:"12px",flexWrap:"wrap"},children:[t.mixProfile&&(0,i.jsxs)("button",{onClick:()=>l(t.id),style:{fontSize:"12px",fontWeight:600,color:"#6366f1",background:"#eef2ff",border:"1px solid #c7d2fe",borderRadius:"6px",padding:"6px 12px",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[(0,i.jsx)(eQ.Z,{size:14}),"Gestionar Horario Mixto"]}),(0,i.jsx)("button",{onClick:()=>r(t.id),style:{fontSize:"12px",fontWeight:500,color:"#4338ca",background:"none",border:"none",cursor:"pointer"},children:"+ A\xf1adir horario especial"})]})]})}function t0(e){let{shift:t,representatives:n,onEdit:r,onAddSchedule:a,addingScheduleFor:o,advancedEditMode:s,managingMixedFor:l,onManageMixed:d}=e,c=Z(e=>e.reorderRepresentatives),p=n.map(e=>e.id);return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontSize:"12px",color:s?"#92400e":"#6b7280",marginBottom:"12px",fontStyle:"italic",background:s?"#fef3c7":"#f9fafb",padding:"8px 12px",borderRadius:"6px",border:"1px solid ".concat(s?"#fbbf24":"#e5e7eb")},children:s?"\uD83D\uDCA1 El orden define el ranking del incentivo. Arrastra desde ≡ para reordenar.":"\uD83D\uDD12 Activa el Modo de Edici\xf3n Avanzada para reordenar representantes."}),s?(0,i.jsx)(tV.LB,{collisionDetection:tV.pE,onDragEnd:e=>{let{active:n,over:i}=e;if(!i||n.id===i.id)return;let r=p.indexOf(n.id),a=p.indexOf(i.id);c(t,(0,tY.Rp)(p,r,a))},children:(0,i.jsx)(tY.Fo,{items:p,strategy:tY.qw,children:(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:n.map(e=>(0,i.jsx)(t$,{rep:e,onEdit:r,onAddSchedule:a,addingScheduleFor:o,advancedEditMode:s,managingMixedFor:l,onManageMixed:d},e.id))})})}):(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:n.map(e=>(0,i.jsx)(t$,{rep:e,onEdit:r,onAddSchedule:a,addingScheduleFor:o,advancedEditMode:s,managingMixedFor:l,onManageMixed:d},e.id))})]})}let t1=e=>{let{schedule:t,onChange:n}=e;return(0,i.jsx)("div",{style:{display:"flex",gap:"4px"},children:["D","L","M","X","J","V","S"].map((e,r)=>{let a="OFF"===t[r];return(0,i.jsx)("button",{type:"button",onClick:()=>{let e={...t};e[r]="WORKING"===t[r]?"OFF":"WORKING",n(e)},style:{width:"32px",height:"32px",borderRadius:"50%",border:"1px solid",cursor:"pointer",fontWeight:600,fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center",background:a?"hsl(220, 10%, 92%)":"transparent",borderColor:a?"hsl(220, 10%, 75%)":"hsl(220, 15%, 88%)",color:a?"hsl(220, 15%, 25%)":"hsl(220, 15%, 35%)"},children:e},r)})})},t2=e=>{var t;let{rep:n,onSave:a,onCancel:o}=e,[s,l]=(0,r.useState)((null==n?void 0:n.name)||""),[d,c]=(0,r.useState)((null==n?void 0:n.baseShift)||"DAY"),[p,x]=(0,r.useState)((null==n?void 0:n.role)||"SALES"),[u,f]=(0,r.useState)((null==n?void 0:n.baseSchedule)||function(e){let t={};for(let n=0;n<7;n++)t[n]=e.includes(n)?"OFF":"WORKING";return t}([1])),[g,h]=(0,r.useState)((null==n?void 0:null===(t=n.mixProfile)||void 0===t?void 0:t.type)||"");return(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s.trim()&&a({name:s,baseShift:d,role:p,baseSchedule:u,mixProfile:g?{type:g}:void 0},null==n?void 0:n.id)},style:{background:"#f9fafb",padding:"20px",borderRadius:"8px",border:"1px solid var(--border-subtle)",marginBottom:"24px",display:"flex",flexDirection:"column",gap:"16px"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("h3",{style:{margin:0,fontSize:"16px",color:"var(--text-main)"},children:n?"Editar Representante":"Nuevo Representante"}),n&&(0,i.jsx)("button",{type:"button",onClick:o,style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)"},children:(0,i.jsx)(ec.Z,{size:18})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"var(--text-main)"},children:"Nombre Completo"}),(0,i.jsx)("input",{type:"text",value:s,onChange:e=>l(e.target.value),placeholder:"Ej: Ana Garc\xeda",style:{width:"100%",padding:"8px 10px",border:"1px solid var(--border-strong)",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box"},required:!0})]}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"var(--text-main)"},children:"Rol"}),(0,i.jsxs)("select",{value:p,onChange:e=>x(e.target.value),style:{width:"100%",padding:"8px 10px",border:"1px solid var(--border-strong)",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box",background:"var(--bg-panel)"},children:[(0,i.jsx)("option",{value:"SALES",children:"Ventas"}),(0,i.jsx)("option",{value:"CUSTOMER_SERVICE",children:"Servicio al Cliente"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"var(--text-main)"},children:"Turno Base"}),(0,i.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,i.jsxs)("button",{type:"button",onClick:()=>c("DAY"),style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"8px",border:"1px solid",borderRadius:"6px",cursor:"pointer",background:"DAY"===d?"#fffbeb":"white",borderColor:"DAY"===d?"#fcd34d":"#d1d5db",color:"DAY"===d?"#b45309":"#374151"},children:[(0,i.jsx)(Q.Z,{size:16})," D\xeda"]}),(0,i.jsxs)("button",{type:"button",onClick:()=>c("NIGHT"),style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"8px",border:"1px solid",borderRadius:"6px",cursor:"pointer",background:"NIGHT"===d?"#eef2ff":"white",borderColor:"NIGHT"===d?"#c7d2fe":"#d1d5db",color:"NIGHT"===d?"#4338ca":"#374151"},children:[(0,i.jsx)(ed.Z,{size:16})," Noche"]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"var(--text-main)"},children:"Patr\xf3n base de mixto"}),(0,i.jsx)("p",{style:{fontSize:"12px",color:"var(--text-muted)",marginBottom:"8px",marginTop:0},children:"Se usa solo como referencia cuando no hay ajustes temporales. Los cambios especiales se configuran en Horarios Especiales."}),(0,i.jsxs)("select",{value:g,onChange:e=>h(e.target.value),style:{width:"100%",padding:"8px 10px",border:"1px solid var(--border-strong)",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box",background:"var(--bg-panel)"},children:[(0,i.jsx)("option",{value:"",children:"Ninguno"}),(0,i.jsx)("option",{value:"WEEKDAY",children:"Mixto entre semana (L-J) - base"}),(0,i.jsx)("option",{value:"WEEKEND",children:"Mixto fin de semana (V-D) - base"})]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"var(--text-main)"},children:"D\xedas Libres Base (semana)"}),(0,i.jsx)("p",{style:{fontSize:"12px",color:"var(--text-muted)",marginBottom:"8px",marginTop:0},children:"Selecciona los d\xedas que el representante NO trabaja"}),(0,i.jsx)(t1,{schedule:u,onChange:f})]}),(0,i.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",marginTop:"8px"},children:(0,i.jsxs)("button",{type:"submit",style:{padding:"8px 16px",background:"#111827",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:600,fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:[(0,i.jsx)(tH.Z,{size:16})," ",n?"Guardar Cambios":"Agregar"]})})]})};function t6(){let{representatives:e,addRepresentative:t,updateRepresentative:n}=Z(e=>{var t;return{representatives:null!==(t=e.representatives)&&void 0!==t?t:[],addRepresentative:e.addRepresentative,updateRepresentative:e.updateRepresentative}}),{mode:a}=es(),[o,s]=(0,r.useState)(null),[l,d]=(0,r.useState)(null),[c,p]=(0,r.useState)(null),[x,u]=(0,r.useState)(!1),[f,g]=(0,r.useState)("DAY"),h=(0,r.useMemo)(()=>e.filter(e=>!1!==e.isActive),[e]),y=(0,r.useMemo)(()=>e.filter(e=>!1===e.isActive),[e]),b=(0,r.useMemo)(()=>tU(h,"DAY"),[h]),m=(0,r.useMemo)(()=>tU(h,"NIGHT"),[h]),v=(i,r)=>{if(r){let t=e.find(e=>e.id===r);t&&n({...t,...i})}else{let e=h.filter(e=>e.baseShift===i.baseShift),n=e.length>0?Math.max(...e.map(e=>e.orderIndex||0)):-1;t({...i,orderIndex:n+1})}s(null)};return(0,i.jsxs)("div",{style:{maxWidth:"800px",margin:"0 auto"},children:[(0,i.jsxs)("div",{style:{marginBottom:"30px"},children:[(0,i.jsx)("h2",{style:{margin:0,marginBottom:"8px",fontSize:"20px",color:"var(--text-main)"},children:"Gesti\xf3n de Representantes"}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("p",{style:{margin:0,fontSize:"14px",color:"var(--text-muted)"},children:"A\xf1ade, edita o desactiva representantes. El orden determina el ranking del incentivo."}),(0,i.jsx)(eM,{title:"\xbfC\xf3mo agregar representantes?",points:["Completa el formulario con nombre, rol y turno base","Selecciona los d\xedas libres en el calendario semanal","El representante aparecer\xe1 al final de su turno"]})]})]}),!o&&(0,i.jsx)(t2,{onSave:v,onCancel:()=>s(null)}),o&&(0,i.jsx)(t2,{rep:o,onSave:v,onCancel:()=>s(null)}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{display:"flex",gap:"8px",marginBottom:"16px",borderBottom:"1px solid #e5e7eb",paddingBottom:"8px"},children:[(0,i.jsx)(X,{content:"Vista de solo lectura. Selecciona un turno para reordenar",children:(0,i.jsxs)("button",{onClick:()=>g("ALL"),style:{padding:"8px 16px",border:"none",borderBottom:"ALL"===f?"2px solid #111827":"2px solid transparent",background:"transparent",cursor:"pointer",fontWeight:"ALL"===f?600:400,color:"ALL"===f?"#111827":"#6b7280",fontSize:"14px"},children:["Todos (",h.length,")"]})}),(0,i.jsxs)("button",{onClick:()=>g("DAY"),style:{padding:"8px 16px",border:"none",borderBottom:"DAY"===f?"2px solid #f59e0b":"2px solid transparent",background:"transparent",cursor:"pointer",fontWeight:"DAY"===f?600:400,color:"DAY"===f?"#f59e0b":"#6b7280",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:[(0,i.jsx)(Q.Z,{size:16})," D\xeda (",b.length,")"]}),(0,i.jsxs)("button",{onClick:()=>g("NIGHT"),style:{padding:"8px 16px",border:"none",borderBottom:"NIGHT"===f?"2px solid #6366f1":"2px solid transparent",background:"transparent",cursor:"pointer",fontWeight:"NIGHT"===f?600:400,color:"NIGHT"===f?"#6366f1":"#6b7280",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:[(0,i.jsx)(ed.Z,{size:16})," Noche (",m.length,")"]})]}),"ALL"===f?(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontSize:"12px",color:"var(--text-muted)",marginBottom:"12px",fontStyle:"italic"},children:"\uD83D\uDCA1 Para reordenar, selecciona un turno espec\xedfico"}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("h4",{style:{margin:"0 0 8px 0",fontSize:"14px",color:"#f59e0b",fontWeight:600},children:[(0,i.jsx)(Q.Z,{size:14,style:{display:"inline",marginRight:"6px"}}),"Turno D\xeda (",b.length,")"]}),(0,i.jsx)("div",{style:{fontSize:"13px",color:"var(--text-muted)"},children:b.map(e=>e.name).join(", ")||"Sin representantes"})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("h4",{style:{margin:"0 0 8px 0",fontSize:"14px",color:"#6366f1",fontWeight:600},children:[(0,i.jsx)(ed.Z,{size:14,style:{display:"inline",marginRight:"6px"}}),"Turno Noche (",m.length,")"]}),(0,i.jsx)("div",{style:{fontSize:"13px",color:"var(--text-muted)"},children:m.map(e=>e.name).join(", ")||"Sin representantes"})]})]})]}):(0,i.jsx)(t0,{shift:f,representatives:"DAY"===f?b:m,onEdit:s,onAddSchedule:d,addingScheduleFor:l,advancedEditMode:"ADMIN_OVERRIDE"===a,managingMixedFor:c,onManageMixed:p}),y.length>0&&(0,i.jsxs)("div",{style:{marginTop:"24px"},children:[(0,i.jsxs)("button",{onClick:()=>u(!x),style:{fontSize:"14px",color:"var(--text-muted)",fontWeight:500,background:"none",border:"none",cursor:"pointer"},children:[x?"Ocultar":"Mostrar"," ",y.length," representantes inactivos"]}),x&&(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"12px"},children:y.map(e=>(0,i.jsxs)("div",{style:{padding:"12px 16px",background:"#f9fafb",border:"1px solid var(--border-subtle)",borderRadius:"6px",color:"#9ca3af",fontStyle:"italic"},children:[e.name," (Inactivo)"]},e.id))})]})]})]})}var t4=n(8728),t5=n(5621),t8=n(7117),t3=n(9076),t7=n(7102),t9=n(7689),ne=n(3229);function nt(){let{representatives:e,incidents:t,calendar:n,coverageRules:a,swaps:o,specialSchedules:s,effectivePeriods:l,historyEvents:d,auditLog:c,version:p,importState:x}=Z(),[u,f]=(0,r.useState)([]),[g,h]=(0,r.useState)(null),[y,b]=(0,r.useState)(null);(0,r.useEffect)(()=>{m()},[]);let m=()=>{f((0,t7.getBackupHistory)())},v=async e=>{var t;let n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(n){try{let e=await (0,t7.importBackup)(n);if(confirm("\xbfEst\xe1s seguro de que deseas restaurar este backup? Esto reemplazar\xe1 todos los datos actuales.")){let t={...e,exportedAt:new Date().toISOString(),appVersion:1};await x(t),b("Backup restaurado exitosamente"),setTimeout(()=>b(null),3e3)}}catch(e){h("Error al importar backup: "+e.message)}e.target.value=""}},j=e=>{if(confirm("\xbfEst\xe1s seguro de que deseas restaurar este backup?"))try{let t=(0,t7.loadBackupFromLocalStorage)(e);if(!t){h("No se pudo cargar el backup");return}let n={...t,exportedAt:new Date().toISOString(),appVersion:1};x(n),b("Backup restaurado exitosamente"),setTimeout(()=>b(null),3e3)}catch(e){h("Error al restaurar backup: "+e.message)}},S=e=>{if(confirm("\xbfEst\xe1s seguro de que deseas eliminar este backup?"))try{(0,t7.deleteBackupFromLocalStorage)(e),m(),b("Backup eliminado"),setTimeout(()=>b(null),3e3)}catch(e){h("Error al eliminar backup: "+e.message)}},I=e=>{try{return new Date(e).toLocaleString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return e}},C=e=>e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB";return(0,i.jsxs)("div",{style:{padding:"20px",fontFamily:"sans-serif"},children:[(0,i.jsxs)("h2",{style:{marginTop:0,marginBottom:"24px",color:"var(--text-main)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Gesti\xf3n de Backups",u.length>0&&(0,i.jsxs)("span",{style:{fontSize:"14px",fontWeight:500,color:"var(--text-muted)"},children:["\xdaltimo respaldo: ",I(u[0].timestamp)]})]}),g&&(0,i.jsxs)("div",{style:{padding:"12px 16px",background:"var(--bg-danger)",border:"1px solid var(--border-danger)",borderRadius:"8px",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px",color:"var(--text-danger)"},children:[(0,i.jsx)(e$.Z,{size:18}),g]}),y&&(0,i.jsx)("div",{style:{padding:"12px 16px",background:"#f0fdf4",border:"1px solid #86efac",borderRadius:"8px",marginBottom:"16px",color:"#166534"},children:y}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"12px",marginBottom:"32px"},children:[(0,i.jsxs)("button",{onClick:()=>{try{(0,t7.exportBackup)({representatives:e,incidents:t,calendar:n,coverageRules:a,swaps:o,specialSchedules:s,effectivePeriods:l,historyEvents:d,auditLog:c,version:p}),b("Backup exportado exitosamente"),setTimeout(()=>b(null),3e3)}catch(e){h("Error al exportar backup: "+e.message)}},style:{padding:"12px 16px",background:"var(--accent)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[(0,i.jsx)(tm.Z,{size:18}),"Exportar Backup"]}),(0,i.jsxs)("label",{style:{padding:"12px 16px",background:"var(--bg-panel)",color:"var(--text-main)",border:"1px solid var(--border-strong)",borderRadius:"8px",cursor:"pointer",fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[(0,i.jsx)(t9.Z,{size:18}),"Importar Backup",(0,i.jsx)("input",{type:"file",accept:".json",onChange:v,style:{display:"none"}})]}),(0,i.jsxs)("button",{onClick:()=>{try{(0,t7.saveBackupToLocalStorage)({representatives:e,incidents:t,calendar:n,coverageRules:a,swaps:o,specialSchedules:s,effectivePeriods:l,historyEvents:d,auditLog:c,version:p}),m(),b("Backup guardado en el navegador"),setTimeout(()=>b(null),3e3)}catch(e){h("Error al guardar backup: "+e.message)}},style:{padding:"12px 16px",background:"var(--bg-panel)",color:"var(--text-main)",border:"1px solid var(--border-strong)",borderRadius:"8px",cursor:"pointer",fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[(0,i.jsx)(ne.Z,{size:18}),"Guardar Backup Local"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("h3",{style:{marginBottom:"16px",color:"var(--text-main)"},children:["Backups Guardados (",u.length,")"]}),0===u.length?(0,i.jsx)("div",{style:{padding:"40px",textAlign:"center",color:"var(--text-muted)",background:"var(--bg-muted)",borderRadius:"8px"},children:"No hay backups guardados en el navegador"}):(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:u.map(e=>(0,i.jsxs)("div",{style:{padding:"16px",background:"var(--bg-panel)",border:"1px solid var(--border-subtle)",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{fontWeight:600,color:"var(--text-main)",marginBottom:"4px",display:"flex",alignItems:"center",gap:"8px"},children:[I(e.timestamp),e.key.includes("-auto-")&&(0,i.jsx)("span",{style:{fontSize:"10px",background:"#e0f2fe",color:"#0369a1",padding:"2px 6px",borderRadius:"4px",textTransform:"uppercase"},children:"AUTO"}),e.key.includes("-manual-")&&(0,i.jsx)("span",{style:{fontSize:"10px",background:"#f3f4f6",color:"#374151",padding:"2px 6px",borderRadius:"4px",textTransform:"uppercase"},children:"MANUAL"})]}),(0,i.jsxs)("div",{style:{fontSize:"13px",color:"var(--text-muted)"},children:["Tama\xf1o: ",C(e.size)]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,i.jsx)("button",{onClick:()=>j(e.key),style:{padding:"8px 16px",background:"var(--accent)",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:600,fontSize:"13px"},children:"Restaurar"}),(0,i.jsx)("button",{onClick:()=>S(e.key),style:{padding:"8px 12px",background:"transparent",color:"var(--text-danger)",border:"1px solid var(--border-danger)",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center"},children:(0,i.jsx)(eH.Z,{size:16})})]})]},e.key))})]})]})}let nn=[{value:1,label:"Lunes"},{value:2,label:"Martes"},{value:3,label:"Mi\xe9rcoles"},{value:4,label:"Jueves"},{value:5,label:"Viernes"},{value:6,label:"S\xe1bado"},{value:0,label:"Domingo"}],ni=["DAY","NIGHT"];function nr(){let{coverageRules:e,addOrUpdateCoverageRule:t,removeCoverageRule:n}=Z(e=>({coverageRules:e.coverageRules,addOrUpdateCoverageRule:e.addOrUpdateCoverageRule,removeCoverageRule:e.removeCoverageRule})),r=(t,n)=>e.find(e=>"WEEKDAY"===e.scope.type&&e.scope.day===t&&e.scope.shift===n),a=(t,n)=>{let i=e.find(e=>"WEEKDAY"===e.scope.type&&e.scope.day===t&&!e.scope.shift);if(i)return i.required;let r=e.find(e=>"SHIFT"===e.scope.type&&e.scope.shift===n);if(r)return r.required;let a=e.find(e=>"GLOBAL"===e.scope.type);return a?a.required:0},o=(e,i,a)=>{var o;let s=parseInt(a,10),l=r(e,i);if(isNaN(s)){l&&n(l.id);return}let d=(null===(o=nn.find(t=>t.value===e))||void 0===o?void 0:o.label)||"",c="DAY"===i?"D\xeda":"Noche";t({id:(null==l?void 0:l.id)||"wk-".concat(e,"-").concat(i,"-").concat(crypto.randomUUID().slice(0,4)),required:s,scope:{type:"WEEKDAY",day:e,shift:i},label:"Demanda: ".concat(d," \xb7 Turno ").concat(c)})};return(0,i.jsxs)("div",{style:{background:"white",padding:"24px",borderRadius:"12px",border:"1px solid #e5e7eb"},children:[(0,i.jsx)("h3",{style:{margin:"0 0 8px 0",fontSize:"18px",color:"#111827"},children:"Demanda Operativa Semanal"}),(0,i.jsxs)("p",{style:{margin:"0 0 24px 0",fontSize:"14px",color:"#6b7280"},children:["Define la cantidad m\xednima aceptable de personal por d\xeda y turno.",(0,i.jsx)("br",{}),"Si no se define un valor espec\xedfico, el sistema usar\xe1 la demanda heredada."]}),(0,i.jsx)("div",{style:{overflowX:"auto"},children:(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:"600px"},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:{textAlign:"left",padding:"12px",borderBottom:"2px solid #e5e7eb",color:"#6b7280",fontWeight:600,fontSize:"14px"},children:"D\xeda"}),ni.map(e=>(0,i.jsxs)("th",{style:{textAlign:"center",padding:"12px",borderBottom:"2px solid #e5e7eb",color:"#6b7280",fontWeight:600,fontSize:"14px"},children:["Turno ","DAY"===e?"D\xeda":"Noche"]},e))]})}),(0,i.jsx)("tbody",{children:nn.map(e=>(0,i.jsxs)("tr",{style:{borderBottom:"1px solid #f3f4f6"},children:[(0,i.jsx)("td",{style:{padding:"12px",fontWeight:500,color:"#111827"},children:e.label}),ni.map(t=>{var n;let s=r(e.value,t),l=a(e.value,t),d=!!s;return(0,i.jsx)("td",{style:{padding:"8px",textAlign:"center"},children:(0,i.jsx)("div",{style:{position:"relative",display:"inline-block"},children:(0,i.jsx)("input",{type:"number",min:"0",value:null!==(n=null==s?void 0:s.required)&&void 0!==n?n:"",placeholder:l.toString(),onChange:n=>o(e.value,t,n.target.value),style:{width:"80px",textAlign:"center",padding:"8px",borderRadius:"6px",border:"1px solid ".concat(d?"#2563eb":"#d1d5db"),background:d?"#eff6ff":"#f9fafb",fontWeight:d?600:400,color:d?"#1e40af":"#6b7280",fontSize:"14px",outline:"none",transition:"all 0.2s"}})})},t)})]},e.value))})]})}),(0,i.jsxs)("div",{style:{marginTop:"20px",padding:"12px",background:"#f9fafb",borderRadius:"8px",display:"flex",gap:"20px",fontSize:"13px",color:"#6b7280"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,i.jsx)("div",{style:{width:"12px",height:"12px",background:"#eff6ff",border:"1px solid #2563eb",borderRadius:"3px"}}),(0,i.jsx)("span",{children:"Regla Expl\xedcita"})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,i.jsx)("div",{style:{width:"12px",height:"12px",background:"#f9fafb",border:"1px solid #d1d5db",borderRadius:"3px"}}),(0,i.jsx)("span",{children:"Heredado (Est\xe1ndar)"})]})]})]})}function na(e){let{title:t,isOpen:n,onClose:r,items:a,renderItem:o,emptyMessage:s="No hay registros para mostrar."}=e;return n?(0,i.jsx)("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(4px)",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"},onClick:r,children:(0,i.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"16px",width:"90%",maxWidth:"600px",height:"80vh",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",overflow:"hidden"},onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("div",{style:{padding:"20px 24px",borderBottom:"1px solid #f3f4f6",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"#fff"},children:[(0,i.jsx)("h2",{style:{margin:0,fontSize:"18px",fontWeight:700,color:"#111827"},children:t}),(0,i.jsx)("button",{onClick:r,style:{background:"transparent",border:"none",cursor:"pointer",color:"#6b7280",padding:"4px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(ec.Z,{size:20})})]}),(0,i.jsx)("div",{style:{flex:1,overflowY:"auto",padding:"0",background:"#f9fafb"},children:0===a.length?(0,i.jsx)("div",{style:{padding:"40px",textAlign:"center",color:"#9ca3af",fontSize:"14px"},children:s}):(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column"},children:a.map((e,t)=>(0,i.jsx)("div",{style:{borderBottom:"1px solid #e5e7eb",background:"white",padding:"16px 24px"},children:o(e)},t))})}),(0,i.jsxs)("div",{style:{padding:"16px 24px",borderTop:"1px solid #e5e7eb",background:"#fff",color:"#6b7280",fontSize:"12px",textAlign:"right"},children:["Mostrando ",a.length," registros"]})]})}):null}function no(){let[e,t]=(0,r.useState)("sistema"),[n,a]=(0,r.useState)("representatives"),[o,s]=(0,r.useState)(!1),[l,d]=(0,r.useState)(!1),{mode:c,toggle:p}=es(),x="ADMIN_OVERRIDE"===c,{showToast:u}=eK(),{resetState:f,showConfirm:g,historyEvents:h,auditLog:y}=Z(e=>({resetState:e.resetState,showConfirm:e.showConfirm,historyEvents:e.historyEvents||[],auditLog:e.auditLog||[]})),b=[...h].sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()),m=[...y].sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()),v=async()=>{await g({title:"⚠️ \xbfReiniciar la planificaci\xf3n?",description:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{children:"Esta acci\xf3n eliminar\xe1 todas las incidencias y ajustes manuales (ausencias, tardanzas, cambios de turno, etc.)."}),(0,i.jsx)("p",{style:{marginTop:"10px",fontWeight:500},children:"Se conservar\xe1n las licencias y vacaciones ya registradas."}),(0,i.jsx)("p",{style:{marginTop:"10px",fontSize:"12px",color:"#6b7280"},children:"Esta acci\xf3n no se puede deshacer."})]}),intent:"danger",confirmLabel:"S\xed, reiniciar"})&&(f(!0),u({title:"Planificaci\xf3n reiniciada",message:"Se han eliminado los cambios manuales.",type:"success"}))},j=e=>({padding:"10px 20px",cursor:"pointer",border:"none",borderBottom:e?"2px solid hsl(0, 0%, 13%)":"2px solid transparent",color:e?"#111827":"#4b5563",fontWeight:e?600:500,background:"transparent",fontSize:"15px",display:"flex",alignItems:"center",gap:"8px"}),S=e=>({padding:"6px 16px",borderRadius:"20px",border:"1px solid",borderColor:e?"var(--accent)":"var(--border-subtle)",background:e?"var(--accent-light)":"transparent",color:e?"var(--accent)":"#6b7280",fontSize:"13px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"}),I={background:"var(--bg-panel)",border:"1px solid var(--border-subtle)",borderRadius:"12px",padding:"20px",marginBottom:"16px",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},C={padding:"8px 16px",borderRadius:"6px",border:"1px solid #e5e7eb",background:"#fff",color:"#374151",fontSize:"14px",fontWeight:500,cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},D={...C,background:"#fef2f2",color:"#991b1b",borderColor:"#fecaca"};return(0,i.jsxs)("div",{style:{padding:"0px 20px 40px 20px",maxWidth:"1200px",margin:"0 auto"},children:[(0,i.jsx)(na,{title:"Historial de Cambios",isOpen:o,onClose:()=>s(!1),items:b,renderItem:e=>(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,i.jsx)("span",{style:{fontSize:"11px",fontWeight:700,textTransform:"uppercase",color:"#4b5563",background:"#f3f4f6",padding:"2px 6px",borderRadius:"4px"},children:e.category}),(0,i.jsx)("span",{style:{fontSize:"12px",color:"#9ca3af"},children:(0,k.WU)((0,A.D)(e.timestamp),"d MMM yyyy, HH:mm",{locale:eD.es})})]}),(0,i.jsx)("div",{style:{fontWeight:600,color:"#111827",fontSize:"14px",marginTop:"4px"},children:e.title}),e.description&&(0,i.jsx)("div",{style:{fontSize:"13px",color:"#4b5563"},children:e.description}),(e.subject||e.impact)&&(0,i.jsxs)("div",{style:{display:"flex",gap:"8px",fontSize:"12px",marginTop:"4px",color:"#6b7280"},children:[e.subject&&(0,i.jsxs)("span",{children:["\uD83D\uDC64 ",e.subject]}),e.impact&&(0,i.jsxs)("span",{children:["⚡ ",e.impact]})]})]}),emptyMessage:"No hay eventos en el historial reciente."}),(0,i.jsx)(na,{title:"Auditor\xeda del Sistema",isOpen:l,onClose:()=>d(!1),items:m,renderItem:e=>(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,i.jsx)("span",{style:{fontSize:"11px",fontWeight:700,color:"#059669",background:"#ecfdf5",padding:"2px 6px",borderRadius:"4px"},children:e.action}),(0,i.jsx)("span",{style:{fontSize:"12px",color:"#9ca3af"},children:(0,k.WU)((0,A.D)(e.timestamp),"d MMM yyyy, HH:mm:ss",{locale:eD.es})})]}),(0,i.jsxs)("div",{style:{fontSize:"13px",color:"#374151",marginTop:"4px"},children:[(0,i.jsx)("span",{style:{fontWeight:600},children:e.actor.name}),": ",e.target.entity," ",e.target.label?"(".concat(e.target.label,")"):""]}),e.change&&(0,i.jsxs)("div",{style:{fontSize:"12px",fontFamily:"monospace",background:"#f9fafb",padding:"4px",borderRadius:"4px",marginTop:"4px"},children:[e.change.field,": ",String(e.change.from)," ➔ ",String(e.change.to)]})]}),emptyMessage:"No hay registros de auditor\xeda."}),(0,i.jsxs)("div",{style:{background:"var(--bg-panel)",borderRadius:"12px 12px 0 0",padding:"0 16px",border:"1px solid var(--border-subtle)",borderBottom:"none",marginBottom:0,display:"flex"},children:[(0,i.jsxs)("button",{style:j("equipo"===e),onClick:()=>t("equipo"),children:[(0,i.jsx)(eq.Z,{size:16}),"Equipo y Reglas"]}),(0,i.jsxs)("button",{style:j("calendario"===e),onClick:()=>t("calendario"),children:[(0,i.jsx)(eQ.Z,{size:16}),"Calendario"]}),(0,i.jsxs)("button",{style:j("sistema"===e),onClick:()=>t("sistema"),children:[(0,i.jsx)(t4.Z,{size:16}),"Sistema"]})]}),(0,i.jsxs)("div",{style:{background:"var(--bg-panel)",borderRadius:"0 0 12px 12px",border:"1px solid var(--border-subtle)",borderTop:"none",padding:"24px",minHeight:"600px"},children:["equipo"===e&&(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[(0,i.jsxs)("div",{style:{display:"flex",gap:"12px",paddingBottom:"16px",borderBottom:"1px solid var(--border-subtle)"},children:[(0,i.jsx)("button",{style:S("representatives"===n),onClick:()=>a("representatives"),children:"Gesti\xf3n de Representantes"}),(0,i.jsx)("button",{style:S("demand"===n),onClick:()=>a("demand"),children:"Reglas de Demanda"})]}),"representatives"===n?(0,i.jsx)(t6,{}):(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,i.jsx)("h3",{style:{margin:0,fontSize:"18px",display:"flex",alignItems:"center",gap:"8px"},children:"\uD83D\uDCC9 Reglas de Demanda"}),(0,i.jsx)("p",{style:{margin:"4px 0 0",fontSize:"14px",color:"var(--text-muted)"},children:"Configura la cobertura m\xednima requerida para cada turno y d\xeda."})]}),(0,i.jsx)(nr,{})]})]}),"calendario"===e&&(0,i.jsx)(tP,{}),"sistema"===e&&(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[(0,i.jsx)("div",{style:I,children:(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{style:{margin:"0 0 4px 0",fontSize:"16px",color:"var(--text-main)"},children:"Modo Edici\xf3n Avanzada"}),(0,i.jsx)("p",{style:{margin:0,fontSize:"13px",color:"var(--text-muted)"},children:"Permite modificar semanas pasadas. Usar con precauci\xf3n."})]}),(0,i.jsx)("button",{onClick:p,style:{padding:"8px 16px",borderRadius:"20px",border:"none",background:x?"var(--accent)":"#e5e7eb",color:x?"white":"#374151",fontSize:"14px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:x?"Activado":"Desactivado"})]})}),(0,i.jsx)("div",{style:{...I,padding:0,overflow:"hidden"},children:(0,i.jsx)(nt,{})}),(0,i.jsxs)("div",{style:I,children:[(0,i.jsx)("h3",{style:{margin:"0 0 4px 0",fontSize:"16px",color:"var(--text-main)"},children:"Auditor\xeda del Sistema"}),(0,i.jsx)("p",{style:{margin:"0 0 12px 0",fontSize:"13px",color:"var(--text-muted)"},children:"Historial detallado de cambios y acciones administrativas."}),(0,i.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,i.jsxs)("button",{style:{...C,opacity:x?1:.5,cursor:x?"pointer":"not-allowed"},onClick:()=>x&&s(!0),children:[(0,i.jsx)(t5.Z,{size:16}),"Historial"]}),(0,i.jsxs)("button",{style:{...C,opacity:x?1:.5,cursor:x?"pointer":"not-allowed"},onClick:()=>x&&d(!0),children:[(0,i.jsx)(t8.Z,{size:16}),"Auditor\xeda"]})]})]}),(0,i.jsxs)("div",{style:{...I,borderColor:"#fecaca",background:"#fff5f5"},children:[(0,i.jsxs)("h3",{style:{margin:"0 0 4px 0",fontSize:"16px",color:"#991b1b",display:"flex",alignItems:"center",gap:"8px"},children:[(0,i.jsx)(ex.Z,{size:18}),"Zona de Peligro"]}),(0,i.jsx)("p",{style:{margin:"0 0 16px 0",fontSize:"13px",color:"#7f1d1d"},children:"Estas acciones son irreversibles y pueden afectar datos importantes."}),(0,i.jsxs)("button",{style:D,onClick:v,children:[(0,i.jsx)(t3.Z,{size:16}),"Resetear Planificaci\xf3n"]})]})]})]})]})}function ns(e){let{open:t,title:n,description:r,intent:a="info",confirmLabel:o="Confirmar",cancelLabel:s="Cancelar",onConfirm:l,onCancel:d}=e;if(!t)return null;let c={padding:"0.5rem 1rem",borderRadius:"0.375rem",border:"none",cursor:"pointer",fontWeight:500};return(0,i.jsx)("div",{style:{position:"fixed",inset:0,zIndex:50,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0, 0, 0, 0.5)"},onClick:d,children:(0,i.jsx)(q.E.div,{style:{backgroundColor:"white",borderRadius:"0.75rem",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",width:"100%",maxWidth:"28rem"},onClick:e=>e.stopPropagation(),initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.15,ease:"easeOut"},children:(0,i.jsxs)("div",{style:{padding:"1.5rem"},children:[(0,i.jsx)("h2",{style:{fontSize:"1.25rem",fontWeight:600,marginBottom:"0.5rem"},children:n}),r&&(0,i.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"1.5rem",lineHeight:"1.5"},children:r}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5rem",marginTop:"1.5rem"},children:[(0,i.jsx)("button",{onClick:d,style:{...c,backgroundColor:"#f3f4f6",color:"#374151"},children:s}),(0,i.jsx)("button",{onClick:l,style:{...c,...{danger:{backgroundColor:"#dc2626",color:"white"},warning:{backgroundColor:"#f59e0b",color:"black"},info:{backgroundColor:"#2563eb",color:"white"}}[a]},children:o})]})]})})})}function nl(){let e=Z(e=>e.undoStack),t=Z(e=>e.executeUndo);return(0,i.jsx)("div",{style:{position:"fixed",bottom:"24px",right:"24px",display:"flex",flexDirection:"column",gap:"12px",zIndex:2e3},children:(0,i.jsx)(K.M,{children:e.map(e=>(0,i.jsxs)(q.E.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20,transition:{duration:.2}},transition:{duration:.25,ease:"easeOut"},style:{background:"hsl(220, 20%, 15%)",color:"white",padding:"12px 20px",borderRadius:"10px",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.2)",display:"flex",alignItems:"center",gap:"16px"},children:[(0,i.jsx)("span",{children:e.label}),(0,i.jsx)("button",{onClick:()=>t(e.id),style:{fontWeight:600,color:"hsl(200, 100%, 70%)",background:"none",border:"none",cursor:"pointer",padding:"4px"},children:"Deshacer"})]},e.id))})})}function nd(e){let{isOpen:t,repName:n,startDate:a,endDate:o,returnDate:s,workingDays:l,onClose:d}=e;(0,r.useEffect)(()=>{if(t){let e=setTimeout(()=>{d()},5e3);return()=>clearTimeout(e)}},[t,d]);let c=e=>{try{return new Date(e+"T12:00:00Z").toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return e}};return(0,i.jsx)(K.M,{children:t&&(0,i.jsx)(q.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},style:{position:"fixed",top:"20px",right:"20px",zIndex:9999,maxWidth:"400px"},children:(0,i.jsxs)("div",{style:{background:"var(--bg-panel)",borderRadius:"8px",boxShadow:"0 10px 40px rgba(0,0,0,0.15)",border:"1px solid var(--border-subtle)",overflow:"hidden"},children:[(0,i.jsxs)("div",{style:{background:"#10b981",padding:"16px 20px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[(0,i.jsx)(eg.Z,{size:24,style:{color:"white"}}),(0,i.jsx)("span",{style:{color:"white",fontWeight:600,fontSize:"16px"},children:"Vacaciones Registradas"})]}),(0,i.jsx)("button",{onClick:d,style:{background:"transparent",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center"},children:(0,i.jsx)(ec.Z,{size:20,style:{color:"white"}})})]}),(0,i.jsxs)("div",{style:{padding:"20px"},children:[(0,i.jsx)("div",{style:{marginBottom:"16px"},children:(0,i.jsx)("div",{style:{fontSize:"15px",fontWeight:600,color:"var(--text-main)",marginBottom:"4px"},children:n})}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,i.jsx)("span",{style:{color:"var(--text-muted)",fontSize:"14px"},children:"Desde:"}),(0,i.jsx)("span",{style:{color:"var(--text-main)",fontSize:"14px",fontWeight:500},children:c(a)})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,i.jsx)("span",{style:{color:"var(--text-muted)",fontSize:"14px"},children:"Hasta:"}),(0,i.jsx)("span",{style:{color:"var(--text-main)",fontSize:"14px",fontWeight:500},children:c(o)})]}),(0,i.jsx)("div",{style:{height:"1px",background:"#e5e7eb",margin:"6px 0"}}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,i.jsx)("span",{style:{color:"var(--text-muted)",fontSize:"14px"},children:"Reingresa:"}),(0,i.jsx)("span",{style:{color:"#10b981",fontSize:"14px",fontWeight:600},children:c(s)})]})]}),(0,i.jsx)("div",{style:{marginTop:"16px",padding:"12px",background:"#f0fdf4",borderRadius:"6px",textAlign:"center"},children:(0,i.jsxs)("span",{style:{color:"#15803d",fontSize:"13px",fontWeight:500},children:["(",l," d\xedas laborables)"]})})]})]})})})}let nc=e=>{let{level:t}=e;return(0,i.jsx)("span",{style:{...{danger:{backgroundColor:"#fdecea",color:"#b42318"},warning:{backgroundColor:"#fff3cd",color:"#9a6a00"},ok:{backgroundColor:"#e6f9ee",color:"#1c7c44"}}[t],padding:"6px 12px",borderRadius:"99px",fontSize:"12px",fontWeight:600},children:{danger:"RIESGO",warning:"ATENCI\xd3N",ok:"OK"}[t]})};function np(e){let{label:t,value:n}=e;return(0,i.jsxs)("div",{style:{background:"#f9fafb",border:"1px solid #f3f4f6",borderRadius:"8px",padding:"8px 12px",textAlign:"center"},children:[(0,i.jsx)("div",{style:{fontSize:"12px",color:"#6b7280",marginBottom:"2px",fontWeight:500},children:t}),(0,i.jsx)("div",{style:{fontSize:"18px",fontWeight:700,color:"#1f2937"},children:n})]})}function nx(e){let[t,n,i]=e.split("-").map(Number);return new Date(t,n-1,i)}function nu(e){let{summary:t,personId:n,onClose:a}=e,o=(0,r.useRef)(null),[s,l]=(0,r.useState)(null),{openDetailModal:d,representatives:c,allCalendarDays:p}=Z(e=>({openDetailModal:e.openDetailModal,representatives:e.representatives,allCalendarDays:e.allCalendarDaysForRelevantMonths})),x=(0,r.useMemo)(()=>t&&n?t.byPerson.find(e=>e.representativeId===n):null,[t,n]),u=(0,r.useMemo)(()=>c.find(e=>e.id===n),[c,n]),f=(0,r.useMemo)(()=>(0,A.D)("".concat(t.month,"-01")),[t.month]),g=e=>{let t=new Date(f.getFullYear(),f.getMonth()+e,1);d(n,(0,k.WU)(t,"yyyy-MM")),l(null)};(0,r.useEffect)(()=>{let e=e=>{"Escape"===e.key&&a()};return document.body.style.overflow="hidden",document.addEventListener("keydown",e),()=>{document.body.style.overflow="",document.removeEventListener("keydown",e)}},[a]);let h=(0,r.useMemo)(()=>(0,k.WU)(f,"MMMM yyyy",{locale:eD.es}),[f]),y=(0,r.useMemo)(()=>{if(!(null==x?void 0:x.incidents)||!u)return[];if(!s)return x.incidents;let e=(0,k.WU)(s,"yyyy-MM-dd");return x.incidents.filter(t=>"VACACIONES"===t.type||"LICENCIA"===t.type?W(t,p,u).dates.includes(e):t.startDate===e)},[s,x,u,p]),b=(0,r.useMemo)(()=>{if(!x||!u)return[];let e=new Map,n=parseInt(t.month.split("-")[0]),i=parseInt(t.month.split("-")[1])-1,r=new Date(n,i+1,0).getDate();for(let t=1;t<=r;t++){let r=new Date(n,i,t),a=r.getDay(),o="OFF"===u.baseSchedule[a],s=(0,k.WU)(r,"yyyy-MM-dd");e.set(s,{points:0,isOffDay:o,visualTypes:[]})}for(let t of x.incidents)if(t.startDate){if("VACACIONES"===t.type||"LICENCIA"===t.type){let n=W(t,p,u),i="VACACIONES"===t.type?"VACATION":"LICENSE";for(let r of n.dates){let n=e.get(r);if(n){let e=F(t);n.points+=e,n.visualTypes.push(i)}}}else{let n=e.get(t.startDate);if(n){let e=F(t);n.points+=e,"AUSENCIA"===t.type&&n.visualTypes.push("ABSENT")}}}return Array.from(e.entries()).map(e=>{var t;let[n,i]=e,r="normal";return i.isOffDay&&0===i.points?r="disabled":i.points>=6?r="danger":i.points>0&&(r="warning"),{date:nx(n),state:r,visualType:(t=i.visualTypes).includes("ABSENT")?"ABSENT":t.includes("VACATION")?"VACATION":t.includes("LICENSE")?"LICENSE":t.includes("HOLIDAY")?"HOLIDAY":t.includes("SHIFT_CHANGE")?"SHIFT_CHANGE":"NORMAL"}})},[x,u,t.month,p]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(q.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.25,ease:"easeOut"},style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.4)",zIndex:50},onClick:a},"overlay"),(0,i.jsx)("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},onClick:a,children:(0,i.jsx)(q.E.div,{ref:o,tabIndex:-1,style:{outline:"none",backgroundColor:"white",borderRadius:"12px",padding:"24px",width:"700px",maxWidth:"90vw",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.2)",maxHeight:"85vh",display:"flex",flexDirection:"column"},onClick:e=>e.stopPropagation(),initial:{opacity:0,y:30},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.25,ease:"easeOut"},children:(()=>{if(!x)return(0,i.jsx)("div",{style:{padding:"24px",minHeight:"400px",display:"flex",alignItems:"center",justifyContent:"center",color:"#6b7280"},children:"No se encontr\xf3 informaci\xf3n para este representante en el mes seleccionado."});let{totals:e,riskLevel:t,name:n}=x;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("header",{style:{paddingBottom:"12px",borderBottom:"1px solid #e5e7eb",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:600,margin:0},children:n}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginTop:"8px"},children:[(0,i.jsx)("button",{onClick:()=>g(-1),style:{background:"none",border:"none",cursor:"pointer",color:"#6b7280"},children:(0,i.jsx)(eX.Z,{size:20})}),(0,i.jsx)("p",{style:{margin:0,color:"#374151",fontWeight:600,textTransform:"capitalize",width:"140px",textAlign:"center"},children:h}),(0,i.jsx)("button",{onClick:()=>g(1),style:{background:"none",border:"none",cursor:"pointer",color:"#6b7280"},children:(0,i.jsx)(eJ.Z,{size:20})})]})]}),(0,i.jsx)("button",{onClick:a,style:{background:"none",border:"none",cursor:"pointer",color:"#6b7280"},children:(0,i.jsx)(ec.Z,{size:24})})]}),(0,i.jsxs)("div",{style:{margin:"16px 0",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px"},children:[(0,i.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,i.jsx)(np,{label:"Ausencias",value:e.ausencias}),(0,i.jsx)(np,{label:"Tardanzas",value:e.tardanzas}),(0,i.jsx)(np,{label:"Errores",value:e.errores}),(0,i.jsx)(np,{label:"Puntos",value:e.puntos})]}),(0,i.jsxs)("div",{style:{textAlign:"right"},children:[(0,i.jsx)("div",{style:{fontSize:"12px",color:"#6b7280",marginBottom:"2px",fontWeight:500},children:"Estado General"}),(0,i.jsx)(nc,{level:t})]})]}),(0,i.jsxs)("div",{style:{flex:"1 1 auto",display:"grid",gridTemplateColumns:"280px 1fr",gap:"24px",overflow:"hidden",marginTop:"16px"},children:[(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:(0,i.jsx)(te,{month:f,days:b,selected:s,onSelect:l})}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,i.jsxs)("h3",{style:{fontSize:"1rem",fontWeight:600,margin:0,marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)("span",{children:["Eventos",s?" para ".concat((0,k.WU)(s,"d MMM",{locale:eD.es})):" del Mes"]}),s&&(0,i.jsx)("button",{onClick:()=>l(null),style:{fontSize:12,cursor:"pointer",background:"none",border:"none",color:"#2563eb",fontWeight:500},children:"Mostrar todo el mes"})]}),(0,i.jsx)("div",{style:{flex:"1 1 auto",overflowY:"auto",paddingRight:"8px"},children:(0,i.jsx)(K.M,{mode:"wait",children:(0,i.jsx)(q.E.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.18,ease:"easeOut"},children:0===y.length?(0,i.jsx)("p",{style:{fontSize:"14px",color:"#6b7280",fontStyle:"italic",textAlign:"center",padding:"20px 0"},children:s?"No se registraron incidencias en este d\xeda.":"No se registraron incidencias con penalizaci\xf3n este mes."}):(0,i.jsx)("ul",{style:{listStyle:"none",padding:0,margin:0},children:y.map(e=>{var t;let n=null!==(t=eL[e.type])&&void 0!==t?t:eL.OTRO,r="",a="";if("VACACIONES"===e.type||"LICENCIA"===e.type){let t=W(e,p,u);if(t.start&&t.end&&t.returnDate){let n=(0,k.WU)(nx(t.start),"dd 'de' MMMM",{locale:eD.es}),i=(0,k.WU)(nx(t.end),"dd 'de' MMMM",{locale:eD.es}),o=(0,k.WU)(nx(t.returnDate),"dd 'de' MMMM",{locale:eD.es});r="".concat("VACACIONES"===e.type?"Vacaciones":"Licencia"," del ").concat(n," al ").concat(i),a="VACACIONES"===e.type?"".concat(t.dates.length," d\xedas laborables • Retorna ").concat(o):"".concat(t.dates.length," d\xedas naturales • Retorna ").concat(o)}}else r=e.startDate?(0,k.WU)(nx(e.startDate),"EEEE, dd 'de' MMMM",{locale:eD.es}):"Fecha no disponible";let o=F(e);return(0,i.jsxs)("li",{style:{borderBottom:"1px solid #f3f4f6",padding:"12px 4px",display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"14px"},children:[(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[(0,i.jsxs)("div",{style:{fontWeight:500,color:"#374151",display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[(0,i.jsx)("span",{style:{padding:"2px 8px",borderRadius:"6px",fontSize:"12px",fontWeight:600,backgroundColor:"danger"===n.variant?"hsl(0, 100%, 97%)":"warning"===n.variant?"hsl(45, 100%, 96%)":"hsl(220, 15%, 96%)",color:"danger"===n.variant?"hsl(0, 70%, 45%)":"warning"===n.variant?"hsl(45, 70%, 35%)":"hsl(220, 10%, 40%)"},children:n.label}),(0,i.jsx)("span",{style:{color:"#6b7280"},children:r})]}),a&&(0,i.jsx)("p",{style:{fontSize:"12px",color:"#059669",margin:"0",paddingLeft:"8px",fontWeight:500},children:a}),e.note&&(0,i.jsx)("p",{style:{fontSize:"12px",color:"#4b5563",fontStyle:"italic",margin:"0",paddingLeft:"8px",borderLeft:"2px solid #e5e7eb"},children:e.note})]}),(0,i.jsx)("span",{style:{fontWeight:700,fontSize:"16px",color:o>0?"#b91c1c":"#374151"},children:o>0?"-".concat(o):o})]},e.id)})})},(null==s?void 0:s.toISOString())||"month-view")})})]})]}),(0,i.jsx)("div",{style:{marginTop:"24px",textAlign:"right"},children:(0,i.jsx)("button",{onClick:a,style:{padding:"10px 20px",borderRadius:"8px",backgroundColor:"#e5e7eb",color:"#374151",border:"none",cursor:"pointer",fontWeight:600},children:"Cerrar"})})]})})()},"modal-content")})]})}function nf(e){let{activeShift:t,onClose:n,onSelect:r}=e,a={display:"flex",alignItems:"center",gap:"12px",width:"100%",padding:"16px",fontSize:"16px",border:"1px solid var(--border-subtle)",borderRadius:"8px",background:"#f9fafb",cursor:"pointer",textAlign:"left",marginBottom:"12px",transition:"background 0.2s, border-color 0.2s"},o={background:"#eff6ff",borderColor:"#93c5fd"},s={fontWeight:600};return(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:n,children:(0,i.jsxs)(q.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.15},style:{background:"var(--bg-panel)",padding:"24px",borderRadius:"12px",width:"420px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.1)"},onClick:e=>e.stopPropagation(),children:[(0,i.jsx)("h2",{style:{marginTop:0,marginBottom:"8px",fontSize:"18px"},children:"⚠️ Modificaci\xf3n de Turno Mixto"}),(0,i.jsxs)("p",{style:{color:"var(--text-muted)",marginTop:0,marginBottom:"24px",lineHeight:1.5},children:["Este representante est\xe1 programado para ",(0,i.jsx)("b",{children:"D\xcdA y NOCHE"})," hoy.",(0,i.jsx)("br",{}),"Tu acci\xf3n afectar\xe1 su planificaci\xf3n. \xbfQu\xe9 deseas hacer?"]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("button",{style:a,onMouseEnter:e=>Object.assign(e.currentTarget.style,o),onMouseLeave:e=>Object.assign(e.currentTarget.style,a),onClick:()=>r({type:"NONE"}),children:[(0,i.jsx)($.Z,{size:20,color:"#ef4444"}),(0,i.jsx)("span",{style:s,children:"Libre todo el d\xeda"})]}),(0,i.jsxs)("button",{style:a,onMouseEnter:e=>Object.assign(e.currentTarget.style,o),onMouseLeave:e=>Object.assign(e.currentTarget.style,a),onClick:()=>r({type:"SINGLE",shift:"DAY"}),children:[(0,i.jsx)(Q.Z,{size:20,color:"#f59e0b"}),(0,i.jsx)("span",{style:s,children:"Trabaja solo Turno D\xeda"})]}),(0,i.jsxs)("button",{style:a,onMouseEnter:e=>Object.assign(e.currentTarget.style,o),onMouseLeave:e=>Object.assign(e.currentTarget.style,a),onClick:()=>r({type:"SINGLE",shift:"NIGHT"}),children:[(0,i.jsx)(ed.Z,{size:20,color:"#4f46e5"}),(0,i.jsx)("span",{style:s,children:"Trabaja solo Turno Noche"})]})]}),(0,i.jsx)("div",{style:{marginTop:"24px",textAlign:"right"},children:(0,i.jsx)("button",{onClick:n,style:{padding:"10px 20px",border:"none",borderRadius:"8px",background:"#e5e7eb",color:"var(--text-main)",cursor:"pointer",fontWeight:500},children:"Cancelar"})})]})})}function ng(){let{isLoading:e,confirmState:t,handleConfirm:a,representatives:o,incidents:s,detailModalState:l,closeDetailModal:d,mixedShiftConfirmModalState:c,handleMixedShiftConfirm:p,vacationConfirmationState:x,closeVacationConfirmation:u}=Z(e=>({isLoading:e.isLoading,confirmState:e.confirmState,handleConfirm:e.handleConfirm,representatives:e.representatives,incidents:e.incidents,detailModalState:e.detailModalState,closeDetailModal:e.closeDetailModal,mixedShiftConfirmModalState:e.mixedShiftConfirmModalState,handleMixedShiftConfirm:e.handleMixedShiftConfirm,vacationConfirmationState:e.vacationConfirmationState,closeVacationConfirmation:e.closeVacationConfirmation}));(0,r.useEffect)(()=>{e||Promise.resolve().then(n.bind(n,7102)).then(e=>{let{shouldRunAutoBackup:t,saveBackupToLocalStorage:n}=e;t()&&(console.log("Running auto-backup..."),n(Z.getState(),"auto"))})},[e]);let[f,g]=(0,r.useState)("DAILY_LOG"),h=function(e){let{incidents:t,representatives:n}=Z(e=>({incidents:e.incidents,representatives:e.representatives}));return(0,r.useMemo)(()=>e&&t&&n?H(t,e,n):null,[t,e,n])}(l.month),y=e=>({padding:"12px 24px",cursor:"pointer",border:"none",borderBottom:e?"3px solid hsl(0, 0%, 13%)":"3px solid transparent",color:e?"hsl(0, 0%, 10%)":"#374151",fontWeight:e?600:500,background:e?"hsl(0, 0%, 97%)":"transparent",fontSize:"16px",marginRight:"8px",transition:"all 0.2s ease-in-out"});return e?(0,i.jsx)("div",{style:{padding:"40px",fontFamily:"sans-serif",color:"#555"},children:"Cargando estado de la aplicaci\xf3n..."}):(0,i.jsxs)("div",{style:{padding:"0 40px",fontFamily:"sans-serif",background:"#F8F9FA",minHeight:"100vh"},children:[(0,i.jsx)("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingTop:"20px",paddingBottom:"16px",marginBottom:"24px",borderBottom:"1px solid #e5e7eb"},children:(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{style:{color:"#1F2937",margin:0,fontSize:"18px",fontWeight:700,lineHeight:1.2},children:"Control Operativo"}),(0,i.jsx)("p",{style:{color:"#6b7280",margin:"4px 0 0",fontSize:"13px",fontWeight:400,opacity:.7},children:"Incidencias y Horarios"})]})}),(0,i.jsxs)("nav",{style:{borderBottom:"1px solid #e5e7eb",marginTop:"12px",background:"#FFFFFF"},children:[(0,i.jsx)("button",{style:y("DAILY_LOG"===f),onClick:()=>g("DAILY_LOG"),children:"Registro Diario"}),(0,i.jsx)("button",{style:y("PLANNING"===f),onClick:()=>g("PLANNING"),children:"Planificaci\xf3n Semanal"}),(0,i.jsx)("button",{style:y("STATS"===f),onClick:()=>g("STATS"),children:"Estad\xedsticas y Reportes"}),(0,i.jsx)("button",{style:y("SETTINGS"===f),onClick:()=>g("SETTINGS"),children:"Configuraci\xf3n"})]}),(0,i.jsxs)("main",{style:{paddingTop:"30px"},children:["DAILY_LOG"===f&&(0,i.jsx)(ta,{}),"PLANNING"===f&&(0,i.jsx)(eW,{onNavigateToSettings:()=>g("SETTINGS")}),"STATS"===f&&(0,i.jsx)(tF,{}),"SETTINGS"===f&&(0,i.jsx)(no,{})]}),(0,i.jsx)("footer",{style:{marginTop:"40px",padding:"20px 0",borderTop:"1px solid #e5e7eb",color:"#9ca3af",fontSize:"12px",textAlign:"center"}}),t&&(0,i.jsx)(ns,{open:!!t,title:t.options.title,description:t.options.description,intent:t.options.intent,confirmLabel:t.options.confirmLabel,cancelLabel:t.options.cancelLabel,onConfirm:()=>a(!0),onCancel:()=>a(!1)}),(null==x?void 0:x.isOpen)&&(0,i.jsx)(nd,{isOpen:x.isOpen,repName:x.repName,startDate:x.startDate,endDate:x.endDate,returnDate:x.returnDate,workingDays:x.workingDays,onClose:u}),(0,i.jsx)(nl,{}),(null==c?void 0:c.isOpen)&&(0,i.jsx)(nf,{activeShift:c.activeShift,onClose:()=>p(null),onSelect:p}),(0,i.jsx)(K.M,{children:l.isOpen&&l.personId&&h&&(0,i.jsx)(nu,{summary:h,personId:l.personId,onClose:d})})]})}function nh(){return(0,i.jsx)(ng,{})}let ny=e=>{let{representatives:t,incidents:n,calendar:i,coverageRules:r,swaps:a,specialSchedules:o,effectivePeriods:s,historyEvents:l,auditLog:d,version:c}=e;return{representatives:t,incidents:n,calendar:i,coverageRules:r,swaps:a,specialSchedules:o,effectivePeriods:s,historyEvents:l,auditLog:d,version:c}};function nb(){let{isLoading:e,initialize:t}=Z(e=>({isLoading:e.isLoading,initialize:e.initialize}));return((0,r.useEffect)(()=>{let e;t(),Z.subscribe(t=>{t.isLoading||(clearTimeout(e),e=window.setTimeout(()=>{D(ny(t))},300))})},[t]),e)?(0,i.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",fontFamily:"sans-serif",fontSize:"1.2rem",color:"#6b7280"},children:"Cargando estado de la aplicaci\xf3n..."}):(0,i.jsx)(e_,{children:(0,i.jsx)(el,{children:(0,i.jsx)(nh,{})})})}},7102:function(e,t,n){"use strict";function i(e,t){let n=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5),i=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=URL.createObjectURL(i),a=document.createElement("a");a.href=r,a.download=t||"planning-backup-".concat(n,".json"),a.click(),URL.revokeObjectURL(r)}function r(e){return new Promise((t,n)=>{let i=new FileReader;i.onload=e=>{try{var i;let n=null===(i=e.target)||void 0===i?void 0:i.result,r=JSON.parse(n);if(!r.representatives||!r.calendar||!r.version)throw Error("Invalid backup file format");t(r)}catch(e){n(Error("Failed to parse backup file: "+e.message))}},i.onerror=()=>{n(Error("Failed to read file"))},i.readAsText(e)})}function a(){let e=[];for(let t=0;t<localStorage.length;t++){let n=localStorage.key(t);if(null==n?void 0:n.startsWith("planning-backup-")){let t=localStorage.getItem(n);t&&e.push({key:n,timestamp:n.replace("planning-backup-manual-","").replace("planning-backup-auto-","").replace("planning-backup-",""),size:new Blob([t]).size})}}return e.sort((e,t)=>t.timestamp.localeCompare(e.timestamp))}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"manual",n=new Date().toISOString(),i="planning-backup-".concat(t,"-").concat(n),r=JSON.stringify(e);try{if("auto"===t){let e=a().filter(e=>e.key.includes("-auto-"));e.length>=5&&e.sort((e,t)=>e.timestamp.localeCompare(t.timestamp)).slice(0,e.length-4).forEach(e=>localStorage.removeItem(e.key))}localStorage.setItem(i,r),"auto"===t&&localStorage.setItem("planning-auto-backup-last-run",n)}catch(t){let e=a();if(e.length>0){localStorage.removeItem(e[e.length-1].key);try{localStorage.setItem(i,r)}catch(e){console.error("Storage full, cannot save backup")}}else console.error("Storage full, cannot save backup",t)}}function s(){let e=localStorage.getItem("planning-auto-backup-last-run");if(!e)return!0;let t=new Date(e).getTime();return(new Date().getTime()-t)/36e5>=24}function l(){let e=a();return 0===e.length?null:new Date(e[0].timestamp)}function d(e){let t=localStorage.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(e){return null}}function c(e){localStorage.removeItem(e)}n.r(t),n.d(t,{deleteBackupFromLocalStorage:function(){return c},exportBackup:function(){return i},getBackupHistory:function(){return a},getLastBackupDate:function(){return l},importBackup:function(){return r},loadBackupFromLocalStorage:function(){return d},saveBackupToLocalStorage:function(){return o},shouldRunAutoBackup:function(){return s}})}},function(e){e.O(0,[674,220,971,117,744],function(){return e(e.s=3652)}),_N_E=e.O()}]);