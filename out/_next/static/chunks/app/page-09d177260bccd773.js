(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3652:function(e,t,n){Promise.resolve().then(n.bind(n,6670))},6670:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ns}});var i=n(7437),r=n(2265),a=n(9625),o=n(4391);let s=[],l=[],d=[],c={specialDays:[{date:"2024-12-25",kind:"HOLIDAY",label:"Navidad"},{date:"2025-01-01",kind:"HOLIDAY",label:"A\xf1o Nuevo"},{date:"2025-01-06",kind:"HOLIDAY",label:"D\xeda de los Reyes Magos"},{date:"2025-01-21",kind:"HOLIDAY",label:"D\xeda de la Altagracia"},{date:"2025-01-26",kind:"HOLIDAY",label:"D\xeda de Duarte"},{date:"2025-02-27",kind:"HOLIDAY",label:"D\xeda de la Independencia"},{date:"2025-04-18",kind:"HOLIDAY",label:"Viernes Santo"},{date:"2025-05-01",kind:"HOLIDAY",label:"D\xeda del Trabajo"},{date:"2025-06-19",kind:"HOLIDAY",label:"Corpus Christi"},{date:"2025-08-16",kind:"HOLIDAY",label:"D\xeda de la Restauraci\xf3n"},{date:"2025-09-24",kind:"HOLIDAY",label:"D\xeda de las Mercedes"},{date:"2025-11-06",kind:"HOLIDAY",label:"D\xeda de la Constituci\xf3n"},{date:"2025-12-25",kind:"HOLIDAY",label:"Navidad"},{date:"2026-01-01",kind:"HOLIDAY",label:"A\xf1o Nuevo"},{date:"2026-01-06",kind:"HOLIDAY",label:"D\xeda de los Reyes Magos"},{date:"2026-01-21",kind:"HOLIDAY",label:"D\xeda de la Altagracia"},{date:"2026-01-26",kind:"HOLIDAY",label:"D\xeda de Duarte"},{date:"2026-02-27",kind:"HOLIDAY",label:"D\xeda de la Independencia"},{date:"2026-04-03",kind:"HOLIDAY",label:"Viernes Santo"},{date:"2026-05-01",kind:"HOLIDAY",label:"D\xeda del Trabajo"},{date:"2026-06-04",kind:"HOLIDAY",label:"Corpus Christi"},{date:"2026-08-16",kind:"HOLIDAY",label:"D\xeda de la Restauraci\xf3n"},{date:"2026-09-24",kind:"HOLIDAY",label:"D\xeda de las Mercedes"},{date:"2026-11-06",kind:"HOLIDAY",label:"D\xeda de la Constituci\xf3n"},{date:"2026-12-25",kind:"HOLIDAY",label:"Navidad"}]},p=[{id:"global-day",scope:{type:"SHIFT",shift:"DAY"},required:10},{id:"global-night",scope:{type:"SHIFT",shift:"NIGHT"},required:6}],x=[],u=[],f=[];function h(){return{representatives:s,incidents:l,specialSchedules:d,calendar:c,coverageRules:p,version:7,historyEvents:x,auditLog:u,swaps:f}}var g=n(960);let y="baseState",b="singleton",m="control-puntos:v1",v=void 0!==window.indexedDB;function j(){return v?(0,g.X3)("control-puntos-db",7,{upgrade(e,t){e.objectStoreNames.contains(y)||e.createObjectStore(y)}}):Promise.resolve({get:()=>Promise.resolve(void 0),put:()=>Promise.resolve(void 0),clear:()=>Promise.resolve(void 0),close:()=>{}})}async function S(){if(v&&void 0!==window.localStorage)try{if(!localStorage.getItem(m))return;localStorage.removeItem(m),console.log("Legacy localStorage data discarded due to new data model.")}catch(e){console.error("Failed to clear legacy localStorage:",e);try{localStorage.removeItem(m)}catch(e){}}}async function I(){if(!v)return null;try{var e,t,n,i,r,a,o;await S();let s=await j(),l=await s.get(y,b);if(s.close(),!l)return null;return null!==(e=l.incidents)&&void 0!==e||(l.incidents=[]),null!==(t=l.historyEvents)&&void 0!==t||(l.historyEvents=[]),null!==(n=l.auditLog)&&void 0!==n||(l.auditLog=[]),null!==(i=l.swaps)&&void 0!==i||(l.swaps=[]),null!==(r=l.specialSchedules)&&void 0!==r||(l.specialSchedules=[]),null!==(a=l.coverageRules)&&void 0!==a||(l.coverageRules=[]),null!==(o=l.representatives)&&void 0!==o||(l.representatives=[]),l}catch(e){return console.error("Failed to load state from IndexedDB, returning null:",e),null}}async function C(e){if(v)try{let t=await j();await t.put(y,e,b),t.close()}catch(e){throw console.error("Failed to save state to IndexedDB:",e),e}}var D=n(9651),A=n(5696),E=n(936),k=n(9121),R=n(1747),w=n(183),N=n(3993);function O(e,t,n){let i=new Date(e,t,0).getDate(),r=[];for(let n=1;n<=i;n++){let i=function(e,t,n){let i=e=>e.toString().padStart(2,"0");return"".concat(e,"-").concat(i(t),"-").concat(i(n))}(e,t,n);r.push(function(e){let[t,n,i]=e.split("-").map(Number);return{date:e,dayOfWeek:(0,N.w)(new Date(t,n-1,i)),kind:"WORKING",isSpecial:!1}}(i))}return function(e,t){let n=new Map(t.specialDays.map(e=>[e.date,e]));return e.map(e=>{let t=n.get(e.date);return t?{...e,...t,isSpecial:!0}:e})}(r,n)}var T=n(6698),z=n(5778);function M(e,t,n){var i,r,a;let o;if(!Array.isArray(t)||!e.startDate||!(0,T.J)((0,E.D)(e.startDate)))return console.warn("[resolveIncidentDates] Invalid arguments (calendar days or incident date) for incident ".concat(e.id,". Skipping resolution.")),{incident:e,dates:[],start:null,end:null};let s=[],l="VACACIONES"===e.type?null!==(i=e.duration)&&void 0!==i?i:14:null!==(r=e.duration)&&void 0!==r?r:1;if(l<=0)return{incident:e,dates:[],start:e.startDate,end:e.startDate};let d=new Map(t.map(e=>[e.date,e])),c=(0,E.D)(e.startDate),p=0,x=3*l+30,u=0;for(;p<l&&u<x;){let t=(0,z.c)(c,{representation:"date"}),i=d.get(t);u++;let r=!1;switch(e.type){case"LICENCIA":r=!0;break;case"VACACIONES":if(i){let e="HOLIDAY"!==i.kind;if(n){let t=c.getUTCDay(),i="OFF"===n.baseSchedule[t];e=e&&!i}r=e}break;default:0===s.length&&(r=!0)}if(r&&(s.push(t),p++),"LICENCIA"!==e.type&&"VACACIONES"!==e.type&&1===p)break;c=(0,k.E)(c,1)}let f=s[s.length-1];if(f&&("VACACIONES"===e.type||"LICENCIA"===e.type)){let e=(0,k.E)((0,E.D)(f),1);for(let t=0;t<14;t++){let t=(0,z.c)(e,{representation:"date"}),i=d.get(t),r=!1;if((null==i?void 0:i.kind)!=="HOLIDAY"){if(n){let t=e.getUTCDay();r="OFF"!==n.baseSchedule[t]}else r=!0}if(r){o=t;break}e=(0,k.E)(e,1)}}else f&&(o=(0,z.c)((0,k.E)((0,E.D)(f),1),{representation:"date"}));return{incident:e,dates:s,start:null!==(a=s[0])&&void 0!==a?a:e.startDate,end:null!=f?f:e.startDate,returnDate:o}}function W(e,t,n){return t>n&&"VACACIONES"!==e?{ok:!1,code:"CANNOT_REGISTER_IN_FUTURE",message:'Las incidencias de tipo "'.concat(e,'" no pueden registrarse en fechas futuras.')}:{ok:!0}}let L={AUSENCIA:{weekday:3,weekend:6},TARDANZA:{weekday:2,weekend:3},ERROR:{weekday:2,weekend:2}};function B(e){if(!e.startDate||"LICENCIA"===e.type||"VACACIONES"===e.type||"OVERRIDE"===e.type)return 0;if("OTRO"===e.type){var t;return Number(null!==(t=e.customPoints)&&void 0!==t?t:0)}let n=function(e){let t=e.getDay();return 5===t||6===t||0===t}(function(e){let[t,n,i]=e.split("-").map(Number);return new Date(t,n-1,i)}(e.startDate)),i=L[e.type];return i?n?i.weekend:i.weekday:0}function F(e,t,n){let i=e.filter(e=>e.startDate&&e.startDate.startsWith(t)),r={};for(let e of n)r[e.id]={representativeId:e.id,name:e.name,incidents:[],totals:{puntos:0,ausencias:0,tardanzas:0,errores:0},riskLevel:"ok"};for(let e of i){let t=r[e.representativeId];if(!t)continue;let n=B(e);switch(t.incidents.push({...e,points:n}),t.totals.puntos+=n,e.type){case"AUSENCIA":t.totals.ausencias++;break;case"TARDANZA":t.totals.tardanzas++;break;case"ERROR":t.totals.errores++}}let a=Object.values(r).map(e=>(e.totals.puntos>=10||e.totals.ausencias>=2||e.totals.tardanzas>=3||e.totals.errores>=2?e.riskLevel="danger":e.totals.puntos>0&&(e.riskLevel="warning"),e)),o={totalPoints:0,totalIncidents:0,ausencias:0,tardanzas:0,errores:0};return a.forEach(e=>{o.totalPoints+=e.totals.puntos,o.totalIncidents+=e.incidents.length,o.ausencias+=e.totals.ausencias,o.tardanzas+=e.totals.tardanzas,o.errores+=e.totals.errores}),{month:t,byPerson:a,totals:o}}function H(e,t){let n={id:"audit-".concat(crypto.randomUUID()),timestamp:new Date().toISOString(),...t};e.auditLog.unshift(n)}function V(e){switch(e){case"TARDANZA":return"Tardanza";case"AUSENCIA":return"Ausencia";case"ERROR":return"Error";case"OTRO":return"Otro";case"VACACIONES":return"Vacaciones";case"LICENCIA":return"Licencia";case"OVERRIDE":return"Cambio de turno";default:return"Incidencia"}}function U(e,t){let n=e=>{var n,i;return null!==(i=null===(n=t.find(t=>t.id===e))||void 0===n?void 0:n.name)&&void 0!==i?i:"—"};switch(e.type){case"COVER":return"".concat(n(e.toRepresentativeId)," cubre a ").concat(n(e.fromRepresentativeId));case"DOUBLE":return"".concat(n(e.representativeId)," realiza doble turno");case"SWAP":return"".concat(n(e.fromRepresentativeId)," intercambia turno con ").concat(n(e.toRepresentativeId));default:return"Movimiento de turno registrado"}}function P(e,t){var n,i;return t&&null!==(i=null===(n=e.find(e=>e.id===t))||void 0===n?void 0:n.name)&&void 0!==i?i:"—"}let Y=(0,a.Ue)()((0,o.n)((e,t)=>({...h(),isLoading:!0,planningAnchorDate:new Date().toISOString().split("T")[0],allCalendarDaysForRelevantMonths:[],confirmState:null,detailModalState:{isOpen:!1,personId:null,month:null},vacationConfirmationState:null,mixedShiftConfirmModalState:null,undoStack:[],async initialize(){let n=await I();if(n)e(e=>{Object.assign(e,n),e.representatives.forEach((e,t)=>{void 0===e.orderIndex&&(e.orderIndex=t)}),e.isLoading=!1});else{let t=h();e(e=>{Object.assign(e,t),e.isLoading=!1}),await C(t)}t()._generateCalendarDays()},setPlanningAnchorDate:n=>{e(e=>{let t=(0,D.WU)((0,A.z)((0,E.D)(n),{weekStartsOn:1}),"yyyy-MM-dd");e.planningAnchorDate=t}),t()._generateCalendarDays()},_generateCalendarDays:()=>{e(e=>{if(!e.calendar)return;let t=new Date(e.planningAnchorDate+"T12:00:00Z"),n=new Map;for(let i=-6;i<=18;i++){let r=(0,k.E)(t,30*i);O((0,R.S)(r),(0,w.j)(r)+1,e.calendar).forEach(e=>{n.has(e.date)||n.set(e.date,e)})}e.allCalendarDaysForRelevantMonths=Array.from(n.values())})},addOrUpdateCoverageRule:n=>{let{addHistoryEvent:i}=t();i({category:"RULE",title:"Regla de cobertura actualizada",description:n.label||n.id,impact:"M\xednimo ".concat(n.required," pers."),metadata:{rule:n}}),e(e=>{let t=Math.max(0,Math.floor(n.required)),i={...n,required:t};e.coverageRules.some(e=>e.id===i.id)?e.coverageRules=e.coverageRules.map(e=>e.id===i.id?i:e):e.coverageRules.push(i)})},removeCoverageRule:n=>{let{addHistoryEvent:i,coverageRules:r}=t(),a=r.find(e=>e.id===n);a&&i({category:"RULE",title:"Regla de cobertura eliminada",description:a.label||a.id,metadata:{rule:a}}),e(e=>{e.coverageRules=e.coverageRules.filter(e=>e.id!==n)})},addOrUpdateSpecialDay:n=>{let{addHistoryEvent:i}=t();i({category:"CALENDAR",title:"D\xeda especial actualizado",subject:n.date,description:n.label,impact:n.kind,metadata:{day:n}}),e(e=>{let t=e.calendar.specialDays.filter(e=>e.date!==n.date);e.calendar.specialDays=[...t,n]}),t()._generateCalendarDays()},removeSpecialDay:n=>{let{addHistoryEvent:i}=t();i({category:"CALENDAR",title:"Excepci\xf3n de d\xeda eliminada",subject:n}),e(e=>{e.calendar.specialDays=e.calendar.specialDays.filter(e=>e.date!==n)}),t()._generateCalendarDays()},resetState:async n=>{let{showConfirm:i}=t();await i({title:"⚠️ \xbfReiniciar la planificaci\xf3n?",description:"Esto restaurar\xe1 el estado a los valores iniciales. Esta acci\xf3n no se puede deshacer.",intent:"danger",confirmLabel:"S\xed, reiniciar"})&&(e(e=>{let t=h(),i=[];n&&(i=e.incidents.filter(e=>"LICENCIA"===e.type||"VACACIONES"===e.type),t.incidents=i),Object.assign(e,t,{isLoading:!1})}),t()._generateCalendarDays())},addIncident:async function(n){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{representatives:r,incidents:a,allCalendarDaysForRelevantMonths:o,showConfirm:s}=t(),l=r.find(e=>e.id===n.representativeId);if(!l)return{ok:!1,reason:"Representante no encontrado."};let d={id:"incident-".concat(crypto.randomUUID()),createdAt:new Date().toISOString(),...n},c=function(e,t,n,i,r){if("OVERRIDE"===e.type)return{ok:!0};let a=(0,D.WU)(new Date,"yyyy-MM-dd"),o=W(e.type,e.startDate,a);if(!o.ok)return{ok:!1,code:o.code,message:o.message};let s=M(e,n,i);if(0===s.dates.length&&"VACACIONES"===e.type)return{ok:!1,code:"NO_WORKING_DAYS_FOR_VACATION",message:"No se encontraron d\xedas laborables para iniciar las vacaciones."};if(0===s.dates.length&&"LICENCIA"===e.type&&e.duration>0)return{ok:!1,code:"NO_DAYS_FOR_LICENSE",message:"La duraci\xf3n de la licencia debe ser de al menos 1 d\xeda."};let l=s.dates,d=t.filter(t=>t.representativeId===e.representativeId),c=new Map(r.map(e=>[e.id,e]));if("AUSENCIA"!==e.type){for(let e of l)if(d.some(t=>t.startDate===e&&"AUSENCIA"===t.type))return{ok:!1,code:"BLOCKED_BY_ABSENCE",message:"No se pueden registrar eventos en un d\xeda con ausencia (".concat(e,").")}}for(let i of t)if(i.representativeId===e.representativeId&&i.id!==e.id&&("VACACIONES"===i.type||"LICENCIA"===i.type)){let t=c.get(i.representativeId);if(!t)continue;let r=M(i,n,t).dates;if(l.some(e=>r.includes(e)))return{ok:!1,code:"OVERLAP_WITH_FORMAL_INCIDENT",message:"VACACIONES"===e.type||"LICENCIA"===e.type?"El rango de fechas se solapa con una ".concat("VACACIONES"===i.type?"vacaci\xf3n":"licencia"," existente."):"El d\xeda seleccionado est\xe1 cubierto por una ".concat("VACACIONES"===i.type?"vacaci\xf3n":"licencia"," existente.")}}return"TARDANZA"===e.type&&d.some(t=>t.id!==e.id&&t.startDate===e.startDate&&"TARDANZA"===t.type)?{ok:!1,code:"DUPLICATE_TARDY",message:"Ya existe una tardanza registrada para este d\xeda."}:"AUSENCIA"===e.type&&d.some(t=>t.startDate===e.startDate&&"OVERRIDE"!==t.type)?{ok:!0,warning:"Registrar una ausencia en esta fecha eliminar\xe1 otras incidencias existentes para este representante en el mismo d\xeda. \xbfDesea continuar?"}:{ok:!0}}(d,a,o,l,r);if(!c.ok)return{ok:!1,reason:c.message};let p=i;if(!p){if(c.warning)p=await s({title:"Confirmar Acci\xf3n",description:c.warning,intent:"warning",confirmLabel:"Continuar"});else{let e="OVERRIDE"===d.type;p=await s({title:e?"Confirmar Cambio de Turno":"Confirmar Incidencia",description:"Registrar ".concat(e?"una modificaci\xf3n manual":V(d.type)," a ").concat(P(r,d.representativeId),"."),intent:"info",confirmLabel:e?"Aplicar Cambio":"Registrar"})}if(!p)return{ok:!1,reason:"Acci\xf3n cancelada por el usuario."}}let{addHistoryEvent:x,addAuditEvent:u,pushUndo:f}=t();return x({category:"INCIDENT",title:"".concat(V(d.type)," registrada"),subject:l.name,impact:"OVERRIDE"!==d.type&&"VACACIONES"!==d.type&&"LICENCIA"!==d.type?"-".concat(B(d)," pts"):void 0,description:d.note}),u({actor:{id:"admin",name:"Administrador"},action:"INCIDENT_CREATED",target:{entity:"INCIDENT",entityId:d.id,label:V(d.type)},context:{date:d.startDate,representativeId:d.representativeId,reason:d.note}}),e(e=>{if("AUSENCIA"===d.type){let t=e.incidents.filter(e=>e.representativeId===d.representativeId&&e.startDate===d.startDate);t.length>0&&x({category:"SYSTEM",title:"Incidencias limpiadas por AUSENCIA",subject:l.name,description:"Se eliminaron ".concat(t.length," evento(s) previos.")}),e.incidents=e.incidents.filter(e=>!(e.representativeId===d.representativeId&&e.startDate===d.startDate))}if(e.incidents.some(e=>e.id===d.id)||e.incidents.push(d),"OVERRIDE"!==d.type&&f({label:"".concat(V(d.type)," registrada: ").concat(l.name),undo:()=>t().removeIncident(d.id)}),"VACACIONES"===d.type){let t=M(d,o,l);t.dates.length>0&&(e.vacationConfirmationState={isOpen:!0,repName:l.name,startDate:t.start||d.startDate,endDate:t.end||d.startDate,returnDate:t.returnDate||d.startDate,workingDays:t.dates.length})}}),{ok:!0,newId:d.id}},removeIncident:n=>{let{incidents:i,representatives:r,addHistoryEvent:a,addAuditEvent:o}=t(),s=i.find(e=>e.id===n);if(!s)return;let l=P(r,s.representativeId);a({category:"INCIDENT",title:"Incidencia eliminada: ".concat(V(s.type)),subject:l,metadata:{incident:s}}),o({actor:{id:"admin",name:"Administrador"},action:"INCIDENT_DELETED",target:{entity:"INCIDENT",entityId:s.id,label:V(s.type)},context:{date:s.startDate,representativeId:s.representativeId,reason:"Eliminaci\xf3n manual"}}),e(e=>{e.incidents=e.incidents.filter(e=>e.id!==n)})},removeIncidents:n=>{let{incidents:i,representatives:r,pushUndo:a,addHistoryEvent:o}=t(),s=i.filter(e=>n.includes(e.id));if(0===s.length)return;let l=P(r,s[0].representativeId);o({category:"INCIDENT",title:"".concat(s.length," incidencia(s) eliminada(s)"),subject:l,description:"Tipo: ".concat(V(s[0].type)),metadata:{incidents:s}}),e(e=>{s.forEach(t=>{"OVERRIDE"!==t.type&&H(e,{action:"INCIDENT_DELETED",actor:{id:"admin",name:"Administrador"},target:{entity:"INCIDENT",entityId:t.id,label:V(t.type)},context:{date:t.startDate,representativeId:t.representativeId,reason:"Eliminaci\xf3n m\xfaltiple"}})}),e.incidents=e.incidents.filter(e=>!n.includes(e.id))}),a({label:"Restauradas ".concat(s.length," incidencias de ").concat(l),undo:()=>{o({category:"SYSTEM",title:'Incidencias restauradas por "Deshacer"',subject:l,metadata:{incidents:s}}),e(e=>{e.incidents.push(...s)})}})},addSwap:n=>{let{addHistoryEvent:i,representatives:r,pushUndo:a}=t(),o={id:"swap-".concat(crypto.randomUUID()),createdAt:new Date().toISOString(),...n};e(e=>{e.swaps.push(o)}),i({category:"PLANNING",title:"Cobertura registrada",description:U(o,r),metadata:{swap:o}}),a({label:"Cobertura cancelada: ".concat(U(o,r).substring(0,50),"..."),undo:()=>{e(e=>{e.swaps=e.swaps.filter(e=>e.id!==o.id)}),i({category:"SYSTEM",title:"Cambio de turno deshecho",description:"Se revirti\xf3: ".concat(U(o,r))})}})},removeSwap:t=>{e(e=>{e.swaps=e.swaps.filter(e=>e.id!==t)})},deactivateRepresentative:async n=>{let{showConfirm:i,representatives:r,normalizeOrderIndexes:a}=t(),o=P(r,n),s=r.find(e=>e.id===n);await i({title:"\xbfDesactivar Representante?",description:"Est\xe1s a punto de desactivar a ".concat(o,". No aparecer\xe1 en los nuevos planes, pero su historial se conservar\xe1. \xbfEst\xe1s seguro?"),intent:"warning",confirmLabel:"S\xed, desactivar"})&&(e(e=>{let t=e.representatives.findIndex(e=>e.id===n);-1!==t&&(e.representatives[t].isActive=!1)}),(null==s?void 0:s.baseShift)&&a(s.baseShift))},showConfirm:t=>new Promise(n=>{e(e=>{e.confirmState={options:t,resolve:n}})}),handleConfirm:t=>{e(e=>{e.confirmState&&(e.confirmState.resolve(t),e.confirmState=null)})},showMixedShiftConfirmModal:(t,n,i)=>new Promise(r=>{e(e=>{e.mixedShiftConfirmModalState={isOpen:!0,representativeId:t,date:n,activeShift:i,resolve:r}})}),handleMixedShiftConfirm:t=>{e(e=>{e.mixedShiftConfirmModalState&&(e.mixedShiftConfirmModalState.resolve(t),e.mixedShiftConfirmModalState=null)})},addRepresentative:t=>{e(e=>{e.representatives.push({id:crypto.randomUUID(),...t,isActive:!0})})},updateRepresentative:t=>{e(e=>{let n=e.representatives.findIndex(e=>e.id===t.id);-1!==n&&(e.representatives[n]={...e.representatives[n],...t})})},reorderRepresentatives:(n,i)=>{e(e=>{let t=e.representatives.filter(e=>e.baseShift===n&&e.isActive);if(i.length!==t.length){console.warn("⚠️ Orden incompleto ignorado. Esperado:",t.length,"Recibido:",i.length);return}i.forEach((t,i)=>{let r=e.representatives.find(e=>e.id===t);r&&r.baseShift===n&&(r.orderIndex=i)})}),t().addHistoryEvent({category:"SETTINGS",title:"Orden de ".concat("DAY"===n?"D\xeda":"Noche"," actualizado"),description:"Se reordenaron los representantes del turno"})},normalizeOrderIndexes:t=>{e(e=>{e.representatives.filter(e=>e.baseShift===t&&e.isActive).sort((e,t)=>e.orderIndex-t.orderIndex).forEach((e,t)=>{e.orderIndex=t})})},addSpecialSchedule:t=>{e(e=>{let n={id:"ss-".concat(crypto.randomUUID()),...t};e.specialSchedules.push(n)})},removeSpecialSchedule:t=>{e(e=>{e.specialSchedules=e.specialSchedules.filter(e=>e.id!==t)})},openDetailModal:(t,n)=>{e({detailModalState:{isOpen:!0,personId:t,month:n}})},closeDetailModal:()=>{e({detailModalState:{isOpen:!1,personId:null,month:null}})},addHistoryEvent:t=>{e(e=>{let n={id:"hist-".concat(crypto.randomUUID()),timestamp:new Date().toISOString(),...t};e.historyEvents.unshift(n)})},addAuditEvent:t=>{e(e=>{H(e,t)})},pushUndo:function(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,{commitUndo:r}=t();e(e=>{let t="undo-".concat(crypto.randomUUID()),a=window.setTimeout(()=>{r(t)},i),o=e.undoStack.findIndex(e=>e.id===t);o>-1&&(clearTimeout(e.undoStack[o].timeoutId),e.undoStack.splice(o,1)),e.undoStack.push({...n,id:t,timeoutId:a})})},commitUndo:t=>{e(e=>{e.undoStack=e.undoStack.filter(e=>e.id!==t)})},executeUndo:e=>{let{undoStack:n,commitUndo:i}=t(),r=n.find(t=>t.id===e);r&&(clearTimeout(r.timeoutId),r.undo(),i(e))},closeVacationConfirmation:()=>{e({vacationConfirmationState:null})},exportState:()=>{let{representatives:e,incidents:n,calendar:i,coverageRules:r,swaps:a,specialSchedules:o,historyEvents:s,auditLog:l,version:d}=t();return{representatives:e,incidents:n,calendar:i,coverageRules:r,swaps:a,specialSchedules:o,historyEvents:s,auditLog:l,version:d}},importState:n=>{var i,r,a,o,s,l;let d={...h(),representatives:Array.isArray(n.representatives)?n.representatives:[],incidents:Array.isArray(n.incidents)?n.incidents:[],calendar:null!==(i=n.calendar)&&void 0!==i?i:h().calendar,coverageRules:null!==(r=n.coverageRules)&&void 0!==r?r:[],swaps:null!==(a=n.swaps)&&void 0!==a?a:[],historyEvents:null!==(o=n.historyEvents)&&void 0!==o?o:[],auditLog:null!==(s=n.auditLog)&&void 0!==s?s:[],specialSchedules:null!==(l=n.specialSchedules)&&void 0!==l?l:[],version:7};return e(e=>{Object.assign(e,d,{isLoading:!1,planningAnchorDate:new Date().toISOString().split("T")[0],confirmState:null,mixedShiftConfirmModalState:null,vacationConfirmationState:null,undoStack:[]})}),t()._generateCalendarDays(),{success:!0,message:"Estado importado correctamente."}}})));var G=n(413),Z=n(8614),_=n(521);function q(e){let{content:t,children:n}=e,[a,o]=r.useState(!1);return t?(0,i.jsxs)("div",{className:"relative inline-block",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onFocus:()=>o(!0),onBlur:()=>o(!1),children:[n,(0,i.jsx)(Z.M,{children:a&&(0,i.jsx)(_.E.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},transition:{duration:.15,ease:"easeOut"},style:{position:"absolute",zIndex:50,bottom:"100%",marginBottom:"8px",left:"50%",transform:"translateX(-50%)",padding:"8px 12px",borderRadius:"6px",fontSize:"12px",color:"white",backgroundColor:"hsl(0, 0%, 13%)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",whiteSpace:"nowrap"},children:t})})]}):(0,i.jsx)(i.Fragment,{children:n})}var K=n(401),J=n(5929),Q=n(9388);let X={WORKING:{bg:"#ffffff",fg:"#15803d",icon:K.Z},OFF:{bg:"transparent",fg:"#9ca3af",border:"none"},VACATION:{bg:"hsl(200, 70%, 94%)",fg:"hsl(200, 55%, 30%)"},LICENSE:{bg:"hsl(265, 60%, 95%)",fg:"hsl(265, 40%, 35%)"},HOLIDAY:{bg:"hsl(142, 60%, 94%)",fg:"hsl(35, 90%, 30%)",border:"hsl(35, 90%, 60%)",icon:J.Z},ABSENT:{bg:"hsl(0, 85%, 92%)",fg:"hsl(0, 70%, 25%)",border:"hsl(0, 85%, 60%)",icon:Q.Z}},$=r.memo(function(e){let{resolved:t,onClick:n,onContextMenu:r}=e,a=X[t.variant],o=a.icon,s={flex:1,padding:"10px 8px",textAlign:"center",fontSize:"12px",fontWeight:600,userSelect:"none",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",background:a.bg,color:a.fg,border:a.border?"1px solid ".concat(a.border):"1px solid #eee",borderLeft:"1px solid #eee",cursor:t.canEdit?"pointer":"default",opacity:t.canEdit?1:.6,borderRadius:"6px",transition:"background-color 120ms ease, transform 100ms ease, box-shadow 120ms ease"};return(0,i.jsx)("div",{role:"gridcell","aria-label":t.ariaLabel,"aria-disabled":!t.canEdit,tabIndex:0,style:s,onClick:t.canEdit?n:void 0,onContextMenu:t.canContextMenu?r:void 0,onKeyDown:e=>{t.canEdit&&("Enter"===e.key||" "===e.key)&&(e.preventDefault(),n())},children:(0,i.jsx)(q,{content:t.tooltip,children:(0,i.jsxs)("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[o&&(0,i.jsx)(o,{size:14,strokeWidth:2}),t.label&&(0,i.jsx)("span",{children:t.label})]})})})}),ee=r.memo(function(e){let{agent:t,weekDays:n,activeShift:r,assignmentsMap:a,isAlternate:o,onCellClick:s,onCellContextMenu:l}=e,{representatives:d}=Y(e=>({representatives:e.representatives}));return(0,i.jsxs)("div",{style:{display:"flex",alignItems:"stretch",borderBottom:"1px solid #eee",minHeight:"45px",background:o?"#f9fafb":"white"},children:[(0,i.jsx)("div",{style:{padding:"8px 12px",fontWeight:500,width:"".concat(220,"px"),minWidth:"".concat(220,"px"),display:"flex",alignItems:"center"},children:t.name}),(0,i.jsx)("div",{style:{flex:1,display:"flex",gap:"4px",paddingRight:"4px"},children:n.map(e=>{var n,o,d,c,p,x,u;let f=(d=null===(o=a[t.id])||void 0===o?void 0:null===(n=o[e.date])||void 0===n?void 0:n[r],c=e,p=t,x=0,"AUSENCIA"===d.reason?{variant:"ABSENT",label:"AUS",tooltip:(c.date,"".concat(p.name," deb\xeda trabajar este d\xeda pero no se present\xf3.")),ariaLabel:"".concat(p.name," estuvo ausente el ").concat(c.date),canEdit:!0,canContextMenu:!0}:"VACACIONES"===d.reason?{variant:"VACATION",label:"VAC",tooltip:"".concat(p.name," est\xe1 de vacaciones."),ariaLabel:"".concat(p.name," est\xe1 de vacaciones"),canEdit:!1,canContextMenu:!1}:"LICENCIA"===d.reason?{variant:"LICENSE",label:"LIC",tooltip:"".concat(p.name," est\xe1 de licencia."),ariaLabel:"".concat(p.name," est\xe1 de licencia"),canEdit:!1,canContextMenu:!1}:d.shouldWork?c.isSpecial?{variant:"HOLIDAY",label:"FER",tooltip:(u=c.label,"".concat(p.name," trabaja en feriado").concat(u?" (".concat(u,")"):"",". Este d\xeda se compensa fuera del planner.")),ariaLabel:"".concat(p.name," trabaja en feriado: ").concat(c.label||"feriado"),canEdit:!0,canContextMenu:!0}:{variant:"WORKING",tooltip:(c.date,"".concat(p.name," trabaja normalmente este d\xeda.")),ariaLabel:"".concat(p.name," trabaja normalmente"),canEdit:!0,canContextMenu:!0}:{variant:"OFF",label:"OFF",tooltip:"D\xeda libre habitual de ".concat(p.name,"."),ariaLabel:"".concat(p.name," no trabaja este d\xeda"),canEdit:!0,canContextMenu:!0});return(0,i.jsx)($,{resolved:f,repId:t.id,date:e.date,onClick:()=>s(t.id,e.date),onContextMenu:n=>l(t.id,e.date,n)},e.date)})})]})});function et(e){let{index:t,style:n,data:r}=e,{agents:a,weeklyPlan:o,weekDays:s,activeShift:l,assignmentsMap:d,onCellClick:c,onCellContextMenu:p}=r,x=a[t];return x?(0,i.jsx)("div",{style:n,children:(0,i.jsx)(ee,{agent:x,weeklyPlan:o,weekDays:s,activeShift:l,assignmentsMap:d,isAlternate:t%2!=0,onCellClick:c,onCellContextMenu:p})}):null}function en(e){let{weeklyPlan:t,weekDays:n,agents:a,activeShift:o,assignmentsMap:s,onCellClick:l,onCellContextMenu:d,onEditDay:c}=e,p=r.useMemo(()=>({agents:a,weeklyPlan:t,weekDays:n,activeShift:o,assignmentsMap:s,onCellClick:l,onCellContextMenu:d}),[a,t,n,o,s,l,d]);return(0,i.jsxs)("div",{style:{height:"calc(100vh - 280px)",width:"100%"},children:[(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"".concat(220,"px repeat(7, 1fr)"),borderBottom:"1px solid #e5e7eb",paddingBottom:"10px",fontWeight:600,background:"#f9fafb",color:"#374151",position:"sticky",top:0,zIndex:10},children:[(0,i.jsx)("div",{style:{paddingLeft:"16px"},children:"Agente"}),n.map(e=>(0,i.jsxs)("div",{style:{textAlign:"center",cursor:"pointer",color:e.isSpecial?"#b45309":"inherit"},onClick:()=>c(e),children:[(0,i.jsx)("div",{children:new Date(e.date+"T12:00:00Z").toLocaleDateString("es-ES",{weekday:"short"}).toUpperCase()}),(0,i.jsx)("div",{style:{fontSize:"12px",fontWeight:400},children:e.date.split("-")[2]})]},e.date))]}),(0,i.jsx)("div",{style:{height:"calc(100% - ${HEADER_HEIGHT}px)",width:"100%",overflow:"auto"},children:(0,i.jsx)(G.S_,{height:window.innerHeight-280-48,itemCount:a.length,itemSize:()=>44,width:"100%",itemData:p,children:et})})]})}function ei(e){var t;let{day:n,onClose:a,onSave:o,onClear:s}=e,[l,d]=(0,r.useState)("HOLIDAY"===n.kind?"HOLIDAY":"WORKING"),[c,p]=(0,r.useState)(null!==(t=n.label)&&void 0!==t?t:"");(0,r.useEffect)(()=>{var e;d("HOLIDAY"===n.kind?"HOLIDAY":"WORKING"),p(null!==(e=n.label)&&void 0!==e?e:"")},[n]),n.dayOfWeek;let x={width:"100%",padding:"10px",fontSize:"14px",border:"1px solid #d1d5db",borderRadius:"6px",boxSizing:"border-box"},u={padding:"10px 15px",border:"none",borderRadius:"6px",fontSize:"14px",cursor:"pointer",fontWeight:600};return(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:a,children:(0,i.jsxs)("div",{style:{background:"white",padding:"25px",borderRadius:"12px",width:"400px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.1)"},onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("h2",{style:{marginTop:0,marginBottom:"20px",color:"#1F2937"},children:["Editar D\xeda:"," ",new Date(n.date+"T12:00:00Z").toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})]}),(0,i.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:500,color:"#1F2937"},children:"Tipo de D\xeda"}),(0,i.jsxs)("select",{value:l,onChange:e=>d(e.target.value),style:x,children:[(0,i.jsx)("option",{value:"WORKING",children:"Laborable"}),(0,i.jsx)("option",{value:"HOLIDAY",children:"Feriado (Laborable)"})]}),(0,i.jsxs)("p",{style:{fontSize:12,color:"#6b7280",marginTop:"5px"},children:["El estado base de este d\xeda es: ",(0,i.jsx)("strong",{children:"Laborable"}),"."]})]}),(0,i.jsxs)("div",{style:{marginBottom:"25px"},children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:500,color:"#1F2937"},children:"Etiqueta (opcional)"}),(0,i.jsx)("input",{type:"text",value:c,onChange:e=>p(e.target.value),placeholder:"Ej: Navidad, D\xeda del Trabajador",style:x})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,i.jsx)("div",{children:n.isSpecial&&(0,i.jsx)("button",{onClick:()=>{s(n.date),a()},style:{...u,background:"#fee2e2",color:"#991b1b"},children:"Quitar Excepci\xf3n"})}),(0,i.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,i.jsx)("button",{onClick:a,style:{...u,background:"#f3f4f6",color:"#374151"},children:"Cancelar"}),(0,i.jsx)("button",{onClick:()=>{o({date:n.date,kind:l,label:c.trim()||void 0}),a()},style:{...u,background:"#111827",color:"white"},children:"Guardar Cambios"})]})]})]})})}let er=(0,r.createContext)(null);function ea(){let e=(0,r.useContext)(er);if(!e)throw Error("useEditMode must be used within an EditModeProvider");return e}function eo(e){let{children:t}=e,[n,a]=(0,r.useState)("NORMAL"),o=(0,r.useCallback)(()=>{a("ADMIN_OVERRIDE")},[]),s=(0,r.useCallback)(()=>{a("NORMAL")},[]),l=(0,r.useCallback)(()=>{a(e=>"NORMAL"===e?"ADMIN_OVERRIDE":"NORMAL")},[]),d=(0,r.useMemo)(()=>({mode:n,isAdmin:"ADMIN_OVERRIDE"===n,enableAdmin:o,disableAdmin:s,toggle:l}),[n,o,s,l]);return(0,i.jsx)(er.Provider,{value:d,children:t})}var es=n(7226),el=n(2489),ed=n(6865),ec=n(8906),ep=n(8428),ex=n(8867),eu=n(2934);function ef(e,t){return!!e&&("BOTH"===e.type||"SINGLE"===e.type&&e.shift===t)}function eh(e){let{weeklyPlan:t,initialDate:n,initialShift:a,initialRepId:o,existingSwap:s,onClose:l}=e,{representatives:d,addSwap:c,planningAnchorDate:p,incidents:x,allCalendarDaysForRelevantMonths:u,removeSwap:f,addHistoryEvent:h,swaps:g}=Y(e=>({representatives:e.representatives,addSwap:e.addSwap,planningAnchorDate:e.planningAnchorDate,incidents:e.incidents,allCalendarDaysForRelevantMonths:e.allCalendarDaysForRelevantMonths,removeSwap:e.removeSwap,addHistoryEvent:e.addHistoryEvent,swaps:e.swaps})),{mode:y}=ea(),[b,m]=(0,r.useState)(n||p),[v,j]=(0,r.useState)("SWAP"),[S,I]=(0,r.useState)(a||"DAY"),C=(0,r.useMemo)(()=>t?function(e){let{date:t,weeklyPlan:n,swaps:i,incidents:r,allCalendarDays:a,representatives:o}=e,s={daily:{}},l=i.filter(e=>e.date===t);for(let e of n.agents){let n=e.representativeId,i=e.days[t],d=null==i?void 0:i.assignment,c=new Set;d&&("SINGLE"===d.type?c.add(d.shift):"BOTH"===d.type&&(c.add("DAY"),c.add("NIGHT")));let p=o.find(e=>e.id===n),x=!!r.find(e=>!!(e.representativeId===n&&["VACACIONES","LICENCIA"].includes(e.type))&&M(e,a,p).dates.includes(t)),u=new Set;if(!x){let e=new Set(c);for(let t of l)"COVER"===t.type?(t.fromRepresentativeId===n&&e.has(t.shift)&&e.delete(t.shift),t.toRepresentativeId===n&&e.add(t.shift)):"DOUBLE"===t.type?t.representativeId===n&&e.add(t.shift):"SWAP"===t.type&&(t.fromRepresentativeId===n&&e.has(t.fromShift)&&(e.delete(t.fromShift),e.add(t.toShift)),t.toRepresentativeId===n&&e.has(t.toShift)&&(e.delete(t.toShift),e.add(t.fromShift)));e.forEach(e=>u.add(e))}s.daily[n]={effectiveShifts:u,baseShifts:c,isBlocked:x}}return s}({date:b,weeklyPlan:t,swaps:g,incidents:x,allCalendarDays:u,representatives:d}):{daily:{}},[b,t,g,x,u,d]),[D,A]=(0,r.useState)((null==s?void 0:s.type)||"COVER"),[E,k]=(0,r.useState)(o||(s&&"fromRepresentativeId"in s?s.fromRepresentativeId:"")||""),[R,w]=(0,r.useState)((s&&"toRepresentativeId"in s?s.toRepresentativeId:s&&"representativeId"in s?s.representativeId:"")||""),[N,O]=(0,r.useState)((null==s?void 0:s.note)||""),T=(0,r.useMemo)(()=>{if("COVER"===D&&E&&C.daily[E]){let e=Array.from(C.daily[E].baseShifts);if(1===e.length)return e[0]}return S},[D,E,S,C]),z=(0,r.useMemo)(()=>D&&b?function(e,t,n,i,r){var a,o,s;let l=e=>e?r.daily[e]:void 0;if("COVER"===e||"SWAP"===e){if(!t||!n)return null;if(t===n)return"La operaci\xf3n requiere dos personas distintas."}if("DOUBLE"===e&&!n)return null;let d=l(t),c=l(n);return"COVER"===e?d&&c?"VACATION"===d.incidentType?"No se puede cubrir a alguien de vacaciones.":"LEAVE"===d.incidentType?"No se puede cubrir a alguien de licencia.":"VACATION"===c.incidentType?"No se puede cubrir con alguien de vacaciones.":"LEAVE"===c.incidentType?"No se puede cubrir con alguien de licencia.":d.shouldWork?ef(d.assignment,i)?ef(c.assignment,i)?"El representante que cubre no est\xe1 disponible en ese horario.":null:"No se puede cubrir a alguien que no trabaja ese turno.":"No se puede cubrir a alguien que no trabaja ese d\xeda.":"Representante inv\xe1lido.":"SWAP"===e?d&&c?"VACATION"===d.incidentType||"LEAVE"===d.incidentType||"VACATION"===c.incidentType||"LEAVE"===c.incidentType?"No se puede intercambiar con alguien de vacaciones o licencia.":d.shouldWork&&c.shouldWork?(null===(a=d.assignment)||void 0===a?void 0:a.type)==="SINGLE"&&(null===(o=c.assignment)||void 0===o?void 0:o.type)==="SINGLE"&&d.assignment.shift===c.assignment.shift?"El intercambio no tiene efecto: ambos trabajan el mismo turno.":null:"Ambos representantes deben trabajar ese d\xeda para intercambiar.":"Representante inv\xe1lido.":"DOUBLE"===e?c?"VACATION"===c.incidentType||"LEAVE"===c.incidentType?"No se puede asignar doble turno a alguien de vacaciones o licencia.":c.shouldWork?(null===(s=c.assignment)||void 0===s?void 0:s.type)==="BOTH"?"Este representante ya trabaja ambos turnos.":ef(c.assignment,i)?"El representante ya trabaja ese turno.":null:"No se puede asignar doble turno a alguien que no trabaja.":"Representante inv\xe1lido.":"Operaci\xf3n no v\xe1lida."}(D,E,R,T,C):null,[D,E,R,b,T,C]),W=(0,r.useMemo)(()=>!z&&("COVER"===D||"SWAP"===D?!!(E&&R&&b):"DOUBLE"===D&&!!(R&&b)),[D,E,R,z,b]),L=(0,r.useMemo)(()=>{if(!W||!E&&"DOUBLE"!==D||!R)return null;let e=P(d,E),t=P(d,R);if("COVER"===D){let n="DAY"===T?"D\xeda":"Noche";return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("strong",{children:t})," cubrir\xe1 el turno ",(0,i.jsx)("strong",{children:n})," ","de ",(0,i.jsx)("strong",{children:e}),".",(0,i.jsx)("br",{}),(0,i.jsx)("span",{style:{fontSize:"12px",color:"#6b7280"},children:"Este cambio aplica para el d\xeda seleccionado."})]})}if("SWAP"===D){var n,r;let a=null===(n=C.daily[E])||void 0===n?void 0:n.effectiveShifts,o=null===(r=C.daily[R])||void 0===r?void 0:r.effectiveShifts;if(a&&o&&1===a.size&&1===o.size){let n=Array.from(a)[0],r=Array.from(o)[0];return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("strong",{children:e})," (Turno ",n,") y ",(0,i.jsx)("strong",{children:t})," (Turno ",r,") intercambian sus turnos."]})}return"Intercambio de turnos."}if("DOUBLE"===D){let e="DAY"===S?"D\xeda":"Noche";return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("strong",{children:t})," har\xe1 un turno DOBLE en"," ",(0,i.jsx)("strong",{children:e}),".",(0,i.jsx)("br",{}),(0,i.jsx)("span",{style:{fontSize:"12px",color:"#6b7280"},children:"Se cuenta como +1 en la cobertura."})]})}return null},[D,E,R,W,S,T,C,d]),B=()=>{if(!s)return"";if("COVER"===s.type){let e=P(d,s.fromRepresentativeId),t=P(d,s.toRepresentativeId),n="DAY"===s.shift?"D\xeda":"Noche";return"".concat(t," est\xe1 cubriendo el turno ").concat(n," de ").concat(e)}if("DOUBLE"===s.type){let e=P(d,s.representativeId),t="DAY"===s.shift?"D\xeda":"Noche";return"".concat(e," tiene un turno doble en ").concat(t)}if("SWAP"===s.type){let e=P(d,s.fromRepresentativeId),t=P(d,s.toRepresentativeId);return"".concat(e," y ").concat(t," intercambiaron turnos")}return""},F={width:"100%",padding:"10px",backgroundColor:"#f9fafb",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",outline:"none",boxSizing:"border-box"},H={display:"block",fontSize:"11px",fontWeight:600,color:"#6b7280",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"6px"};return(0,i.jsx)("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50,padding:"16px"},onClick:l,children:(0,i.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",width:"100%",maxWidth:"500px",overflow:"hidden",display:"flex",flexDirection:"column",maxHeight:"90vh"},onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("div",{style:{backgroundColor:"#f9fafb",padding:"16px 24px",borderBottom:"1px solid #f3f4f6",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{style:{fontSize:"18px",fontWeight:700,color:"#111827",margin:0},children:"Gesti\xf3n de Cobertura"}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"8px"},children:[(0,i.jsx)("input",{type:"date",style:{fontSize:"13px",border:"1px solid #d1d5db",borderRadius:"4px",padding:"4px 8px",color:"#374151"},value:b,onChange:e=>m(e.target.value),disabled:!!s}),(0,i.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,i.jsxs)("button",{onClick:()=>I("DAY"),style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:600,cursor:"pointer",border:"DAY"===S?"1px solid #fcd34d":"1px solid #e5e7eb",backgroundColor:"DAY"===S?"#fffbeb":"white",color:"DAY"===S?"#b45309":"#6b7280",pointerEvents:s?"none":"auto",opacity:s?.7:1},children:[(0,i.jsx)(J.Z,{size:12})," D\xeda"]}),(0,i.jsxs)("button",{onClick:()=>I("NIGHT"),style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:600,cursor:"pointer",border:"NIGHT"===S?"1px solid #c7d2fe":"1px solid #e5e7eb",backgroundColor:"NIGHT"===S?"#eef2ff":"white",color:"NIGHT"===S?"#4338ca":"#6b7280",pointerEvents:s?"none":"auto",opacity:s?.7:1},children:[(0,i.jsx)(es.Z,{size:12})," Noche"]})]})]})]}),(0,i.jsx)("button",{onClick:l,style:{color:"#9ca3af",background:"none",border:"none",cursor:"pointer",padding:"4px"},children:(0,i.jsx)(el.Z,{size:20})})]}),(0,i.jsx)("div",{style:{padding:"24px",overflowY:"auto",flex:1},children:s?(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[(0,i.jsxs)("div",{style:{background:"#fef3c7",border:"1px solid #fcd34d",borderRadius:"8px",padding:"16px",display:"flex",gap:"12px",alignItems:"flex-start"},children:[(0,i.jsx)(ed.Z,{size:24,color:"#b45309",style:{flexShrink:0}}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontWeight:600,color:"#92400e"},children:"Cambio de turno activo"}),(0,i.jsx)("div",{style:{fontSize:"14px",color:"#78350f",marginTop:"4px"},children:B()}),s.note&&(0,i.jsxs)("div",{style:{fontSize:"13px",fontStyle:"italic",marginTop:"8px",color:"#78350f"},children:["Nota: ",s.note]})]})]}),(0,i.jsx)("div",{style:{fontSize:"14px",color:"#6b7280",lineHeight:1.5},children:"Si eliminas este cambio, la celda volver\xe1 a su estado original seg\xfan el plan base (WORKING u OFF)."})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"12px",marginBottom:"24px"},children:[(0,i.jsx)(eg,{active:"COVER"===D,onClick:()=>A("COVER"),icon:ec.Z,label:"Cubrir",color:"blue"}),(0,i.jsx)(eg,{active:"SWAP"===D,onClick:()=>A("SWAP"),icon:ep.Z,label:"Intercambio",color:"green"}),(0,i.jsx)(eg,{active:"DOUBLE"===D,onClick:()=>A("DOUBLE"),icon:ex.Z,label:"Doble",color:"orange"})]}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px",marginBottom:"24px"},children:["DOUBLE"!==D&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:H,children:"SWAP"===D?"Qui\xe9n cede (Origen)":"Qui\xe9n necesita cobertura"}),(0,i.jsxs)("select",{style:F,value:E,onChange:e=>k(e.target.value),children:[(0,i.jsx)("option",{value:"",children:"Seleccionar representante..."}),d.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]}),"COVER"===D&&E&&C.daily[E]&&(0,i.jsxs)("div",{style:{marginTop:"8px",fontSize:"12px",color:"#6b7280",display:"flex",alignItems:"center",gap:"6px"},children:["DAY"===T?(0,i.jsx)(J.Z,{size:14}):(0,i.jsx)(es.Z,{size:14}),(0,i.jsxs)("span",{children:["Turno a cubrir:"," ",(0,i.jsx)("strong",{children:"DAY"===T?"D\xeda":"Noche"})]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:H,children:"DOUBLE"===D?"Qui\xe9n har\xe1 el doble turno":"SWAP"===D?"Con qui\xe9n intercambia":"Qui\xe9n va a cubrir"}),(0,i.jsxs)("select",{style:F,value:R,onChange:e=>w(e.target.value),children:[(0,i.jsx)("option",{value:"",children:"Seleccionar representante..."}),d.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),L&&!z&&(0,i.jsxs)("div",{style:{marginBottom:"24px",padding:"16px",backgroundColor:"#f9fafb",border:"1px solid #e5e7eb",borderRadius:"8px",display:"flex",gap:"12px",alignItems:"flex-start"},children:[(0,i.jsx)(eu.Z,{color:"#16a34a",size:18,style:{marginTop:"2px",flexShrink:0}}),(0,i.jsx)("div",{style:{fontSize:"14px",color:"#374151",lineHeight:"1.5"},children:L})]}),z&&(0,i.jsxs)("div",{style:{marginBottom:"24px",padding:"16px",backgroundColor:"#fef2f2",border:"1px solid #fee2e2",borderRadius:"8px",display:"flex",gap:"12px",alignItems:"flex-start"},children:[(0,i.jsx)(ed.Z,{color:"#ef4444",size:18,style:{marginTop:"2px",flexShrink:0}}),(0,i.jsx)("div",{style:{fontSize:"14px",color:"#b91c1c",fontWeight:500},children:z})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:H,children:"Nota Adicional (Opcional)"}),(0,i.jsx)("input",{style:F,placeholder:"Ej: Cambio autorizado por jefe de guardia...",value:N,onChange:e=>O(e.target.value)})]})]})}),(0,i.jsx)("div",{style:{padding:"16px",borderTop:"1px solid #f3f4f6",backgroundColor:"#f9fafb",display:"flex",justifyContent:"space-between",alignItems:"center"},children:s?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{style:{fontSize:"12px",color:"#9ca3af"},children:"Esta acci\xf3n no se puede deshacer."}),(0,i.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,i.jsx)("button",{onClick:l,style:{padding:"8px 16px",fontSize:"14px",fontWeight:500,color:"#4b5563",backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"8px",cursor:"pointer"},children:"Cancelar"}),"ADMIN_OVERRIDE"===y&&(0,i.jsx)("button",{onClick:()=>{s&&(f(s.id),h({category:"PLANNING",title:"Cambio de turno eliminado",description:B()}),l())},style:{padding:"8px 20px",fontSize:"14px",fontWeight:500,color:"white",backgroundColor:"#dc2626",border:"none",borderRadius:"8px",cursor:"pointer"},children:"Eliminar Cambio"})]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{style:{fontSize:"12px",color:"#9ca3af"},children:"Los cambios afectan solo a este d\xeda."}),(0,i.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,i.jsx)("button",{onClick:l,style:{padding:"8px 16px",fontSize:"14px",fontWeight:500,color:"#4b5563",backgroundColor:"transparent",border:"none",cursor:"pointer"},children:"Cancelar"}),(0,i.jsx)("button",{onClick:()=>{if(W&&(E||"DOUBLE"===D)){if("COVER"===D&&E)c({type:"COVER",date:b,shift:T,fromRepresentativeId:E,toRepresentativeId:R,note:N});else if("DOUBLE"===D&&R)c({type:"DOUBLE",date:b,shift:S,representativeId:R,note:N});else if("SWAP"===D&&E&&R){var e,t;let n=null===(e=C.daily[E])||void 0===e?void 0:e.effectiveShifts,i=null===(t=C.daily[R])||void 0===t?void 0:t.effectiveShifts;n&&i&&1===n.size&&1===i.size&&c({type:"SWAP",date:b,fromRepresentativeId:E,fromShift:Array.from(n)[0],toRepresentativeId:R,toShift:Array.from(i)[0],note:N})}l()}},disabled:!W,style:{padding:"8px 20px",fontSize:"14px",fontWeight:500,color:"white",backgroundColor:W?"#2563eb":"#d1d5db",border:"none",borderRadius:"8px",cursor:W?"pointer":"not-allowed",boxShadow:W?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none",transition:"all 0.2s"},children:"Confirmar"})]})]})})]})})}function eg(e){let{active:t,onClick:n,icon:r,label:a,color:o}=e,s=((e,t)=>{if(!t)return{backgroundColor:"white",borderColor:"#e5e7eb",color:"#4b5563"};switch(e){case"blue":return{backgroundColor:"#eff6ff",borderColor:"#bfdbfe",color:"#1d4ed8"};case"green":return{backgroundColor:"#f0fdf4",borderColor:"#bbf7d0",color:"#15803d"};case"orange":return{backgroundColor:"#fff7ed",borderColor:"#fed7aa",color:"#c2410c"};default:return{}}})(o,t);return(0,i.jsxs)("button",{onClick:n,style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"12px",borderRadius:"12px",border:"1px solid ".concat(s.borderColor),backgroundColor:s.backgroundColor,color:s.color,cursor:"pointer",transition:"all 0.2s",width:"100%"},children:[(0,i.jsx)(r,{size:24,style:{color:t?"inherit":"#9ca3af"},strokeWidth:1.5}),(0,i.jsx)("span",{style:{fontSize:"12px",fontWeight:600},children:a})]})}function ey(e){let{rule:t,onEdit:n,onDelete:r}=e,{mode:a}=ea(),o=function(e){switch(e.scope.type){case"GLOBAL":return"Global";case"SHIFT":return"Turno ".concat("DAY"===e.scope.shift?"D\xeda":"Noche");case"DATE":let t=new Date(e.scope.date+"T12:00:00Z");return"Fecha: ".concat(t.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}));default:return"Regla desconocida"}}(t);return(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",background:"white",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontWeight:600,color:"#1f2937"},children:t.label||o}),(0,i.jsxs)("div",{style:{fontSize:"14px",color:"#4b5563",marginTop:"2px"},children:["M\xednimo:"," ",(0,i.jsx)("strong",{style:{color:"#111827"},children:t.required})," personas"]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,i.jsx)("button",{onClick:n,style:{padding:"6px 10px",border:"1px solid #d1d5db",background:"white",borderRadius:"6px",cursor:"pointer"},children:"Editar"}),"ADMIN_OVERRIDE"===a&&(0,i.jsx)("button",{onClick:r,style:{padding:"6px 10px",border:"none",background:"#fee2e2",color:"#991b1b",borderRadius:"6px",cursor:"pointer",fontWeight:500},children:"Eliminar"})]})]})}function eb(e){let{rules:t,onAdd:n,onEdit:r,onDelete:a}=e,o=[...t].sort((e,t)=>{let n={DATE:1,SHIFT:2,GLOBAL:3},i=e.scope.type,r=t.scope.type;return(n[i]||99)-(n[r]||99)});return(0,i.jsxs)("div",{style:{background:"#FFFFFF",padding:"20px",borderRadius:"12px",border:"1px solid #e5e7eb"},children:[(0,i.jsxs)("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:"15px",borderBottom:"1px solid #e5e7eb"},children:[(0,i.jsx)("h3",{style:{margin:0,color:"#111827"},children:"Reglas de Cobertura"}),(0,i.jsx)("button",{onClick:n,style:{padding:"8px 12px",border:"none",borderRadius:"6px",background:"#1F2937",color:"white",fontWeight:600,cursor:"pointer"},children:"+ Nueva regla"})]}),0===t.length?(0,i.jsx)("p",{style:{opacity:.6,textAlign:"center",padding:"20px 0",color:"#6b7280"},children:"No hay reglas personalizadas."}):(0,i.jsx)("ul",{style:{listStyle:"none",padding:0,margin:"15px 0 0 0",display:"flex",flexDirection:"column",gap:"10px"},children:o.map(e=>(0,i.jsx)("li",{children:(0,i.jsx)(ey,{rule:e,onEdit:()=>r(e),onDelete:()=>a(e.id)})},e.id))})]})}function em(e){var t,n,a;let{rule:o,onSave:s,onClose:l}=e,[d,c]=(0,r.useState)(null!==(t=null==o?void 0:o.scope.type)&&void 0!==t?t:"SHIFT"),[p,x]=(0,r.useState)((null==o?void 0:o.scope.type)==="SHIFT"?o.scope.shift:"DAY"),[u,f]=(0,r.useState)((null==o?void 0:o.scope.type)==="DATE"?o.scope.date:new Date().toISOString().split("T")[0]),[h,g]=(0,r.useState)(null!==(n=null==o?void 0:o.required)&&void 0!==n?n:1),[y,b]=(0,r.useState)(null!==(a=null==o?void 0:o.label)&&void 0!==a?a:""),m={width:"100%",padding:"10px",fontSize:"14px",border:"1px solid #d1d5db",borderRadius:"6px",boxSizing:"border-box",marginTop:"8px"},v={padding:"10px 15px",border:"none",borderRadius:"6px",fontSize:"14px",cursor:"pointer",fontWeight:600};return(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:l,children:(0,i.jsxs)("div",{style:{background:"white",padding:"25px",borderRadius:"12px",width:"450px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.1)"},onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("h2",{style:{marginTop:0,marginBottom:"20px",color:"#111827"},children:[o?"Editar Regla":"Nueva Regla"," de Cobertura"]}),(0,i.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,i.jsx)("label",{style:{display:"block",fontWeight:500,color:"#1F2937"},children:"\xc1mbito de la Regla"}),(0,i.jsxs)("select",{value:d,onChange:e=>c(e.target.value),style:m,children:[(0,i.jsx)("option",{value:"SHIFT",children:"Por Turno"}),(0,i.jsx)("option",{value:"DATE",children:"Por Fecha Espec\xedfica"}),(0,i.jsx)("option",{value:"GLOBAL",children:"Global"})]})]}),"SHIFT"===d&&(0,i.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,i.jsx)("label",{style:{display:"block",fontWeight:500,color:"#1F2937"},children:"Turno"}),(0,i.jsxs)("select",{value:p,onChange:e=>x(e.target.value),style:m,children:[(0,i.jsx)("option",{value:"DAY",children:"D\xeda"}),(0,i.jsx)("option",{value:"NIGHT",children:"Noche"})]})]}),"DATE"===d&&(0,i.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,i.jsx)("label",{style:{display:"block",fontWeight:500,color:"#1F2937"},children:"Fecha"}),(0,i.jsx)("input",{type:"date",value:u,onChange:e=>f(e.target.value),style:m})]}),(0,i.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,i.jsx)("label",{style:{display:"block",fontWeight:500,color:"#1F2937"},children:"M\xednimo de Personas Requeridas"}),(0,i.jsx)("input",{type:"number",min:"0",value:h,onChange:e=>g(parseInt(e.target.value,10)||0),style:m})]}),(0,i.jsxs)("div",{style:{marginBottom:"25px"},children:[(0,i.jsx)("label",{style:{display:"block",fontWeight:500,color:"#1F2937"},children:"Etiqueta (opcional)"}),(0,i.jsx)("input",{type:"text",value:y,onChange:e=>b(e.target.value),placeholder:"Ej: Feriado Nacional, Evento especial",style:m})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[(0,i.jsx)("button",{onClick:l,style:{...v,background:"#f3f4f6",color:"#374151"},children:"Cancelar"}),(0,i.jsx)("button",{onClick:()=>{var e;let t;switch(d){case"GLOBAL":t={type:"GLOBAL"};break;case"SHIFT":t={type:"SHIFT",shift:p};break;case"DATE":t={type:"DATE",date:u}}s({id:null!==(e=null==o?void 0:o.id)&&void 0!==e?e:"rule-".concat(crypto.randomUUID()),required:Math.max(0,h),scope:t,label:y.trim()||void 0})},style:{...v,background:"#111827",color:"white"},children:"Guardar Regla"})]})]})})}var ev=n(5775);function ej(e){let{representatives:t,incidents:n,specialSchedules:i,allCalendarDaysForRelevantMonths:a}=Y(e=>({representatives:e.representatives,incidents:e.incidents,specialSchedules:e.specialSchedules,allCalendarDaysForRelevantMonths:e.allCalendarDaysForRelevantMonths}));return{weeklyPlan:(0,r.useMemo)(()=>t.length&&e&&7===e.length?function(e,t,n,i,r){if(7!==i.length)throw Error("buildWeeklySchedule expects an array of 7 DayInfo objects.");let a=i[0].date,o=new Map(e.map(e=>[e.id,e])),s=t.filter(e=>"VACACIONES"===e.type||"LICENCIA"===e.type).map(e=>{let t=o.get(e.representativeId);return M(e,r,t)}).filter(e=>e.dates.length>0),l=new Map;t.filter(e=>"OVERRIDE"===e.type||"AUSENCIA"===e.type).forEach(e=>{l.set("".concat(e.representativeId,":").concat(e.startDate),e)});let d=new Map;return n.forEach(e=>{d.has(e.representativeId)||d.set(e.representativeId,[]),d.get(e.representativeId).push(e)}),{weekStart:a,agents:e.map(e=>{let t={},n=d.get(e.id)||[];for(let r of i){let i=r.date,a=(0,E.D)(i),o=s.find(t=>t.incident.representativeId===e.id&&t.dates.includes(i)),d=l.get("".concat(e.id,":").concat(i)),c=(null==d?void 0:d.type)==="OVERRIDE"?d:void 0,p=(null==d?void 0:d.type)==="AUSENCIA",x=n.find(e=>(0,ev._)(a,{start:(0,E.D)(e.startDate),end:(0,E.D)(e.endDate)})&&e.daysOfWeek.includes(r.dayOfWeek)),u=function(e,t,n,i,r,a){var o,s,l,d;let c;if(i)return{status:"OFF",source:"INCIDENT",type:i.incident.type,assignment:{type:"NONE"}};if(r&&r.assignment)return{status:"NONE"===r.assignment.type?"OFF":"WORKING",source:"OVERRIDE",assignment:r.assignment};if(a)return{status:"NONE"===a.assignment.type?"OFF":"WORKING",source:"BASE",assignment:a.assignment};if("OFF"===(null!==(d=null===(o=e.baseSchedule)||void 0===o?void 0:o[t.dayOfWeek])&&void 0!==d?d:"OFF"))return{status:"OFF",source:"BASE",assignment:{type:"NONE"}};let p=t.dayOfWeek>=1&&t.dayOfWeek<=4,x=0===t.dayOfWeek||5===t.dayOfWeek||6===t.dayOfWeek;return(c=(null===(s=e.mixProfile)||void 0===s?void 0:s.type)==="WEEKDAY"&&p||(null===(l=e.mixProfile)||void 0===l?void 0:l.type)==="WEEKEND"&&x?{type:"BOTH"}:{type:"SINGLE",shift:e.baseShift},n)?{status:"WORKING",source:"INCIDENT",type:"AUSENCIA",assignment:c}:{status:"WORKING",source:"BASE",assignment:c}}(e,r,p,o,c,x);t[i]={status:u.status,source:u.source,type:u.type,assignment:u.assignment}}return{representativeId:e.id,days:t}})}}(t,n,i,e,a):null,[e,t,n,i,a])}}var eS=n(5704),eI=n(6579),eC=n(6035),eD=n(3292);function eA(e){return(0,D.WU)(e,"yyyy-MM-dd")}function eE(e,t){let{calendar:n}=Y(e=>({calendar:e.calendar})),i=(0,r.useMemo)(()=>(function(e,t){let n=function(e){let t="string"==typeof e?new Date(e+"T12:00:00Z"):e;return(0,A.z)(t,{weekStartsOn:1})}(e),i=O((0,R.S)(n),(0,w.j)(n)+1,t),r=(0,k.E)(n,6);if((0,w.j)(r)!==(0,w.j)(n)){let e=O((0,R.S)(r),(0,w.j)(r)+1,t);i.push(...e)}let a=new Map(i.map(e=>[e.date,e])),o=[];for(let e=0;e<7;e++){let t=(0,k.E)(n,e),i=(0,D.WU)(t,"yyyy-MM-dd"),r=a.get(i);if(r)o.push(r);else{console.warn("Could not find day info for ".concat(i));let e={date:i,dayOfWeek:t.getDay(),kind:"WORKING",isSpecial:!1};o.push(e)}}return o})(e,n),[e,n]),a=(0,r.useMemo)(()=>(function(e){let t=new Date(e+"T12:00:00Z"),n=(0,A.z)(t,{weekStartsOn:1}),i=(0,eC.v)(t,{weekStartsOn:1});if((0,D.WU)(n,"MMMM",{locale:eD.es})===(0,D.WU)(i,"MMMM",{locale:eD.es})){let e=(0,D.WU)(n,"d"),t=(0,D.WU)(i,"d 'de' MMMM 'de' yyyy",{locale:eD.es});return"Semana del ".concat(e," al ").concat(t)}{let e=(0,D.WU)(n,"d 'de' MMMM",{locale:eD.es}),t=(0,D.WU)(i,"d 'de' MMMM 'de' yyyy",{locale:eD.es});return"Semana del ".concat(e," al ").concat(t)}})(e),[e]),o=(0,r.useMemo)(()=>(0,eS.x)(new Date,new Date(e+"T12:00:00"),{weekStartsOn:1}),[e]);return{weekStart:e,weekDays:i,label:a,isCurrentWeek:o,handlePrevWeek:()=>{t(eA((0,eI.j)(new Date(e+"T12:00:00"),-1)))},handleNextWeek:()=>{t(eA((0,eI.j)(new Date(e+"T12:00:00"),1)))},handleGoToday:()=>{t(eA(new Date))}}}let ek=e=>{let{content:t,children:n}=e,[a,o]=r.useState(!1);return(0,i.jsxs)("div",{style:{position:"relative",display:"flex",alignItems:"flex-end",width:"100%",height:"100%"},onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[n,a&&(0,i.jsx)("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",background:"#1f2937",color:"white",padding:"8px 12px",borderRadius:"6px",fontSize:"13px",whiteSpace:"nowrap",zIndex:1e3,marginBottom:"8px"},children:t})]})};function eR(e){let{data:t}=e,n=Object.keys(t).sort(),r=Math.max(1,...Object.values(t).map(e=>Math.max(e.actual,e.required)));return(0,i.jsxs)("div",{style:{padding:"20px",background:"#f9fafb",borderRadius:"8px",border:"1px solid #e5e7eb",position:"relative"},children:[(0,i.jsx)("h3",{style:{marginTop:0,marginBottom:"20px",color:"#111827"},children:"An\xe1lisis de Cobertura Diaria"}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"flex-end",gap:"10px",height:"250px",borderLeft:"1px solid #d1d5db",borderBottom:"1px solid #d1d5db",paddingLeft:"10px",position:"relative"},children:[n.map(e=>{let{actual:n,required:a,status:o,reason:s}=t[e],l=r>0?n/r*100:0,d="DEFICIT"===o,c=(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{fontWeight:600},children:["Presentes: ",n," | Requerido: ",a]}),s&&(0,i.jsx)("div",{style:{marginTop:4,fontSize:11,color:"#cbd5e1",maxWidth:200},children:s})]});return(0,i.jsxs)("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end",gap:"8px",height:"100%"},children:[(0,i.jsx)("div",{style:{fontWeight:"600",color:d?"hsl(350, 80%, 50%)":"#111827",transition:"color 0.3s ease-in-out"},children:n}),(0,i.jsx)(ek,{content:c,children:(0,i.jsx)("div",{style:{width:"80%",height:"".concat(l,"%"),minHeight:"4px",backgroundColor:d?"hsl(350, 80%, 60%)":"hsl(142.1, 76.2%, 40%)",borderRadius:"4px 4px 0 0",transition:"all 0.3s ease-in-out",cursor:"help"}})}),(0,i.jsx)("div",{style:{fontSize:"12px",color:"#6b7280",whiteSpace:"nowrap"},children:new Date(e+"T12:00:00Z").toLocaleDateString("es-ES",{weekday:"short",day:"numeric"})})]},e)}),(0,i.jsx)("svg",{style:{position:"absolute",bottom:"34px",left:"10px",width:"calc(100% - 10px)",height:"calc(100% - 34px)",pointerEvents:"none"},viewBox:"0 0 100 100",preserveAspectRatio:"none",children:(0,i.jsx)("polyline",{points:n.map((e,i)=>{var a,o;let s=null!==(o=null===(a=t[e])||void 0===a?void 0:a.required)&&void 0!==o?o:0,l=100/n.length*(i+.5);return"".concat(l,",").concat(100-(r>0?s/r*100:0))}).join(" "),stroke:"#9ca3af",strokeWidth:"0.5",fill:"none",strokeDasharray:"2 2",vectorEffect:"non-scaling-stroke"})})]})]})}function ew(e){let{onCreateRule:t}=e;return(0,i.jsxs)("div",{style:{padding:"32px",border:"1px dashed #d1d5db",borderRadius:"12px",background:"#f9fafb",textAlign:"center",color:"#374151"},children:[(0,i.jsx)("h3",{style:{marginTop:0,marginBottom:"8px",fontWeight:600},children:"No hay reglas de cobertura definidas"}),(0,i.jsx)("p",{style:{marginBottom:"20px",fontSize:"14px",color:"#6b7280"},children:"El an\xe1lisis de cobertura solo se muestra cuando existen reglas de m\xednimo de personal para este turno o fechas espec\xedficas."}),(0,i.jsx)("button",{onClick:t,style:{padding:"8px 14px",borderRadius:"6px",border:"none",background:"#111827",color:"white",fontWeight:600,cursor:"pointer",fontSize:"14px"},children:"+ Crear regla de cobertura"})]})}function eN(e,t,n,i,r,a,o,s){var l;let d=e.agents.find(e=>e.representativeId===a),c=null==d?void 0:null===(l=d.days[i])||void 0===l?void 0:l.assignment,p=(null==c?void 0:c.type)==="BOTH"||(null==c?void 0:c.type)==="SINGLE"&&c.shift===r,x=s.find(e=>e.id===a);x||console.warn("[resolveEffectiveDuty] Representative ".concat(a," not found. This may cause incorrect vacation calculations."));let u=n.find(e=>{if(e.representativeId!==a||!["VACACIONES","LICENCIA"].includes(e.type))return!1;let t=M(e,o,x);return!!t.dates.includes(i)||"VACACIONES"===e.type&&!!t.start&&!!t.returnDate&&i>=t.start&&i<t.returnDate||"LICENCIA"===e.type&&!!t.start&&!!t.returnDate&&i>=t.start&&i<t.returnDate});if(u)return{shouldWork:!1,role:"NONE",reason:u.type};if(n.find(e=>e.representativeId===a&&"AUSENCIA"===e.type&&M(e,o,x).dates.includes(i))&&p)return{shouldWork:!1,role:"NONE",reason:"AUSENCIA"};for(let e of t.filter(e=>e.date===i)){if("COVER"===e.type&&e.shift===r){if(e.fromRepresentativeId===a)return{shouldWork:!1,role:"COVERED",reason:"Cubierto por ".concat(e.toRepresentativeId)};if(e.toRepresentativeId===a)return{shouldWork:!0,role:"COVERING",reason:"Cubriendo a ".concat(e.fromRepresentativeId)}}if("DOUBLE"===e.type&&e.shift===r&&e.representativeId===a)return{shouldWork:!0,role:"DOUBLE",reason:"Turno adicional"};if("SWAP"===e.type){if(e.fromRepresentativeId===a){if(e.fromShift===r)return{shouldWork:!1,role:"SWAPPED_OUT",reason:"Intercambio con ".concat(e.toRepresentativeId)};if(e.toShift===r)return{shouldWork:!0,role:"SWAPPED_IN",reason:"Intercambio con ".concat(e.toRepresentativeId)}}if(e.toRepresentativeId===a){if(e.toShift===r)return{shouldWork:!1,role:"SWAPPED_OUT",reason:"Intercambio con ".concat(e.fromRepresentativeId)};if(e.fromShift===r)return{shouldWork:!0,role:"SWAPPED_IN",reason:"Intercambio con ".concat(e.fromRepresentativeId)}}}}return p?{shouldWork:!0,role:"BASE"}:{shouldWork:!1,role:"NONE"}}function eO(e,t,n){let i=n.find(t=>"DATE"===t.scope.type&&t.scope.date===e);if(i)return{required:i.required,source:"RULE",ruleId:i.id,reason:"Regla espec\xedfica para fecha: ".concat(i.label||i.id)};let r=n.find(e=>"SHIFT"===e.scope.type&&e.scope.shift===t);if(r)return{required:r.required,source:"RULE",ruleId:r.id,reason:"Regla general de turno ".concat(t,": ").concat(r.label||r.id)};let a=n.find(e=>"GLOBAL"===e.scope.type);return a?{required:a.required,source:"RULE",ruleId:a.id,reason:"Regla global: ".concat(a.label||a.id)}:{required:0,source:"DEFAULT",reason:"Valor por defecto (ninguna regla aplicable)"}}function eT(e,t){return e<t?"DEFICIT":e>t?"SURPLUS":"OK"}var ez=n(5368);function eM(e){let{title:t,points:n}=e,[a,o]=(0,r.useState)(!1);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("button",{onClick:()=>o(!0),style:{background:"none",border:"none",color:"#6b7280",fontSize:"13px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",padding:"4px 8px",borderRadius:"4px",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.background="#f3f4f6",e.currentTarget.style.color="#374151"},onMouseLeave:e=>{e.currentTarget.style.background="none",e.currentTarget.style.color="#6b7280"},children:[(0,i.jsx)(ez.Z,{size:14}),t]}),a&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{onClick:()=>o(!1),style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.3)",zIndex:999}}),(0,i.jsxs)("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"white",borderRadius:"12px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",zIndex:1e3},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[(0,i.jsx)("h3",{style:{margin:0,fontSize:"18px",fontWeight:600,color:"#111827"},children:t}),(0,i.jsx)("button",{onClick:()=>o(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#6b7280",padding:"4px"},children:(0,i.jsx)(el.Z,{size:20})})]}),(0,i.jsx)("ul",{style:{margin:0,padding:0,listStyle:"none",display:"flex",flexDirection:"column",gap:"12px"},children:n.map((e,t)=>(0,i.jsxs)("li",{style:{display:"flex",gap:"8px",fontSize:"14px",color:"#374151",lineHeight:"1.5"},children:[(0,i.jsx)("span",{style:{color:"#6366f1",fontWeight:600},children:"•"}),(0,i.jsx)("span",{children:e})]},t))})]})]})]})}function eW(){let{representatives:e,coverageRules:t,planningAnchorDate:n,isLoading:a,addOrUpdateCoverageRule:o,removeCoverageRule:s,addOrUpdateSpecialDay:l,removeSpecialDay:d,setPlanningAnchorDate:c,incidents:p,swaps:x,addIncident:u,showMixedShiftConfirmModal:f,allCalendarDaysForRelevantMonths:h,pushUndo:g}=Y(e=>{var t;return{representatives:null!==(t=e.representatives)&&void 0!==t?t:[],coverageRules:e.coverageRules,planningAnchorDate:e.planningAnchorDate,isLoading:e.isLoading,addOrUpdateCoverageRule:e.addOrUpdateCoverageRule,removeCoverageRule:e.removeCoverageRule,addOrUpdateSpecialDay:e.addOrUpdateSpecialDay,removeSpecialDay:e.removeSpecialDay,setPlanningAnchorDate:e.setPlanningAnchorDate,incidents:e.incidents,addIncident:e.addIncident,showMixedShiftConfirmModal:e.showMixedShiftConfirmModal,swaps:e.swaps,allCalendarDaysForRelevantMonths:e.allCalendarDaysForRelevantMonths,pushUndo:e.pushUndo}}),y=(0,r.useMemo)(()=>e.filter(e=>!1!==e.isActive),[e]),{mode:b}=ea(),{weekDays:m,label:v,isCurrentWeek:j,handlePrevWeek:S,handleNextWeek:I,handleGoToday:C}=eE(n,c),{weeklyPlan:D}=ej(m),[A,E]=(0,r.useState)("DAY"),[k,R]=(0,r.useState)(null),[w,N]=(0,r.useState)(null),[O,T]=(0,r.useState)(!1),[z,W]=(0,r.useState)({isOpen:!1,repId:null,date:null,shift:null,existingSwap:null}),{showConfirm:L}=Y(e=>({showConfirm:e.showConfirm})),B=async(t,n)=>{var i;let r;if(!D)return;let a=e.find(e=>e.id===t);if(!a||p.find(e=>{if(e.representativeId!==t||!["VACACIONES","LICENCIA"].includes(e.type))return!1;let i=M(e,h,a);return!!i.start&&!!i.returnDate&&n>=i.start&&n<i.returnDate}))return;let o=D.agents.find(e=>e.representativeId===t),s=null==o?void 0:o.days[n],l=p.find(e=>e.representativeId===t&&e.startDate===n&&"OVERRIDE"===e.type);if(l){Y.setState(e=>{e.incidents=e.incidents.filter(e=>e.id!==l.id),e.swaps=e.swaps.filter(e=>e.date!==n||!("representativeId"in e&&e.representativeId===t||"fromRepresentativeId"in e&&e.fromRepresentativeId===t||"toRepresentativeId"in e&&e.toRepresentativeId===t))}),g({label:"Reaplicar cambio de turno de ".concat(a.name),undo:()=>{Y.setState(e=>{e.incidents.push(l)})}});return}let d=null!==(i=null==s?void 0:s.assignment)&&void 0!==i?i:{type:"NONE"};if((null==d?void 0:d.type)==="BOTH"){if(null===(r=await f(t,n,A)))return}else r="SINGLE"===d.type&&d.shift===A?{type:"NONE"}:{type:"SINGLE",shift:A};let c={representativeId:t,startDate:n,type:"OVERRIDE",duration:1,assignment:r,previousAssignment:d},x=await u(c,!0);x.ok&&g({label:"Deshacer cambio de turno de ".concat(a.name),undo:()=>{Y.setState(e=>{e.incidents=e.incidents.filter(e=>e.id!==x.newId),e.swaps=e.swaps.filter(e=>e.date!==n||!("representativeId"in e&&e.representativeId===t||"fromRepresentativeId"in e&&e.fromRepresentativeId===t||"toRepresentativeId"in e&&e.toRepresentativeId===t))})}})},F=(0,r.useMemo)(()=>D?function(e,t,n,i,r){let a={};for(let o of e.agents)for(let s of(a[o.representativeId]={},Object.keys(o.days)))a[o.representativeId][s]={DAY:eN(e,t,n,s,"DAY",o.representativeId,i,r),NIGHT:eN(e,t,n,s,"NIGHT",o.representativeId,i,r)};return a}(D,x,p,h,e):{},[D,x,p,h,e]),H=(0,r.useMemo)(()=>{if(!D)return[];let e=new Map(D.agents.map(e=>[e.representativeId,e]));return y.filter(t=>{let n=e.get(t.id);return!!n&&(t.baseShift===A||m.some(e=>{var t;let i=null===(t=n.days[e.date])||void 0===t?void 0:t.assignment;return!!i&&("BOTH"===i.type||"SINGLE"===i.type&&i.shift===A)}))})},[D,m,A,y]),V=(0,r.useMemo)(()=>{if(!D)return{};let n={};return m.forEach(i=>{let r=function(e,t,n,i,r,a,o){let s=function(e,t,n,i){let r=new Set;for(let a of e){if(!["VACACIONES","LICENCIA"].includes(a.type))continue;let e=i.find(e=>e.id===a.representativeId);if(!e)continue;let o=M(a,n,e);o.start&&o.returnDate&&t>=o.start&&t<o.returnDate&&r.add(a.representativeId)}return r}(r,i,a,o),l={DAY:{actual:0},NIGHT:{actual:0}};for(let t of e.agents){if(s.has(t.representativeId))continue;let e=t.days[i];(null==e?void 0:e.assignment)&&("SINGLE"===e.assignment.type?l[e.assignment.shift].actual++:"BOTH"===e.assignment.type&&(l.DAY.actual++,l.NIGHT.actual++))}let d=function(e,t){let n={date:e.date,shifts:{DAY:e.shifts.DAY,NIGHT:e.shifts.NIGHT}};for(let i of t.filter(t=>t.date===e.date))"DOUBLE"===i.type&&i.shift&&n.shifts[i.shift]++;return n}({date:i,shifts:{DAY:l.DAY.actual,NIGHT:l.NIGHT.actual}},t),c=eO(i,"DAY",n),p=eO(i,"NIGHT",n);return{DAY:{actual:d.shifts.DAY,required:c.required,status:eT(d.shifts.DAY,c.required),reason:c.reason},NIGHT:{actual:d.shifts.NIGHT,required:p.required,status:eT(d.shifts.NIGHT,p.required),reason:p.reason}}}(D,x,t,i.date,p,h,e);n[i.date]=r[A]}),n},[D,x,t,m,A]),U=(0,r.useMemo)(()=>Object.values(V).some(e=>e.required>0),[V]),P=e=>({padding:"8px 16px",cursor:"pointer",border:"none",borderBottom:e?"2px solid hsl(0, 0%, 13%)":"2px solid transparent",color:e?"#111827":"#4b5563",fontWeight:e?600:500,background:"transparent",fontSize:"16px",marginRight:"10px"});return a||!m||0===m.length?(0,i.jsx)("div",{style:{padding:"40px",fontFamily:"sans-serif",color:"#555"},children:"Cargando planificaci\xf3n..."}):(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{marginBottom:"25px",padding:"16px 20px",background:"#FFFFFF",borderRadius:"12px",display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid ".concat("ADMIN_OVERRIDE"===b?"#f59e0b":"#e5e7eb"),height:"74px",boxSizing:"border-box",transition:"border-color 0.3s ease"},children:(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,i.jsx)("h2",{style:{margin:0,fontWeight:600,fontSize:"18px"},children:"Planificaci\xf3n"}),(0,i.jsx)(eM,{title:"\xbfC\xf3mo usar el planner?",points:["Click en una celda para cambiar el turno del agente","Click derecho para gestionar swaps y coberturas","El gr\xe1fico lateral muestra la cobertura requerida vs actual"]})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,i.jsx)("button",{onClick:S,style:{padding:"8px",border:"1px solid #d1d5db",borderRadius:"6px",background:"white",lineHeight:1},children:"<"}),(0,i.jsx)("div",{style:{fontSize:"14px",fontWeight:500,color:"#374151",width:"280px",textAlign:"center"},children:v}),(0,i.jsx)("button",{onClick:I,style:{padding:"8px",border:"1px solid #d1d5db",borderRadius:"6px",background:"white",lineHeight:1},children:">"}),!j&&(0,i.jsx)("button",{onClick:C,style:{padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",background:"white",fontSize:"12px",fontWeight:600},children:"Semana Actual"})]})]})}),(0,i.jsx)("div",{style:{marginBottom:"20px"},children:(0,i.jsxs)("div",{style:{borderBottom:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("button",{style:P("DAY"===A),onClick:()=>E("DAY"),children:"Turno D\xeda"}),(0,i.jsx)("button",{style:P("NIGHT"===A),onClick:()=>E("NIGHT"),children:"Turno Noche"})]}),(0,i.jsxs)("button",{onClick:()=>W({isOpen:!0,repId:null,date:n,shift:A,existingSwap:null}),style:{padding:"8px 16px",backgroundColor:"#2563eb",color:"white",border:"none",borderRadius:"6px",fontWeight:600,fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,i.jsx)("path",{d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})}),"Gestionar Cambios"]})]})}),(0,i.jsx)(Z.M,{mode:"wait",children:(0,i.jsx)(_.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.18,ease:"easeOut"},children:D?(0,i.jsxs)("div",{style:{display:"flex",overflowX:"hidden",gap:"40px",alignItems:"start"},children:[(0,i.jsx)("div",{style:{flex:1,minWidth:0},children:(0,i.jsx)(en,{weeklyPlan:D,weekDays:m,agents:H,activeShift:A,assignmentsMap:F,onCellClick:(e,t)=>B(e,t),onCellContextMenu:(e,t,n)=>{n.preventDefault();let i=x.find(n=>n.date===t&&("COVER"===n.type?(n.fromRepresentativeId===e||n.toRepresentativeId===e)&&n.shift===A:"DOUBLE"===n.type?n.representativeId===e&&n.shift===A:"SWAP"===n.type&&(n.fromRepresentativeId===e||n.toRepresentativeId===e)));W({isOpen:!0,repId:e,date:t,shift:A,existingSwap:i||null})},onEditDay:R})}),(0,i.jsx)("aside",{style:{position:"sticky",top:"20px",width:"340px",flexShrink:0},children:(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[U?(0,i.jsx)(eR,{data:V}):(0,i.jsx)(ew,{onCreateRule:()=>T(!0)}),(0,i.jsx)(eb,{rules:t,onAdd:()=>T(!0),onEdit:e=>N(e),onDelete:async e=>{await L({title:"\xbfEliminar Regla?",description:"Esta acci\xf3n eliminar\xe1 la regla de cobertura permanentemente.",intent:"danger",confirmLabel:"S\xed, eliminar"})&&s(e)}})]})})]}):(0,i.jsx)("div",{children:"Cargando plan..."})},D?D.weekStart+A:A)}),k&&(0,i.jsx)(ei,{day:k,onClose:()=>R(null),onSave:l,onClear:async e=>{await L({title:"\xbfQuitar Excepci\xf3n?",description:"Esto restaurar\xe1 el comportamiento por defecto del d\xeda ".concat(e,"."),intent:"warning"})&&d(e)}}),(w||O)&&(0,i.jsx)(em,{rule:null!=w?w:void 0,onSave:e=>{o(e),N(null),T(!1)},onClose:()=>{N(null),T(!1)}}),z.isOpen&&D&&(0,i.jsx)(eh,{weeklyPlan:D,initialDate:z.date||n,initialShift:z.shift||A,initialRepId:z.repId||void 0,existingSwap:z.existingSwap||void 0,onClose:()=>W({isOpen:!1,repId:null,date:null,shift:null,existingSwap:null})})]})}let eL={TARDANZA:{label:"Tardanza",variant:"warning"},AUSENCIA:{label:"Ausencia",variant:"danger"},ERROR:{label:"Error",variant:"danger"},LICENCIA:{label:"Licencia",variant:"info"},VACACIONES:{label:"Vacaciones",variant:"ok"},OTRO:{label:"Otro",variant:"neutral"},OVERRIDE:{label:"Cambio de Turno",variant:"neutral"}},eB={ok:{background:"hsl(142.1, 80%, 96%)",color:"hsl(142.1, 76.2%, 25%)"},warning:{background:"hsl(45, 100%, 96%)",color:"hsl(45, 80%, 25%)"},danger:{background:"hsl(0, 100%, 97%)",color:"hsl(0, 80%, 45%)"},info:{background:"hsl(210, 100%, 96%)",color:"hsl(210, 80%, 35%)"},neutral:{background:"hsl(220, 15%, 96%)",color:"hsl(220, 10%, 40%)"}};function eF(e){let{label:t,value:n,variant:r="neutral",className:a=""}=e,o={display:"inline-flex",alignItems:"center",gap:"8px",padding:"4px 12px",borderRadius:"9999px",fontSize:"12px",fontWeight:500,lineHeight:"1.5",...eB[r]};return(0,i.jsxs)("div",{style:o,className:a,children:[(0,i.jsx)("span",{children:t}),void 0!==n&&(0,i.jsx)("span",{style:{fontWeight:600},children:n})]})}var eH=n(8930);let eV=(0,r.memo)(function(e){let{person:t,onDelete:n,canDelete:r}=e;return(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 8px",borderRadius:"6px",background:"#f9fafb"},children:[(0,i.jsx)("span",{style:{fontWeight:500,color:"#374151"},children:t.repName}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.count>1&&(0,i.jsxs)("span",{style:{fontSize:"12px",fontWeight:600,color:"#6b7280"},children:["\xd7",t.count]}),r&&(0,i.jsx)("button",{onClick:()=>n(t.incidents.map(e=>e.id)),style:{background:"none",border:"none",color:"#9ca3af",cursor:"pointer"},children:(0,i.jsx)(eH.Z,{size:14})})]})]})}),eU=(0,r.memo)(function(e){let{incident:t,onDelete:n,canDelete:r}=e,a=B(t);return(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"4px",padding:"8px",borderRadius:"6px",background:"#f9fafb"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("span",{style:{fontWeight:500,color:"#374151"},children:t.repName}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[a>0&&(0,i.jsxs)("div",{style:{fontSize:12,fontWeight:700,color:"#b91c1c"},children:["-",a," pts"]}),r&&(0,i.jsx)("button",{onClick:()=>n(t.id),style:{background:"none",border:"none",color:"#9ca3af",cursor:"pointer"},children:(0,i.jsx)(eH.Z,{size:14})})]})]}),t.note&&(0,i.jsx)("p",{style:{margin:0,fontSize:"12px",fontStyle:"italic",color:"#6b7280"},children:t.note})]})}),eP=(0,r.memo)(function(e){var t;let{incident:n,onDelete:r,canDelete:a}=e,o=null!==(t=eL[n.type])&&void 0!==t?t:eL.OTRO,s=n.totalDuration&&n.dayCount?n.dayCount/n.totalDuration*100:0;return(0,i.jsxs)(_.E.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2,ease:"easeOut"},style:{marginBottom:"1rem",border:"1px solid #e5e7eb",borderRadius:"10px",background:"white",overflow:"hidden"},children:[(0,i.jsxs)("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 15px",borderBottom:"1px solid #f3f4f6"},children:[(0,i.jsx)(eF,{label:o.label,variant:o.variant}),a&&(0,i.jsx)("button",{onClick:()=>r(n.id),style:{background:"none",border:"none",color:"#9ca3af",cursor:"pointer"},children:(0,i.jsx)(eH.Z,{size:14})})]}),(0,i.jsxs)("div",{style:{padding:"12px 15px",display:"flex",flexDirection:"column",gap:"10px"},children:[(0,i.jsx)("div",{style:{fontWeight:600,color:"#1f2937"},children:n.repName}),(0,i.jsx)("div",{style:{position:"relative",width:"100%",background:"#f3f4f6",height:"8px",borderRadius:"4px"},children:(0,i.jsx)("div",{style:{position:"absolute",left:0,top:0,height:"100%",width:"".concat(s,"%"),background:"ok"===o.variant?"#22c55e":"#3b82f6",borderRadius:"4px",transition:"width 0.3s ease-out"}})}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#6b7280"},children:[(0,i.jsxs)("span",{children:["D\xeda ",n.dayCount," de ",n.totalDuration]}),n.returnDate&&(0,i.jsxs)("span",{style:{fontWeight:500},children:["Reingresa: ",(0,D.WU)((0,E.D)(n.returnDate),"dd/MM/yyyy",{locale:eD.es})]})]})]})]})}),eY=(0,r.memo)(function(e){var t,n,r;let{group:a,onDeleteSingle:o,onDeleteGroup:s,canDelete:l}=e,d=null!==(r=eL[a.type])&&void 0!==r?r:eL.OTRO;return(0,i.jsxs)(_.E.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2,ease:"easeOut"},style:{marginBottom:"1rem",border:"1px solid #e5e7eb",borderRadius:"10px",background:"white"},children:[(0,i.jsxs)("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 15px",borderBottom:"1px solid #f3f4f6"},children:[(0,i.jsx)(eF,{label:d.label,variant:d.variant}),(0,i.jsx)("span",{style:{fontWeight:700,fontSize:18,color:"#1f2937"},children:a.totalCount})]}),(0,i.jsx)("div",{style:{padding:"10px",display:"flex",flexDirection:"column",gap:"8px"},children:"OTRO"===a.type?null===(t=a.items)||void 0===t?void 0:t.map(e=>(0,i.jsx)(eU,{incident:e,onDelete:o,canDelete:l},e.id)):null===(n=a.people)||void 0===n?void 0:n.map(e=>(0,i.jsx)(eV,{person:e,onDelete:s,canDelete:l},e.repName))})]})});function eG(e){let{title:t,incidents:n=[],emptyMessage:a}=e,{removeIncident:o,removeIncidents:s,showConfirm:l}=Y(e=>({removeIncident:e.removeIncident,removeIncidents:e.removeIncidents,showConfirm:e.showConfirm})),{mode:d}=ea(),c="ADMIN_OVERRIDE"===d,{punctualGroups:p,rangeIncidents:x}=(0,r.useMemo)(()=>{let e=n.filter(e=>"LICENCIA"!==e.type&&"VACACIONES"!==e.type),t=n.filter(e=>"LICENCIA"===e.type||"VACACIONES"===e.type),i=new Map;for(let t of e)i.has(t.type)||i.set(t.type,[]),i.get(t.type).push(t);let r=[];for(let[e,t]of i.entries()){if("OTRO"===e){r.push({type:e,totalCount:t.length,items:t,totalPoints:t.reduce((e,t)=>e+B(t),0),people:[]});continue}let n=new Map;for(let e of t){n.has(e.repName)||n.set(e.repName,{repName:e.repName,count:0,incidents:[]});let t=n.get(e.repName);t.count++,t.incidents.push(e)}r.push({type:e,totalCount:t.length,people:Array.from(n.values()),totalPoints:t.reduce((e,t)=>e+B(t),0)})}return{punctualGroups:r.sort((e,t)=>{let n={AUSENCIA:1,TARDANZA:2,ERROR:3,OTRO:4,VACACIONES:5,LICENCIA:6,OVERRIDE:7};return(n[e.type]||99)-(n[t.type]||99)}),rangeIncidents:t}},[n]),u=async(e,t)=>{var n;let i=null!==(n=eL[t])&&void 0!==n?n:eL.OTRO;await l({title:"\xbfEliminar ".concat(e.count," incidencia(s)?"),description:'Esto eliminar\xe1 permanentemente todas las incidencias de tipo "'.concat(i.label,'" registradas para ').concat(e.repName," en este d\xeda."),intent:"danger",confirmLabel:"S\xed, eliminar"})&&s(e.incidents.map(e=>e.id))},f=async e=>{await l({title:"\xbfEliminar incidencia?",description:'Esto eliminar\xe1 permanentemente la incidencia "'.concat(e.note||eL[e.type].label,'" registrada para ').concat(e.repName,"."),intent:"danger",confirmLabel:"S\xed, eliminar"})&&o(e.id)},h=n.length>0;return(0,i.jsxs)("section",{children:[(0,i.jsxs)("h3",{style:{marginBottom:"0.75rem",fontSize:"1rem",fontWeight:600,color:"#374151",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("span",{children:t}),n.length>0&&(0,i.jsxs)("span",{style:{fontSize:"12px",color:"#6b7280"},children:[n.length," evento(s)"]})]}),(0,i.jsxs)(Z.M,{mode:"popLayout",children:[!h&&(0,i.jsx)(_.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{fontSize:"0.875rem",color:"#6b7280",fontStyle:"italic",textAlign:"center",padding:"20px 0",background:"#f9fafb",borderRadius:"8px",border:"1px dashed #e5e7eb"},children:a},"empty-day"),x.map(e=>(0,i.jsx)(eP,{incident:e,onDelete:()=>f(e),canDelete:c},e.id)),p.map(e=>(0,i.jsx)(eY,{group:e,onDeleteSingle:t=>{var n;let i=null===(n=e.people)||void 0===n?void 0:n.flatMap(e=>e.incidents).find(e=>e.id===t);i&&f(i)},onDeleteGroup:t=>{var n;let i=null===(n=e.people)||void 0===n?void 0:n.find(e=>e.incidents.some(e=>e.id===t[0]));i&&u(i,e.type)},canDelete:c},e.type))]})]})}let eZ=(0,r.createContext)(null);function e_(e){let{children:t}=e,[n,a]=(0,r.useState)([]),o=e=>{switch(e){case"success":return{backgroundColor:"hsl(142.1, 80%, 96%)",color:"hsl(142.1, 76.2%, 25%)",border:"1px solid hsl(142.1, 76.2%, 85%)"};case"error":return{backgroundColor:"hsl(0, 100%, 97%)",color:"hsl(0, 80%, 45%)",border:"1px solid hsl(0, 100%, 90%)"};case"warning":return{backgroundColor:"hsl(45, 100%, 96%)",color:"hsl(45, 80%, 25%)",border:"1px solid hsl(45, 100%, 85%)"};default:return{backgroundColor:"hsl(210, 100%, 96%)",color:"hsl(210, 80%, 35%)",border:"1px solid hsl(210, 100%, 88%)"}}};return(0,i.jsxs)(eZ.Provider,{value:{showToast:e=>{let t=crypto.randomUUID(),n=e.type||"info";a(i=>[...i,{id:t,...e,type:n}]),setTimeout(()=>{a(e=>e.filter(e=>e.id!==t))},3500)}},children:[t,(0,i.jsx)("div",{style:{position:"fixed",top:"16px",right:"16px",display:"flex",flexDirection:"column",gap:"8px",zIndex:1001},children:n.map(e=>(0,i.jsxs)("div",{className:"animate-fade-in",style:{padding:"12px 16px",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",fontWeight:500,pointerEvents:"auto",minWidth:"300px",...o(e.type)},children:[(0,i.jsx)("div",{style:{fontWeight:600,marginBottom:"4px"},children:e.title}),(0,i.jsx)("div",{style:{fontSize:"14px",opacity:.9},children:e.message})]},e.id))})]})}let eq=()=>{let e=(0,r.useContext)(eZ);if(!e)throw Error("useToast must be inside ToastProvider");return e};var eK=n(5805),eJ=n(2451),eQ=n(407),eX=n(1047),e$=n(9322),e0=n(3245);function e1(e){let{variant:t,children:n}=e,r={warning:{background:"#fef3c7",border:"1px solid #fbbf24",color:"#92400e",icon:(0,i.jsx)(ed.Z,{size:18})},error:{background:"#fee2e2",border:"1px solid #ef4444",color:"#991b1b",icon:(0,i.jsx)(e$.Z,{size:18})},info:{background:"#dbeafe",border:"1px solid #3b82f6",color:"#1e40af",icon:(0,i.jsx)(e0.Z,{size:18})}}[t];return(0,i.jsxs)("div",{style:{display:"flex",gap:"10px",padding:"10px 12px",borderRadius:"6px",background:r.background,border:r.border,color:r.color,fontSize:"13px",alignItems:"flex-start"},children:[(0,i.jsx)("div",{style:{marginTop:"1px",flexShrink:0},children:r.icon}),(0,i.jsx)("div",{style:{flex:1},children:n})]})}var e2=n(5341),e6=n(9394),e5=n(29),e4=n.n(e5),e8=n(3070),e7=n(1650),e3=n(6357),e9=n(1994);function te(e){let{month:t,days:n,selected:r,onSelect:a}=e,o=(0,e8.N)(t),s=(0,e7.N)(t),l=((0,N.w)(o)+6)%7,d=new Map(n.map(e=>[(0,D.WU)(e.date,"yyyy-MM-dd"),e]));return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e4(),{id:"7fd884f4d6d24ce2",children:'.calendar.jsx-7fd884f4d6d24ce2{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:6px}.calendar-header.jsx-7fd884f4d6d24ce2,.calendar-grid.jsx-7fd884f4d6d24ce2{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}.day-label.jsx-7fd884f4d6d24ce2{text-align:center;padding:8px 0;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;font-size:14px;font-weight:600;color:#6b7280}.day.jsx-7fd884f4d6d24ce2{text-align:center;padding:8px 0;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;font-size:14px;background:#f9fafb;cursor:pointer;border:1px solid transparent;height:36px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-transition:all.15s ease;-moz-transition:all.15s ease;-o-transition:all.15s ease;transition:all.15s ease}.day.jsx-7fd884f4d6d24ce2:hover{background:#f1f5f9}.day[data-visual="ABSENT"].jsx-7fd884f4d6d24ce2{background:hsl(0,85%,90%);color:hsl(0,60%,30%);font-weight:600}.day[data-visual="VACATION"].jsx-7fd884f4d6d24ce2{background:hsl(195,70%,94%);color:hsl(195,40%,30%)}.day[data-visual="LICENSE"].jsx-7fd884f4d6d24ce2{background:hsl(260,55%,95%);color:hsl(260,35%,35%)}.day[data-visual="HOLIDAY"].jsx-7fd884f4d6d24ce2{background:hsl(45,90%,92%);color:hsl(45,50%,30%)}.day[data-visual="SHIFT_CHANGE"].jsx-7fd884f4d6d24ce2{border-bottom:2px solid hsl(220,15%,75%)}.day[data-visual="NORMAL"].jsx-7fd884f4d6d24ce2{background:transparent;color:hsl(220,15%,35%)}.day.warning.jsx-7fd884f4d6d24ce2{background:#fff7d6;color:#92400e}.day.danger.jsx-7fd884f4d6d24ce2{background:#fee2e2;color:#991b1b}.day.disabled.jsx-7fd884f4d6d24ce2{background:#f3f4f6;color:#d1d5db;cursor:default;opacity:.5}.day.selected.jsx-7fd884f4d6d24ce2{outline:2px solid#2563eb;border-color:#2563eb}.day.empty.jsx-7fd884f4d6d24ce2{background:transparent;pointer-events:none}'}),(0,i.jsxs)("div",{className:"jsx-7fd884f4d6d24ce2 calendar",children:[(0,i.jsx)("div",{className:"jsx-7fd884f4d6d24ce2 calendar-header",children:["L","M","X","J","V","S","D"].map(e=>(0,i.jsx)("div",{className:"jsx-7fd884f4d6d24ce2 day-label",children:e},e))}),(0,i.jsx)("div",{className:"jsx-7fd884f4d6d24ce2 calendar-grid",children:Array.from({length:7*Math.ceil((l+s)/7)}).map((e,n)=>{let o=n-l+1;if(o<1||o>s)return(0,i.jsx)("div",{className:"jsx-7fd884f4d6d24ce2 day empty"},n);let c=new Date(t.getFullYear(),t.getMonth(),o),p=(0,D.WU)(c,"yyyy-MM-dd"),x=d.get(p);return(0,i.jsx)("button",{"data-visual":(null==x?void 0:x.visualType)||"NORMAL",onClick:()=>a(c),className:"jsx-7fd884f4d6d24ce2 "+((0,e9.Z)("day",null==x?void 0:x.state,r&&(0,e3.K)(r,c)&&"selected")||""),children:o},p)})})]})]})}let tt={btnPrimary:{backgroundColor:"#111827",color:"white",padding:"10px",borderRadius:"6px",fontWeight:600,transition:"all 0.2s ease",border:"none",cursor:"pointer",width:"100%"},btnDisabled:{backgroundColor:"#e5e7eb",color:"#9ca3af",cursor:"not-allowed"},input:{width:"100%",border:"1px solid #d1d5db",borderRadius:"6px",padding:"10px 12px",fontSize:"14px",boxSizing:"border-box"},label:{display:"block",fontSize:"14px",fontWeight:500,marginBottom:"6px",color:"#374151"},listItem:{width:"100%",textAlign:"left",padding:"8px 12px",borderRadius:"6px",cursor:"pointer",border:"none",background:"transparent",fontSize:"14px",color:"#374151"},activeListItem:{background:"#f3f4f6",fontWeight:600}},tn=e=>{let{label:t,isActive:n,onClick:r,coverageCount:a,totalCount:o}=e,s={width:"100%",padding:"10px 14px",borderRadius:"8px",border:"1px solid transparent",textAlign:"left",cursor:"pointer",transition:"all 0.2s ease",background:"#f9fafb",borderColor:"#f3f4f6",position:"relative"};return n&&(s.background="white",s.borderColor="#e5e7eb",s.boxShadow="0 2px 8px rgba(0,0,0,0.05)"),(0,i.jsxs)("button",{onClick:r,style:s,children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:["D\xeda"===t?(0,i.jsx)(J.Z,{size:18,style:{color:"#fbbf24"}}):(0,i.jsx)(es.Z,{size:18,style:{color:"#a5b4fc"}}),(0,i.jsx)("span",{style:{fontWeight:600,fontSize:"1rem",color:"#1f2937"},children:t})]}),(0,i.jsxs)("div",{style:{position:"absolute",top:"12px",right:"14px",display:"flex",alignItems:"center",gap:"6px"},children:[(0,i.jsx)(eK.Z,{size:14,style:{color:"#6b7280"}}),(0,i.jsx)("span",{style:{fontWeight:700,fontSize:"1.25rem",color:"#111827"},children:a}),(0,i.jsxs)("span",{style:{fontWeight:500,fontSize:"1rem",color:"#9ca3af"},children:["/ ",o]})]})]})};function ti(){let{incidents:e,allCalendarDaysForRelevantMonths:t,representatives:n,planningAnchorDate:a,setPlanningAnchorDate:o,swaps:s,isLoading:l}=Y(e=>({incidents:e.incidents,allCalendarDaysForRelevantMonths:e.allCalendarDaysForRelevantMonths,representatives:e.representatives,planningAnchorDate:e.planningAnchorDate,setPlanningAnchorDate:e.setPlanningAnchorDate,swaps:e.swaps,isLoading:e.isLoading})),[d,c]=(0,r.useState)(()=>(0,D.WU)(new Date,"yyyy-MM-dd")),[p,x]=(0,r.useState)(!1),u=(0,r.useRef)(null),{weekDays:f}=eE(d,c),{weeklyPlan:h}=ej(f),[g,y]=(0,r.useState)("DAY"),[b,m]=(0,r.useState)(null),[v,j]=(0,r.useState)(""),[S,I]=(0,r.useState)("TARDANZA"),[C,A]=(0,r.useState)(""),[R,w]=(0,r.useState)(1),[N,O]=(0,r.useState)(0);(0,r.useEffect)(()=>{function e(e){u.current&&!u.current.contains(e.target)&&x(!1)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[u]);let T=(0,r.useMemo)(()=>!h||l?[]:function(e,t,n,i,r,a){let o=[];for(let s of e.agents)for(let l of["DAY","NIGHT"]){let d=eN(e,t,n,i,l,s.representativeId,r,a),c=eN(e,t,n,i,l,s.representativeId,r,a).shouldWork,p="OFF";switch(d.role){case"BASE":p=d.shouldWork?"WORKING":"OFF";break;case"COVERING":p="COVERING";break;case"DOUBLE":p="DOUBLE";break;case"SWAPPED_IN":p="SWAPPED_IN";break;case"COVERED":p="COVERED";break;case"SWAPPED_OUT":p="SWAPPED_OUT";break;case"NONE":p="AUSENCIA"===d.reason?"ABSENT":d.reason&&["VACACIONES","LICENCIA"].includes(d.reason)?"ABSENT":"OFF"}o.push({representativeId:s.representativeId,shift:l,logStatus:p,isResponsible:c,details:d.reason})}return o}(h,s,e,d,t,n),[h,s,e,d,t,n,l]),{representativesInShift:z,dayShiftCoverage:L,nightShiftCoverage:B,dayShiftTotal:F,nightShiftTotal:H}=(0,r.useMemo)(()=>{if(!h||l)return{representativesInShift:[],dayShiftCoverage:0,nightShiftCoverage:0,dayShiftTotal:0,nightShiftTotal:0};let e=T.filter(e=>"DAY"===e.shift),t=T.filter(e=>"NIGHT"===e.shift),i=e=>["WORKING","COVERING","DOUBLE","SWAPPED_IN"].includes(e.logStatus),r=e.filter(i).length,a=t.filter(i).length,o=e.filter(e=>"OFF"!==e.logStatus||e.isResponsible).length,s=t.filter(e=>"OFF"!==e.logStatus||e.isResponsible).length,d="DAY"===g?e:t,c=new Map(n.map(e=>[e.id,e]));return{representativesInShift:d.filter(e=>"OFF"!==e.logStatus||e.isResponsible).map(e=>c.get(e.representativeId)).filter(e=>!!e),dayShiftCoverage:r,nightShiftCoverage:a,dayShiftTotal:o,nightShiftTotal:s}},[T,g,h,n,l]),V=(0,r.useMemo)(()=>v?z.filter(e=>e.name.toLowerCase().includes(v.toLowerCase())):z,[z,v]),{dayIncidents:U,ongoingIncidents:P}=(0,r.useMemo)(()=>{if(l)return{dayIncidents:[],ongoingIncidents:[]};let i=new Map(n.map(e=>[e.id,e])),r=e.map(e=>{if("OVERRIDE"===e.type)return null;let n=i.get(e.representativeId);if(!n)return null;let r=M(e,t,n);if(!r.dates.includes(d))return null;let a=r.dates.indexOf(d)+1,o=r.dates.length;if("VACACIONES"===e.type){var s;o=null!==(s=e.duration)&&void 0!==s?s:14;let i=0,l=r.dates,c=l.indexOf(d);for(let e=0;e<=c;e++){let r=l[e],a=t.find(e=>e.date===r),o=(0,E.D)(r).getUTCDay(),s="OFF"===n.baseSchedule[o],d=(null==a?void 0:a.isSpecial)===!0;!s&&!d&&i++}a=Math.max(1,i)}return{...e,repName:n.name,repShift:n.baseShift,dayCount:a,totalDuration:o,returnDate:r.returnDate}}).filter(e=>!!e);return{dayIncidents:r.filter(e=>"VACACIONES"!==e.type&&"LICENCIA"!==e.type),ongoingIncidents:r.filter(e=>"VACACIONES"===e.type||"LICENCIA"===e.type)}},[e,d,t,n,l]),G=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];I("TARDANZA"),A(""),w(1),O(0),e||(m(null),j(""))},[]),{submit:Z}=function(e){let{onSuccess:t}=e,n=Y(e=>e.addIncident),{showToast:i}=eq();return{submit:async(e,r)=>{if(!r||!e){i({title:"Datos incompletos",message:"Por favor, selecciona un representante y completa los datos.",type:"error"});return}let a=(0,D.WU)(new Date,"yyyy-MM-dd"),o=W(e.type,e.startDate,a);if(!o.ok){i({title:"Acci\xf3n no permitida",message:o.message,type:"error"});return}let s=await n(e);s.ok?t():"Acci\xf3n cancelada por el usuario."!==s.reason&&i({title:"Error de validaci\xf3n",message:s.reason||"Ocurri\xf3 un error desconocido.",type:"error"})}}}({onSuccess:()=>G(!0)}),_=(0,r.useMemo)(()=>!b||l?{hasConflict:!1}:function(e,t,n,i,r,a,o){let s=r.filter(t=>t.representativeId===e);for(let e of s.filter(e=>"VACACIONES"===e.type)){let n=M(e,a,o);if(n.dates.includes(t))return{hasConflict:!0,message:"Ya tiene vacaciones activas desde ".concat(n.start," hasta ").concat(n.end),conflictType:"VACATION"}}for(let e of s.filter(e=>"LICENCIA"===e.type)){let n=M(e,a,o);if(n.dates.includes(t))return{hasConflict:!0,message:"Ya tiene licencia activa desde ".concat(n.start," hasta ").concat(n.end),conflictType:"LICENSE"}}if("VACACIONES"===n||"LICENCIA"===n){let r=M({id:"temp",representativeId:e,type:n,startDate:t,duration:i,createdAt:new Date().toISOString()},a,o);for(let e of s)if("VACACIONES"===e.type||"LICENCIA"===e.type){let t=M(e,a,o);if(r.dates.some(e=>t.dates.includes(e)))return{hasConflict:!0,message:"Se solapa con ".concat("VACACIONES"===e.type?"vacaciones":"licencia"," del ").concat(t.start," al ").concat(t.end),conflictType:"OVERLAP"}}}return{hasConflict:!1}}(b.id,d,S,R,e,t,b),[b,d,S,R,e,t,l]);(0,r.useEffect)(()=>{b&&!V.some(e=>e.id===b.id)&&G(!1)},[g,b,V,G]);let q=(0,E.D)(d);return l||0===t.length?(0,i.jsx)("div",{children:"Cargando..."}):(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"300px 1fr",height:"calc(100vh - 200px)",gap:"16px",fontFamily:"sans-serif"},children:[(0,i.jsxs)("aside",{style:{flexShrink:0,backgroundColor:"white",borderRadius:"12px",padding:"20px",border:"1px solid #e5e7eb",display:"flex",flexDirection:"column",gap:"16px",marginBottom:"16px"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{style:{fontWeight:500,margin:"0 0 12px 0",color:"#1f2937",fontSize:"13px"},children:"Estado de Turnos"}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,i.jsx)(tn,{label:"D\xeda",isActive:"DAY"===g,onClick:()=>y("DAY"),coverageCount:L,totalCount:F}),(0,i.jsx)(tn,{label:"Noche",isActive:"NIGHT"===g,onClick:()=>y("NIGHT"),coverageCount:B,totalCount:H})]})]}),(0,i.jsxs)("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[(0,i.jsx)("label",{style:{...tt.label,marginBottom:"8px"},children:"Representantes del Turno"}),(0,i.jsx)("input",{type:"text",placeholder:"Buscar representante...",style:{...tt.input,marginBottom:"12px"},value:v,onChange:e=>j(e.target.value)}),(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px",overflowY:"auto",flex:1},children:V.map(e=>(0,i.jsx)("button",{onClick:()=>m(e),style:{...tt.listItem,...(null==b?void 0:b.id)===e.id?tt.activeListItem:{}},children:e.name},e.id))})]})]}),(0,i.jsxs)("section",{style:{display:"flex",flexDirection:"column",gap:"16px",overflowY:"auto"},children:[(0,i.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"12px",padding:"16px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",height:"74px",boxSizing:"border-box"},children:[(0,i.jsx)("h2",{style:{margin:"0 0 32px 0",fontWeight:700,fontSize:"16px"},children:"Registro de Eventos"}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",position:"relative"},ref:u,children:[(0,i.jsx)("button",{onClick:()=>c((0,D.WU)((0,e2.k)(q,1),"yyyy-MM-dd")),style:{padding:"8px",border:"1px solid #d1d5db",background:"white",borderRadius:"6px",cursor:"pointer"},children:(0,i.jsx)(eJ.Z,{size:16})}),(0,i.jsx)("div",{style:{fontWeight:600,fontSize:"14px",color:"#1f2937",minWidth:"220px",textAlign:"center"},children:(0,D.WU)(q,"EEEE, dd 'de' MMMM",{locale:eD.es})}),(0,i.jsx)("button",{onClick:()=>c((0,D.WU)((0,k.E)(q,1),"yyyy-MM-dd")),style:{padding:"8px",border:"1px solid #d1d5db",background:"white",borderRadius:"6px",cursor:"pointer"},children:(0,i.jsx)(eQ.Z,{size:16})}),(0,i.jsx)("button",{onClick:()=>x(e=>!e),style:{padding:"8px",border:"1px solid #d1d5db",background:"white",borderRadius:"6px",cursor:"pointer"},children:(0,i.jsx)(eX.Z,{size:16})}),!(0,e6.z)(q)&&(0,i.jsx)("button",{onClick:()=>c((0,D.WU)(new Date,"yyyy-MM-dd")),style:{padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",background:"white",fontSize:"12px",fontWeight:600,cursor:"pointer"},children:"Hoy"}),p&&(0,i.jsx)("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"8px",background:"white",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"16px",zIndex:10,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:(0,i.jsx)(te,{month:q,selected:q,onSelect:e=>{c((0,D.WU)(e,"yyyy-MM-dd")),x(!1)},days:[]})})]})]}),(0,i.jsx)("form",{onSubmit:e=>{if(e.preventDefault(),!b)return;let t="LICENCIA"===S||"VACACIONES"===S;Z({representativeId:b.id,type:S,startDate:d,duration:t?R:1,customPoints:"OTRO"===S?N:void 0,note:C.trim()||void 0},b)},children:(0,i.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"12px",padding:"20px",display:"flex",flexDirection:"column",gap:"16px"},children:[(0,i.jsx)("header",{children:(0,i.jsx)("h3",{style:{margin:0,fontWeight:600,fontSize:"16px"},children:b?(0,i.jsxs)(i.Fragment,{children:["Registrar para:"," ",(0,i.jsx)("span",{style:{fontWeight:700},children:b.name})]}):"Seleccione un representante para comenzar"})}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:tt.label,children:"Tipo de incidencia"}),(0,i.jsxs)("select",{style:tt.input,value:S,onChange:e=>I(e.target.value),disabled:!b,children:[(0,i.jsx)("option",{value:"TARDANZA",children:"Tardanza"}),(0,i.jsx)("option",{value:"AUSENCIA",children:"Ausencia"}),(0,i.jsx)("option",{value:"ERROR",children:"Error"}),(0,i.jsx)("option",{value:"OTRO",children:"Otro"}),(0,i.jsx)("option",{value:"LICENCIA",children:"Licencia"}),(0,i.jsx)("option",{value:"VACACIONES",children:"Vacaciones"})]})]}),("LICENCIA"===S||"VACACIONES"===S)&&(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{style:tt.label,children:["Duraci\xf3n (","LICENCIA"===S?"d\xedas naturales":"d\xedas laborables",")"]}),(0,i.jsx)("input",{type:"number",style:tt.input,min:"1",value:R,onChange:e=>w(Math.max(1,parseInt(e.target.value)||1)),disabled:!b})]}),"OTRO"===S&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:tt.label,children:"Puntos (manual)"}),(0,i.jsx)("input",{type:"number",style:tt.input,min:"0",value:N,onChange:e=>O(Math.max(0,parseInt(e.target.value)||0)),disabled:!b})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:tt.label,children:"Comentario (opcional)"}),(0,i.jsx)("textarea",{style:{...tt.input,height:"60px"},placeholder:"Escribe un comentario...",value:C,onChange:e=>A(e.target.value),disabled:!b})]}),_.hasConflict&&(0,i.jsx)(e1,{variant:"warning",children:_.message}),(0,i.jsx)("div",{children:(0,i.jsx)("button",{type:"submit",style:{...tt.btnPrimary,...b?{}:tt.btnDisabled},disabled:!b,children:"Registrar evento"})})]})}),(0,i.jsxs)("div",{style:{flex:1,display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",overflowY:"hidden"},children:[(0,i.jsx)("div",{style:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"12px",padding:"20px",overflowY:"auto",marginBottom:"24px"},children:(0,i.jsx)(eG,{title:"Incidencias del D\xeda",incidents:U,emptyMessage:"No hay incidencias puntuales registradas hoy."})}),(0,i.jsx)("div",{style:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"12px",padding:"20px",overflowY:"auto",marginBottom:"16px"},children:(0,i.jsx)(eG,{title:"Ausencias en Curso (Todos)",incidents:P,emptyMessage:"No hay licencias o vacaciones activas."})})]})]})]})}var tr=n(5902),ta=n(1091),to=n(6705),ts=n(6381),tl=n(8736),td=n(4084);td.kL.register(td.uw,td.f$,td.ZL,td.Dx,td.u,td.De);let tc=e=>{let{monthLabel:t,onPrev:n,onNext:r}=e;return(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingBottom:"16px",borderBottom:"1px solid #e5e7eb"},children:[(0,i.jsx)("h2",{style:{fontSize:"20px",fontWeight:600,margin:0},children:"Resumen Mensual de Incidencias"}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,i.jsx)("button",{onClick:n,style:{padding:"8px",border:"1px solid #d1d5db",borderRadius:"6px",background:"white",cursor:"pointer"},children:"<"}),(0,i.jsx)("h3",{style:{fontSize:"16px",fontWeight:600,textTransform:"capitalize",margin:0,minWidth:"150px",textAlign:"center"},children:t}),(0,i.jsx)("button",{onClick:r,style:{padding:"8px",border:"1px solid #d1d5db",borderRadius:"6px",background:"white",cursor:"pointer"},children:">"})]})]})},tp=e=>{let{icon:t,label:n,value:r,color:a}=e;return(0,i.jsxs)("div",{style:{padding:"16px",background:"white",borderRadius:"8px",border:"1px solid #e5e7eb",display:"flex",flexDirection:"column",gap:"8px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,i.jsx)(t,{size:18,style:{color:a}}),(0,i.jsx)("span",{style:{fontSize:"13px",color:"#6b7280",fontWeight:500},children:n})]}),(0,i.jsx)("div",{style:{fontSize:"28px",fontWeight:700,color:"#1f2937"},children:r})]})},tx=e=>{let{summary:t}=e,n=(0,r.useMemo)(()=>{if(!t)return null;let e=t.byPerson.flatMap(e=>e.incidents),[n,i]=t.month.split("-").map(Number),r=new Date(n,i,0).getDate(),a=Array.from({length:r},(e,t)=>String(t+1)),o=Array(r).fill(0);for(let t of e)if(t.startDate)try{let e=(0,E.D)(t.startDate).getDate();e>0&&e<=r&&(o[e-1]+=1)}catch(e){console.error("Invalid date for incident",t)}return{labels:a,datasets:[{label:"Incidencias por D\xeda",data:o,backgroundColor:o.map(e=>e>=3?"hsl(0, 70%, 60%)":e>0?"hsl(40, 80%, 60%)":"hsl(210, 30%, 85%)"),borderRadius:4,borderSkipped:!1}]}},[t]);return n?(0,i.jsxs)("div",{style:{background:"white",padding:"20px",borderRadius:"12px",border:"1px solid #e5e7eb",height:"100%"},children:[(0,i.jsx)("h3",{style:{marginTop:0,color:"#1f2937"},children:"Incidencias por D\xeda"}),(0,i.jsx)("div",{style:{height:"220px"},children:(0,i.jsx)(to.$Q,{data:n,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!1},tooltip:{callbacks:{label:function(e){return"Incidencias: ".concat(e.parsed.y)}}}},scales:{x:{grid:{display:!1}},y:{beginAtZero:!0,grid:{color:"#f3f4f6"},ticks:{stepSize:1}}}}})})]}):(0,i.jsx)("div",{style:{height:"240px",background:"#f9fafb",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"#6b7280"},children:"Cargando datos del gr\xe1fico..."})},tu=e=>{let{level:t}=e;return(0,i.jsx)("span",{style:{...{danger:{backgroundColor:"#fdecea",color:"#b42318"},warning:{backgroundColor:"#fff3cd",color:"#9a6a00"},ok:{backgroundColor:"#e6f9ee",color:"#1c7c44"}}[t],padding:"4px 10px",borderRadius:"99px",fontSize:"12px",fontWeight:600},children:{danger:"RIESGO",warning:"ATENCI\xd3N",ok:"OK"}[t]})},tf=e=>{let{data:t,onSelectRow:n}=e,r={padding:"10px 12px",textAlign:"left",fontSize:"12px",fontWeight:600,color:"#6b7280",textTransform:"uppercase",borderBottom:"1px solid #e5e7eb",opacity:.7},a={padding:"12px",borderTop:"1px solid #f3f4f6",fontSize:"14px"},o=[...t].sort((e,t)=>t.totals.puntos-e.totals.puntos);return(0,i.jsx)("div",{style:{borderRadius:"8px",border:"1px solid #e5e7eb",overflow:"hidden",background:"white"},children:(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,i.jsx)("thead",{style:{background:"#f9fafb"},children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:r,children:"Representante"}),(0,i.jsx)("th",{style:{...r,textAlign:"center"},children:"Puntos"}),(0,i.jsx)("th",{style:{...r,textAlign:"center"},children:"Ausencias"}),(0,i.jsx)("th",{style:{...r,textAlign:"center"},children:"Tardanzas"}),(0,i.jsx)("th",{style:{...r,textAlign:"center"},children:"Errores"}),(0,i.jsx)("th",{style:{...r,textAlign:"center"},children:"Estado"}),(0,i.jsx)("th",{style:{...r,textAlign:"center"},children:"Acci\xf3n"})]})}),(0,i.jsx)("tbody",{children:o.map(e=>(0,i.jsxs)("tr",{style:{background:"danger"===e.riskLevel?"hsl(0,100%,98%)":"warning"===e.riskLevel?"hsl(45,100%,98%)":"white"},className:"hover-row",children:[(0,i.jsx)("td",{style:{...a,fontWeight:600,color:"#1f2937"},children:e.name}),(0,i.jsx)("td",{style:{...a,fontWeight:700,color:e.totals.puntos>0?"#b91c1c":"#374151",textAlign:"center"},children:e.totals.puntos}),(0,i.jsx)("td",{style:{...a,textAlign:"center"},children:e.totals.ausencias}),(0,i.jsx)("td",{style:{...a,textAlign:"center"},children:e.totals.tardanzas}),(0,i.jsx)("td",{style:{...a,textAlign:"center"},children:e.totals.errores}),(0,i.jsx)("td",{style:{...a,textAlign:"center"},children:(0,i.jsx)(tu,{level:e.riskLevel})}),(0,i.jsx)("td",{style:{...a,textAlign:"center"},children:(0,i.jsx)("button",{onClick:()=>n(e),style:{fontSize:"12px",fontWeight:600,color:"#2563eb",background:"#eff6ff",border:"1px solid #dbeafe",padding:"6px 12px",borderRadius:"6px",cursor:"pointer"},children:"Ver detalle"})})]},e.representativeId))})]})})};function th(){let[e,t]=(0,r.useState)(new Date),[n,a]=(0,r.useState)(""),o=Y(e=>e.openDetailModal),{incidents:s,representatives:l,allCalendarDaysForRelevantMonths:d}=Y(e=>({incidents:e.incidents,representatives:e.representatives,allCalendarDaysForRelevantMonths:e.allCalendarDaysForRelevantMonths})),c=(0,r.useMemo)(()=>(0,D.WU)(e,"yyyy-MM"),[e]),p=(0,r.useMemo)(()=>(0,D.WU)(e,"MMMM yyyy",{locale:eD.es}),[e]),x=function(e){let{incidents:t,representatives:n}=Y(e=>({incidents:e.incidents,representatives:e.representatives}));return(0,r.useMemo)(()=>e&&t&&n?F(t,e,n):null,[t,e,n])}(c),u=(0,r.useMemo)(()=>x&&n.trim()?{...x,byPerson:x.byPerson.filter(e=>e.name.toLowerCase().includes(n.toLowerCase()))}:x,[x,n]),f=(0,r.useMemo)(()=>{if(!x)return{onVacation:0,onLicense:0,atRisk:0};let e=(0,D.WU)(new Date,"yyyy-MM-dd"),t=s.filter(e=>"VACACIONES"===e.type),n=new Set;t.forEach(t=>{let i=l.find(e=>e.id===t.representativeId);i&&M(t,d,i).dates.includes(e)&&n.add(t.representativeId)});let i=s.filter(e=>"LICENCIA"===e.type),r=new Set;i.forEach(t=>{let n=l.find(e=>e.id===t.representativeId);n&&M(t,d,n).dates.includes(e)&&r.add(t.representativeId)});let a=x.byPerson.filter(e=>e.totals.puntos>=10).length;return{onVacation:n.size,onLicense:r.size,atRisk:a}},[x,s,l,d]);return x?(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"24px",padding:"24px"},className:"jsx-9414da19be6453a5",children:[(0,i.jsx)(e4(),{id:"9414da19be6453a5",children:".hover-row:hover{background-color:#f9fafb!important}"}),(0,i.jsx)(tc,{monthLabel:p,onPrev:()=>t(e=>(0,tr.W)(e,1)),onNext:()=>t(e=>(0,ta.z)(e,1))}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"24px",marginBottom:"32px"},className:"jsx-9414da19be6453a5",children:[(0,i.jsx)(tp,{icon:ts.Z,label:"De Vacaciones",value:f.onVacation,color:"#2563eb"}),(0,i.jsx)(tp,{icon:tl.Z,label:"De Licencia",value:f.onLicense,color:"#7c3aed"}),(0,i.jsx)(tp,{icon:ed.Z,label:"En Riesgo (≥10 pts)",value:f.atRisk,color:"#dc2626"})]}),(0,i.jsx)("div",{style:{marginBottom:"32px",paddingBottom:"16px",borderBottom:"1px dashed #e5e7eb"},className:"jsx-9414da19be6453a5",children:(0,i.jsx)(tx,{summary:x})}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},className:"jsx-9414da19be6453a5",children:[(0,i.jsx)("label",{style:{fontSize:"14px",fontWeight:600,color:"#374151"},className:"jsx-9414da19be6453a5",children:"Buscar Representante"}),(0,i.jsx)("input",{type:"text",placeholder:"Escribe el nombre del representante...",value:n,onChange:e=>a(e.target.value),style:{width:"100%",padding:"10px 14px",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"14px",outline:"none",transition:"border-color 0.2s"},onFocus:e=>e.target.style.borderColor="#2563eb",onBlur:e=>e.target.style.borderColor="#d1d5db",className:"jsx-9414da19be6453a5"}),n&&u&&(0,i.jsxs)("div",{style:{fontSize:"13px",color:"#6b7280"},className:"jsx-9414da19be6453a5",children:["Mostrando ",u.byPerson.length," de ",(null==x?void 0:x.byPerson.length)||0," representantes"]})]}),(0,i.jsx)("div",{style:{marginTop:"16px"},className:"jsx-9414da19be6453a5",children:(0,i.jsx)(tf,{data:(null==u?void 0:u.byPerson)||[],onSelectRow:e=>{o(e.representativeId,c)}})})]}):(0,i.jsx)("div",{style:{padding:"40px"},children:"Cargando resumen mensual..."})}let tg=["TARDANZA","AUSENCIA","ERROR","OTRO"];var ty=n(2735),tb=n(4857);let tm=e=>{let{monthLabel:t,onPrev:n,onNext:r}=e;return(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingBottom:"16px",borderBottom:"1px solid #e5e7eb"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{style:{fontSize:"20px",fontWeight:600,margin:0},children:"Reporte de Puntos por Incidencia"}),(0,i.jsx)("p",{style:{margin:"4px 0 0",color:"#6b7280",fontSize:"14px"},children:"Resumen mensual de incidencias punitivas y puntos, segmentado por rol y turno."})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,i.jsx)("button",{onClick:n,style:{padding:"8px",border:"1px solid #d1d5db",borderRadius:"6px",background:"white",cursor:"pointer"},children:"<"}),(0,i.jsx)("h3",{style:{fontSize:"16px",fontWeight:600,textTransform:"capitalize",margin:0,minWidth:"150px",textAlign:"center"},children:t}),(0,i.jsx)("button",{onClick:r,style:{padding:"8px",border:"1px solid #d1d5db",borderRadius:"6px",background:"white",cursor:"pointer"},children:">"})]})]})},tv=e=>{let{title:t,data:n,onCopy:r}=e,a=()=>{let e=e=>0===e?"":e;return n.map(t=>[e(t.tardanza),e(t.ausencia),e(t.errores),e(t.otros)].join("	")).join("\n")},o={padding:"10px 12px",textAlign:"left",fontSize:"12px",fontWeight:600,color:"#6b7280",textTransform:"uppercase",borderBottom:"1px solid #e5e7eb"},s={padding:"10px 12px",borderTop:"1px solid #f3f4f6",fontSize:"14px"};return(0,i.jsxs)("section",{children:[(0,i.jsxs)("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[(0,i.jsx)("h3",{style:{fontSize:"16px",fontWeight:600,margin:0},children:t}),(0,i.jsx)("div",{style:{display:"flex",gap:"10px"},children:(0,i.jsxs)("button",{onClick:()=>r(a(),t),style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px",padding:"6px 12px",background:"#eef2ff",color:"#312e81",border:"1px solid #c7d2fe",borderRadius:"6px",cursor:"pointer",fontWeight:600},children:[(0,i.jsx)(ty.Z,{size:14})," Copiar Puntos (para Excel)"]})})]}),(0,i.jsx)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"8px",overflow:"hidden",background:"white"},children:(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,i.jsx)("thead",{style:{background:"#f9fafb"},children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:o,children:"Empleado"}),(0,i.jsx)("th",{style:{...o,textAlign:"right"},children:"Tardanza"}),(0,i.jsx)("th",{style:{...o,textAlign:"right"},children:"Ausencia"}),(0,i.jsx)("th",{style:{...o,textAlign:"right"},children:"Errores"}),(0,i.jsx)("th",{style:{...o,textAlign:"right"},children:"Otros"}),(0,i.jsx)("th",{style:{...o,textAlign:"right"},children:"Total"})]})}),(0,i.jsxs)("tbody",{children:[n.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{...s,fontWeight:500},children:e.repName}),(0,i.jsx)("td",{style:{...s,textAlign:"right"},children:e.tardanza>0?e.tardanza:""}),(0,i.jsx)("td",{style:{...s,textAlign:"right"},children:e.ausencia>0?e.ausencia:""}),(0,i.jsx)("td",{style:{...s,textAlign:"right"},children:e.errores>0?e.errores:""}),(0,i.jsx)("td",{style:{...s,textAlign:"right"},children:e.otros>0?e.otros:""}),(0,i.jsx)("td",{style:{...s,textAlign:"right",fontWeight:700,color:e.total>0?"#b91c1c":"#1f2937"},children:e.total})]},e.repId)),0===n.length&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:6,style:{...s,textAlign:"center",color:"#9ca3af",fontStyle:"italic"},children:"No hay representantes en esta categor\xeda."})})]})]})})]})};function tj(){let[e,t]=(0,r.useState)(new Date),{representatives:n,incidents:a}=Y(e=>({representatives:e.representatives,incidents:e.incidents})),[o,s]=(0,r.useState)(!1),l=(0,r.useMemo)(()=>(0,D.WU)(e,"yyyy-MM"),[e]),d=(0,r.useMemo)(()=>(0,D.WU)(e,"MMMM yyyy",{locale:eD.es}),[e]),c=(0,r.useMemo)(()=>(function(e,t,n){let i=t.filter(e=>tg.includes(e.type)&&e.startDate.startsWith(n)),r=e=>e.map(e=>{let t={repId:e.id,repName:e.name,tardanza:0,ausencia:0,errores:0,otros:0,total:0};return i.filter(t=>t.representativeId===e.id).forEach(e=>{var n;let i="OTRO"===e.type?null!==(n=e.customPoints)&&void 0!==n?n:0:B(e);switch(e.type){case"TARDANZA":t.tardanza+=i;break;case"AUSENCIA":t.ausencia+=i;break;case"ERROR":t.errores+=i;break;case"OTRO":t.otros+=i}}),t.total=t.tardanza+t.ausencia+t.errores+t.otros,t}),a=(t,n)=>e.filter(e=>{var i;return!1!==e.isActive&&(null!==(i=e.role)&&void 0!==i?i:"SALES")===t&&e.baseShift===n});return{salesDay:r(a("SALES","DAY")),salesNight:r(a("SALES","NIGHT")),serviceDay:r(a("CUSTOMER_SERVICE","DAY")),serviceNight:r(a("CUSTOMER_SERVICE","NIGHT"))}})(n,a,l),[n,a,l]),p=(e,t)=>{navigator.clipboard.writeText(e).then(()=>{s(t),setTimeout(()=>s(!1),2500)})};return(0,i.jsxs)("div",{style:{padding:"24px",display:"flex",flexDirection:"column",gap:"24px"},children:[(0,i.jsx)(tm,{monthLabel:d,onPrev:()=>t(e=>(0,tr.W)(e,1)),onNext:()=>t(e=>(0,ta.z)(e,1))}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"32px"},children:[(0,i.jsx)(tv,{title:"Ventas - Turno D\xeda",data:c.salesDay,onCopy:p}),(0,i.jsx)(tv,{title:"Ventas - Turno Noche",data:c.salesNight,onCopy:p}),(0,i.jsx)(tv,{title:"Servicio al Cliente - Turno D\xeda",data:c.serviceDay,onCopy:p}),(0,i.jsx)(tv,{title:"Servicio al Cliente - Turno Noche",data:c.serviceNight,onCopy:p})]}),o&&(0,i.jsxs)("div",{style:{position:"fixed",bottom:"24px",left:"50%",transform:"translateX(-50%)",padding:"12px 24px",background:"#1f2937",color:"white",borderRadius:"8px",display:"flex",alignItems:"center",gap:"10px",zIndex:100},children:[(0,i.jsx)(tb.Z,{size:18}),(0,i.jsxs)("span",{children:['Matriz de puntos para "',o,'" copiada.']})]})]})}var tS=n(5527),tI=n(1567),tC=n(3085),tD=n(8896),tA=n(3327);function tE(e){return Math.round(10*e)/10}function tk(e,t){let n=e.filter(e=>e.shift===t);if(0===n.length)return{incidents:0,points:0,avgPointsPerRep:0};let i=n.reduce((e,t)=>e+t.points,0);return{incidents:n.reduce((e,t)=>e+t.incidents,0),points:i,avgPointsPerRep:tE(i/n.length)}}let tR=(e,t,n)=>(function(e,t,n,i){let r=e.filter(e=>!1!==e.isActive),a=t.filter(e=>e.startDate>=n&&e.startDate<=i),o=new Map;r.forEach(e=>{o.set(e.id,{repId:e.id,name:e.name,shift:e.baseShift,incidents:0,points:0})}),a.forEach(e=>{let t=o.get(e.representativeId);if(!t)return;let n=B(e);n>0&&(t.incidents++,t.points+=n)});let s=Array.from(o.values()),l=s.reduce((e,t)=>e+t.incidents,0),d=s.reduce((e,t)=>e+t.points,0),c=0===s.length?0:d/s.length,p={DAY:tk(s,"DAY"),NIGHT:tk(s,"NIGHT")},x=function(e){let t=new Map;return e.forEach(e=>{let n=t.get(e.type)||{type:e.type,count:0,points:0};n.count++,n.points+=B(e),t.set(e.type,n)}),Array.from(t.values()).sort((e,t)=>t.count-e.count)}(a.filter(e=>B(e)>0));return{period:{from:n,to:i},kpis:{totalIncidents:l,totalPoints:d,averagePointsPerRep:tE(c)},shifts:p,incidentTypes:x,candidates:s.filter(e=>0===e.incidents).sort((e,t)=>e.name.localeCompare(t.name)),needsAttention:s.filter(e=>e.points>0).sort((e,t)=>t.points-e.points)}})(e.representatives,e.incidents,t,n),tw=[{label:"\xdaltimos 7 d\xedas",days:7},{label:"\xdaltimos 30 d\xedas",days:30},{label:"Este Trimestre",days:"quarter"},{label:"\xdaltimos 90 d\xedas",days:90}],tN=e=>{let{onPeriodChange:t}=e;return(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingBottom:"16px",borderBottom:"1px solid #e5e7eb"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{style:{fontSize:"20px",fontWeight:600,margin:0},children:"Reporte Ejecutivo de Desempe\xf1o"}),(0,i.jsx)("p",{style:{margin:"4px 0 0",color:"#6b7280",fontSize:"14px"},children:"Vista panor\xe1mica de incidencias y rendimiento del equipo."})]}),(0,i.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:(0,i.jsx)("select",{onChange:e=>t(e.target.value),defaultValue:30,style:{padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",background:"white",cursor:"pointer",fontSize:"14px"},children:tw.map(e=>(0,i.jsx)("option",{value:e.days,children:e.label},e.label))})})]})},tO=e=>{let{label:t,value:n,Icon:r}=e;return(0,i.jsxs)("div",{style:{background:"white",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"16px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#6b7280",fontSize:"14px",fontWeight:500},children:[(0,i.jsx)(r,{size:16}),(0,i.jsx)("span",{children:t})]}),(0,i.jsx)("div",{style:{marginTop:"8px",fontSize:"28px",fontWeight:700,color:"#1f2937"},children:n})]})},tT=e=>{let{shift:t,stats:n}=e;return(0,i.jsxs)("div",{style:{background:"white",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"16px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"DAY"===t?"#b45309":"#312e81",fontSize:"16px",fontWeight:600},children:["DAY"===t?(0,i.jsx)(J.Z,{size:18}):(0,i.jsx)(es.Z,{size:18}),(0,i.jsxs)("span",{children:["Turno ","DAY"===t?"D\xeda":"Noche"]})]}),(0,i.jsxs)("div",{style:{marginTop:"12px",display:"flex",justifyContent:"space-around"},children:[(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("div",{style:{fontSize:12,color:"#6b7280"},children:"Incidencias"}),(0,i.jsx)("div",{style:{fontSize:20,fontWeight:700},children:n.incidents})]}),(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("div",{style:{fontSize:12,color:"#6b7280"},children:"Puntos"}),(0,i.jsx)("div",{style:{fontSize:20,fontWeight:700},children:n.points})]}),(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("div",{style:{fontSize:12,color:"#6b7280"},children:"Ptos/Rep"}),(0,i.jsx)("div",{style:{fontSize:20,fontWeight:700},children:n.avgPointsPerRep})]})]})]})},tz=e=>{let{title:t,data:n,icon:r,variant:a}=e,o={padding:"8px 12px",fontSize:"14px",borderTop:"1px solid #f3f4f6"};return(0,i.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"12px",background:"white",height:"100%"},children:[(0,i.jsxs)("header",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",borderBottom:"1px solid #e5e7eb",color:"success"===a?"#059669":"#b91c1c"},children:[(0,i.jsx)(r,{size:20}),(0,i.jsxs)("h3",{style:{fontSize:"16px",fontWeight:600,margin:0},children:[t," (",n.length,")"]})]}),(0,i.jsx)("div",{style:{maxHeight:"250px",overflowY:"auto"},children:(0,i.jsx)("table",{style:{width:"100%",borderCollapse:"collapse"},children:(0,i.jsxs)("tbody",{children:[n.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{...o,fontWeight:500},children:e.name}),(0,i.jsx)("td",{style:{...o,textAlign:"right",fontWeight:700,color:"danger"===a&&e.points>0?"#b91c1c":"#374151"},children:e.points>0?"".concat(e.points," pts"):""})]},e.repId)),0===n.length&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:2,style:{...o,textAlign:"center",color:"#6b7280",fontStyle:"italic"},children:"No hay representantes en esta categor\xeda."})})]})})})]})},tM=e=>{let{data:t}=e;return(0,i.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"12px",background:"white"},children:[(0,i.jsxs)("header",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",borderBottom:"1px solid #e5e7eb"},children:[(0,i.jsx)(tl.Z,{size:18}),(0,i.jsx)("h3",{style:{fontSize:"16px",fontWeight:600,margin:0},children:"Desglose por Tipo de Incidencia"})]}),(0,i.jsxs)("div",{style:{padding:"16px",display:"flex",flexDirection:"column",gap:"10px"},children:[t.map(e=>{let t=eL[e.type]||eL.OTRO;return(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("span",{style:{fontWeight:500,color:"#374151",fontSize:"14px"},children:t.label}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[(0,i.jsxs)("span",{style:{fontSize:"14px"},children:[(0,i.jsx)("strong",{children:e.count})," evento(s)"]}),(0,i.jsxs)("span",{style:{fontSize:"14px",fontWeight:700,color:"#b91c1c"},children:[e.points," pts"]})]})]},e.type)}),0===t.length&&(0,i.jsx)("div",{style:{textAlign:"center",color:"#6b7280",fontStyle:"italic",padding:"20px 0"},children:"No hay incidencias punitivas en este per\xedodo."})]})]})};function tW(){let[e,t]=(0,r.useState)(30),{from:n,to:a}=(0,r.useMemo)(()=>{let t;let n=new Date;return t="quarter"===e?(0,tS.x)(n):(0,e2.k)(n,e),{from:(0,D.WU)(t,"yyyy-MM-dd"),to:(0,D.WU)(n,"yyyy-MM-dd")}},[e]),o=Y(e=>tR(e,n,a));return o?(0,i.jsxs)("div",{style:{padding:"24px",display:"flex",flexDirection:"column",gap:"24px"},children:[(0,i.jsx)(tN,{onPeriodChange:t}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",marginBottom:"32px"},children:[(0,i.jsx)(tO,{label:"Total Incidencias",value:o.kpis.totalIncidents,Icon:tI.Z}),(0,i.jsx)(tO,{label:"Total Puntos",value:o.kpis.totalPoints,Icon:tC.Z}),(0,i.jsx)(tO,{label:"Puntos / Rep Prom.",value:o.kpis.averagePointsPerRep,Icon:tD.Z})]}),(0,i.jsx)("div",{style:{marginBottom:"24px"},children:(0,i.jsx)(tz,{title:"Requieren Atenci\xf3n",data:o.needsAttention,icon:tC.Z,variant:"danger"})}),(0,i.jsx)("div",{style:{marginBottom:"32px",paddingBottom:"16px",borderBottom:"1px dashed #e5e7eb"},children:(0,i.jsx)(tz,{title:"Candidatos Destacados",data:o.candidates,icon:tA.Z,variant:"success"})}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"24px"},children:[(0,i.jsx)(tT,{shift:"DAY",stats:o.shifts.DAY}),(0,i.jsx)(tT,{shift:"NIGHT",stats:o.shifts.NIGHT})]}),(0,i.jsx)("div",{style:{marginTop:"16px"},children:(0,i.jsx)(tM,{data:o.incidentTypes})})]}):(0,i.jsx)("div",{children:"Cargando reporte..."})}function tL(){let[e,t]=(0,r.useState)("monthly"),n=e=>({padding:"10px 20px",cursor:"pointer",border:"none",borderBottom:e?"2px solid hsl(0, 0%, 13%)":"2px solid transparent",color:e?"#111827":"#4b5563",fontWeight:e?600:500,background:"transparent",fontSize:"15px"});return(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,i.jsxs)("div",{style:{background:"white",borderRadius:"12px 12px 0 0",padding:"0 16px",border:"1px solid #e5e7eb",borderBottom:"none"},children:[(0,i.jsx)("button",{style:n("monthly"===e),onClick:()=>t("monthly"),children:"Resumen Mensual"}),(0,i.jsx)("button",{style:n("points"===e),onClick:()=>t("points"),children:"Reporte de Puntos"}),(0,i.jsx)("button",{style:n("executive"===e),onClick:()=>t("executive"),children:"Reporte Ejecutivo"})]}),(0,i.jsxs)("div",{style:{background:"#ffffff",borderRadius:"0 0 12px 12px",border:"1px solid #e5e7eb",borderTop:"none",minHeight:"80vh"},children:["monthly"===e&&(0,i.jsx)(th,{}),"points"===e&&(0,i.jsx)(tj,{}),"executive"===e&&(0,i.jsx)(tW,{})]})]})}var tB=n(9397);function tF(){let{calendar:e,addOrUpdateSpecialDay:t,removeSpecialDay:n}=Y(e=>({calendar:e.calendar,addOrUpdateSpecialDay:e.addOrUpdateSpecialDay,removeSpecialDay:e.removeSpecialDay})),{mode:a}=ea(),[o,s]=(0,r.useState)(""),[l,d]=(0,r.useState)(""),c=e.specialDays.filter(e=>"HOLIDAY"===e.kind).sort((e,t)=>e.date.localeCompare(t.date)),p=()=>{if(!o.trim()){alert("Debe ingresar una fecha");return}if(!l.trim()){alert("Debe ingresar un nombre para el feriado");return}t({date:o,kind:"HOLIDAY",label:l.trim()}),s(""),d("")},x=e=>{confirm("\xbfEliminar este feriado?")&&n(e)},u=e=>{try{return new Date(e+"T12:00:00Z").toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})}catch(t){return e}};return(0,i.jsxs)("div",{style:{maxWidth:"800px",margin:"0 auto"},children:[(0,i.jsxs)("div",{style:{marginBottom:"30px"},children:[(0,i.jsx)("h2",{style:{margin:0,marginBottom:"8px",fontSize:"20px",color:"#1F2937"},children:"Feriados del A\xf1o"}),(0,i.jsx)("p",{style:{margin:0,fontSize:"14px",color:"#6b7280"},children:"Los d\xedas marcados como feriados ser\xe1n excluidos autom\xe1ticamente del c\xe1lculo de vacaciones."})]}),(0,i.jsxs)("div",{style:{background:"#f9fafb",padding:"20px",borderRadius:"8px",border:"1px solid #e5e7eb",marginBottom:"24px"},children:[(0,i.jsx)("h3",{style:{margin:"0 0 16px 0",fontSize:"16px",color:"#374151"},children:"Agregar Feriado"}),(0,i.jsxs)("div",{style:{display:"flex",gap:"12px",alignItems:"flex-end"},children:[(0,i.jsxs)("div",{style:{flex:"0 0 160px"},children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"#374151"},children:"Fecha"}),(0,i.jsx)("input",{type:"date",value:o,onChange:e=>s(e.target.value),style:{width:"100%",padding:"8px 10px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box"}})]}),(0,i.jsxs)("div",{style:{flex:1},children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"#374151"},children:"Nombre del Feriado"}),(0,i.jsx)("input",{type:"text",value:l,onChange:e=>d(e.target.value),placeholder:"Ej: D\xeda de la Independencia",style:{width:"100%",padding:"8px 10px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box"},onKeyPress:e=>{"Enter"===e.key&&p()}})]}),(0,i.jsxs)("button",{onClick:p,style:{padding:"8px 16px",background:"#111827",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:600,fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:[(0,i.jsx)(tB.Z,{size:16}),"Agregar"]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("h3",{style:{margin:"0 0 12px 0",fontSize:"16px",color:"#374151"},children:["Feriados Configurados (",c.length,")"]}),0===c.length?(0,i.jsxs)("div",{style:{padding:"40px",textAlign:"center",background:"#f9fafb",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[(0,i.jsx)(eX.Z,{size:48,style:{color:"#d1d5db",margin:"0 auto 12px"}}),(0,i.jsx)("p",{style:{margin:0,color:"#6b7280",fontSize:"14px"},children:"No hay feriados configurados"}),(0,i.jsx)("p",{style:{margin:"8px 0 0 0",color:"#9ca3af",fontSize:"13px"},children:"Agregue los feriados del a\xf1o para que se excluyan del c\xe1lculo de vacaciones"})]}):(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:c.map(e=>(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 16px",background:"white",border:"1px solid #e5e7eb",borderRadius:"6px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,i.jsx)("div",{style:{width:"4px",height:"40px",background:"#fbbf24",borderRadius:"2px"}}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontWeight:600,fontSize:"14px",color:"#1F2937"},children:e.label}),(0,i.jsx)("div",{style:{fontSize:"13px",color:"#6b7280",marginTop:"2px"},children:u(e.date)})]})]}),"ADMIN_OVERRIDE"===a&&(0,i.jsx)("button",{onClick:()=>x(e.date),style:{padding:"8px",background:"transparent",border:"none",cursor:"pointer",color:"#ef4444",display:"flex",alignItems:"center",borderRadius:"4px"},title:"Eliminar feriado",children:(0,i.jsx)(eH.Z,{size:18})})]},e.date))})]})]})}function tH(e,t){return e.filter(e=>e.baseShift===t&&e.isActive).sort((e,t)=>e.orderIndex-t.orderIndex)}var tV=n(795),tU=n(3662),tP=n(9892),tY=n(5868),tG=n(1723);function tZ(e){let{repId:t}=e,{specialSchedules:n,removeSpecialSchedule:r}=Y(e=>({specialSchedules:e.specialSchedules.filter(e=>e.representativeId===t),removeSpecialSchedule:e.removeSpecialSchedule})),{mode:a}=ea();if(0===n.length)return null;let o=e=>{let t=["D","L","M","X","J","V","S"];return e.map(e=>t[e]).join(", ")},s=e=>"NONE"===e.type?"Libre":"BOTH"===e.type?"Mixto":"DAY"===e.shift?"D\xeda":"Noche";return(0,i.jsx)("div",{style:{marginTop:"16px"},children:n.map(e=>(0,i.jsxs)("div",{style:{fontSize:"12px",color:"#4b5563",background:"#f9fafb",padding:"10px",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,i.jsx)(eX.Z,{size:14}),(0,i.jsxs)("span",{children:[(0,D.WU)((0,E.D)(e.startDate),"dd/MM/yy")," - ",(0,D.WU)((0,E.D)(e.endDate),"dd/MM/yy")]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginTop:"4px"},children:[(0,i.jsx)(tG.Z,{size:14}),(0,i.jsxs)("span",{children:[o(e.daysOfWeek)," → ",(0,i.jsx)("strong",{children:s(e.assignment)})]})]})]}),"ADMIN_OVERRIDE"===a&&(0,i.jsx)("button",{onClick:()=>r(e.id),style:{color:"#ef4444",background:"none",border:"none",cursor:"pointer"},children:(0,i.jsx)(eH.Z,{size:14})})]},e.id))})}var t_=n(1005);let tq=e=>{let{selectedDays:t,onToggle:n}=e;return(0,i.jsx)("div",{style:{display:"flex",gap:"4px"},children:["D","L","M","X","J","V","S"].map((e,r)=>(0,i.jsx)("button",{type:"button",onClick:()=>n(r),style:{width:"36px",height:"36px",borderRadius:"50%",border:"2px solid",cursor:"pointer",fontWeight:600,fontSize:"13px",display:"flex",alignItems:"center",justifyContent:"center",background:t.includes(r)?"#eef2ff":"white",borderColor:t.includes(r)?"#6366f1":"#d1d5db",color:t.includes(r)?"#4f46e5":"#6b7280",transition:"all 120ms ease"},children:e},r))})};function tK(e){var t,n;let{repId:a,repName:o,onSave:s}=e,[l,d]=(0,r.useState)({intent:null,days:[],replaceBaseMixedDays:!0}),c=Y(e=>e.addSpecialSchedule),p=Y(e=>{var t;return null!==(t=e.representatives)&&void 0!==t?t:[]}).find(e=>e.id===a),x=(null==p?void 0:null===(t=p.mixProfile)||void 0===t?void 0:t.type)==="WEEKDAY"?[1,2,3,4]:(null==p?void 0:null===(n=p.mixProfile)||void 0===n?void 0:n.type)==="WEEKEND"?[5,6,0]:[],u=x.length>0,f=e=>{d(t=>({...t,...e}))},h=["Domingo","Lunes","Martes","Mi\xe9rcoles","Jueves","Viernes","S\xe1bado"],g=l.days.sort((e,t)=>e-t).map(e=>h[e]).join(", "),y=(0,r.useMemo)(()=>{if(!l.startDate||!l.endDate)return null;try{return(0,t_.p)((0,E.D)(l.endDate),(0,E.D)(l.startDate))}catch(e){return null}},[l.startDate,l.endDate]),b=l.intent&&l.days.length>0&&l.startDate&&l.endDate,m=(0,r.useMemo)(()=>{if(!b)return null;let e="";switch(l.intent){case"WORK_SINGLE_SHIFT":e="DAY"===l.shift?"Trabajar\xe1 en turno D\xeda":"Trabajar\xe1 en turno Noche";break;case"WORK_BOTH_SHIFTS":e="Trabajar\xe1 en ambos turnos (mixto)";break;case"OFF":e="No trabajar\xe1 (libre)"}return{action:e,period:"".concat((0,D.WU)((0,E.D)(l.startDate),"dd/MM/yyyy")," – ").concat((0,D.WU)((0,E.D)(l.endDate),"dd/MM/yyyy")),days:g}},[b,l.intent,l.shift,l.startDate,l.endDate,g]),v=e=>({display:"flex",alignItems:"center",gap:"12px",padding:"14px 16px",border:"2px solid",borderRadius:"8px",borderColor:e?"#6366f1":"#e5e7eb",background:e?"#f5f3ff":"white",cursor:"pointer",transition:"all 120ms ease",fontSize:"15px",fontWeight:500,color:e?"#4f46e5":"#374151"});return(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault();try{(function(e,t){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!e.intent)throw Error("Debe seleccionar qu\xe9 pasar\xe1 en esos d\xedas");if(!e.startDate||!e.endDate)throw Error("Debe especificar el per\xedodo (fechas de inicio y fin)");if(0===e.days.length)throw Error("Debe seleccionar al menos un d\xeda de la semana");let r=[];if("WORK_BOTH_SHIFTS"===e.intent&&!0===e.replaceBaseMixedDays&&i.length>0){let n=i.filter(t=>!e.days.includes(t));n.length>0&&r.push({representativeId:t,startDate:e.startDate,endDate:e.endDate,daysOfWeek:n,assignment:{type:"NONE"},reason:"Reemplazo de d\xedas mixtos base"})}switch(e.intent){case"WORK_SINGLE_SHIFT":if(!e.shift)throw Error("Debe seleccionar el turno espec\xedfico");n={type:"SINGLE",shift:e.shift};break;case"WORK_BOTH_SHIFTS":n={type:"BOTH"};break;case"OFF":n={type:"NONE"}}return r.push({representativeId:t,startDate:e.startDate,endDate:e.endDate,daysOfWeek:e.days,assignment:n,reason:e.note||void 0}),r})(l,a,x).forEach(e=>c(e)),s()}catch(e){alert(e instanceof Error?e.message:"Error al guardar")}},style:{background:"white",padding:"24px",borderRadius:"12px",border:"1px solid #e5e7eb",margin:"16px 0",display:"flex",flexDirection:"column",gap:"24px"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{style:{margin:0,fontSize:"18px",fontWeight:600,color:"#111827"},children:"Ajuste temporal de horario"}),(0,i.jsx)("p",{style:{margin:"4px 0 0 0",fontSize:"14px",color:"#6b7280"},children:"Define excepciones al horario habitual durante un per\xedodo"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"15px",fontWeight:600,marginBottom:"12px",color:"#111827"},children:"\xbfQu\xe9 cambio necesitas?"}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,i.jsxs)("label",{style:v("WORK_SINGLE_SHIFT"===l.intent),children:[(0,i.jsx)("input",{type:"radio",name:"intent",checked:"WORK_SINGLE_SHIFT"===l.intent,onChange:()=>f({intent:"WORK_SINGLE_SHIFT",shift:"DAY"}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"Trabajar\xe1 en un turno espec\xedfico"]}),(0,i.jsxs)("label",{style:v("WORK_BOTH_SHIFTS"===l.intent),children:[(0,i.jsx)("input",{type:"radio",name:"intent",checked:"WORK_BOTH_SHIFTS"===l.intent,onChange:()=>f({intent:"WORK_BOTH_SHIFTS",shift:void 0}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"Trabajar\xe1 en ambos turnos (mixto)"]}),(0,i.jsxs)("label",{style:v("OFF"===l.intent),children:[(0,i.jsx)("input",{type:"radio",name:"intent",checked:"OFF"===l.intent,onChange:()=>f({intent:"OFF",shift:void 0}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"No trabajar\xe1 (libre)"]})]})]}),"WORK_BOTH_SHIFTS"===l.intent&&u&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"15px",fontWeight:600,marginBottom:"12px",color:"#111827"},children:"\xbfEste ajuste reemplaza los d\xedas mixtos habituales?"}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,i.jsxs)("label",{style:v(!0===l.replaceBaseMixedDays),children:[(0,i.jsx)("input",{type:"radio",name:"replaceBaseMixedDays",checked:!0===l.replaceBaseMixedDays,onChange:()=>f({replaceBaseMixedDays:!0}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"S\xed, solo estos d\xedas ser\xe1n mixtos"]}),(0,i.jsxs)("label",{style:v(!1===l.replaceBaseMixedDays),children:[(0,i.jsx)("input",{type:"radio",name:"replaceBaseMixedDays",checked:!1===l.replaceBaseMixedDays,onChange:()=>f({replaceBaseMixedDays:!1}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"No, se suman a los habituales (caso especial)"]})]})]}),"WORK_SINGLE_SHIFT"===l.intent&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"15px",fontWeight:600,marginBottom:"12px",color:"#111827"},children:"\xbfEn qu\xe9 turno trabajar\xe1?"}),(0,i.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,i.jsxs)("label",{style:v("DAY"===l.shift),children:[(0,i.jsx)("input",{type:"radio",name:"shift",checked:"DAY"===l.shift,onChange:()=>f({shift:"DAY"}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"Turno D\xeda"]}),(0,i.jsxs)("label",{style:v("NIGHT"===l.shift),children:[(0,i.jsx)("input",{type:"radio",name:"shift",checked:"NIGHT"===l.shift,onChange:()=>f({shift:"NIGHT"}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"Turno Noche"]})]})]}),"WORK_BOTH_SHIFTS"===l.intent&&(0,i.jsx)("div",{style:{padding:"12px 16px",background:"#f0fdf4",border:"1px solid #86efac",borderRadius:"8px",fontSize:"14px",color:"#166534"},children:"Trabajar\xe1 en ambos turnos"}),"OFF"===l.intent&&(0,i.jsx)("div",{style:{padding:"12px 16px",background:"#fef3c7",border:"1px solid #fde047",borderRadius:"8px",fontSize:"14px",color:"#854d0e"},children:"No tendr\xe1 asignaci\xf3n"}),l.intent&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"15px",fontWeight:600,marginBottom:"8px",color:"#111827"},children:"\xbfQu\xe9 d\xedas se ver\xe1n afectados?"}),(0,i.jsx)(tq,{selectedDays:l.days,onToggle:e=>{f({days:l.days.includes(e)?l.days.filter(t=>t!==e):[...l.days,e]})}}),(0,i.jsxs)("div",{style:{marginTop:"12px",display:"flex",gap:"8px",flexWrap:"wrap"},children:[(0,i.jsx)("button",{type:"button",onClick:()=>f({days:[1,2,3,4,5]}),style:{padding:"6px 12px",fontSize:"13px",border:"1px solid #d1d5db",borderRadius:"6px",background:"white",cursor:"pointer"},children:"Lunes a Viernes"}),(0,i.jsx)("button",{type:"button",onClick:()=>f({days:[0,6]}),style:{padding:"6px 12px",fontSize:"13px",border:"1px solid #d1d5db",borderRadius:"6px",background:"white",cursor:"pointer"},children:"Fin de semana"}),(0,i.jsx)("button",{type:"button",onClick:()=>f({days:[0,1,2,3,4,5,6]}),style:{padding:"6px 12px",fontSize:"13px",border:"1px solid #d1d5db",borderRadius:"6px",background:"white",cursor:"pointer"},children:"Todos"})]}),l.days.length>0&&(0,i.jsxs)("p",{style:{marginTop:"8px",fontSize:"14px",color:"#6b7280"},children:["Se aplicar\xe1 los ",(0,i.jsx)("strong",{children:g})]})]}),l.intent&&l.days.length>0&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"15px",fontWeight:600,marginBottom:"12px",color:"#111827"},children:"\xbfDurante qu\xe9 per\xedodo aplica este ajuste?"}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"#6b7280"},children:"Desde"}),(0,i.jsx)("input",{type:"date",value:l.startDate||"",onChange:e=>f({startDate:e.target.value}),style:{width:"100%",padding:"10px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"#6b7280"},children:"Hasta"}),(0,i.jsx)("input",{type:"date",value:l.endDate||"",onChange:e=>f({endDate:e.target.value}),style:{width:"100%",padding:"10px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"}})]})]}),null!==y&&y>=0&&(0,i.jsxs)("p",{style:{marginTop:"8px",fontSize:"14px",color:"#6b7280"},children:["Este ajuste estar\xe1 activo durante ",(0,i.jsxs)("strong",{children:[y," semana",1!==y?"s":""]})]})]}),m&&(0,i.jsxs)("div",{style:{padding:"16px",background:"#f9fafb",border:"2px solid #e5e7eb",borderRadius:"8px"},children:[(0,i.jsx)("div",{style:{fontSize:"13px",fontWeight:600,color:"#6b7280",marginBottom:"8px"},children:"\uD83E\uDDFE Resumen del ajuste"}),(0,i.jsxs)("div",{style:{fontSize:"15px",color:"#111827",lineHeight:1.6},children:[(0,i.jsx)("div",{style:{fontWeight:600,marginBottom:"4px"},children:o}),(0,i.jsxs)("div",{children:["Durante el per\xedodo ",(0,i.jsx)("strong",{children:m.period})]}),(0,i.jsx)("div",{children:(0,i.jsx)("strong",{children:m.action})}),(0,i.jsxs)("div",{children:["Los d\xedas: ",(0,i.jsx)("strong",{children:m.days})]})]})]}),l.intent&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"#6b7280"},children:"Motivo (opcional)"}),(0,i.jsx)("input",{type:"text",value:l.note||"",onChange:e=>f({note:e.target.value}),placeholder:"Ej: Universidad, Capacitaci\xf3n, Familiar enfermo",style:{width:"100%",padding:"10px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"}})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",paddingTop:"8px",borderTop:"1px solid #e5e7eb"},children:[(0,i.jsx)("button",{type:"button",onClick:s,style:{padding:"10px 16px",border:"1px solid #d1d5db",borderRadius:"8px",background:"white",cursor:"pointer",fontSize:"14px",fontWeight:500},children:"Cancelar"}),(0,i.jsx)("button",{type:"submit",disabled:!b,style:{padding:"10px 20px",background:b?"#111827":"#d1d5db",color:"white",border:"none",borderRadius:"8px",cursor:b?"pointer":"not-allowed",fontWeight:600,fontSize:"14px"},children:"Guardar Horario"})]})]})}function tJ(e){let{rep:t,onEdit:n,onAddSchedule:r,addingScheduleFor:a,advancedEditMode:o}=e,s=Y(e=>e.deactivateRepresentative),{mode:l}=ea(),{attributes:d,listeners:c,setNodeRef:p,transform:x,transition:u,isDragging:f}=(0,tU.nB)({id:t.id}),h=o?{transform:tP.ux.Transform.toString(x),transition:u,opacity:f?.5:1}:{};return(0,i.jsxs)("div",{ref:o?p:void 0,style:{...h,padding:"16px",background:"white",border:"1px solid #e5e7eb",borderRadius:"8px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[o&&(0,i.jsx)(q,{content:"Arrastra para reordenar",children:(0,i.jsx)("span",{...d,...c,style:{cursor:"grab",padding:"8px",fontSize:"18px",color:"#9ca3af",userSelect:"none",display:"flex",alignItems:"center"},children:"≡"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontWeight:600,fontSize:"14px",color:"#1F2937"},children:t.name}),(0,i.jsxs)("div",{style:{fontSize:"13px",color:"#6b7280",marginTop:"2px"},children:["Rol: ","CUSTOMER_SERVICE"===t.role?"Servicio al Cliente":"Ventas"," | Turno: ","DAY"===t.baseShift?"D\xeda":"Noche"," ",t.mixProfile&&"(Mixto ".concat("WEEKDAY"===t.mixProfile.type?"L-J":"V-D",")")]})]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,i.jsx)("button",{onClick:()=>n(t),style:{padding:"8px",background:"#f3f4f6",border:"1px solid #e5e7eb",borderRadius:"4px",cursor:"pointer",color:"#374151"},title:"Editar",children:(0,i.jsx)(tY.Z,{size:16})}),"ADMIN_OVERRIDE"===l&&(0,i.jsx)("button",{onClick:()=>s(t.id),style:{padding:"8px",background:"#fef2f2",border:"1px solid #fee2e2",borderRadius:"4px",cursor:"pointer",color:"#b91c1c"},title:"Desactivar",children:(0,i.jsx)(eH.Z,{size:16})})]})]}),(0,i.jsx)(tZ,{repId:t.id}),a===t.id?(0,i.jsx)(tK,{repId:t.id,repName:t.name,onSave:()=>r(null)}):(0,i.jsx)("div",{style:{marginTop:"12px"},children:(0,i.jsx)("button",{onClick:()=>r(t.id),style:{fontSize:"12px",fontWeight:500,color:"#4338ca",background:"none",border:"none",cursor:"pointer"},children:"+ A\xf1adir horario especial"})})]})}function tQ(e){let{shift:t,representatives:n,onEdit:r,onAddSchedule:a,addingScheduleFor:o,advancedEditMode:s}=e,l=Y(e=>e.reorderRepresentatives),d=n.map(e=>e.id);return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontSize:"12px",color:s?"#92400e":"#6b7280",marginBottom:"12px",fontStyle:"italic",background:s?"#fef3c7":"#f9fafb",padding:"8px 12px",borderRadius:"6px",border:"1px solid ".concat(s?"#fbbf24":"#e5e7eb")},children:s?"\uD83D\uDCA1 El orden define el ranking del incentivo. Arrastra desde ≡ para reordenar.":"\uD83D\uDD12 Activa el Modo de Edici\xf3n Avanzada para reordenar representantes."}),s?(0,i.jsx)(tV.LB,{collisionDetection:tV.pE,onDragEnd:e=>{let{active:n,over:i}=e;if(!i||n.id===i.id)return;let r=d.indexOf(n.id),a=d.indexOf(i.id);l(t,(0,tU.Rp)(d,r,a))},children:(0,i.jsx)(tU.Fo,{items:d,strategy:tU.qw,children:(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:n.map(e=>(0,i.jsx)(tJ,{rep:e,onEdit:r,onAddSchedule:a,addingScheduleFor:o,advancedEditMode:s},e.id))})})}):(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:n.map(e=>(0,i.jsx)(tJ,{rep:e,onEdit:r,onAddSchedule:a,addingScheduleFor:o,advancedEditMode:s},e.id))})]})}let tX=e=>{let{schedule:t,onChange:n}=e;return(0,i.jsx)("div",{style:{display:"flex",gap:"4px"},children:["D","L","M","X","J","V","S"].map((e,r)=>{let a="OFF"===t[r];return(0,i.jsx)("button",{type:"button",onClick:()=>{let e={...t};e[r]="WORKING"===t[r]?"OFF":"WORKING",n(e)},style:{width:"32px",height:"32px",borderRadius:"50%",border:"1px solid",cursor:"pointer",fontWeight:600,fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center",background:a?"hsl(220, 10%, 92%)":"transparent",borderColor:a?"hsl(220, 10%, 75%)":"hsl(220, 15%, 88%)",color:a?"hsl(220, 15%, 25%)":"hsl(220, 15%, 35%)"},children:e},r)})})},t$=e=>{var t;let{rep:n,onSave:a,onCancel:o}=e,[s,l]=(0,r.useState)((null==n?void 0:n.name)||""),[d,c]=(0,r.useState)((null==n?void 0:n.baseShift)||"DAY"),[p,x]=(0,r.useState)((null==n?void 0:n.role)||"SALES"),[u,f]=(0,r.useState)((null==n?void 0:n.baseSchedule)||function(e){let t={};for(let n=0;n<7;n++)t[n]=e.includes(n)?"OFF":"WORKING";return t}([1])),[h,g]=(0,r.useState)((null==n?void 0:null===(t=n.mixProfile)||void 0===t?void 0:t.type)||"");return(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s.trim()&&a({name:s,baseShift:d,role:p,baseSchedule:u,mixProfile:h?{type:h}:void 0},null==n?void 0:n.id)},style:{background:"#f9fafb",padding:"20px",borderRadius:"8px",border:"1px solid #e5e7eb",marginBottom:"24px",display:"flex",flexDirection:"column",gap:"16px"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("h3",{style:{margin:0,fontSize:"16px",color:"#374151"},children:n?"Editar Representante":"Nuevo Representante"}),n&&(0,i.jsx)("button",{type:"button",onClick:o,style:{background:"none",border:"none",cursor:"pointer",color:"#6b7280"},children:(0,i.jsx)(el.Z,{size:18})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"#374151"},children:"Nombre Completo"}),(0,i.jsx)("input",{type:"text",value:s,onChange:e=>l(e.target.value),placeholder:"Ej: Ana Garc\xeda",style:{width:"100%",padding:"8px 10px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box"},required:!0})]}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"#374151"},children:"Rol"}),(0,i.jsxs)("select",{value:p,onChange:e=>x(e.target.value),style:{width:"100%",padding:"8px 10px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box",background:"white"},children:[(0,i.jsx)("option",{value:"SALES",children:"Ventas"}),(0,i.jsx)("option",{value:"CUSTOMER_SERVICE",children:"Servicio al Cliente"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"#374151"},children:"Turno Base"}),(0,i.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,i.jsxs)("button",{type:"button",onClick:()=>c("DAY"),style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"8px",border:"1px solid",borderRadius:"6px",cursor:"pointer",background:"DAY"===d?"#fffbeb":"white",borderColor:"DAY"===d?"#fcd34d":"#d1d5db",color:"DAY"===d?"#b45309":"#374151"},children:[(0,i.jsx)(J.Z,{size:16})," D\xeda"]}),(0,i.jsxs)("button",{type:"button",onClick:()=>c("NIGHT"),style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"8px",border:"1px solid",borderRadius:"6px",cursor:"pointer",background:"NIGHT"===d?"#eef2ff":"white",borderColor:"NIGHT"===d?"#c7d2fe":"#d1d5db",color:"NIGHT"===d?"#4338ca":"#374151"},children:[(0,i.jsx)(es.Z,{size:16})," Noche"]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"#374151"},children:"Patr\xf3n base de mixto"}),(0,i.jsx)("p",{style:{fontSize:"12px",color:"#6b7280",marginBottom:"8px",marginTop:0},children:"Se usa solo como referencia cuando no hay ajustes temporales. Los cambios especiales se configuran en Horarios Especiales."}),(0,i.jsxs)("select",{value:h,onChange:e=>g(e.target.value),style:{width:"100%",padding:"8px 10px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box",background:"white"},children:[(0,i.jsx)("option",{value:"",children:"Ninguno"}),(0,i.jsx)("option",{value:"WEEKDAY",children:"Mixto entre semana (L-J) - base"}),(0,i.jsx)("option",{value:"WEEKEND",children:"Mixto fin de semana (V-D) - base"})]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"#374151"},children:"D\xedas Libres Base (semana)"}),(0,i.jsx)("p",{style:{fontSize:"12px",color:"#6b7280",marginBottom:"8px",marginTop:0},children:"Selecciona los d\xedas que el representante NO trabaja"}),(0,i.jsx)(tX,{schedule:u,onChange:f})]}),(0,i.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",marginTop:"8px"},children:(0,i.jsxs)("button",{type:"submit",style:{padding:"8px 16px",background:"#111827",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:600,fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:[(0,i.jsx)(tB.Z,{size:16})," ",n?"Guardar Cambios":"Agregar"]})})]})};function t0(){let{representatives:e,addRepresentative:t,updateRepresentative:n}=Y(e=>{var t;return{representatives:null!==(t=e.representatives)&&void 0!==t?t:[],addRepresentative:e.addRepresentative,updateRepresentative:e.updateRepresentative}}),{mode:a}=ea(),[o,s]=(0,r.useState)(null),[l,d]=(0,r.useState)(null),[c,p]=(0,r.useState)(!1),[x,u]=(0,r.useState)("DAY"),f=(0,r.useMemo)(()=>e.filter(e=>!1!==e.isActive),[e]),h=(0,r.useMemo)(()=>e.filter(e=>!1===e.isActive),[e]),g=(0,r.useMemo)(()=>tH(f,"DAY"),[f]),y=(0,r.useMemo)(()=>tH(f,"NIGHT"),[f]),b=(i,r)=>{if(r){let t=e.find(e=>e.id===r);t&&n({...t,...i})}else{let e=f.filter(e=>e.baseShift===i.baseShift),n=e.length>0?Math.max(...e.map(e=>e.orderIndex||0)):-1;t({...i,orderIndex:n+1})}s(null)};return(0,i.jsxs)("div",{style:{maxWidth:"800px",margin:"0 auto"},children:[(0,i.jsxs)("div",{style:{marginBottom:"30px"},children:[(0,i.jsx)("h2",{style:{margin:0,marginBottom:"8px",fontSize:"20px",color:"#1F2937"},children:"Gesti\xf3n de Representantes"}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("p",{style:{margin:0,fontSize:"14px",color:"#6b7280"},children:"A\xf1ade, edita o desactiva representantes. El orden determina el ranking del incentivo."}),(0,i.jsx)(eM,{title:"\xbfC\xf3mo agregar representantes?",points:["Completa el formulario con nombre, rol y turno base","Selecciona los d\xedas libres en el calendario semanal","El representante aparecer\xe1 al final de su turno"]})]})]}),!o&&(0,i.jsx)(t$,{onSave:b,onCancel:()=>s(null)}),o&&(0,i.jsx)(t$,{rep:o,onSave:b,onCancel:()=>s(null)}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{display:"flex",gap:"8px",marginBottom:"16px",borderBottom:"1px solid #e5e7eb",paddingBottom:"8px"},children:[(0,i.jsx)(q,{content:"Vista de solo lectura. Selecciona un turno para reordenar",children:(0,i.jsxs)("button",{onClick:()=>u("ALL"),style:{padding:"8px 16px",border:"none",borderBottom:"ALL"===x?"2px solid #111827":"2px solid transparent",background:"transparent",cursor:"pointer",fontWeight:"ALL"===x?600:400,color:"ALL"===x?"#111827":"#6b7280",fontSize:"14px"},children:["Todos (",f.length,")"]})}),(0,i.jsxs)("button",{onClick:()=>u("DAY"),style:{padding:"8px 16px",border:"none",borderBottom:"DAY"===x?"2px solid #f59e0b":"2px solid transparent",background:"transparent",cursor:"pointer",fontWeight:"DAY"===x?600:400,color:"DAY"===x?"#f59e0b":"#6b7280",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:[(0,i.jsx)(J.Z,{size:16})," D\xeda (",g.length,")"]}),(0,i.jsxs)("button",{onClick:()=>u("NIGHT"),style:{padding:"8px 16px",border:"none",borderBottom:"NIGHT"===x?"2px solid #6366f1":"2px solid transparent",background:"transparent",cursor:"pointer",fontWeight:"NIGHT"===x?600:400,color:"NIGHT"===x?"#6366f1":"#6b7280",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:[(0,i.jsx)(es.Z,{size:16})," Noche (",y.length,")"]})]}),"ALL"===x?(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontSize:"12px",color:"#6b7280",marginBottom:"12px",fontStyle:"italic"},children:"\uD83D\uDCA1 Para reordenar, selecciona un turno espec\xedfico"}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("h4",{style:{margin:"0 0 8px 0",fontSize:"14px",color:"#f59e0b",fontWeight:600},children:[(0,i.jsx)(J.Z,{size:14,style:{display:"inline",marginRight:"6px"}}),"Turno D\xeda (",g.length,")"]}),(0,i.jsx)("div",{style:{fontSize:"13px",color:"#6b7280"},children:g.map(e=>e.name).join(", ")||"Sin representantes"})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("h4",{style:{margin:"0 0 8px 0",fontSize:"14px",color:"#6366f1",fontWeight:600},children:[(0,i.jsx)(es.Z,{size:14,style:{display:"inline",marginRight:"6px"}}),"Turno Noche (",y.length,")"]}),(0,i.jsx)("div",{style:{fontSize:"13px",color:"#6b7280"},children:y.map(e=>e.name).join(", ")||"Sin representantes"})]})]})]}):(0,i.jsx)(tQ,{shift:x,representatives:"DAY"===x?g:y,onEdit:s,onAddSchedule:d,addingScheduleFor:l,advancedEditMode:"ADMIN_OVERRIDE"===a}),h.length>0&&(0,i.jsxs)("div",{style:{marginTop:"24px"},children:[(0,i.jsxs)("button",{onClick:()=>p(!c),style:{fontSize:"14px",color:"#6b7280",fontWeight:500,background:"none",border:"none",cursor:"pointer"},children:[c?"Ocultar":"Mostrar"," ",h.length," representantes inactivos"]}),c&&(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"12px"},children:h.map(e=>(0,i.jsxs)("div",{style:{padding:"12px 16px",background:"#f9fafb",border:"1px solid #e5e7eb",borderRadius:"6px",color:"#9ca3af",fontStyle:"italic"},children:[e.name," (Inactivo)"]},e.id))})]})]})]})}var t1=n(7689),t2=n(5621),t6=n(7117),t5=n(9076);function t4(){let[e,t]=(0,r.useState)("representatives"),{mode:n,toggle:a}=ea(),{showToast:o}=eq(),{resetState:s,showConfirm:l,exportState:d,importState:c}=Y(e=>({resetState:e.resetState,showConfirm:e.showConfirm,exportState:e.exportState,importState:e.importState})),p=async()=>{await l({title:"⚠️ \xbfReiniciar la planificaci\xf3n?",description:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{children:"Esta acci\xf3n eliminar\xe1 todas las incidencias y ajustes manuales (ausencias, tardanzas, cambios de turno, etc.)."}),(0,i.jsx)("p",{style:{marginTop:"10px",fontWeight:500},children:"Se conservar\xe1n las licencias y vacaciones ya registradas."}),(0,i.jsx)("p",{style:{marginTop:"10px",fontSize:"12px",color:"#6b7280"},children:"Esta acci\xf3n no se puede deshacer."})]}),intent:"danger",confirmLabel:"S\xed, reiniciar"})&&s(!0)},x=async e=>{var t;let n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(n){if(!await l({title:"⚠️ \xbfImportar Estado?",description:"Esto sobreescribir\xe1 todo el estado actual de la aplicaci\xf3n con los datos del archivo. Esta acci\xf3n no se puede deshacer.",intent:"danger",confirmLabel:"S\xed, importar"})){e.target.value="";return}try{let e=await n.text(),t=function(e){let t;try{t=JSON.parse(e)}catch(e){throw Error("El archivo no es JSON v\xe1lido.")}if(!t||"object"!=typeof t)throw Error("Formato de respaldo inv\xe1lido.");let n=t;if(7!==n.version)throw Error("Versi\xf3n incompatible. Esperada ".concat(7,", recibida ").concat(n.version||"desconocida"));if(!Array.isArray(n.representatives))throw Error("Respaldo corrupto: representantes inv\xe1lidos.");if(!Array.isArray(n.incidents))throw Error("Respaldo corrupto: incidencias inv\xe1lidas.");return n}(e);c(t),o({title:"\xc9xito",message:"Estado importado correctamente.",type:"success"})}catch(e){o({title:"Error de Importaci\xf3n",message:e instanceof Error?e.message:"Error desconocido.",type:"error"})}finally{e.target.value=""}}},u=e=>({padding:"10px 20px",border:"none",background:e?"white":"transparent",cursor:"pointer",fontWeight:e?600:500,fontSize:"14px",color:e?"#1F2937":"#6b7280",borderBottom:e?"2px solid #111827":"2px solid transparent",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"8px"}),f={padding:"16px 20px",background:"white",border:"1px solid #e5e7eb",borderRadius:"8px",marginBottom:"12px"},h={padding:"8px 16px",fontSize:"14px",border:"1px solid #d1d5db",borderRadius:"6px",background:"white",cursor:"pointer",fontWeight:500},g={...h,background:"#fef2f2",color:"#991b1b",borderColor:"#fecaca"};return(0,i.jsxs)("div",{style:{maxWidth:"1000px",margin:"0 auto"},children:[(0,i.jsxs)("div",{style:{borderBottom:"1px solid #e5e7eb",marginBottom:"30px",display:"flex"},children:[(0,i.jsxs)("button",{style:u("representatives"===e),onClick:()=>t("representatives"),children:[(0,i.jsx)(eK.Z,{size:16}),"Representantes"]}),(0,i.jsxs)("button",{style:u("holidays"===e),onClick:()=>t("holidays"),children:[(0,i.jsx)(eX.Z,{size:16}),"Feriados"]}),(0,i.jsxs)("button",{style:u("system"===e),onClick:()=>t("system"),children:[(0,i.jsx)(ec.Z,{size:16}),"Sistema"]})]}),"representatives"===e&&(0,i.jsx)(t0,{}),"holidays"===e&&(0,i.jsx)(tF,{}),"system"===e&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{style:{margin:"0 0 8px 0",fontSize:"20px",color:"#1F2937"},children:"Configuraci\xf3n del Sistema"}),(0,i.jsx)("p",{style:{margin:"0 0 24px 0",fontSize:"14px",color:"#6b7280"},children:"Opciones avanzadas de administraci\xf3n y gesti\xf3n del sistema."}),(0,i.jsx)("div",{style:f,children:(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{style:{margin:"0 0 4px 0",fontSize:"16px",color:"#1F2937"},children:"Modo Edici\xf3n Avanzada"}),(0,i.jsx)("p",{style:{margin:0,fontSize:"13px",color:"#6b7280"},children:"Permite modificar semanas pasadas. Usar con precauci\xf3n."})]}),(0,i.jsx)("button",{style:{...h,background:"ADMIN_OVERRIDE"===n?"#fefce8":"white",color:"ADMIN_OVERRIDE"===n?"#a16207":"#374151",borderColor:"ADMIN_OVERRIDE"===n?"#fde047":"#d1d5db"},onClick:a,children:"ADMIN_OVERRIDE"===n?"✓ Activado":"Desactivado"})]})}),(0,i.jsxs)("div",{style:f,children:[(0,i.jsx)("h3",{style:{margin:"0 0 12px 0",fontSize:"16px",color:"#1F2937"},children:"Respaldo de Datos"}),(0,i.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,i.jsxs)("label",{style:{...h,cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[(0,i.jsx)(t1.Z,{size:16}),"Importar Respaldo",(0,i.jsx)("input",{type:"file",accept:"application/json",onChange:x,style:{display:"none"}})]}),(0,i.jsxs)("button",{style:{...h,display:"flex",alignItems:"center",gap:"6px"},onClick:()=>{let e=d();!function(e,t){let n=new Blob([JSON.stringify(t,null,2)],{type:"application/json;charset=utf-8"}),i=URL.createObjectURL(n),r=document.createElement("a");r.href=i,r.download=e,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}("planning-backup-".concat(new Date().toISOString().split("T")[0],".json"),{...e,exportedAt:new Date().toISOString(),appVersion:e.version})},children:[(0,i.jsx)(ty.Z,{size:16}),"Exportar Respaldo"]})]})]}),(0,i.jsxs)("div",{style:f,children:[(0,i.jsx)("h3",{style:{margin:"0 0 4px 0",fontSize:"16px",color:"#1F2937"},children:"Auditor\xeda del Sistema"}),(0,i.jsx)("p",{style:{margin:"0 0 12px 0",fontSize:"13px",color:"#6b7280"},children:"Historial detallado de cambios y acciones administrativas."}),(0,i.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,i.jsxs)("button",{style:{...h,opacity:.5,cursor:"not-allowed"},children:[(0,i.jsx)(t2.Z,{size:16,style:{display:"inline",marginRight:"6px",verticalAlign:"middle"}}),"Historial"]}),(0,i.jsxs)("button",{style:{...h,opacity:.5,cursor:"not-allowed"},children:[(0,i.jsx)(t6.Z,{size:16,style:{display:"inline",marginRight:"6px",verticalAlign:"middle"}}),"Auditor\xeda"]})]})]}),(0,i.jsxs)("div",{style:{...f,borderColor:"#fecaca",background:"#fef2f2"},children:[(0,i.jsx)("h3",{style:{margin:"0 0 4px 0",fontSize:"16px",color:"#991b1b"},children:"Zona de Peligro"}),(0,i.jsx)("p",{style:{margin:"0 0 12px 0",fontSize:"13px",color:"#991b1b"},children:"Estas acciones son irreversibles y pueden afectar datos importantes."}),(0,i.jsxs)("button",{style:g,onClick:p,children:[(0,i.jsx)(t5.Z,{size:16,style:{display:"inline",marginRight:"6px",verticalAlign:"middle"}}),"Resetear Planificaci\xf3n"]})]})]})]})}function t8(e){let{open:t,title:n,description:r,intent:a="info",confirmLabel:o="Confirmar",cancelLabel:s="Cancelar",onConfirm:l,onCancel:d}=e;if(!t)return null;let c={padding:"0.5rem 1rem",borderRadius:"0.375rem",border:"none",cursor:"pointer",fontWeight:500};return(0,i.jsx)("div",{style:{position:"fixed",inset:0,zIndex:50,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0, 0, 0, 0.5)"},onClick:d,children:(0,i.jsx)(_.E.div,{style:{backgroundColor:"white",borderRadius:"0.75rem",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",width:"100%",maxWidth:"28rem"},onClick:e=>e.stopPropagation(),initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.15,ease:"easeOut"},children:(0,i.jsxs)("div",{style:{padding:"1.5rem"},children:[(0,i.jsx)("h2",{style:{fontSize:"1.25rem",fontWeight:600,marginBottom:"0.5rem"},children:n}),r&&(0,i.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"1.5rem",lineHeight:"1.5"},children:r}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5rem",marginTop:"1.5rem"},children:[(0,i.jsx)("button",{onClick:d,style:{...c,backgroundColor:"#f3f4f6",color:"#374151"},children:s}),(0,i.jsx)("button",{onClick:l,style:{...c,...{danger:{backgroundColor:"#dc2626",color:"white"},warning:{backgroundColor:"#f59e0b",color:"black"},info:{backgroundColor:"#2563eb",color:"white"}}[a]},children:o})]})]})})})}function t7(){let e=Y(e=>e.undoStack),t=Y(e=>e.executeUndo);return(0,i.jsx)("div",{style:{position:"fixed",bottom:"24px",right:"24px",display:"flex",flexDirection:"column",gap:"12px",zIndex:2e3},children:(0,i.jsx)(Z.M,{children:e.map(e=>(0,i.jsxs)(_.E.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20,transition:{duration:.2}},transition:{duration:.25,ease:"easeOut"},style:{background:"hsl(220, 20%, 15%)",color:"white",padding:"12px 20px",borderRadius:"10px",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.2)",display:"flex",alignItems:"center",gap:"16px"},children:[(0,i.jsx)("span",{children:e.label}),(0,i.jsx)("button",{onClick:()=>t(e.id),style:{fontWeight:600,color:"hsl(200, 100%, 70%)",background:"none",border:"none",cursor:"pointer",padding:"4px"},children:"Deshacer"})]},e.id))})})}function t3(e){let{isOpen:t,repName:n,startDate:a,endDate:o,returnDate:s,workingDays:l,onClose:d}=e;(0,r.useEffect)(()=>{if(t){let e=setTimeout(()=>{d()},5e3);return()=>clearTimeout(e)}},[t,d]);let c=e=>{try{return new Date(e+"T12:00:00Z").toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return e}};return(0,i.jsx)(Z.M,{children:t&&(0,i.jsx)(_.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},style:{position:"fixed",top:"20px",right:"20px",zIndex:9999,maxWidth:"400px"},children:(0,i.jsxs)("div",{style:{background:"white",borderRadius:"8px",boxShadow:"0 10px 40px rgba(0,0,0,0.15)",border:"1px solid #e5e7eb",overflow:"hidden"},children:[(0,i.jsxs)("div",{style:{background:"#10b981",padding:"16px 20px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[(0,i.jsx)(eu.Z,{size:24,style:{color:"white"}}),(0,i.jsx)("span",{style:{color:"white",fontWeight:600,fontSize:"16px"},children:"Vacaciones Registradas"})]}),(0,i.jsx)("button",{onClick:d,style:{background:"transparent",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center"},children:(0,i.jsx)(el.Z,{size:20,style:{color:"white"}})})]}),(0,i.jsxs)("div",{style:{padding:"20px"},children:[(0,i.jsx)("div",{style:{marginBottom:"16px"},children:(0,i.jsx)("div",{style:{fontSize:"15px",fontWeight:600,color:"#1F2937",marginBottom:"4px"},children:n})}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,i.jsx)("span",{style:{color:"#6b7280",fontSize:"14px"},children:"Desde:"}),(0,i.jsx)("span",{style:{color:"#1F2937",fontSize:"14px",fontWeight:500},children:c(a)})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,i.jsx)("span",{style:{color:"#6b7280",fontSize:"14px"},children:"Hasta:"}),(0,i.jsx)("span",{style:{color:"#1F2937",fontSize:"14px",fontWeight:500},children:c(o)})]}),(0,i.jsx)("div",{style:{height:"1px",background:"#e5e7eb",margin:"6px 0"}}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,i.jsx)("span",{style:{color:"#6b7280",fontSize:"14px"},children:"Reingresa:"}),(0,i.jsx)("span",{style:{color:"#10b981",fontSize:"14px",fontWeight:600},children:c(s)})]})]}),(0,i.jsx)("div",{style:{marginTop:"16px",padding:"12px",background:"#f0fdf4",borderRadius:"6px",textAlign:"center"},children:(0,i.jsxs)("span",{style:{color:"#15803d",fontSize:"13px",fontWeight:500},children:["(",l," d\xedas laborables)"]})})]})]})})})}let t9=e=>{let{level:t}=e;return(0,i.jsx)("span",{style:{...{danger:{backgroundColor:"#fdecea",color:"#b42318"},warning:{backgroundColor:"#fff3cd",color:"#9a6a00"},ok:{backgroundColor:"#e6f9ee",color:"#1c7c44"}}[t],padding:"6px 12px",borderRadius:"99px",fontSize:"12px",fontWeight:600},children:{danger:"RIESGO",warning:"ATENCI\xd3N",ok:"OK"}[t]})};function ne(e){let{label:t,value:n}=e;return(0,i.jsxs)("div",{style:{background:"#f9fafb",border:"1px solid #f3f4f6",borderRadius:"8px",padding:"8px 12px",textAlign:"center"},children:[(0,i.jsx)("div",{style:{fontSize:"12px",color:"#6b7280",marginBottom:"2px",fontWeight:500},children:t}),(0,i.jsx)("div",{style:{fontSize:"18px",fontWeight:700,color:"#1f2937"},children:n})]})}function nt(e){let[t,n,i]=e.split("-").map(Number);return new Date(t,n-1,i)}function nn(e){let{summary:t,personId:n,onClose:a}=e,o=(0,r.useRef)(null),[s,l]=(0,r.useState)(null),{openDetailModal:d,representatives:c,allCalendarDays:p}=Y(e=>({openDetailModal:e.openDetailModal,representatives:e.representatives,allCalendarDays:e.allCalendarDaysForRelevantMonths})),x=(0,r.useMemo)(()=>t&&n?t.byPerson.find(e=>e.representativeId===n):null,[t,n]),u=(0,r.useMemo)(()=>c.find(e=>e.id===n),[c,n]),f=(0,r.useMemo)(()=>(0,E.D)("".concat(t.month,"-01")),[t.month]),h=e=>{let t=new Date(f.getFullYear(),f.getMonth()+e,1);d(n,(0,D.WU)(t,"yyyy-MM")),l(null)};(0,r.useEffect)(()=>{let e=e=>{"Escape"===e.key&&a()};return document.body.style.overflow="hidden",document.addEventListener("keydown",e),()=>{document.body.style.overflow="",document.removeEventListener("keydown",e)}},[a]);let g=(0,r.useMemo)(()=>(0,D.WU)(f,"MMMM yyyy",{locale:eD.es}),[f]),y=(0,r.useMemo)(()=>{if(!(null==x?void 0:x.incidents)||!u)return[];if(!s)return x.incidents;let e=(0,D.WU)(s,"yyyy-MM-dd");return x.incidents.filter(t=>"VACACIONES"===t.type||"LICENCIA"===t.type?M(t,p,u).dates.includes(e):t.startDate===e)},[s,x,u,p]),b=(0,r.useMemo)(()=>{if(!x||!u)return[];let e=new Map,n=parseInt(t.month.split("-")[0]),i=parseInt(t.month.split("-")[1])-1,r=new Date(n,i+1,0).getDate();for(let t=1;t<=r;t++){let r=new Date(n,i,t),a=r.getDay(),o="OFF"===u.baseSchedule[a],s=(0,D.WU)(r,"yyyy-MM-dd");e.set(s,{points:0,isOffDay:o,visualTypes:[]})}for(let t of x.incidents)if(t.startDate){if("VACACIONES"===t.type||"LICENCIA"===t.type){let n=M(t,p,u),i="VACACIONES"===t.type?"VACATION":"LICENSE";for(let r of n.dates){let n=e.get(r);if(n){let e=B(t);n.points+=e,n.visualTypes.push(i)}}}else{let n=e.get(t.startDate);if(n){let e=B(t);n.points+=e,"AUSENCIA"===t.type&&n.visualTypes.push("ABSENT")}}}return Array.from(e.entries()).map(e=>{var t;let[n,i]=e,r="normal";return i.isOffDay&&0===i.points?r="disabled":i.points>=6?r="danger":i.points>0&&(r="warning"),{date:nt(n),state:r,visualType:(t=i.visualTypes).includes("ABSENT")?"ABSENT":t.includes("VACATION")?"VACATION":t.includes("LICENSE")?"LICENSE":t.includes("HOLIDAY")?"HOLIDAY":t.includes("SHIFT_CHANGE")?"SHIFT_CHANGE":"NORMAL"}})},[x,u,t.month,p]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(_.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.25,ease:"easeOut"},style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.4)",zIndex:50},onClick:a},"overlay"),(0,i.jsx)("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},onClick:a,children:(0,i.jsx)(_.E.div,{ref:o,tabIndex:-1,style:{outline:"none",backgroundColor:"white",borderRadius:"12px",padding:"24px",width:"700px",maxWidth:"90vw",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.2)",maxHeight:"85vh",display:"flex",flexDirection:"column"},onClick:e=>e.stopPropagation(),initial:{opacity:0,y:30},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.25,ease:"easeOut"},children:(()=>{if(!x)return(0,i.jsx)("div",{style:{padding:"24px",minHeight:"400px",display:"flex",alignItems:"center",justifyContent:"center",color:"#6b7280"},children:"No se encontr\xf3 informaci\xf3n para este representante en el mes seleccionado."});let{totals:e,riskLevel:t,name:n}=x;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("header",{style:{paddingBottom:"12px",borderBottom:"1px solid #e5e7eb",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:600,margin:0},children:n}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginTop:"8px"},children:[(0,i.jsx)("button",{onClick:()=>h(-1),style:{background:"none",border:"none",cursor:"pointer",color:"#6b7280"},children:(0,i.jsx)(eJ.Z,{size:20})}),(0,i.jsx)("p",{style:{margin:0,color:"#374151",fontWeight:600,textTransform:"capitalize",width:"140px",textAlign:"center"},children:g}),(0,i.jsx)("button",{onClick:()=>h(1),style:{background:"none",border:"none",cursor:"pointer",color:"#6b7280"},children:(0,i.jsx)(eQ.Z,{size:20})})]})]}),(0,i.jsx)("button",{onClick:a,style:{background:"none",border:"none",cursor:"pointer",color:"#6b7280"},children:(0,i.jsx)(el.Z,{size:24})})]}),(0,i.jsxs)("div",{style:{margin:"16px 0",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px"},children:[(0,i.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,i.jsx)(ne,{label:"Ausencias",value:e.ausencias}),(0,i.jsx)(ne,{label:"Tardanzas",value:e.tardanzas}),(0,i.jsx)(ne,{label:"Errores",value:e.errores}),(0,i.jsx)(ne,{label:"Puntos",value:e.puntos})]}),(0,i.jsxs)("div",{style:{textAlign:"right"},children:[(0,i.jsx)("div",{style:{fontSize:"12px",color:"#6b7280",marginBottom:"2px",fontWeight:500},children:"Estado General"}),(0,i.jsx)(t9,{level:t})]})]}),(0,i.jsxs)("div",{style:{flex:"1 1 auto",display:"grid",gridTemplateColumns:"280px 1fr",gap:"24px",overflow:"hidden",marginTop:"16px"},children:[(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:(0,i.jsx)(te,{month:f,days:b,selected:s,onSelect:l})}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,i.jsxs)("h3",{style:{fontSize:"1rem",fontWeight:600,margin:0,marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)("span",{children:["Eventos",s?" para ".concat((0,D.WU)(s,"d MMM",{locale:eD.es})):" del Mes"]}),s&&(0,i.jsx)("button",{onClick:()=>l(null),style:{fontSize:12,cursor:"pointer",background:"none",border:"none",color:"#2563eb",fontWeight:500},children:"Mostrar todo el mes"})]}),(0,i.jsx)("div",{style:{flex:"1 1 auto",overflowY:"auto",paddingRight:"8px"},children:(0,i.jsx)(Z.M,{mode:"wait",children:(0,i.jsx)(_.E.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.18,ease:"easeOut"},children:0===y.length?(0,i.jsx)("p",{style:{fontSize:"14px",color:"#6b7280",fontStyle:"italic",textAlign:"center",padding:"20px 0"},children:s?"No se registraron incidencias en este d\xeda.":"No se registraron incidencias con penalizaci\xf3n este mes."}):(0,i.jsx)("ul",{style:{listStyle:"none",padding:0,margin:0},children:y.map(e=>{var t;let n=null!==(t=eL[e.type])&&void 0!==t?t:eL.OTRO,r="",a="";if("VACACIONES"===e.type||"LICENCIA"===e.type){let t=M(e,p,u);if(t.start&&t.end&&t.returnDate){let n=(0,D.WU)(nt(t.start),"dd 'de' MMMM",{locale:eD.es}),i=(0,D.WU)(nt(t.end),"dd 'de' MMMM",{locale:eD.es}),o=(0,D.WU)(nt(t.returnDate),"dd 'de' MMMM",{locale:eD.es});r="".concat("VACACIONES"===e.type?"Vacaciones":"Licencia"," del ").concat(n," al ").concat(i),a="VACACIONES"===e.type?"".concat(t.dates.length," d\xedas laborables • Retorna ").concat(o):"".concat(t.dates.length," d\xedas naturales • Retorna ").concat(o)}}else r=e.startDate?(0,D.WU)(nt(e.startDate),"EEEE, dd 'de' MMMM",{locale:eD.es}):"Fecha no disponible";let o=B(e);return(0,i.jsxs)("li",{style:{borderBottom:"1px solid #f3f4f6",padding:"12px 4px",display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"14px"},children:[(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[(0,i.jsxs)("div",{style:{fontWeight:500,color:"#374151",display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[(0,i.jsx)("span",{style:{padding:"2px 8px",borderRadius:"6px",fontSize:"12px",fontWeight:600,backgroundColor:"danger"===n.variant?"hsl(0, 100%, 97%)":"warning"===n.variant?"hsl(45, 100%, 96%)":"hsl(220, 15%, 96%)",color:"danger"===n.variant?"hsl(0, 70%, 45%)":"warning"===n.variant?"hsl(45, 70%, 35%)":"hsl(220, 10%, 40%)"},children:n.label}),(0,i.jsx)("span",{style:{color:"#6b7280"},children:r})]}),a&&(0,i.jsx)("p",{style:{fontSize:"12px",color:"#059669",margin:"0",paddingLeft:"8px",fontWeight:500},children:a}),e.note&&(0,i.jsx)("p",{style:{fontSize:"12px",color:"#4b5563",fontStyle:"italic",margin:"0",paddingLeft:"8px",borderLeft:"2px solid #e5e7eb"},children:e.note})]}),(0,i.jsx)("span",{style:{fontWeight:700,fontSize:"16px",color:o>0?"#b91c1c":"#374151"},children:o>0?"-".concat(o):o})]},e.id)})})},(null==s?void 0:s.toISOString())||"month-view")})})]})]}),(0,i.jsx)("div",{style:{marginTop:"24px",textAlign:"right"},children:(0,i.jsx)("button",{onClick:a,style:{padding:"10px 20px",borderRadius:"8px",backgroundColor:"#e5e7eb",color:"#374151",border:"none",cursor:"pointer",fontWeight:600},children:"Cerrar"})})]})})()},"modal-content")})]})}function ni(e){let{activeShift:t,onClose:n,onSelect:r}=e,a={display:"flex",alignItems:"center",gap:"12px",width:"100%",padding:"16px",fontSize:"16px",border:"1px solid #e5e7eb",borderRadius:"8px",background:"#f9fafb",cursor:"pointer",textAlign:"left",marginBottom:"12px",transition:"background 0.2s, border-color 0.2s"},o={background:"#eff6ff",borderColor:"#93c5fd"},s={fontWeight:600};return(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:n,children:(0,i.jsxs)(_.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.15},style:{background:"white",padding:"24px",borderRadius:"12px",width:"420px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.1)"},onClick:e=>e.stopPropagation(),children:[(0,i.jsx)("h2",{style:{marginTop:0,marginBottom:"8px",fontSize:"18px"},children:"⚠️ Modificaci\xf3n de Turno Mixto"}),(0,i.jsxs)("p",{style:{color:"#6b7280",marginTop:0,marginBottom:"24px",lineHeight:1.5},children:["Este representante est\xe1 programado para ",(0,i.jsx)("b",{children:"D\xcdA y NOCHE"})," hoy.",(0,i.jsx)("br",{}),"Tu acci\xf3n afectar\xe1 su planificaci\xf3n. \xbfQu\xe9 deseas hacer?"]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("button",{style:a,onMouseEnter:e=>Object.assign(e.currentTarget.style,o),onMouseLeave:e=>Object.assign(e.currentTarget.style,a),onClick:()=>r({type:"NONE"}),children:[(0,i.jsx)(Q.Z,{size:20,color:"#ef4444"}),(0,i.jsx)("span",{style:s,children:"Libre todo el d\xeda"})]}),(0,i.jsxs)("button",{style:a,onMouseEnter:e=>Object.assign(e.currentTarget.style,o),onMouseLeave:e=>Object.assign(e.currentTarget.style,a),onClick:()=>r({type:"SINGLE",shift:"DAY"}),children:[(0,i.jsx)(J.Z,{size:20,color:"#f59e0b"}),(0,i.jsx)("span",{style:s,children:"Trabaja solo Turno D\xeda"})]}),(0,i.jsxs)("button",{style:a,onMouseEnter:e=>Object.assign(e.currentTarget.style,o),onMouseLeave:e=>Object.assign(e.currentTarget.style,a),onClick:()=>r({type:"SINGLE",shift:"NIGHT"}),children:[(0,i.jsx)(es.Z,{size:20,color:"#4f46e5"}),(0,i.jsx)("span",{style:s,children:"Trabaja solo Turno Noche"})]})]}),(0,i.jsx)("div",{style:{marginTop:"24px",textAlign:"right"},children:(0,i.jsx)("button",{onClick:n,style:{padding:"10px 20px",border:"none",borderRadius:"8px",background:"#e5e7eb",color:"#374151",cursor:"pointer",fontWeight:500},children:"Cancelar"})})]})})}function nr(){let{isLoading:e,confirmState:t,handleConfirm:n,representatives:a,incidents:o,detailModalState:s,closeDetailModal:l,mixedShiftConfirmModalState:d,handleMixedShiftConfirm:c,vacationConfirmationState:p,closeVacationConfirmation:x}=Y(e=>({isLoading:e.isLoading,confirmState:e.confirmState,handleConfirm:e.handleConfirm,representatives:e.representatives,incidents:e.incidents,detailModalState:e.detailModalState,closeDetailModal:e.closeDetailModal,mixedShiftConfirmModalState:e.mixedShiftConfirmModalState,handleMixedShiftConfirm:e.handleMixedShiftConfirm,vacationConfirmationState:e.vacationConfirmationState,closeVacationConfirmation:e.closeVacationConfirmation})),[u,f]=(0,r.useState)("PLANNING"),h=function(e){let{incidents:t,representatives:n}=Y(e=>({incidents:e.incidents,representatives:e.representatives}));return(0,r.useMemo)(()=>e&&t&&n?F(t,e,n):null,[t,e,n])}(s.month),g=e=>({padding:"12px 24px",cursor:"pointer",border:"none",borderBottom:e?"3px solid hsl(0, 0%, 13%)":"3px solid transparent",color:e?"hsl(0, 0%, 10%)":"#374151",fontWeight:e?600:500,background:e?"hsl(0, 0%, 97%)":"transparent",fontSize:"16px",marginRight:"8px",transition:"all 0.2s ease-in-out"});return e?(0,i.jsx)("div",{style:{padding:"40px",fontFamily:"sans-serif",color:"#555"},children:"Cargando estado de la aplicaci\xf3n..."}):(0,i.jsxs)("div",{style:{padding:"0 40px",fontFamily:"sans-serif",background:"#F8F9FA",minHeight:"100vh"},children:[(0,i.jsx)("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingTop:"20px",paddingBottom:"16px",marginBottom:"24px",borderBottom:"1px solid #e5e7eb"},children:(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{style:{color:"#1F2937",margin:0,fontSize:"18px",fontWeight:700,lineHeight:1.2},children:"Control Operativo"}),(0,i.jsx)("p",{style:{color:"#6b7280",margin:"4px 0 0",fontSize:"13px",fontWeight:400,opacity:.7},children:"Incidencias y Horarios"})]})}),(0,i.jsxs)("nav",{style:{borderBottom:"1px solid #e5e7eb",marginTop:"12px",background:"#FFFFFF"},children:[(0,i.jsx)("button",{style:g("PLANNING"===u),onClick:()=>f("PLANNING"),children:"Planificaci\xf3n Semanal"}),(0,i.jsx)("button",{style:g("DAILY_LOG"===u),onClick:()=>f("DAILY_LOG"),children:"Registro Diario"}),(0,i.jsx)("button",{style:g("STATS"===u),onClick:()=>f("STATS"),children:"Estad\xedsticas y Reportes"}),(0,i.jsx)("button",{style:g("SETTINGS"===u),onClick:()=>f("SETTINGS"),children:"Configuraci\xf3n"})]}),(0,i.jsxs)("main",{style:{paddingTop:"30px"},children:["DAILY_LOG"===u&&(0,i.jsx)(ti,{}),"PLANNING"===u&&(0,i.jsx)(eW,{}),"STATS"===u&&(0,i.jsx)(tL,{}),"SETTINGS"===u&&(0,i.jsx)(t4,{})]}),(0,i.jsx)("footer",{style:{marginTop:"40px",padding:"20px 0",borderTop:"1px solid #e5e7eb",color:"#9ca3af",fontSize:"12px",textAlign:"center"}}),t&&(0,i.jsx)(t8,{open:!!t,title:t.options.title,description:t.options.description,intent:t.options.intent,confirmLabel:t.options.confirmLabel,cancelLabel:t.options.cancelLabel,onConfirm:()=>n(!0),onCancel:()=>n(!1)}),(null==p?void 0:p.isOpen)&&(0,i.jsx)(t3,{isOpen:p.isOpen,repName:p.repName,startDate:p.startDate,endDate:p.endDate,returnDate:p.returnDate,workingDays:p.workingDays,onClose:x}),(0,i.jsx)(t7,{}),(null==d?void 0:d.isOpen)&&(0,i.jsx)(ni,{activeShift:d.activeShift,onClose:()=>c(null),onSelect:c}),(0,i.jsx)(Z.M,{children:s.isOpen&&s.personId&&h&&(0,i.jsx)(nn,{summary:h,personId:s.personId,onClose:l})})]})}function na(){return(0,i.jsx)(nr,{})}let no=e=>{let{representatives:t,incidents:n,calendar:i,coverageRules:r,swaps:a,specialSchedules:o,historyEvents:s,auditLog:l,version:d}=e;return{representatives:t,incidents:n,calendar:i,coverageRules:r,swaps:a,specialSchedules:o,historyEvents:s,auditLog:l,version:d}};function ns(){let{isLoading:e,initialize:t}=Y(e=>({isLoading:e.isLoading,initialize:e.initialize}));return((0,r.useEffect)(()=>{let e;t(),Y.subscribe(t=>{t.isLoading||(clearTimeout(e),e=window.setTimeout(()=>{C(no(t))},300))})},[t]),e)?(0,i.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",fontFamily:"sans-serif",fontSize:"1.2rem",color:"#6b7280"},children:"Cargando estado de la aplicaci\xf3n..."}):(0,i.jsx)(e_,{children:(0,i.jsx)(eo,{children:(0,i.jsx)(na,{})})})}}},function(e){e.O(0,[674,911,971,117,744],function(){return e(e.s=3652)}),_N_E=e.O()}]);